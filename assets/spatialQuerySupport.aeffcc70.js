import{_ as F}from"./index.8ac88fb7.js";import{cd as j,eX as x,cj as D,bO as J,t as w,f4 as V,f5 as B,ap as Z,eP as b,aK as p,r as z,aG as L,aH as G,f6 as k,f7 as $,aI as K,f8 as W,f9 as Y,fa as H,fb as X,au as I,c0 as N,at as R,cA as Q,fc as ee,e as d,bl as A,aC as te}from"./GISSearch.b73a2371.js";import{f as P,g as O}from"./projectionSupport.66acda0b.js";function ve(e,t){if(!e)return null;const n=t.featureAdapter,{startTimeField:r,endTimeField:i}=e;let s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(r&&i)t.forEach(l=>{const a=n.getAttribute(l,r),u=n.getAttribute(l,i);a==null||isNaN(a)||(s=Math.min(s,a)),u==null||isNaN(u)||(o=Math.max(o,u))});else{const l=r||i;t.forEach(a=>{const u=n.getAttribute(a,l);u==null||isNaN(u)||(s=Math.min(s,u),o=Math.max(o,u))})}return{start:s,end:o}}function we(e,t,n){if(!t||!e)return null;const{startTimeField:r,endTimeField:i}=e;if(!r&&!i)return null;const{start:s,end:o}=t;return s===null&&o===null?null:s===void 0&&o===void 0?ne():r&&i?re(n,r,i,s,o):ie(n,r||i,s,o)}function re(e,t,n,r,i){return r!=null&&i!=null?s=>{const o=e.getAttribute(s,t),l=e.getAttribute(s,n);return(o==null||o<=i)&&(l==null||l>=r)}:r!=null?s=>{const o=e.getAttribute(s,n);return o==null||o>=r}:i!=null?s=>{const o=e.getAttribute(s,t);return o==null||o<=i}:void 0}function ie(e,t,n,r){return n!=null&&r!=null&&n===r?i=>e.getAttribute(i,t)===n:n!=null&&r!=null?i=>{const s=e.getAttribute(i,t);return s>=n&&s<=r}:n!=null?i=>e.getAttribute(i,t)>=n:r!=null?i=>e.getAttribute(i,t)<=r:void 0}function ne(){return()=>!1}const se=new j({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),M=Object.freeze({}),E=new p,oe=new p,v=new p,g={esriGeometryPoint:$,esriGeometryPolyline:K,esriGeometryPolygon:W,esriGeometryMultipoint:Y};function Pe(e,t,n,r=e.hasZ,i=e.hasM){if(w(t))return null;const s=e.hasZ&&r,o=e.hasM&&i;if(n){const l=G(v,t,e.hasZ,e.hasM,"esriGeometryPoint",n,r,i);return $(l,s,o)}return $(t,s,o)}function y(e,t,n,r,i,s,o=t,l=n){const a=t&&o,u=n&&l,c=z(r)?"coords"in r?r:r.geometry:null;if(w(c))return null;if(i){let f=L(oe,c,t,n,e,i,o,l);return s&&(f=G(v,f,a,u,e,s)),g[e](f,a,u)}if(s){const f=G(v,c,t,n,e,s,o,l);return g[e](f,a,u)}return k(E,c,t,n,o,l),g[e](E,a,u)}async function _e(e,t,n){const{outFields:r,orderByFields:i,groupByFieldsForStatistics:s,outStatistics:o}=e;if(r)for(let l=0;l<r.length;l++)r[l]=r[l].trim();if(i)for(let l=0;l<i.length;l++)i[l]=i[l].trim();if(s)for(let l=0;l<s.length;l++)s[l]=s[l].trim();if(o)for(let l=0;l<o.length;l++)o[l].onStatisticField&&(o[l].onStatisticField=o[l].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),le(e,t,n)}async function le(e,t,n){if(!e)return null;let{where:r}=e;if(e.where=r=r&&r.trim(),(!r||/^1 *= *1$/.test(r)||t&&t===r)&&(e.where=null),!e.geometry)return e;let i=await ae(e);if(e.distance=0,e.units=null,e.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:a}=e.geometry;i=x(i),i.spatialReference=a}e.geometry=i,await P(i.spatialReference,n);const s=(await D(J(i)))[0];if(w(s))throw M;const o=s.toJSON(),l=await O(o,o.spatialReference,n);if(!l)throw M;return l.spatialReference=n,e.geometry=l,e}async function ae(e){const{geometry:t,distance:n,units:r}=e;if(n==null||"vertexAttributes"in t)return t;const i=t.spatialReference,s=r?se.fromJSON(r):V(i),o=i&&(B(i)||Z(i))?t:await P(i,b).then(()=>O(t,b));return(await ue())(o.spatialReference,o,n,s)}async function ue(){return(await F(()=>import("./geometryEngineJSON.1eda2436.js"),["assets/geometryEngineJSON.1eda2436.js","assets/geometryEngineBase.40db0853.js","assets/geometryEngineJSON.1865e318.js","assets/json.da51edc4.js"])).geodesicBuffer}function be(e){return e&&T in e?JSON.parse(JSON.stringify(e,ce)):e}const T="_geVersion",ce=(e,t)=>e!==T?t:void 0;function fe(e){return e==="mesh"?H:X(e)}function U(e,t){return e?t?4:3:t?3:2}function pe(e,t,n,r){return C(e,t,n,r.coords[0],r.coords[1])}function me(e,t,n,r,i,s){const o=U(i,s),{coords:l,lengths:a}=r;if(!a)return!1;for(let u=0,c=0;u<a.length;u++,c+=o)if(!C(e,t,n,l[c],l[c+1]))return!1;return!0}function C(e,t,n,r,i){if(!e)return!1;const s=U(t,n),{coords:o,lengths:l}=e;let a=!1,u=0;for(const c of l)a=ye(a,o,s,u,c,r,i),u+=c*s;return a}function ye(e,t,n,r,i,s,o){let l=e,a=r;for(let u=r,c=r+i*n;u<c;u+=n){a=u+n,a===c&&(a=r);const f=t[u],m=t[u+1],q=t[a],S=t[a+1];(m<o&&S>=o||S<o&&m>=o)&&f+(o-m)/(S-m)*(q-f)<s&&(l=!l)}return l}const h="feature-store:unsupported-query",Re={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},_={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};function Se(e){return _.spatialRelationship[e]===!0}function de(e){return _.queryGeometry[te(e)]===!0}function ge(e){return _.layerGeometry[e]===!0}function he(){return F(()=>import("./geometryEngineJSON.1eda2436.js"),["assets/geometryEngineJSON.1eda2436.js","assets/geometryEngineBase.40db0853.js","assets/geometryEngineJSON.1865e318.js","assets/json.da51edc4.js"])}function Ne(e,t,n,r,i){if(I(t)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains")){const s=N(new p,t,!1,!1);return Promise.resolve(o=>pe(s,!1,!1,o))}if(I(t)&&n==="esriGeometryMultipoint"){const s=N(new p,t,!1,!1);if(e==="esriSpatialRelContains")return Promise.resolve(o=>me(s,!1,!1,o,r,i))}if(R(t)&&n==="esriGeometryPoint"&&(e==="esriSpatialRelIntersects"||e==="esriSpatialRelContains"))return Promise.resolve(s=>Q(t,y(n,r,i,s)));if(R(t)&&n==="esriGeometryMultipoint"&&e==="esriSpatialRelContains")return Promise.resolve(s=>ee(t,y(n,r,i,s)));if(R(t)&&e==="esriSpatialRelIntersects"){const s=fe(n);return Promise.resolve(o=>s(t,y(n,r,i,o)))}return he().then(s=>{const o=s[Re[e]].bind(null,t.spatialReference,t);return l=>o(y(n,r,i,l))})}async function Ae(e,t,n){const{spatialRel:r,geometry:i}=e;if(i){if(!Se(r))throw new d(h,"Unsupported query spatial relationship",{query:e});if(A(i.spatialReference)&&A(n)){if(!de(i))throw new d(h,"Unsupported query geometry type",{query:e});if(!ge(t))throw new d(h,"Unsupported layer geometry type",{query:e});if(e.outSR)return P(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function Me(e){if(R(e))return!0;if(I(e)){for(const t of e.rings)if(t.length!==5||t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1;return!0}return!1}export{Me as I,y as J,Pe as O,_e as P,M as U,le as Z,Ae as a,we as n,ve as t,Ne as v,be as z};
