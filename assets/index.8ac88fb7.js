var uF=Object.defineProperty,hF=Object.defineProperties;var dF=Object.getOwnPropertyDescriptors;var ZI=Object.getOwnPropertySymbols;var fF=Object.prototype.hasOwnProperty,pF=Object.prototype.propertyIsEnumerable;var XI=(t,e,i)=>e in t?uF(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,gi=(t,e)=>{for(var i in e||(e={}))fF.call(e,i)&&XI(t,i,e[i]);if(ZI)for(var i of ZI(e))pF.call(e,i)&&XI(t,i,e[i]);return t},hg=(t,e)=>hF(t,dF(e));const mF=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const f of c)if(f.type==="childList")for(const y of f.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&r(y)}).observe(document,{childList:!0,subtree:!0});function i(c){const f={};return c.integrity&&(f.integrity=c.integrity),c.referrerpolicy&&(f.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?f.credentials="include":c.crossorigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function r(c){if(c.ep)return;c.ep=!0;const f=i(c);fetch(c.href,f)}};mF();var $r="top",bs="bottom",ws="right",jr="left",By="auto",hd=[$r,bs,ws,jr],Wc="start",$h="end",KM="clippingParents",Ew="viewport",wh="popper",ZM="reference",sb=hd.reduce(function(t,e){return t.concat([e+"-"+Wc,e+"-"+$h])},[]),Tw=[].concat(hd,[By]).reduce(function(t,e){return t.concat([e,e+"-"+Wc,e+"-"+$h])},[]),XM="beforeRead",YM="read",JM="afterRead",QM="beforeMain",e2="main",t2="afterMain",i2="beforeWrite",n2="write",r2="afterWrite",s2=[XM,YM,JM,QM,e2,t2,i2,n2,r2];function Go(t){return t?(t.nodeName||"").toLowerCase():null}function uo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function jh(t){var e=uo(t).Element;return t instanceof e||t instanceof Element}function zs(t){var e=uo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function Iw(t){if(typeof ShadowRoot=="undefined")return!1;var e=uo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function _F(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},c=e.attributes[i]||{},f=e.elements[i];!zs(f)||!Go(f)||(Object.assign(f.style,r),Object.keys(c).forEach(function(y){var l=c[y];l===!1?f.removeAttribute(y):f.setAttribute(y,l===!0?"":l)}))})}function gF(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var c=e.elements[r],f=e.attributes[r]||{},y=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),l=y.reduce(function(I,C){return I[C]="",I},{});!zs(c)||!Go(c)||(Object.assign(c.style,l),Object.keys(f).forEach(function(I){c.removeAttribute(I)}))})}}var Sw={name:"applyStyles",enabled:!0,phase:"write",fn:_F,effect:gF,requires:["computeStyles"]};function Uo(t){return t.split("-")[0]}var Fc=Math.max,Wg=Math.min,Gh=Math.round;function qh(t,e){e===void 0&&(e=!1);var i=t.getBoundingClientRect(),r=1,c=1;if(zs(t)&&e){var f=t.offsetHeight,y=t.offsetWidth;y>0&&(r=Gh(i.width)/y||1),f>0&&(c=Gh(i.height)/f||1)}return{width:i.width/r,height:i.height/c,top:i.top/c,right:i.right/r,bottom:i.bottom/c,left:i.left/r,x:i.left/r,y:i.top/c}}function Aw(t){var e=qh(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function o2(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&Iw(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Aa(t){return uo(t).getComputedStyle(t)}function yF(t){return["table","td","th"].indexOf(Go(t))>=0}function Rl(t){return((jh(t)?t.ownerDocument:t.document)||window.document).documentElement}function Uy(t){return Go(t)==="html"?t:t.assignedSlot||t.parentNode||(Iw(t)?t.host:null)||Rl(t)}function YI(t){return!zs(t)||Aa(t).position==="fixed"?null:t.offsetParent}function vF(t){var e=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1,i=navigator.userAgent.indexOf("Trident")!==-1;if(i&&zs(t)){var r=Aa(t);if(r.position==="fixed")return null}var c=Uy(t);for(Iw(c)&&(c=c.host);zs(c)&&["html","body"].indexOf(Go(c))<0;){var f=Aa(c);if(f.transform!=="none"||f.perspective!=="none"||f.contain==="paint"||["transform","perspective"].indexOf(f.willChange)!==-1||e&&f.willChange==="filter"||e&&f.filter&&f.filter!=="none")return c;c=c.parentNode}return null}function cm(t){for(var e=uo(t),i=YI(t);i&&yF(i)&&Aa(i).position==="static";)i=YI(i);return i&&(Go(i)==="html"||Go(i)==="body"&&Aa(i).position==="static")?e:i||vF(t)||e}function Cw(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function yp(t,e,i){return Fc(t,Wg(e,i))}function xF(t,e,i){var r=yp(t,e,i);return r>i?i:r}function a2(){return{top:0,right:0,bottom:0,left:0}}function l2(t){return Object.assign({},a2(),t)}function c2(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var bF=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,l2(typeof e!="number"?e:c2(e,hd))};function wF(t){var e,i=t.state,r=t.name,c=t.options,f=i.elements.arrow,y=i.modifiersData.popperOffsets,l=Uo(i.placement),I=Cw(l),C=[jr,ws].indexOf(l)>=0,L=C?"height":"width";if(!(!f||!y)){var R=bF(c.padding,i),$=Aw(f),J=I==="y"?$r:jr,pe=I==="y"?bs:ws,Re=i.rects.reference[L]+i.rects.reference[I]-y[I]-i.rects.popper[L],we=y[I]-i.rects.reference[I],Be=cm(f),nt=Be?I==="y"?Be.clientHeight||0:Be.clientWidth||0:0,yt=Re/2-we/2,lt=R[J],zt=nt-$[L]-R[pe],rt=nt/2-$[L]/2+yt,Wt=yp(lt,rt,zt),hi=I;i.modifiersData[r]=(e={},e[hi]=Wt,e.centerOffset=Wt-rt,e)}}function EF(t){var e=t.state,i=t.options,r=i.element,c=r===void 0?"[data-popper-arrow]":r;c!=null&&(typeof c=="string"&&(c=e.elements.popper.querySelector(c),!c)||!o2(e.elements.popper,c)||(e.elements.arrow=c))}var u2={name:"arrow",enabled:!0,phase:"main",fn:wF,effect:EF,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Wh(t){return t.split("-")[1]}var TF={top:"auto",right:"auto",bottom:"auto",left:"auto"};function IF(t){var e=t.x,i=t.y,r=window,c=r.devicePixelRatio||1;return{x:Gh(e*c)/c||0,y:Gh(i*c)/c||0}}function JI(t){var e,i=t.popper,r=t.popperRect,c=t.placement,f=t.variation,y=t.offsets,l=t.position,I=t.gpuAcceleration,C=t.adaptive,L=t.roundOffsets,R=t.isFixed,$=y.x,J=$===void 0?0:$,pe=y.y,Re=pe===void 0?0:pe,we=typeof L=="function"?L({x:J,y:Re}):{x:J,y:Re};J=we.x,Re=we.y;var Be=y.hasOwnProperty("x"),nt=y.hasOwnProperty("y"),yt=jr,lt=$r,zt=window;if(C){var rt=cm(i),Wt="clientHeight",hi="clientWidth";if(rt===uo(i)&&(rt=Rl(i),Aa(rt).position!=="static"&&l==="absolute"&&(Wt="scrollHeight",hi="scrollWidth")),rt=rt,c===$r||(c===jr||c===ws)&&f===$h){lt=bs;var _i=R&&rt===zt&&zt.visualViewport?zt.visualViewport.height:rt[Wt];Re-=_i-r.height,Re*=I?1:-1}if(c===jr||(c===$r||c===bs)&&f===$h){yt=ws;var Ci=R&&rt===zt&&zt.visualViewport?zt.visualViewport.width:rt[hi];J-=Ci-r.width,J*=I?1:-1}}var Ht=Object.assign({position:l},C&&TF),$i=L===!0?IF({x:J,y:Re}):{x:J,y:Re};if(J=$i.x,Re=$i.y,I){var Xi;return Object.assign({},Ht,(Xi={},Xi[lt]=nt?"0":"",Xi[yt]=Be?"0":"",Xi.transform=(zt.devicePixelRatio||1)<=1?"translate("+J+"px, "+Re+"px)":"translate3d("+J+"px, "+Re+"px, 0)",Xi))}return Object.assign({},Ht,(e={},e[lt]=nt?Re+"px":"",e[yt]=Be?J+"px":"",e.transform="",e))}function SF(t){var e=t.state,i=t.options,r=i.gpuAcceleration,c=r===void 0?!0:r,f=i.adaptive,y=f===void 0?!0:f,l=i.roundOffsets,I=l===void 0?!0:l,C={placement:Uo(e.placement),variation:Wh(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:c,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,JI(Object.assign({},C,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:y,roundOffsets:I})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,JI(Object.assign({},C,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:I})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var Mw={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:SF,data:{}},dg={passive:!0};function AF(t){var e=t.state,i=t.instance,r=t.options,c=r.scroll,f=c===void 0?!0:c,y=r.resize,l=y===void 0?!0:y,I=uo(e.elements.popper),C=[].concat(e.scrollParents.reference,e.scrollParents.popper);return f&&C.forEach(function(L){L.addEventListener("scroll",i.update,dg)}),l&&I.addEventListener("resize",i.update,dg),function(){f&&C.forEach(function(L){L.removeEventListener("scroll",i.update,dg)}),l&&I.removeEventListener("resize",i.update,dg)}}var kw={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:AF,data:{}},CF={left:"right",right:"left",bottom:"top",top:"bottom"};function Mg(t){return t.replace(/left|right|bottom|top/g,function(e){return CF[e]})}var MF={start:"end",end:"start"};function QI(t){return t.replace(/start|end/g,function(e){return MF[e]})}function Dw(t){var e=uo(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function Pw(t){return qh(Rl(t)).left+Dw(t).scrollLeft}function kF(t){var e=uo(t),i=Rl(t),r=e.visualViewport,c=i.clientWidth,f=i.clientHeight,y=0,l=0;return r&&(c=r.width,f=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(y=r.offsetLeft,l=r.offsetTop)),{width:c,height:f,x:y+Pw(t),y:l}}function DF(t){var e,i=Rl(t),r=Dw(t),c=(e=t.ownerDocument)==null?void 0:e.body,f=Fc(i.scrollWidth,i.clientWidth,c?c.scrollWidth:0,c?c.clientWidth:0),y=Fc(i.scrollHeight,i.clientHeight,c?c.scrollHeight:0,c?c.clientHeight:0),l=-r.scrollLeft+Pw(t),I=-r.scrollTop;return Aa(c||i).direction==="rtl"&&(l+=Fc(i.clientWidth,c?c.clientWidth:0)-f),{width:f,height:y,x:l,y:I}}function Rw(t){var e=Aa(t),i=e.overflow,r=e.overflowX,c=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+c+r)}function h2(t){return["html","body","#document"].indexOf(Go(t))>=0?t.ownerDocument.body:zs(t)&&Rw(t)?t:h2(Uy(t))}function vp(t,e){var i;e===void 0&&(e=[]);var r=h2(t),c=r===((i=t.ownerDocument)==null?void 0:i.body),f=uo(r),y=c?[f].concat(f.visualViewport||[],Rw(r)?r:[]):r,l=e.concat(y);return c?l:l.concat(vp(Uy(y)))}function ob(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function PF(t){var e=qh(t);return e.top=e.top+t.clientTop,e.left=e.left+t.clientLeft,e.bottom=e.top+t.clientHeight,e.right=e.left+t.clientWidth,e.width=t.clientWidth,e.height=t.clientHeight,e.x=e.left,e.y=e.top,e}function eS(t,e){return e===Ew?ob(kF(t)):jh(e)?PF(e):ob(DF(Rl(t)))}function RF(t){var e=vp(Uy(t)),i=["absolute","fixed"].indexOf(Aa(t).position)>=0,r=i&&zs(t)?cm(t):t;return jh(r)?e.filter(function(c){return jh(c)&&o2(c,r)&&Go(c)!=="body"}):[]}function LF(t,e,i){var r=e==="clippingParents"?RF(t):[].concat(e),c=[].concat(r,[i]),f=c[0],y=c.reduce(function(l,I){var C=eS(t,I);return l.top=Fc(C.top,l.top),l.right=Wg(C.right,l.right),l.bottom=Wg(C.bottom,l.bottom),l.left=Fc(C.left,l.left),l},eS(t,f));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function d2(t){var e=t.reference,i=t.element,r=t.placement,c=r?Uo(r):null,f=r?Wh(r):null,y=e.x+e.width/2-i.width/2,l=e.y+e.height/2-i.height/2,I;switch(c){case $r:I={x:y,y:e.y-i.height};break;case bs:I={x:y,y:e.y+e.height};break;case ws:I={x:e.x+e.width,y:l};break;case jr:I={x:e.x-i.width,y:l};break;default:I={x:e.x,y:e.y}}var C=c?Cw(c):null;if(C!=null){var L=C==="y"?"height":"width";switch(f){case Wc:I[C]=I[C]-(e[L]/2-i[L]/2);break;case $h:I[C]=I[C]+(e[L]/2-i[L]/2);break}}return I}function Hh(t,e){e===void 0&&(e={});var i=e,r=i.placement,c=r===void 0?t.placement:r,f=i.boundary,y=f===void 0?KM:f,l=i.rootBoundary,I=l===void 0?Ew:l,C=i.elementContext,L=C===void 0?wh:C,R=i.altBoundary,$=R===void 0?!1:R,J=i.padding,pe=J===void 0?0:J,Re=l2(typeof pe!="number"?pe:c2(pe,hd)),we=L===wh?ZM:wh,Be=t.rects.popper,nt=t.elements[$?we:L],yt=LF(jh(nt)?nt:nt.contextElement||Rl(t.elements.popper),y,I),lt=qh(t.elements.reference),zt=d2({reference:lt,element:Be,strategy:"absolute",placement:c}),rt=ob(Object.assign({},Be,zt)),Wt=L===wh?rt:lt,hi={top:yt.top-Wt.top+Re.top,bottom:Wt.bottom-yt.bottom+Re.bottom,left:yt.left-Wt.left+Re.left,right:Wt.right-yt.right+Re.right},_i=t.modifiersData.offset;if(L===wh&&_i){var Ci=_i[c];Object.keys(hi).forEach(function(Ht){var $i=[ws,bs].indexOf(Ht)>=0?1:-1,Xi=[$r,bs].indexOf(Ht)>=0?"y":"x";hi[Ht]+=Ci[Xi]*$i})}return hi}function OF(t,e){e===void 0&&(e={});var i=e,r=i.placement,c=i.boundary,f=i.rootBoundary,y=i.padding,l=i.flipVariations,I=i.allowedAutoPlacements,C=I===void 0?Tw:I,L=Wh(r),R=L?l?sb:sb.filter(function(pe){return Wh(pe)===L}):hd,$=R.filter(function(pe){return C.indexOf(pe)>=0});$.length===0&&($=R);var J=$.reduce(function(pe,Re){return pe[Re]=Hh(t,{placement:Re,boundary:c,rootBoundary:f,padding:y})[Uo(Re)],pe},{});return Object.keys(J).sort(function(pe,Re){return J[pe]-J[Re]})}function zF(t){if(Uo(t)===By)return[];var e=Mg(t);return[QI(t),e,QI(e)]}function NF(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var c=i.mainAxis,f=c===void 0?!0:c,y=i.altAxis,l=y===void 0?!0:y,I=i.fallbackPlacements,C=i.padding,L=i.boundary,R=i.rootBoundary,$=i.altBoundary,J=i.flipVariations,pe=J===void 0?!0:J,Re=i.allowedAutoPlacements,we=e.options.placement,Be=Uo(we),nt=Be===we,yt=I||(nt||!pe?[Mg(we)]:zF(we)),lt=[we].concat(yt).reduce(function(Yi,ze){return Yi.concat(Uo(ze)===By?OF(e,{placement:ze,boundary:L,rootBoundary:R,padding:C,flipVariations:pe,allowedAutoPlacements:Re}):ze)},[]),zt=e.rects.reference,rt=e.rects.popper,Wt=new Map,hi=!0,_i=lt[0],Ci=0;Ci<lt.length;Ci++){var Ht=lt[Ci],$i=Uo(Ht),Xi=Wh(Ht)===Wc,Nn=[$r,bs].indexOf($i)>=0,Fn=Nn?"width":"height",si=Hh(e,{placement:Ht,boundary:L,rootBoundary:R,altBoundary:$,padding:C}),Zt=Nn?Xi?ws:jr:Xi?bs:$r;zt[Fn]>rt[Fn]&&(Zt=Mg(Zt));var Qt=Mg(Zt),Ui=[];if(f&&Ui.push(si[$i]<=0),l&&Ui.push(si[Zt]<=0,si[Qt]<=0),Ui.every(function(Yi){return Yi})){_i=Ht,hi=!1;break}Wt.set(Ht,Ui)}if(hi)for(var Bn=pe?3:1,Ji=function(ze){var _t=lt.find(function(tt){var bt=Wt.get(tt);if(bt)return bt.slice(0,ze).every(function(yi){return yi})});if(_t)return _i=_t,"break"},vn=Bn;vn>0;vn--){var Kt=Ji(vn);if(Kt==="break")break}e.placement!==_i&&(e.modifiersData[r]._skip=!0,e.placement=_i,e.reset=!0)}}var f2={name:"flip",enabled:!0,phase:"main",fn:NF,requiresIfExists:["offset"],data:{_skip:!1}};function tS(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function iS(t){return[$r,ws,bs,jr].some(function(e){return t[e]>=0})}function FF(t){var e=t.state,i=t.name,r=e.rects.reference,c=e.rects.popper,f=e.modifiersData.preventOverflow,y=Hh(e,{elementContext:"reference"}),l=Hh(e,{altBoundary:!0}),I=tS(y,r),C=tS(l,c,f),L=iS(I),R=iS(C);e.modifiersData[i]={referenceClippingOffsets:I,popperEscapeOffsets:C,isReferenceHidden:L,hasPopperEscaped:R},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":L,"data-popper-escaped":R})}var p2={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:FF};function BF(t,e,i){var r=Uo(t),c=[jr,$r].indexOf(r)>=0?-1:1,f=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,y=f[0],l=f[1];return y=y||0,l=(l||0)*c,[jr,ws].indexOf(r)>=0?{x:l,y}:{x:y,y:l}}function UF(t){var e=t.state,i=t.options,r=t.name,c=i.offset,f=c===void 0?[0,0]:c,y=Tw.reduce(function(L,R){return L[R]=BF(R,e.rects,f),L},{}),l=y[e.placement],I=l.x,C=l.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=I,e.modifiersData.popperOffsets.y+=C),e.modifiersData[r]=y}var m2={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:UF};function VF(t){var e=t.state,i=t.name;e.modifiersData[i]=d2({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var Lw={name:"popperOffsets",enabled:!0,phase:"read",fn:VF,data:{}};function $F(t){return t==="x"?"y":"x"}function jF(t){var e=t.state,i=t.options,r=t.name,c=i.mainAxis,f=c===void 0?!0:c,y=i.altAxis,l=y===void 0?!1:y,I=i.boundary,C=i.rootBoundary,L=i.altBoundary,R=i.padding,$=i.tether,J=$===void 0?!0:$,pe=i.tetherOffset,Re=pe===void 0?0:pe,we=Hh(e,{boundary:I,rootBoundary:C,padding:R,altBoundary:L}),Be=Uo(e.placement),nt=Wh(e.placement),yt=!nt,lt=Cw(Be),zt=$F(lt),rt=e.modifiersData.popperOffsets,Wt=e.rects.reference,hi=e.rects.popper,_i=typeof Re=="function"?Re(Object.assign({},e.rects,{placement:e.placement})):Re,Ci=typeof _i=="number"?{mainAxis:_i,altAxis:_i}:Object.assign({mainAxis:0,altAxis:0},_i),Ht=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,$i={x:0,y:0};if(!!rt){if(f){var Xi,Nn=lt==="y"?$r:jr,Fn=lt==="y"?bs:ws,si=lt==="y"?"height":"width",Zt=rt[lt],Qt=Zt+we[Nn],Ui=Zt-we[Fn],Bn=J?-hi[si]/2:0,Ji=nt===Wc?Wt[si]:hi[si],vn=nt===Wc?-hi[si]:-Wt[si],Kt=e.elements.arrow,Yi=J&&Kt?Aw(Kt):{width:0,height:0},ze=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:a2(),_t=ze[Nn],tt=ze[Fn],bt=yp(0,Wt[si],Yi[si]),yi=yt?Wt[si]/2-Bn-bt-_t-Ci.mainAxis:Ji-bt-_t-Ci.mainAxis,xi=yt?-Wt[si]/2+Bn+bt+tt+Ci.mainAxis:vn+bt+tt+Ci.mainAxis,Ut=e.elements.arrow&&cm(e.elements.arrow),ct=Ut?lt==="y"?Ut.clientTop||0:Ut.clientLeft||0:0,se=(Xi=Ht==null?void 0:Ht[lt])!=null?Xi:0,me=Zt+yi-se-ct,Ie=Zt+xi-se,Ue=yp(J?Wg(Qt,me):Qt,Zt,J?Fc(Ui,Ie):Ui);rt[lt]=Ue,$i[lt]=Ue-Zt}if(l){var De,Ye=lt==="x"?$r:jr,ut=lt==="x"?bs:ws,je=rt[zt],Je=zt==="y"?"height":"width",qe=je+we[Ye],Pt=je-we[ut],wt=[$r,jr].indexOf(Be)!==-1,Ct=(De=Ht==null?void 0:Ht[zt])!=null?De:0,Rt=wt?qe:je-Wt[Je]-hi[Je]-Ct+Ci.altAxis,Yt=wt?je+Wt[Je]+hi[Je]-Ct-Ci.altAxis:Pt,di=J&&wt?xF(Rt,je,Yt):yp(J?Rt:qe,je,J?Yt:Pt);rt[zt]=di,$i[zt]=di-je}e.modifiersData[r]=$i}}var _2={name:"preventOverflow",enabled:!0,phase:"main",fn:jF,requiresIfExists:["offset"]};function GF(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function qF(t){return t===uo(t)||!zs(t)?Dw(t):GF(t)}function WF(t){var e=t.getBoundingClientRect(),i=Gh(e.width)/t.offsetWidth||1,r=Gh(e.height)/t.offsetHeight||1;return i!==1||r!==1}function HF(t,e,i){i===void 0&&(i=!1);var r=zs(e),c=zs(e)&&WF(e),f=Rl(e),y=qh(t,c),l={scrollLeft:0,scrollTop:0},I={x:0,y:0};return(r||!r&&!i)&&((Go(e)!=="body"||Rw(f))&&(l=qF(e)),zs(e)?(I=qh(e,!0),I.x+=e.clientLeft,I.y+=e.clientTop):f&&(I.x=Pw(f))),{x:y.left+l.scrollLeft-I.x,y:y.top+l.scrollTop-I.y,width:y.width,height:y.height}}function KF(t){var e=new Map,i=new Set,r=[];t.forEach(function(f){e.set(f.name,f)});function c(f){i.add(f.name);var y=[].concat(f.requires||[],f.requiresIfExists||[]);y.forEach(function(l){if(!i.has(l)){var I=e.get(l);I&&c(I)}}),r.push(f)}return t.forEach(function(f){i.has(f.name)||c(f)}),r}function ZF(t){var e=KF(t);return s2.reduce(function(i,r){return i.concat(e.filter(function(c){return c.phase===r}))},[])}function XF(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function YF(t){var e=t.reduce(function(i,r){var c=i[r.name];return i[r.name]=c?Object.assign({},c,r,{options:Object.assign({},c.options,r.options),data:Object.assign({},c.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var nS={placement:"bottom",modifiers:[],strategy:"absolute"};function rS(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function Vy(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,c=e.defaultOptions,f=c===void 0?nS:c;return function(l,I,C){C===void 0&&(C=f);var L={placement:"bottom",orderedModifiers:[],options:Object.assign({},nS,f),modifiersData:{},elements:{reference:l,popper:I},attributes:{},styles:{}},R=[],$=!1,J={state:L,setOptions:function(Be){var nt=typeof Be=="function"?Be(L.options):Be;Re(),L.options=Object.assign({},f,L.options,nt),L.scrollParents={reference:jh(l)?vp(l):l.contextElement?vp(l.contextElement):[],popper:vp(I)};var yt=ZF(YF([].concat(r,L.options.modifiers)));return L.orderedModifiers=yt.filter(function(lt){return lt.enabled}),pe(),J.update()},forceUpdate:function(){if(!$){var Be=L.elements,nt=Be.reference,yt=Be.popper;if(!!rS(nt,yt)){L.rects={reference:HF(nt,cm(yt),L.options.strategy==="fixed"),popper:Aw(yt)},L.reset=!1,L.placement=L.options.placement,L.orderedModifiers.forEach(function(Ci){return L.modifiersData[Ci.name]=Object.assign({},Ci.data)});for(var lt=0;lt<L.orderedModifiers.length;lt++){if(L.reset===!0){L.reset=!1,lt=-1;continue}var zt=L.orderedModifiers[lt],rt=zt.fn,Wt=zt.options,hi=Wt===void 0?{}:Wt,_i=zt.name;typeof rt=="function"&&(L=rt({state:L,options:hi,name:_i,instance:J})||L)}}}},update:XF(function(){return new Promise(function(we){J.forceUpdate(),we(L)})}),destroy:function(){Re(),$=!0}};if(!rS(l,I))return J;J.setOptions(C).then(function(we){!$&&C.onFirstUpdate&&C.onFirstUpdate(we)});function pe(){L.orderedModifiers.forEach(function(we){var Be=we.name,nt=we.options,yt=nt===void 0?{}:nt,lt=we.effect;if(typeof lt=="function"){var zt=lt({state:L,name:Be,instance:J,options:yt}),rt=function(){};R.push(zt||rt)}})}function Re(){R.forEach(function(we){return we()}),R=[]}return J}}var JF=Vy(),QF=[kw,Lw,Mw,Sw],eB=Vy({defaultModifiers:QF}),tB=[kw,Lw,Mw,Sw,m2,f2,_2,u2,p2],Ow=Vy({defaultModifiers:tB}),g2=Object.freeze(Object.defineProperty({__proto__:null,popperGenerator:Vy,detectOverflow:Hh,createPopperBase:JF,createPopper:Ow,createPopperLite:eB,top:$r,bottom:bs,right:ws,left:jr,auto:By,basePlacements:hd,start:Wc,end:$h,clippingParents:KM,viewport:Ew,popper:wh,reference:ZM,variationPlacements:sb,placements:Tw,beforeRead:XM,read:YM,afterRead:JM,beforeMain:QM,main:e2,afterMain:t2,beforeWrite:i2,write:n2,afterWrite:r2,modifierPhases:s2,applyStyles:Sw,arrow:u2,computeStyles:Mw,eventListeners:kw,flip:f2,hide:p2,offset:m2,popperOffsets:Lw,preventOverflow:_2},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.1.3 (https://getbootstrap.com/)
  * Copyright 2011-2021 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const iB=1e6,nB=1e3,ab="transitionend",rB=t=>t==null?`${t}`:{}.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase(),sB=t=>{do t+=Math.floor(Math.random()*iB);while(document.getElementById(t));return t},y2=t=>{let e=t.getAttribute("data-bs-target");if(!e||e==="#"){let i=t.getAttribute("href");if(!i||!i.includes("#")&&!i.startsWith("."))return null;i.includes("#")&&!i.startsWith("#")&&(i=`#${i.split("#")[1]}`),e=i&&i!=="#"?i.trim():null}return e},zw=t=>{const e=y2(t);return e&&document.querySelector(e)?e:null},Sl=t=>{const e=y2(t);return e?document.querySelector(e):null},oB=t=>{if(!t)return 0;let{transitionDuration:e,transitionDelay:i}=window.getComputedStyle(t);const r=Number.parseFloat(e),c=Number.parseFloat(i);return!r&&!c?0:(e=e.split(",")[0],i=i.split(",")[0],(Number.parseFloat(e)+Number.parseFloat(i))*nB)},v2=t=>{t.dispatchEvent(new Event(ab))},Hc=t=>!t||typeof t!="object"?!1:(typeof t.jquery!="undefined"&&(t=t[0]),typeof t.nodeType!="undefined"),Al=t=>Hc(t)?t.jquery?t[0]:t:typeof t=="string"&&t.length>0?document.querySelector(t):null,Ho=(t,e,i)=>{Object.keys(i).forEach(r=>{const c=i[r],f=e[r],y=f&&Hc(f)?"element":rB(f);if(!new RegExp(c).test(y))throw new TypeError(`${t.toUpperCase()}: Option "${r}" provided type "${y}" but expected type "${c}".`)})},um=t=>!Hc(t)||t.getClientRects().length===0?!1:getComputedStyle(t).getPropertyValue("visibility")==="visible",Bc=t=>!t||t.nodeType!==Node.ELEMENT_NODE||t.classList.contains("disabled")?!0:typeof t.disabled!="undefined"?t.disabled:t.hasAttribute("disabled")&&t.getAttribute("disabled")!=="false",x2=t=>{if(!document.documentElement.attachShadow)return null;if(typeof t.getRootNode=="function"){const e=t.getRootNode();return e instanceof ShadowRoot?e:null}return t instanceof ShadowRoot?t:t.parentNode?x2(t.parentNode):null},Hg=()=>{},dd=t=>{t.offsetHeight},b2=()=>{const{jQuery:t}=window;return t&&!document.body.hasAttribute("data-bs-no-jquery")?t:null},_0=[],aB=t=>{document.readyState==="loading"?(_0.length||document.addEventListener("DOMContentLoaded",()=>{_0.forEach(e=>e())}),_0.push(t)):t()},os=()=>document.documentElement.dir==="rtl",Us=t=>{aB(()=>{const e=b2();if(e){const i=t.NAME,r=e.fn[i];e.fn[i]=t.jQueryInterface,e.fn[i].Constructor=t,e.fn[i].noConflict=()=>(e.fn[i]=r,t.jQueryInterface)}})},Cc=t=>{typeof t=="function"&&t()},w2=(t,e,i=!0)=>{if(!i){Cc(t);return}const r=5,c=oB(e)+r;let f=!1;const y=({target:l})=>{l===e&&(f=!0,e.removeEventListener(ab,y),Cc(t))};e.addEventListener(ab,y),setTimeout(()=>{f||v2(e)},c)},E2=(t,e,i,r)=>{let c=t.indexOf(e);if(c===-1)return t[!i&&r?t.length-1:0];const f=t.length;return c+=i?1:-1,r&&(c=(c+f)%f),t[Math.max(0,Math.min(c,f-1))]},lB=/[^.]*(?=\..*)\.|.*/,cB=/\..*/,uB=/::\d+$/,g0={};let sS=1;const hB={mouseenter:"mouseover",mouseleave:"mouseout"},dB=/^(mouseenter|mouseleave)/i,T2=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function I2(t,e){return e&&`${e}::${sS++}`||t.uidEvent||sS++}function S2(t){const e=I2(t);return t.uidEvent=e,g0[e]=g0[e]||{},g0[e]}function fB(t,e){return function i(r){return r.delegateTarget=t,i.oneOff&&Xe.off(t,r.type,e),e.apply(t,[r])}}function pB(t,e,i){return function r(c){const f=t.querySelectorAll(e);for(let{target:y}=c;y&&y!==this;y=y.parentNode)for(let l=f.length;l--;)if(f[l]===y)return c.delegateTarget=y,r.oneOff&&Xe.off(t,c.type,e,i),i.apply(y,[c]);return null}}function A2(t,e,i=null){const r=Object.keys(t);for(let c=0,f=r.length;c<f;c++){const y=t[r[c]];if(y.originalHandler===e&&y.delegationSelector===i)return y}return null}function C2(t,e,i){const r=typeof e=="string",c=r?i:e;let f=M2(t);return T2.has(f)||(f=t),[r,c,f]}function oS(t,e,i,r,c){if(typeof e!="string"||!t)return;if(i||(i=r,r=null),dB.test(e)){const J=pe=>function(Re){if(!Re.relatedTarget||Re.relatedTarget!==Re.delegateTarget&&!Re.delegateTarget.contains(Re.relatedTarget))return pe.call(this,Re)};r?r=J(r):i=J(i)}const[f,y,l]=C2(e,i,r),I=S2(t),C=I[l]||(I[l]={}),L=A2(C,y,f?i:null);if(L){L.oneOff=L.oneOff&&c;return}const R=I2(y,e.replace(lB,"")),$=f?pB(t,i,r):fB(t,i);$.delegationSelector=f?i:null,$.originalHandler=y,$.oneOff=c,$.uidEvent=R,C[R]=$,t.addEventListener(l,$,f)}function lb(t,e,i,r,c){const f=A2(e[i],r,c);!f||(t.removeEventListener(i,f,Boolean(c)),delete e[i][f.uidEvent])}function mB(t,e,i,r){const c=e[i]||{};Object.keys(c).forEach(f=>{if(f.includes(r)){const y=c[f];lb(t,e,i,y.originalHandler,y.delegationSelector)}})}function M2(t){return t=t.replace(cB,""),hB[t]||t}const Xe={on(t,e,i,r){oS(t,e,i,r,!1)},one(t,e,i,r){oS(t,e,i,r,!0)},off(t,e,i,r){if(typeof e!="string"||!t)return;const[c,f,y]=C2(e,i,r),l=y!==e,I=S2(t),C=e.startsWith(".");if(typeof f!="undefined"){if(!I||!I[y])return;lb(t,I,y,f,c?i:null);return}C&&Object.keys(I).forEach(R=>{mB(t,I,R,e.slice(1))});const L=I[y]||{};Object.keys(L).forEach(R=>{const $=R.replace(uB,"");if(!l||e.includes($)){const J=L[R];lb(t,I,y,J.originalHandler,J.delegationSelector)}})},trigger(t,e,i){if(typeof e!="string"||!t)return null;const r=b2(),c=M2(e),f=e!==c,y=T2.has(c);let l,I=!0,C=!0,L=!1,R=null;return f&&r&&(l=r.Event(e,i),r(t).trigger(l),I=!l.isPropagationStopped(),C=!l.isImmediatePropagationStopped(),L=l.isDefaultPrevented()),y?(R=document.createEvent("HTMLEvents"),R.initEvent(c,I,!0)):R=new CustomEvent(e,{bubbles:I,cancelable:!0}),typeof i!="undefined"&&Object.keys(i).forEach($=>{Object.defineProperty(R,$,{get(){return i[$]}})}),L&&R.preventDefault(),C&&t.dispatchEvent(R),R.defaultPrevented&&typeof l!="undefined"&&l.preventDefault(),R}},ul=new Map,xp={set(t,e,i){ul.has(t)||ul.set(t,new Map);const r=ul.get(t);if(!r.has(e)&&r.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(r.keys())[0]}.`);return}r.set(e,i)},get(t,e){return ul.has(t)&&ul.get(t).get(e)||null},remove(t,e){if(!ul.has(t))return;const i=ul.get(t);i.delete(e),i.size===0&&ul.delete(t)}},_B="5.1.3";class ho{constructor(e){e=Al(e),e&&(this._element=e,xp.set(this._element,this.constructor.DATA_KEY,this))}dispose(){xp.remove(this._element,this.constructor.DATA_KEY),Xe.off(this._element,this.constructor.EVENT_KEY),Object.getOwnPropertyNames(this).forEach(e=>{this[e]=null})}_queueCallback(e,i,r=!0){w2(e,i,r)}static getInstance(e){return xp.get(Al(e),this.DATA_KEY)}static getOrCreateInstance(e,i={}){return this.getInstance(e)||new this(e,typeof i=="object"?i:null)}static get VERSION(){return _B}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}}const $y=(t,e="hide")=>{const i=`click.dismiss${t.EVENT_KEY}`,r=t.NAME;Xe.on(document,i,`[data-bs-dismiss="${r}"]`,function(c){if(["A","AREA"].includes(this.tagName)&&c.preventDefault(),Bc(this))return;const f=Sl(this)||this.closest(`.${r}`);t.getOrCreateInstance(f)[e]()})},gB="alert",yB="bs.alert",k2=`.${yB}`,vB=`close${k2}`,xB=`closed${k2}`,bB="fade",wB="show";class jy extends ho{static get NAME(){return gB}close(){if(Xe.trigger(this._element,vB).defaultPrevented)return;this._element.classList.remove(wB);const i=this._element.classList.contains(bB);this._queueCallback(()=>this._destroyElement(),this._element,i)}_destroyElement(){this._element.remove(),Xe.trigger(this._element,xB),this.dispose()}static jQueryInterface(e){return this.each(function(){const i=jy.getOrCreateInstance(this);if(typeof e=="string"){if(i[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);i[e](this)}})}}$y(jy,"close");Us(jy);const EB="button",TB="bs.button",IB=`.${TB}`,SB=".data-api",AB="active",aS='[data-bs-toggle="button"]',CB=`click${IB}${SB}`;class Gy extends ho{static get NAME(){return EB}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(AB))}static jQueryInterface(e){return this.each(function(){const i=Gy.getOrCreateInstance(this);e==="toggle"&&i[e]()})}}Xe.on(document,CB,aS,t=>{t.preventDefault();const e=t.target.closest(aS);Gy.getOrCreateInstance(e).toggle()});Us(Gy);function lS(t){return t==="true"?!0:t==="false"?!1:t===Number(t).toString()?Number(t):t===""||t==="null"?null:t}function y0(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}const ar={setDataAttribute(t,e,i){t.setAttribute(`data-bs-${y0(e)}`,i)},removeDataAttribute(t,e){t.removeAttribute(`data-bs-${y0(e)}`)},getDataAttributes(t){if(!t)return{};const e={};return Object.keys(t.dataset).filter(i=>i.startsWith("bs")).forEach(i=>{let r=i.replace(/^bs/,"");r=r.charAt(0).toLowerCase()+r.slice(1,r.length),e[r]=lS(t.dataset[i])}),e},getDataAttribute(t,e){return lS(t.getAttribute(`data-bs-${y0(e)}`))},offset(t){const e=t.getBoundingClientRect();return{top:e.top+window.pageYOffset,left:e.left+window.pageXOffset}},position(t){return{top:t.offsetTop,left:t.offsetLeft}}},MB=3,Jt={find(t,e=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(e,t))},findOne(t,e=document.documentElement){return Element.prototype.querySelector.call(e,t)},children(t,e){return[].concat(...t.children).filter(i=>i.matches(e))},parents(t,e){const i=[];let r=t.parentNode;for(;r&&r.nodeType===Node.ELEMENT_NODE&&r.nodeType!==MB;)r.matches(e)&&i.push(r),r=r.parentNode;return i},prev(t,e){let i=t.previousElementSibling;for(;i;){if(i.matches(e))return[i];i=i.previousElementSibling}return[]},next(t,e){let i=t.nextElementSibling;for(;i;){if(i.matches(e))return[i];i=i.nextElementSibling}return[]},focusableChildren(t){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(i=>`${i}:not([tabindex^="-"])`).join(", ");return this.find(e,t).filter(i=>!Bc(i)&&um(i))}},cS="carousel",kB="bs.carousel",As=`.${kB}`,D2=".data-api",DB="ArrowLeft",PB="ArrowRight",RB=500,LB=40,uS={interval:5e3,keyboard:!0,slide:!1,pause:"hover",wrap:!0,touch:!0},OB={interval:"(number|boolean)",keyboard:"boolean",slide:"(boolean|string)",pause:"(string|boolean)",wrap:"boolean",touch:"boolean"},vc="next",xc="prev",Tc="left",up="right",zB={[DB]:up,[PB]:Tc},NB=`slide${As}`,hS=`slid${As}`,FB=`keydown${As}`,BB=`mouseenter${As}`,UB=`mouseleave${As}`,VB=`touchstart${As}`,$B=`touchmove${As}`,jB=`touchend${As}`,GB=`pointerdown${As}`,qB=`pointerup${As}`,WB=`dragstart${As}`,HB=`load${As}${D2}`,KB=`click${As}${D2}`,ZB="carousel",bc="active",XB="slide",YB="carousel-item-end",JB="carousel-item-start",QB="carousel-item-next",e3="carousel-item-prev",t3="pointer-event",i3=".active",fg=".active.carousel-item",n3=".carousel-item",r3=".carousel-item img",s3=".carousel-item-next, .carousel-item-prev",o3=".carousel-indicators",a3="[data-bs-target]",l3="[data-bs-slide], [data-bs-slide-to]",c3='[data-bs-ride="carousel"]',u3="touch",h3="pen";class va extends ho{constructor(e,i){super(e),this._items=null,this._interval=null,this._activeElement=null,this._isPaused=!1,this._isSliding=!1,this.touchTimeout=null,this.touchStartX=0,this.touchDeltaX=0,this._config=this._getConfig(i),this._indicatorsElement=Jt.findOne(o3,this._element),this._touchSupported="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0,this._pointerEvent=Boolean(window.PointerEvent),this._addEventListeners()}static get Default(){return uS}static get NAME(){return cS}next(){this._slide(vc)}nextWhenVisible(){!document.hidden&&um(this._element)&&this.next()}prev(){this._slide(xc)}pause(e){e||(this._isPaused=!0),Jt.findOne(s3,this._element)&&(v2(this._element),this.cycle(!0)),clearInterval(this._interval),this._interval=null}cycle(e){e||(this._isPaused=!1),this._interval&&(clearInterval(this._interval),this._interval=null),this._config&&this._config.interval&&!this._isPaused&&(this._updateInterval(),this._interval=setInterval((document.visibilityState?this.nextWhenVisible:this.next).bind(this),this._config.interval))}to(e){this._activeElement=Jt.findOne(fg,this._element);const i=this._getItemIndex(this._activeElement);if(e>this._items.length-1||e<0)return;if(this._isSliding){Xe.one(this._element,hS,()=>this.to(e));return}if(i===e){this.pause(),this.cycle();return}const r=e>i?vc:xc;this._slide(r,this._items[e])}_getConfig(e){return e=gi(gi(gi({},uS),ar.getDataAttributes(this._element)),typeof e=="object"?e:{}),Ho(cS,e,OB),e}_handleSwipe(){const e=Math.abs(this.touchDeltaX);if(e<=LB)return;const i=e/this.touchDeltaX;this.touchDeltaX=0,i&&this._slide(i>0?up:Tc)}_addEventListeners(){this._config.keyboard&&Xe.on(this._element,FB,e=>this._keydown(e)),this._config.pause==="hover"&&(Xe.on(this._element,BB,e=>this.pause(e)),Xe.on(this._element,UB,e=>this.cycle(e))),this._config.touch&&this._touchSupported&&this._addTouchEventListeners()}_addTouchEventListeners(){const e=f=>this._pointerEvent&&(f.pointerType===h3||f.pointerType===u3),i=f=>{e(f)?this.touchStartX=f.clientX:this._pointerEvent||(this.touchStartX=f.touches[0].clientX)},r=f=>{this.touchDeltaX=f.touches&&f.touches.length>1?0:f.touches[0].clientX-this.touchStartX},c=f=>{e(f)&&(this.touchDeltaX=f.clientX-this.touchStartX),this._handleSwipe(),this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(y=>this.cycle(y),RB+this._config.interval))};Jt.find(r3,this._element).forEach(f=>{Xe.on(f,WB,y=>y.preventDefault())}),this._pointerEvent?(Xe.on(this._element,GB,f=>i(f)),Xe.on(this._element,qB,f=>c(f)),this._element.classList.add(t3)):(Xe.on(this._element,VB,f=>i(f)),Xe.on(this._element,$B,f=>r(f)),Xe.on(this._element,jB,f=>c(f)))}_keydown(e){if(/input|textarea/i.test(e.target.tagName))return;const i=zB[e.key];i&&(e.preventDefault(),this._slide(i))}_getItemIndex(e){return this._items=e&&e.parentNode?Jt.find(n3,e.parentNode):[],this._items.indexOf(e)}_getItemByOrder(e,i){const r=e===vc;return E2(this._items,i,r,this._config.wrap)}_triggerSlideEvent(e,i){const r=this._getItemIndex(e),c=this._getItemIndex(Jt.findOne(fg,this._element));return Xe.trigger(this._element,NB,{relatedTarget:e,direction:i,from:c,to:r})}_setActiveIndicatorElement(e){if(this._indicatorsElement){const i=Jt.findOne(i3,this._indicatorsElement);i.classList.remove(bc),i.removeAttribute("aria-current");const r=Jt.find(a3,this._indicatorsElement);for(let c=0;c<r.length;c++)if(Number.parseInt(r[c].getAttribute("data-bs-slide-to"),10)===this._getItemIndex(e)){r[c].classList.add(bc),r[c].setAttribute("aria-current","true");break}}}_updateInterval(){const e=this._activeElement||Jt.findOne(fg,this._element);if(!e)return;const i=Number.parseInt(e.getAttribute("data-bs-interval"),10);i?(this._config.defaultInterval=this._config.defaultInterval||this._config.interval,this._config.interval=i):this._config.interval=this._config.defaultInterval||this._config.interval}_slide(e,i){const r=this._directionToOrder(e),c=Jt.findOne(fg,this._element),f=this._getItemIndex(c),y=i||this._getItemByOrder(r,c),l=this._getItemIndex(y),I=Boolean(this._interval),C=r===vc,L=C?JB:YB,R=C?QB:e3,$=this._orderToDirection(r);if(y&&y.classList.contains(bc)){this._isSliding=!1;return}if(this._isSliding||this._triggerSlideEvent(y,$).defaultPrevented||!c||!y)return;this._isSliding=!0,I&&this.pause(),this._setActiveIndicatorElement(y),this._activeElement=y;const pe=()=>{Xe.trigger(this._element,hS,{relatedTarget:y,direction:$,from:f,to:l})};if(this._element.classList.contains(XB)){y.classList.add(R),dd(y),c.classList.add(L),y.classList.add(L);const Re=()=>{y.classList.remove(L,R),y.classList.add(bc),c.classList.remove(bc,R,L),this._isSliding=!1,setTimeout(pe,0)};this._queueCallback(Re,c,!0)}else c.classList.remove(bc),y.classList.add(bc),this._isSliding=!1,pe();I&&this.cycle()}_directionToOrder(e){return[up,Tc].includes(e)?os()?e===Tc?xc:vc:e===Tc?vc:xc:e}_orderToDirection(e){return[vc,xc].includes(e)?os()?e===xc?Tc:up:e===xc?up:Tc:e}static carouselInterface(e,i){const r=va.getOrCreateInstance(e,i);let{_config:c}=r;typeof i=="object"&&(c=gi(gi({},c),i));const f=typeof i=="string"?i:c.slide;if(typeof i=="number")r.to(i);else if(typeof f=="string"){if(typeof r[f]=="undefined")throw new TypeError(`No method named "${f}"`);r[f]()}else c.interval&&c.ride&&(r.pause(),r.cycle())}static jQueryInterface(e){return this.each(function(){va.carouselInterface(this,e)})}static dataApiClickHandler(e){const i=Sl(this);if(!i||!i.classList.contains(ZB))return;const r=gi(gi({},ar.getDataAttributes(i)),ar.getDataAttributes(this)),c=this.getAttribute("data-bs-slide-to");c&&(r.interval=!1),va.carouselInterface(i,r),c&&va.getInstance(i).to(c),e.preventDefault()}}Xe.on(document,KB,l3,va.dataApiClickHandler);Xe.on(window,HB,()=>{const t=Jt.find(c3);for(let e=0,i=t.length;e<i;e++)va.carouselInterface(t[e],va.getInstance(t[e]))});Us(va);const dS="collapse",P2="bs.collapse",hm=`.${P2}`,d3=".data-api",fS={toggle:!0,parent:null},f3={toggle:"boolean",parent:"(null|element)"},p3=`show${hm}`,m3=`shown${hm}`,_3=`hide${hm}`,g3=`hidden${hm}`,y3=`click${hm}${d3}`,v0="show",Sh="collapse",pg="collapsing",pS="collapsed",mS=`:scope .${Sh} .${Sh}`,v3="collapse-horizontal",x3="width",b3="height",w3=".collapse.show, .collapse.collapsing",cb='[data-bs-toggle="collapse"]';class Dh extends ho{constructor(e,i){super(e),this._isTransitioning=!1,this._config=this._getConfig(i),this._triggerArray=[];const r=Jt.find(cb);for(let c=0,f=r.length;c<f;c++){const y=r[c],l=zw(y),I=Jt.find(l).filter(C=>C===this._element);l!==null&&I.length&&(this._selector=l,this._triggerArray.push(y))}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return fS}static get NAME(){return dS}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let e=[],i;if(this._config.parent){const C=Jt.find(mS,this._config.parent);e=Jt.find(w3,this._config.parent).filter(L=>!C.includes(L))}const r=Jt.findOne(this._selector);if(e.length){const C=e.find(L=>r!==L);if(i=C?Dh.getInstance(C):null,i&&i._isTransitioning)return}if(Xe.trigger(this._element,p3).defaultPrevented)return;e.forEach(C=>{r!==C&&Dh.getOrCreateInstance(C,{toggle:!1}).hide(),i||xp.set(C,P2,null)});const f=this._getDimension();this._element.classList.remove(Sh),this._element.classList.add(pg),this._element.style[f]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const y=()=>{this._isTransitioning=!1,this._element.classList.remove(pg),this._element.classList.add(Sh,v0),this._element.style[f]="",Xe.trigger(this._element,m3)},I=`scroll${f[0].toUpperCase()+f.slice(1)}`;this._queueCallback(y,this._element,!0),this._element.style[f]=`${this._element[I]}px`}hide(){if(this._isTransitioning||!this._isShown()||Xe.trigger(this._element,_3).defaultPrevented)return;const i=this._getDimension();this._element.style[i]=`${this._element.getBoundingClientRect()[i]}px`,dd(this._element),this._element.classList.add(pg),this._element.classList.remove(Sh,v0);const r=this._triggerArray.length;for(let f=0;f<r;f++){const y=this._triggerArray[f],l=Sl(y);l&&!this._isShown(l)&&this._addAriaAndCollapsedClass([y],!1)}this._isTransitioning=!0;const c=()=>{this._isTransitioning=!1,this._element.classList.remove(pg),this._element.classList.add(Sh),Xe.trigger(this._element,g3)};this._element.style[i]="",this._queueCallback(c,this._element,!0)}_isShown(e=this._element){return e.classList.contains(v0)}_getConfig(e){return e=gi(gi(gi({},fS),ar.getDataAttributes(this._element)),e),e.toggle=Boolean(e.toggle),e.parent=Al(e.parent),Ho(dS,e,f3),e}_getDimension(){return this._element.classList.contains(v3)?x3:b3}_initializeChildren(){if(!this._config.parent)return;const e=Jt.find(mS,this._config.parent);Jt.find(cb,this._config.parent).filter(i=>!e.includes(i)).forEach(i=>{const r=Sl(i);r&&this._addAriaAndCollapsedClass([i],this._isShown(r))})}_addAriaAndCollapsedClass(e,i){!e.length||e.forEach(r=>{i?r.classList.remove(pS):r.classList.add(pS),r.setAttribute("aria-expanded",i)})}static jQueryInterface(e){return this.each(function(){const i={};typeof e=="string"&&/show|hide/.test(e)&&(i.toggle=!1);const r=Dh.getOrCreateInstance(this,i);if(typeof e=="string"){if(typeof r[e]=="undefined")throw new TypeError(`No method named "${e}"`);r[e]()}})}}Xe.on(document,y3,cb,function(t){(t.target.tagName==="A"||t.delegateTarget&&t.delegateTarget.tagName==="A")&&t.preventDefault();const e=zw(this);Jt.find(e).forEach(r=>{Dh.getOrCreateInstance(r,{toggle:!1}).toggle()})});Us(Dh);const x0="dropdown",E3="bs.dropdown",hu=`.${E3}`,Nw=".data-api",kg="Escape",_S="Space",gS="Tab",ub="ArrowUp",Dg="ArrowDown",T3=2,I3=new RegExp(`${ub}|${Dg}|${kg}`),S3=`hide${hu}`,A3=`hidden${hu}`,C3=`show${hu}`,M3=`shown${hu}`,R2=`click${hu}${Nw}`,L2=`keydown${hu}${Nw}`,k3=`keyup${hu}${Nw}`,gh="show",D3="dropup",P3="dropend",R3="dropstart",L3="navbar",bp='[data-bs-toggle="dropdown"]',hb=".dropdown-menu",O3=".navbar-nav",z3=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",N3=os()?"top-end":"top-start",F3=os()?"top-start":"top-end",B3=os()?"bottom-end":"bottom-start",U3=os()?"bottom-start":"bottom-end",V3=os()?"left-start":"right-start",$3=os()?"right-start":"left-start",j3={offset:[0,2],boundary:"clippingParents",reference:"toggle",display:"dynamic",popperConfig:null,autoClose:!0},G3={offset:"(array|string|function)",boundary:"(string|element)",reference:"(string|element|object)",display:"string",popperConfig:"(null|object|function)",autoClose:"(boolean|string)"};class Ls extends ho{constructor(e,i){super(e),this._popper=null,this._config=this._getConfig(i),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar()}static get Default(){return j3}static get DefaultType(){return G3}static get NAME(){return x0}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Bc(this._element)||this._isShown(this._menu))return;const e={relatedTarget:this._element};if(Xe.trigger(this._element,C3,e).defaultPrevented)return;const r=Ls.getParentFromElement(this._element);this._inNavbar?ar.setDataAttribute(this._menu,"popper","none"):this._createPopper(r),"ontouchstart"in document.documentElement&&!r.closest(O3)&&[].concat(...document.body.children).forEach(c=>Xe.on(c,"mouseover",Hg)),this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(gh),this._element.classList.add(gh),Xe.trigger(this._element,M3,e)}hide(){if(Bc(this._element)||!this._isShown(this._menu))return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){Xe.trigger(this._element,S3,e).defaultPrevented||("ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach(r=>Xe.off(r,"mouseover",Hg)),this._popper&&this._popper.destroy(),this._menu.classList.remove(gh),this._element.classList.remove(gh),this._element.setAttribute("aria-expanded","false"),ar.removeDataAttribute(this._menu,"popper"),Xe.trigger(this._element,A3,e))}_getConfig(e){if(e=gi(gi(gi({},this.constructor.Default),ar.getDataAttributes(this._element)),e),Ho(x0,e,this.constructor.DefaultType),typeof e.reference=="object"&&!Hc(e.reference)&&typeof e.reference.getBoundingClientRect!="function")throw new TypeError(`${x0.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(e){if(typeof g2=="undefined")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let i=this._element;this._config.reference==="parent"?i=e:Hc(this._config.reference)?i=Al(this._config.reference):typeof this._config.reference=="object"&&(i=this._config.reference);const r=this._getPopperConfig(),c=r.modifiers.find(f=>f.name==="applyStyles"&&f.enabled===!1);this._popper=Ow(i,this._menu,r),c&&ar.setDataAttribute(this._menu,"popper","static")}_isShown(e=this._element){return e.classList.contains(gh)}_getMenuElement(){return Jt.next(this._element,hb)[0]}_getPlacement(){const e=this._element.parentNode;if(e.classList.contains(P3))return V3;if(e.classList.contains(R3))return $3;const i=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return e.classList.contains(D3)?i?F3:N3:i?U3:B3}_detectNavbar(){return this._element.closest(`.${L3}`)!==null}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(i=>Number.parseInt(i,10)):typeof e=="function"?i=>e(i,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return this._config.display==="static"&&(e.modifiers=[{name:"applyStyles",enabled:!1}]),gi(gi({},e),typeof this._config.popperConfig=="function"?this._config.popperConfig(e):this._config.popperConfig)}_selectMenuItem({key:e,target:i}){const r=Jt.find(z3,this._menu).filter(um);!r.length||E2(r,i,e===Dg,!r.includes(i)).focus()}static jQueryInterface(e){return this.each(function(){const i=Ls.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof i[e]=="undefined")throw new TypeError(`No method named "${e}"`);i[e]()}})}static clearMenus(e){if(e&&(e.button===T3||e.type==="keyup"&&e.key!==gS))return;const i=Jt.find(bp);for(let r=0,c=i.length;r<c;r++){const f=Ls.getInstance(i[r]);if(!f||f._config.autoClose===!1||!f._isShown())continue;const y={relatedTarget:f._element};if(e){const l=e.composedPath(),I=l.includes(f._menu);if(l.includes(f._element)||f._config.autoClose==="inside"&&!I||f._config.autoClose==="outside"&&I||f._menu.contains(e.target)&&(e.type==="keyup"&&e.key===gS||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;e.type==="click"&&(y.clickEvent=e)}f._completeHide(y)}}static getParentFromElement(e){return Sl(e)||e.parentNode}static dataApiKeydownHandler(e){if(/input|textarea/i.test(e.target.tagName)?e.key===_S||e.key!==kg&&(e.key!==Dg&&e.key!==ub||e.target.closest(hb)):!I3.test(e.key))return;const i=this.classList.contains(gh);if(!i&&e.key===kg||(e.preventDefault(),e.stopPropagation(),Bc(this)))return;const r=this.matches(bp)?this:Jt.prev(this,bp)[0],c=Ls.getOrCreateInstance(r);if(e.key===kg){c.hide();return}if(e.key===ub||e.key===Dg){i||c.show(),c._selectMenuItem(e);return}(!i||e.key===_S)&&Ls.clearMenus()}}Xe.on(document,L2,bp,Ls.dataApiKeydownHandler);Xe.on(document,L2,hb,Ls.dataApiKeydownHandler);Xe.on(document,R2,Ls.clearMenus);Xe.on(document,k3,Ls.clearMenus);Xe.on(document,R2,bp,function(t){t.preventDefault(),Ls.getOrCreateInstance(this).toggle()});Us(Ls);const yS=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",vS=".sticky-top";class db{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,"paddingRight",i=>i+e),this._setElementAttributes(yS,"paddingRight",i=>i+e),this._setElementAttributes(vS,"marginRight",i=>i-e)}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,i,r){const c=this.getWidth(),f=y=>{if(y!==this._element&&window.innerWidth>y.clientWidth+c)return;this._saveInitialAttribute(y,i);const l=window.getComputedStyle(y)[i];y.style[i]=`${r(Number.parseFloat(l))}px`};this._applyManipulationCallback(e,f)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,"paddingRight"),this._resetElementAttributes(yS,"paddingRight"),this._resetElementAttributes(vS,"marginRight")}_saveInitialAttribute(e,i){const r=e.style[i];r&&ar.setDataAttribute(e,i,r)}_resetElementAttributes(e,i){const r=c=>{const f=ar.getDataAttribute(c,i);typeof f=="undefined"?c.style.removeProperty(i):(ar.removeDataAttribute(c,i),c.style[i]=f)};this._applyManipulationCallback(e,r)}_applyManipulationCallback(e,i){Hc(e)?i(e):Jt.find(e,this._element).forEach(i)}isOverflowing(){return this.getWidth()>0}}const q3={className:"modal-backdrop",isVisible:!0,isAnimated:!1,rootElement:"body",clickCallback:null},W3={className:"string",isVisible:"boolean",isAnimated:"boolean",rootElement:"(element|string)",clickCallback:"(function|null)"},O2="backdrop",H3="fade",xS="show",bS=`mousedown.bs.${O2}`;class z2{constructor(e){this._config=this._getConfig(e),this._isAppended=!1,this._element=null}show(e){if(!this._config.isVisible){Cc(e);return}this._append(),this._config.isAnimated&&dd(this._getElement()),this._getElement().classList.add(xS),this._emulateAnimation(()=>{Cc(e)})}hide(e){if(!this._config.isVisible){Cc(e);return}this._getElement().classList.remove(xS),this._emulateAnimation(()=>{this.dispose(),Cc(e)})}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add(H3),this._element=e}return this._element}_getConfig(e){return e=gi(gi({},q3),typeof e=="object"?e:{}),e.rootElement=Al(e.rootElement),Ho(O2,e,W3),e}_append(){this._isAppended||(this._config.rootElement.append(this._getElement()),Xe.on(this._getElement(),bS,()=>{Cc(this._config.clickCallback)}),this._isAppended=!0)}dispose(){!this._isAppended||(Xe.off(this._element,bS),this._element.remove(),this._isAppended=!1)}_emulateAnimation(e){w2(e,this._getElement(),this._config.isAnimated)}}const K3={trapElement:null,autofocus:!0},Z3={trapElement:"element",autofocus:"boolean"},X3="focustrap",Y3="bs.focustrap",Kg=`.${Y3}`,J3=`focusin${Kg}`,Q3=`keydown.tab${Kg}`,eU="Tab",tU="forward",wS="backward";class N2{constructor(e){this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}activate(){const{trapElement:e,autofocus:i}=this._config;this._isActive||(i&&e.focus(),Xe.off(document,Kg),Xe.on(document,J3,r=>this._handleFocusin(r)),Xe.on(document,Q3,r=>this._handleKeydown(r)),this._isActive=!0)}deactivate(){!this._isActive||(this._isActive=!1,Xe.off(document,Kg))}_handleFocusin(e){const{target:i}=e,{trapElement:r}=this._config;if(i===document||i===r||r.contains(i))return;const c=Jt.focusableChildren(r);c.length===0?r.focus():this._lastTabNavDirection===wS?c[c.length-1].focus():c[0].focus()}_handleKeydown(e){e.key===eU&&(this._lastTabNavDirection=e.shiftKey?wS:tU)}_getConfig(e){return e=gi(gi({},K3),typeof e=="object"?e:{}),Ho(X3,e,Z3),e}}const ES="modal",iU="bs.modal",Vs=`.${iU}`,nU=".data-api",TS="Escape",IS={backdrop:!0,keyboard:!0,focus:!0},rU={backdrop:"(boolean|string)",keyboard:"boolean",focus:"boolean"},sU=`hide${Vs}`,oU=`hidePrevented${Vs}`,F2=`hidden${Vs}`,B2=`show${Vs}`,aU=`shown${Vs}`,SS=`resize${Vs}`,AS=`click.dismiss${Vs}`,CS=`keydown.dismiss${Vs}`,lU=`mouseup.dismiss${Vs}`,MS=`mousedown.dismiss${Vs}`,cU=`click${Vs}${nU}`,kS="modal-open",uU="fade",DS="show",b0="modal-static",hU=".modal.show",dU=".modal-dialog",fU=".modal-body",pU='[data-bs-toggle="modal"]';class Kh extends ho{constructor(e,i){super(e),this._config=this._getConfig(i),this._dialog=Jt.findOne(dU,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._ignoreBackdropClick=!1,this._isTransitioning=!1,this._scrollBar=new db}static get Default(){return IS}static get NAME(){return ES}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||this._isTransitioning||Xe.trigger(this._element,B2,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isAnimated()&&(this._isTransitioning=!0),this._scrollBar.hide(),document.body.classList.add(kS),this._adjustDialog(),this._setEscapeEvent(),this._setResizeEvent(),Xe.on(this._dialog,MS,()=>{Xe.one(this._element,lU,r=>{r.target===this._element&&(this._ignoreBackdropClick=!0)})}),this._showBackdrop(()=>this._showElement(e)))}hide(){if(!this._isShown||this._isTransitioning||Xe.trigger(this._element,sU).defaultPrevented)return;this._isShown=!1;const i=this._isAnimated();i&&(this._isTransitioning=!0),this._setEscapeEvent(),this._setResizeEvent(),this._focustrap.deactivate(),this._element.classList.remove(DS),Xe.off(this._element,AS),Xe.off(this._dialog,MS),this._queueCallback(()=>this._hideModal(),this._element,i)}dispose(){[window,this._dialog].forEach(e=>Xe.off(e,Vs)),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new z2({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new N2({trapElement:this._element})}_getConfig(e){return e=gi(gi(gi({},IS),ar.getDataAttributes(this._element)),typeof e=="object"?e:{}),Ho(ES,e,rU),e}_showElement(e){const i=this._isAnimated(),r=Jt.findOne(fU,this._dialog);(!this._element.parentNode||this._element.parentNode.nodeType!==Node.ELEMENT_NODE)&&document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0,r&&(r.scrollTop=0),i&&dd(this._element),this._element.classList.add(DS);const c=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Xe.trigger(this._element,aU,{relatedTarget:e})};this._queueCallback(c,this._dialog,i)}_setEscapeEvent(){this._isShown?Xe.on(this._element,CS,e=>{this._config.keyboard&&e.key===TS?(e.preventDefault(),this.hide()):!this._config.keyboard&&e.key===TS&&this._triggerBackdropTransition()}):Xe.off(this._element,CS)}_setResizeEvent(){this._isShown?Xe.on(window,SS,()=>this._adjustDialog()):Xe.off(window,SS)}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(kS),this._resetAdjustments(),this._scrollBar.reset(),Xe.trigger(this._element,F2)})}_showBackdrop(e){Xe.on(this._element,AS,i=>{if(this._ignoreBackdropClick){this._ignoreBackdropClick=!1;return}i.target===i.currentTarget&&(this._config.backdrop===!0?this.hide():this._config.backdrop==="static"&&this._triggerBackdropTransition())}),this._backdrop.show(e)}_isAnimated(){return this._element.classList.contains(uU)}_triggerBackdropTransition(){if(Xe.trigger(this._element,oU).defaultPrevented)return;const{classList:i,scrollHeight:r,style:c}=this._element,f=r>document.documentElement.clientHeight;!f&&c.overflowY==="hidden"||i.contains(b0)||(f||(c.overflowY="hidden"),i.add(b0),this._queueCallback(()=>{i.remove(b0),f||this._queueCallback(()=>{c.overflowY=""},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,i=this._scrollBar.getWidth(),r=i>0;(!r&&e&&!os()||r&&!e&&os())&&(this._element.style.paddingLeft=`${i}px`),(r&&!e&&!os()||!r&&e&&os())&&(this._element.style.paddingRight=`${i}px`)}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,i){return this.each(function(){const r=Kh.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof r[e]=="undefined")throw new TypeError(`No method named "${e}"`);r[e](i)}})}}Xe.on(document,cU,pU,function(t){const e=Sl(this);["A","AREA"].includes(this.tagName)&&t.preventDefault(),Xe.one(e,B2,c=>{c.defaultPrevented||Xe.one(e,F2,()=>{um(this)&&this.focus()})});const i=Jt.findOne(hU);i&&Kh.getInstance(i).hide(),Kh.getOrCreateInstance(e).toggle(this)});$y(Kh);Us(Kh);const PS="offcanvas",mU="bs.offcanvas",du=`.${mU}`,U2=".data-api",_U=`load${du}${U2}`,gU="Escape",RS={backdrop:!0,keyboard:!0,scroll:!1},yU={backdrop:"boolean",keyboard:"boolean",scroll:"boolean"},LS="show",vU="offcanvas-backdrop",V2=".offcanvas.show",xU=`show${du}`,bU=`shown${du}`,wU=`hide${du}`,$2=`hidden${du}`,EU=`click${du}${U2}`,TU=`keydown.dismiss${du}`,IU='[data-bs-toggle="offcanvas"]';class Kc extends ho{constructor(e,i){super(e),this._config=this._getConfig(i),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get NAME(){return PS}static get Default(){return RS}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||Xe.trigger(this._element,xU,{relatedTarget:e}).defaultPrevented)return;this._isShown=!0,this._element.style.visibility="visible",this._backdrop.show(),this._config.scroll||new db().hide(),this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(LS);const r=()=>{this._config.scroll||this._focustrap.activate(),Xe.trigger(this._element,bU,{relatedTarget:e})};this._queueCallback(r,this._element,!0)}hide(){if(!this._isShown||Xe.trigger(this._element,wU).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.remove(LS),this._backdrop.hide();const i=()=>{this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._element.style.visibility="hidden",this._config.scroll||new db().reset(),Xe.trigger(this._element,$2)};this._queueCallback(i,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_getConfig(e){return e=gi(gi(gi({},RS),ar.getDataAttributes(this._element)),typeof e=="object"?e:{}),Ho(PS,e,yU),e}_initializeBackDrop(){return new z2({className:vU,isVisible:this._config.backdrop,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:()=>this.hide()})}_initializeFocusTrap(){return new N2({trapElement:this._element})}_addEventListeners(){Xe.on(this._element,TU,e=>{this._config.keyboard&&e.key===gU&&this.hide()})}static jQueryInterface(e){return this.each(function(){const i=Kc.getOrCreateInstance(this,e);if(typeof e=="string"){if(i[e]===void 0||e.startsWith("_")||e==="constructor")throw new TypeError(`No method named "${e}"`);i[e](this)}})}}Xe.on(document,EU,IU,function(t){const e=Sl(this);if(["A","AREA"].includes(this.tagName)&&t.preventDefault(),Bc(this))return;Xe.one(e,$2,()=>{um(this)&&this.focus()});const i=Jt.findOne(V2);i&&i!==e&&Kc.getInstance(i).hide(),Kc.getOrCreateInstance(e).toggle(this)});Xe.on(window,_U,()=>Jt.find(V2).forEach(t=>Kc.getOrCreateInstance(t).show()));$y(Kc);Us(Kc);const SU=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),AU=/^aria-[\w-]*$/i,CU=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^#&/:?]*(?:[#/?]|$))/i,MU=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[\d+/a-z]+=*$/i,kU=(t,e)=>{const i=t.nodeName.toLowerCase();if(e.includes(i))return SU.has(i)?Boolean(CU.test(t.nodeValue)||MU.test(t.nodeValue)):!0;const r=e.filter(c=>c instanceof RegExp);for(let c=0,f=r.length;c<f;c++)if(r[c].test(i))return!0;return!1},DU={"*":["class","dir","id","lang","role",AU],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]};function OS(t,e,i){if(!t.length)return t;if(i&&typeof i=="function")return i(t);const c=new window.DOMParser().parseFromString(t,"text/html"),f=[].concat(...c.body.querySelectorAll("*"));for(let y=0,l=f.length;y<l;y++){const I=f[y],C=I.nodeName.toLowerCase();if(!Object.keys(e).includes(C)){I.remove();continue}const L=[].concat(...I.attributes),R=[].concat(e["*"]||[],e[C]||[]);L.forEach($=>{kU($,R)||I.removeAttribute($.nodeName)})}return c.body.innerHTML}const zS="tooltip",PU="bs.tooltip",Po=`.${PU}`,RU="bs-tooltip",LU=new Set(["sanitize","allowList","sanitizeFn"]),OU={animation:"boolean",template:"string",title:"(string|element|function)",trigger:"string",delay:"(number|object)",html:"boolean",selector:"(string|boolean)",placement:"(string|function)",offset:"(array|string|function)",container:"(string|element|boolean)",fallbackPlacements:"array",boundary:"(string|element)",customClass:"(string|function)",sanitize:"boolean",sanitizeFn:"(null|function)",allowList:"object",popperConfig:"(null|object|function)"},zU={AUTO:"auto",TOP:"top",RIGHT:os()?"left":"right",BOTTOM:"bottom",LEFT:os()?"right":"left"},NU={animation:!0,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,selector:!1,placement:"top",offset:[0,0],container:!1,fallbackPlacements:["top","right","bottom","left"],boundary:"clippingParents",customClass:"",sanitize:!0,sanitizeFn:null,allowList:DU,popperConfig:null},FU={HIDE:`hide${Po}`,HIDDEN:`hidden${Po}`,SHOW:`show${Po}`,SHOWN:`shown${Po}`,INSERTED:`inserted${Po}`,CLICK:`click${Po}`,FOCUSIN:`focusin${Po}`,FOCUSOUT:`focusout${Po}`,MOUSEENTER:`mouseenter${Po}`,MOUSELEAVE:`mouseleave${Po}`},mg="fade",BU="modal",Jf="show",Qf="show",w0="out",NS=".tooltip-inner",FS=`.${BU}`,BS="hide.bs.modal",ep="hover",E0="focus",UU="click",VU="manual";class fd extends ho{constructor(e,i){if(typeof g2=="undefined")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e),this._isEnabled=!0,this._timeout=0,this._hoverState="",this._activeTrigger={},this._popper=null,this._config=this._getConfig(i),this.tip=null,this._setListeners()}static get Default(){return NU}static get NAME(){return zS}static get Event(){return FU}static get DefaultType(){return OU}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(e){if(!!this._isEnabled)if(e){const i=this._initializeOnDelegatedTarget(e);i._activeTrigger.click=!i._activeTrigger.click,i._isWithActiveTrigger()?i._enter(null,i):i._leave(null,i)}else{if(this.getTipElement().classList.contains(Jf)){this._leave(null,this);return}this._enter(null,this)}}dispose(){clearTimeout(this._timeout),Xe.off(this._element.closest(FS),BS,this._hideModalHandler),this.tip&&this.tip.remove(),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this.isWithContent()&&this._isEnabled))return;const e=Xe.trigger(this._element,this.constructor.Event.SHOW),i=x2(this._element),r=i===null?this._element.ownerDocument.documentElement.contains(this._element):i.contains(this._element);if(e.defaultPrevented||!r)return;this.constructor.NAME==="tooltip"&&this.tip&&this.getTitle()!==this.tip.querySelector(NS).innerHTML&&(this._disposePopper(),this.tip.remove(),this.tip=null);const c=this.getTipElement(),f=sB(this.constructor.NAME);c.setAttribute("id",f),this._element.setAttribute("aria-describedby",f),this._config.animation&&c.classList.add(mg);const y=typeof this._config.placement=="function"?this._config.placement.call(this,c,this._element):this._config.placement,l=this._getAttachment(y);this._addAttachmentClass(l);const{container:I}=this._config;xp.set(c,this.constructor.DATA_KEY,this),this._element.ownerDocument.documentElement.contains(this.tip)||(I.append(c),Xe.trigger(this._element,this.constructor.Event.INSERTED)),this._popper?this._popper.update():this._popper=Ow(this._element,c,this._getPopperConfig(l)),c.classList.add(Jf);const C=this._resolvePossibleFunction(this._config.customClass);C&&c.classList.add(...C.split(" ")),"ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach($=>{Xe.on($,"mouseover",Hg)});const L=()=>{const $=this._hoverState;this._hoverState=null,Xe.trigger(this._element,this.constructor.Event.SHOWN),$===w0&&this._leave(null,this)},R=this.tip.classList.contains(mg);this._queueCallback(L,this.tip,R)}hide(){if(!this._popper)return;const e=this.getTipElement(),i=()=>{this._isWithActiveTrigger()||(this._hoverState!==Qf&&e.remove(),this._cleanTipClass(),this._element.removeAttribute("aria-describedby"),Xe.trigger(this._element,this.constructor.Event.HIDDEN),this._disposePopper())};if(Xe.trigger(this._element,this.constructor.Event.HIDE).defaultPrevented)return;e.classList.remove(Jf),"ontouchstart"in document.documentElement&&[].concat(...document.body.children).forEach(f=>Xe.off(f,"mouseover",Hg)),this._activeTrigger[UU]=!1,this._activeTrigger[E0]=!1,this._activeTrigger[ep]=!1;const c=this.tip.classList.contains(mg);this._queueCallback(i,this.tip,c),this._hoverState=""}update(){this._popper!==null&&this._popper.update()}isWithContent(){return Boolean(this.getTitle())}getTipElement(){if(this.tip)return this.tip;const e=document.createElement("div");e.innerHTML=this._config.template;const i=e.children[0];return this.setContent(i),i.classList.remove(mg,Jf),this.tip=i,this.tip}setContent(e){this._sanitizeAndSetContent(e,this.getTitle(),NS)}_sanitizeAndSetContent(e,i,r){const c=Jt.findOne(r,e);if(!i&&c){c.remove();return}this.setElementContent(c,i)}setElementContent(e,i){if(e!==null){if(Hc(i)){i=Al(i),this._config.html?i.parentNode!==e&&(e.innerHTML="",e.append(i)):e.textContent=i.textContent;return}this._config.html?(this._config.sanitize&&(i=OS(i,this._config.allowList,this._config.sanitizeFn)),e.innerHTML=i):e.textContent=i}}getTitle(){const e=this._element.getAttribute("data-bs-original-title")||this._config.title;return this._resolvePossibleFunction(e)}updateAttachment(e){return e==="right"?"end":e==="left"?"start":e}_initializeOnDelegatedTarget(e,i){return i||this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_getOffset(){const{offset:e}=this._config;return typeof e=="string"?e.split(",").map(i=>Number.parseInt(i,10)):typeof e=="function"?i=>e(i,this._element):e}_resolvePossibleFunction(e){return typeof e=="function"?e.call(this._element):e}_getPopperConfig(e){const i={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"onChange",enabled:!0,phase:"afterWrite",fn:r=>this._handlePopperPlacementChange(r)}],onFirstUpdate:r=>{r.options.placement!==r.placement&&this._handlePopperPlacementChange(r)}};return gi(gi({},i),typeof this._config.popperConfig=="function"?this._config.popperConfig(i):this._config.popperConfig)}_addAttachmentClass(e){this.getTipElement().classList.add(`${this._getBasicClassPrefix()}-${this.updateAttachment(e)}`)}_getAttachment(e){return zU[e.toUpperCase()]}_setListeners(){this._config.trigger.split(" ").forEach(i=>{if(i==="click")Xe.on(this._element,this.constructor.Event.CLICK,this._config.selector,r=>this.toggle(r));else if(i!==VU){const r=i===ep?this.constructor.Event.MOUSEENTER:this.constructor.Event.FOCUSIN,c=i===ep?this.constructor.Event.MOUSELEAVE:this.constructor.Event.FOCUSOUT;Xe.on(this._element,r,this._config.selector,f=>this._enter(f)),Xe.on(this._element,c,this._config.selector,f=>this._leave(f))}}),this._hideModalHandler=()=>{this._element&&this.hide()},Xe.on(this._element.closest(FS),BS,this._hideModalHandler),this._config.selector?this._config=hg(gi({},this._config),{trigger:"manual",selector:""}):this._fixTitle()}_fixTitle(){const e=this._element.getAttribute("title"),i=typeof this._element.getAttribute("data-bs-original-title");(e||i!=="string")&&(this._element.setAttribute("data-bs-original-title",e||""),e&&!this._element.getAttribute("aria-label")&&!this._element.textContent&&this._element.setAttribute("aria-label",e),this._element.setAttribute("title",""))}_enter(e,i){if(i=this._initializeOnDelegatedTarget(e,i),e&&(i._activeTrigger[e.type==="focusin"?E0:ep]=!0),i.getTipElement().classList.contains(Jf)||i._hoverState===Qf){i._hoverState=Qf;return}if(clearTimeout(i._timeout),i._hoverState=Qf,!i._config.delay||!i._config.delay.show){i.show();return}i._timeout=setTimeout(()=>{i._hoverState===Qf&&i.show()},i._config.delay.show)}_leave(e,i){if(i=this._initializeOnDelegatedTarget(e,i),e&&(i._activeTrigger[e.type==="focusout"?E0:ep]=i._element.contains(e.relatedTarget)),!i._isWithActiveTrigger()){if(clearTimeout(i._timeout),i._hoverState=w0,!i._config.delay||!i._config.delay.hide){i.hide();return}i._timeout=setTimeout(()=>{i._hoverState===w0&&i.hide()},i._config.delay.hide)}}_isWithActiveTrigger(){for(const e in this._activeTrigger)if(this._activeTrigger[e])return!0;return!1}_getConfig(e){const i=ar.getDataAttributes(this._element);return Object.keys(i).forEach(r=>{LU.has(r)&&delete i[r]}),e=gi(gi(gi({},this.constructor.Default),i),typeof e=="object"&&e?e:{}),e.container=e.container===!1?document.body:Al(e.container),typeof e.delay=="number"&&(e.delay={show:e.delay,hide:e.delay}),typeof e.title=="number"&&(e.title=e.title.toString()),typeof e.content=="number"&&(e.content=e.content.toString()),Ho(zS,e,this.constructor.DefaultType),e.sanitize&&(e.template=OS(e.template,e.allowList,e.sanitizeFn)),e}_getDelegateConfig(){const e={};for(const i in this._config)this.constructor.Default[i]!==this._config[i]&&(e[i]=this._config[i]);return e}_cleanTipClass(){const e=this.getTipElement(),i=new RegExp(`(^|\\s)${this._getBasicClassPrefix()}\\S+`,"g"),r=e.getAttribute("class").match(i);r!==null&&r.length>0&&r.map(c=>c.trim()).forEach(c=>e.classList.remove(c))}_getBasicClassPrefix(){return RU}_handlePopperPlacementChange(e){const{state:i}=e;!i||(this.tip=i.elements.popper,this._cleanTipClass(),this._addAttachmentClass(this._getAttachment(i.placement)))}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null)}static jQueryInterface(e){return this.each(function(){const i=fd.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof i[e]=="undefined")throw new TypeError(`No method named "${e}"`);i[e]()}})}}Us(fd);const $U="popover",jU="bs.popover",Ro=`.${jU}`,GU="bs-popover",qU=hg(gi({},fd.Default),{placement:"right",offset:[0,8],trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>'}),WU=hg(gi({},fd.DefaultType),{content:"(string|element|function)"}),HU={HIDE:`hide${Ro}`,HIDDEN:`hidden${Ro}`,SHOW:`show${Ro}`,SHOWN:`shown${Ro}`,INSERTED:`inserted${Ro}`,CLICK:`click${Ro}`,FOCUSIN:`focusin${Ro}`,FOCUSOUT:`focusout${Ro}`,MOUSEENTER:`mouseenter${Ro}`,MOUSELEAVE:`mouseleave${Ro}`},KU=".popover-header",ZU=".popover-body";class Fw extends fd{static get Default(){return qU}static get NAME(){return $U}static get Event(){return HU}static get DefaultType(){return WU}isWithContent(){return this.getTitle()||this._getContent()}setContent(e){this._sanitizeAndSetContent(e,this.getTitle(),KU),this._sanitizeAndSetContent(e,this._getContent(),ZU)}_getContent(){return this._resolvePossibleFunction(this._config.content)}_getBasicClassPrefix(){return GU}static jQueryInterface(e){return this.each(function(){const i=Fw.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof i[e]=="undefined")throw new TypeError(`No method named "${e}"`);i[e]()}})}}Us(Fw);const US="scrollspy",XU="bs.scrollspy",qy=`.${XU}`,YU=".data-api",VS={offset:10,method:"auto",target:""},JU={offset:"number",method:"string",target:"(string|element)"},QU=`activate${qy}`,eV=`scroll${qy}`,tV=`load${qy}${YU}`,j2="dropdown-item",yh="active",iV='[data-bs-spy="scroll"]',nV=".nav, .list-group",fb=".nav-link",rV=".nav-item",G2=".list-group-item",T0=`${fb}, ${G2}, .${j2}`,sV=".dropdown",oV=".dropdown-toggle",aV="offset",$S="position";class Wy extends ho{constructor(e,i){super(e),this._scrollElement=this._element.tagName==="BODY"?window:this._element,this._config=this._getConfig(i),this._offsets=[],this._targets=[],this._activeTarget=null,this._scrollHeight=0,Xe.on(this._scrollElement,eV,()=>this._process()),this.refresh(),this._process()}static get Default(){return VS}static get NAME(){return US}refresh(){const e=this._scrollElement===this._scrollElement.window?aV:$S,i=this._config.method==="auto"?e:this._config.method,r=i===$S?this._getScrollTop():0;this._offsets=[],this._targets=[],this._scrollHeight=this._getScrollHeight(),Jt.find(T0,this._config.target).map(f=>{const y=zw(f),l=y?Jt.findOne(y):null;if(l){const I=l.getBoundingClientRect();if(I.width||I.height)return[ar[i](l).top+r,y]}return null}).filter(f=>f).sort((f,y)=>f[0]-y[0]).forEach(f=>{this._offsets.push(f[0]),this._targets.push(f[1])})}dispose(){Xe.off(this._scrollElement,qy),super.dispose()}_getConfig(e){return e=gi(gi(gi({},VS),ar.getDataAttributes(this._element)),typeof e=="object"&&e?e:{}),e.target=Al(e.target)||document.documentElement,Ho(US,e,JU),e}_getScrollTop(){return this._scrollElement===window?this._scrollElement.pageYOffset:this._scrollElement.scrollTop}_getScrollHeight(){return this._scrollElement.scrollHeight||Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}_getOffsetHeight(){return this._scrollElement===window?window.innerHeight:this._scrollElement.getBoundingClientRect().height}_process(){const e=this._getScrollTop()+this._config.offset,i=this._getScrollHeight(),r=this._config.offset+i-this._getOffsetHeight();if(this._scrollHeight!==i&&this.refresh(),e>=r){const c=this._targets[this._targets.length-1];this._activeTarget!==c&&this._activate(c);return}if(this._activeTarget&&e<this._offsets[0]&&this._offsets[0]>0){this._activeTarget=null,this._clear();return}for(let c=this._offsets.length;c--;)this._activeTarget!==this._targets[c]&&e>=this._offsets[c]&&(typeof this._offsets[c+1]=="undefined"||e<this._offsets[c+1])&&this._activate(this._targets[c])}_activate(e){this._activeTarget=e,this._clear();const i=T0.split(",").map(c=>`${c}[data-bs-target="${e}"],${c}[href="${e}"]`),r=Jt.findOne(i.join(","),this._config.target);r.classList.add(yh),r.classList.contains(j2)?Jt.findOne(oV,r.closest(sV)).classList.add(yh):Jt.parents(r,nV).forEach(c=>{Jt.prev(c,`${fb}, ${G2}`).forEach(f=>f.classList.add(yh)),Jt.prev(c,rV).forEach(f=>{Jt.children(f,fb).forEach(y=>y.classList.add(yh))})}),Xe.trigger(this._scrollElement,QU,{relatedTarget:e})}_clear(){Jt.find(T0,this._config.target).filter(e=>e.classList.contains(yh)).forEach(e=>e.classList.remove(yh))}static jQueryInterface(e){return this.each(function(){const i=Wy.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof i[e]=="undefined")throw new TypeError(`No method named "${e}"`);i[e]()}})}}Xe.on(window,tV,()=>{Jt.find(iV).forEach(t=>new Wy(t))});Us(Wy);const lV="tab",cV="bs.tab",dm=`.${cV}`,uV=".data-api",hV=`hide${dm}`,dV=`hidden${dm}`,fV=`show${dm}`,pV=`shown${dm}`,mV=`click${dm}${uV}`,_V="dropdown-menu",tp="active",jS="fade",GS="show",gV=".dropdown",yV=".nav, .list-group",qS=".active",WS=":scope > li > .active",vV='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',xV=".dropdown-toggle",bV=":scope > .dropdown-menu .active";class Hy extends ho{static get NAME(){return lV}show(){if(this._element.parentNode&&this._element.parentNode.nodeType===Node.ELEMENT_NODE&&this._element.classList.contains(tp))return;let e;const i=Sl(this._element),r=this._element.closest(yV);if(r){const l=r.nodeName==="UL"||r.nodeName==="OL"?WS:qS;e=Jt.find(l,r),e=e[e.length-1]}const c=e?Xe.trigger(e,hV,{relatedTarget:this._element}):null;if(Xe.trigger(this._element,fV,{relatedTarget:e}).defaultPrevented||c!==null&&c.defaultPrevented)return;this._activate(this._element,r);const y=()=>{Xe.trigger(e,dV,{relatedTarget:this._element}),Xe.trigger(this._element,pV,{relatedTarget:e})};i?this._activate(i,i.parentNode,y):y()}_activate(e,i,r){const f=(i&&(i.nodeName==="UL"||i.nodeName==="OL")?Jt.find(WS,i):Jt.children(i,qS))[0],y=r&&f&&f.classList.contains(jS),l=()=>this._transitionComplete(e,f,r);f&&y?(f.classList.remove(GS),this._queueCallback(l,e,!0)):l()}_transitionComplete(e,i,r){if(i){i.classList.remove(tp);const f=Jt.findOne(bV,i.parentNode);f&&f.classList.remove(tp),i.getAttribute("role")==="tab"&&i.setAttribute("aria-selected",!1)}e.classList.add(tp),e.getAttribute("role")==="tab"&&e.setAttribute("aria-selected",!0),dd(e),e.classList.contains(jS)&&e.classList.add(GS);let c=e.parentNode;if(c&&c.nodeName==="LI"&&(c=c.parentNode),c&&c.classList.contains(_V)){const f=e.closest(gV);f&&Jt.find(xV,f).forEach(y=>y.classList.add(tp)),e.setAttribute("aria-expanded",!0)}r&&r()}static jQueryInterface(e){return this.each(function(){const i=Hy.getOrCreateInstance(this);if(typeof e=="string"){if(typeof i[e]=="undefined")throw new TypeError(`No method named "${e}"`);i[e]()}})}}Xe.on(document,mV,vV,function(t){if(["A","AREA"].includes(this.tagName)&&t.preventDefault(),Bc(this))return;Hy.getOrCreateInstance(this).show()});Us(Hy);const HS="toast",wV="bs.toast",Ll=`.${wV}`,EV=`mouseover${Ll}`,TV=`mouseout${Ll}`,IV=`focusin${Ll}`,SV=`focusout${Ll}`,AV=`hide${Ll}`,CV=`hidden${Ll}`,MV=`show${Ll}`,kV=`shown${Ll}`,DV="fade",KS="hide",ip="show",_g="showing",PV={animation:"boolean",autohide:"boolean",delay:"number"},ZS={animation:!0,autohide:!0,delay:5e3};class Ky extends ho{constructor(e,i){super(e),this._config=this._getConfig(i),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get DefaultType(){return PV}static get Default(){return ZS}static get NAME(){return HS}show(){if(Xe.trigger(this._element,MV).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(DV);const i=()=>{this._element.classList.remove(_g),Xe.trigger(this._element,kV),this._maybeScheduleHide()};this._element.classList.remove(KS),dd(this._element),this._element.classList.add(ip),this._element.classList.add(_g),this._queueCallback(i,this._element,this._config.animation)}hide(){if(!this._element.classList.contains(ip)||Xe.trigger(this._element,AV).defaultPrevented)return;const i=()=>{this._element.classList.add(KS),this._element.classList.remove(_g),this._element.classList.remove(ip),Xe.trigger(this._element,CV)};this._element.classList.add(_g),this._queueCallback(i,this._element,this._config.animation)}dispose(){this._clearTimeout(),this._element.classList.contains(ip)&&this._element.classList.remove(ip),super.dispose()}_getConfig(e){return e=gi(gi(gi({},ZS),ar.getDataAttributes(this._element)),typeof e=="object"&&e?e:{}),Ho(HS,e,this.constructor.DefaultType),e}_maybeScheduleHide(){!this._config.autohide||this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay))}_onInteraction(e,i){switch(e.type){case"mouseover":case"mouseout":this._hasMouseInteraction=i;break;case"focusin":case"focusout":this._hasKeyboardInteraction=i;break}if(i){this._clearTimeout();return}const r=e.relatedTarget;this._element===r||this._element.contains(r)||this._maybeScheduleHide()}_setListeners(){Xe.on(this._element,EV,e=>this._onInteraction(e,!0)),Xe.on(this._element,TV,e=>this._onInteraction(e,!1)),Xe.on(this._element,IV,e=>this._onInteraction(e,!0)),Xe.on(this._element,SV,e=>this._onInteraction(e,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each(function(){const i=Ky.getOrCreateInstance(this,e);if(typeof e=="string"){if(typeof i[e]=="undefined")throw new TypeError(`No method named "${e}"`);i[e](this)}})}}$y(Ky);Us(Ky);function Bw(t,e){const i=Object.create(null),r=t.split(",");for(let c=0;c<r.length;c++)i[r[c]]=!0;return e?c=>!!i[c.toLowerCase()]:c=>!!i[c]}const RV="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",LV=Bw(RV);function q2(t){return!!t||t===""}function Uw(t){if(Xt(t)){const e={};for(let i=0;i<t.length;i++){const r=t[i],c=Jn(r)?NV(r):Uw(r);if(c)for(const f in c)e[f]=c[f]}return e}else{if(Jn(t))return t;if(Mn(t))return t}}const OV=/;(?![^(]*\))/g,zV=/:(.+)/;function NV(t){const e={};return t.split(OV).forEach(i=>{if(i){const r=i.split(zV);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function Vw(t){let e="";if(Jn(t))e=t;else if(Xt(t))for(let i=0;i<t.length;i++){const r=Vw(t[i]);r&&(e+=r+" ")}else if(Mn(t))for(const i in t)t[i]&&(e+=i+" ");return e.trim()}function FV(t,e){if(t.length!==e.length)return!1;let i=!0;for(let r=0;i&&r<t.length;r++)i=Zy(t[r],e[r]);return i}function Zy(t,e){if(t===e)return!0;let i=XS(t),r=XS(e);if(i||r)return i&&r?t.getTime()===e.getTime():!1;if(i=Xt(t),r=Xt(e),i||r)return i&&r?FV(t,e):!1;if(i=Mn(t),r=Mn(e),i||r){if(!i||!r)return!1;const c=Object.keys(t).length,f=Object.keys(e).length;if(c!==f)return!1;for(const y in t){const l=t.hasOwnProperty(y),I=e.hasOwnProperty(y);if(l&&!I||!l&&I||!Zy(t[y],e[y]))return!1}}return String(t)===String(e)}function BV(t,e){return t.findIndex(i=>Zy(i,e))}const jY=t=>Jn(t)?t:t==null?"":Xt(t)||Mn(t)&&(t.toString===K2||!mi(t.toString))?JSON.stringify(t,W2,2):String(t),W2=(t,e)=>e&&e.__v_isRef?W2(t,e.value):Rh(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((i,[r,c])=>(i[`${r} =>`]=c,i),{})}:Yy(e)?{[`Set(${e.size})`]:[...e.values()]}:Mn(e)&&!Xt(e)&&!Z2(e)?String(e):e,on={},Ph=[],oo=()=>{},UV=()=>!1,VV=/^on[^a-z]/,Xy=t=>VV.test(t),$w=t=>t.startsWith("onUpdate:"),Gr=Object.assign,jw=(t,e)=>{const i=t.indexOf(e);i>-1&&t.splice(i,1)},$V=Object.prototype.hasOwnProperty,Li=(t,e)=>$V.call(t,e),Xt=Array.isArray,Rh=t=>Jy(t)==="[object Map]",Yy=t=>Jy(t)==="[object Set]",XS=t=>t instanceof Date,mi=t=>typeof t=="function",Jn=t=>typeof t=="string",Gw=t=>typeof t=="symbol",Mn=t=>t!==null&&typeof t=="object",H2=t=>Mn(t)&&mi(t.then)&&mi(t.catch),K2=Object.prototype.toString,Jy=t=>K2.call(t),jV=t=>Jy(t).slice(8,-1),Z2=t=>Jy(t)==="[object Object]",qw=t=>Jn(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Pg=Bw(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Qy=t=>{const e=Object.create(null);return i=>e[i]||(e[i]=t(i))},GV=/-(\w)/g,qo=Qy(t=>t.replace(GV,(e,i)=>i?i.toUpperCase():"")),qV=/\B([A-Z])/g,pd=Qy(t=>t.replace(qV,"-$1").toLowerCase()),ev=Qy(t=>t.charAt(0).toUpperCase()+t.slice(1)),I0=Qy(t=>t?`on${ev(t)}`:""),Fp=(t,e)=>!Object.is(t,e),Rg=(t,e)=>{for(let i=0;i<t.length;i++)t[i](e)},Zg=(t,e,i)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:i})},Xg=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let YS;const WV=()=>YS||(YS=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let zo;class HV{constructor(e=!1){this.active=!0,this.effects=[],this.cleanups=[],!e&&zo&&(this.parent=zo,this.index=(zo.scopes||(zo.scopes=[])).push(this)-1)}run(e){if(this.active){const i=zo;try{return zo=this,e()}finally{zo=i}}}on(){zo=this}off(){zo=this.parent}stop(e){if(this.active){let i,r;for(i=0,r=this.effects.length;i<r;i++)this.effects[i].stop();for(i=0,r=this.cleanups.length;i<r;i++)this.cleanups[i]();if(this.scopes)for(i=0,r=this.scopes.length;i<r;i++)this.scopes[i].stop(!0);if(this.parent&&!e){const c=this.parent.scopes.pop();c&&c!==this&&(this.parent.scopes[this.index]=c,c.index=this.index)}this.active=!1}}}function KV(t,e=zo){e&&e.active&&e.effects.push(t)}const Ww=t=>{const e=new Set(t);return e.w=0,e.n=0,e},X2=t=>(t.w&Cl)>0,Y2=t=>(t.n&Cl)>0,ZV=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=Cl},XV=t=>{const{deps:e}=t;if(e.length){let i=0;for(let r=0;r<e.length;r++){const c=e[r];X2(c)&&!Y2(c)?c.delete(t):e[i++]=c,c.w&=~Cl,c.n&=~Cl}e.length=i}},pb=new WeakMap;let hp=0,Cl=1;const mb=30;let to;const Uc=Symbol(""),_b=Symbol("");class Hw{constructor(e,i=null,r){this.fn=e,this.scheduler=i,this.active=!0,this.deps=[],this.parent=void 0,KV(this,r)}run(){if(!this.active)return this.fn();let e=to,i=wl;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=to,to=this,wl=!0,Cl=1<<++hp,hp<=mb?ZV(this):JS(this),this.fn()}finally{hp<=mb&&XV(this),Cl=1<<--hp,to=this.parent,wl=i,this.parent=void 0,this.deferStop&&this.stop()}}stop(){to===this?this.deferStop=!0:this.active&&(JS(this),this.onStop&&this.onStop(),this.active=!1)}}function JS(t){const{deps:e}=t;if(e.length){for(let i=0;i<e.length;i++)e[i].delete(t);e.length=0}}let wl=!0;const J2=[];function md(){J2.push(wl),wl=!1}function _d(){const t=J2.pop();wl=t===void 0?!0:t}function Es(t,e,i){if(wl&&to){let r=pb.get(t);r||pb.set(t,r=new Map);let c=r.get(i);c||r.set(i,c=Ww()),Q2(c)}}function Q2(t,e){let i=!1;hp<=mb?Y2(t)||(t.n|=Cl,i=!X2(t)):i=!t.has(to),i&&(t.add(to),to.deps.push(t))}function Ca(t,e,i,r,c,f){const y=pb.get(t);if(!y)return;let l=[];if(e==="clear")l=[...y.values()];else if(i==="length"&&Xt(t))y.forEach((I,C)=>{(C==="length"||C>=r)&&l.push(I)});else switch(i!==void 0&&l.push(y.get(i)),e){case"add":Xt(t)?qw(i)&&l.push(y.get("length")):(l.push(y.get(Uc)),Rh(t)&&l.push(y.get(_b)));break;case"delete":Xt(t)||(l.push(y.get(Uc)),Rh(t)&&l.push(y.get(_b)));break;case"set":Rh(t)&&l.push(y.get(Uc));break}if(l.length===1)l[0]&&gb(l[0]);else{const I=[];for(const C of l)C&&I.push(...C);gb(Ww(I))}}function gb(t,e){for(const i of Xt(t)?t:[...t])(i!==to||i.allowRecurse)&&(i.scheduler?i.scheduler():i.run())}const YV=Bw("__proto__,__v_isRef,__isVue"),ek=new Set(Object.getOwnPropertyNames(Symbol).map(t=>Symbol[t]).filter(Gw)),JV=Kw(),QV=Kw(!1,!0),e4=Kw(!0),QS=t4();function t4(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...i){const r=Zi(this);for(let f=0,y=this.length;f<y;f++)Es(r,"get",f+"");const c=r[e](...i);return c===-1||c===!1?r[e](...i.map(Zi)):c}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...i){md();const r=Zi(this)[e].apply(this,i);return _d(),r}}),t}function Kw(t=!1,e=!1){return function(r,c,f){if(c==="__v_isReactive")return!t;if(c==="__v_isReadonly")return t;if(c==="__v_isShallow")return e;if(c==="__v_raw"&&f===(t?e?g4:sk:e?rk:nk).get(r))return r;const y=Xt(r);if(!t&&y&&Li(QS,c))return Reflect.get(QS,c,f);const l=Reflect.get(r,c,f);return(Gw(c)?ek.has(c):YV(c))||(t||Es(r,"get",c),e)?l:lr(l)?!y||!qw(c)?l.value:l:Mn(l)?t?ok(l):fm(l):l}}const i4=tk(),n4=tk(!0);function tk(t=!1){return function(i,r,c,f){let y=i[r];if(Bp(y)&&lr(y)&&!lr(c))return!1;if(!t&&!Bp(c)&&(ak(c)||(c=Zi(c),y=Zi(y)),!Xt(i)&&lr(y)&&!lr(c)))return y.value=c,!0;const l=Xt(i)&&qw(r)?Number(r)<i.length:Li(i,r),I=Reflect.set(i,r,c,f);return i===Zi(f)&&(l?Fp(c,y)&&Ca(i,"set",r,c):Ca(i,"add",r,c)),I}}function r4(t,e){const i=Li(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&i&&Ca(t,"delete",e,void 0),r}function s4(t,e){const i=Reflect.has(t,e);return(!Gw(e)||!ek.has(e))&&Es(t,"has",e),i}function o4(t){return Es(t,"iterate",Xt(t)?"length":Uc),Reflect.ownKeys(t)}const ik={get:JV,set:i4,deleteProperty:r4,has:s4,ownKeys:o4},a4={get:e4,set(t,e){return!0},deleteProperty(t,e){return!0}},l4=Gr({},ik,{get:QV,set:n4}),Zw=t=>t,tv=t=>Reflect.getPrototypeOf(t);function gg(t,e,i=!1,r=!1){t=t.__v_raw;const c=Zi(t),f=Zi(e);e!==f&&!i&&Es(c,"get",e),!i&&Es(c,"get",f);const{has:y}=tv(c),l=r?Zw:i?Jw:Up;if(y.call(c,e))return l(t.get(e));if(y.call(c,f))return l(t.get(f));t!==c&&t.get(e)}function yg(t,e=!1){const i=this.__v_raw,r=Zi(i),c=Zi(t);return t!==c&&!e&&Es(r,"has",t),!e&&Es(r,"has",c),t===c?i.has(t):i.has(t)||i.has(c)}function vg(t,e=!1){return t=t.__v_raw,!e&&Es(Zi(t),"iterate",Uc),Reflect.get(t,"size",t)}function eA(t){t=Zi(t);const e=Zi(this);return tv(e).has.call(e,t)||(e.add(t),Ca(e,"add",t,t)),this}function tA(t,e){e=Zi(e);const i=Zi(this),{has:r,get:c}=tv(i);let f=r.call(i,t);f||(t=Zi(t),f=r.call(i,t));const y=c.call(i,t);return i.set(t,e),f?Fp(e,y)&&Ca(i,"set",t,e):Ca(i,"add",t,e),this}function iA(t){const e=Zi(this),{has:i,get:r}=tv(e);let c=i.call(e,t);c||(t=Zi(t),c=i.call(e,t)),r&&r.call(e,t);const f=e.delete(t);return c&&Ca(e,"delete",t,void 0),f}function nA(){const t=Zi(this),e=t.size!==0,i=t.clear();return e&&Ca(t,"clear",void 0,void 0),i}function xg(t,e){return function(r,c){const f=this,y=f.__v_raw,l=Zi(y),I=e?Zw:t?Jw:Up;return!t&&Es(l,"iterate",Uc),y.forEach((C,L)=>r.call(c,I(C),I(L),f))}}function bg(t,e,i){return function(...r){const c=this.__v_raw,f=Zi(c),y=Rh(f),l=t==="entries"||t===Symbol.iterator&&y,I=t==="keys"&&y,C=c[t](...r),L=i?Zw:e?Jw:Up;return!e&&Es(f,"iterate",I?_b:Uc),{next(){const{value:R,done:$}=C.next();return $?{value:R,done:$}:{value:l?[L(R[0]),L(R[1])]:L(R),done:$}},[Symbol.iterator](){return this}}}}function hl(t){return function(...e){return t==="delete"?!1:this}}function c4(){const t={get(f){return gg(this,f)},get size(){return vg(this)},has:yg,add:eA,set:tA,delete:iA,clear:nA,forEach:xg(!1,!1)},e={get(f){return gg(this,f,!1,!0)},get size(){return vg(this)},has:yg,add:eA,set:tA,delete:iA,clear:nA,forEach:xg(!1,!0)},i={get(f){return gg(this,f,!0)},get size(){return vg(this,!0)},has(f){return yg.call(this,f,!0)},add:hl("add"),set:hl("set"),delete:hl("delete"),clear:hl("clear"),forEach:xg(!0,!1)},r={get(f){return gg(this,f,!0,!0)},get size(){return vg(this,!0)},has(f){return yg.call(this,f,!0)},add:hl("add"),set:hl("set"),delete:hl("delete"),clear:hl("clear"),forEach:xg(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(f=>{t[f]=bg(f,!1,!1),i[f]=bg(f,!0,!1),e[f]=bg(f,!1,!0),r[f]=bg(f,!0,!0)}),[t,i,e,r]}const[u4,h4,d4,f4]=c4();function Xw(t,e){const i=e?t?f4:d4:t?h4:u4;return(r,c,f)=>c==="__v_isReactive"?!t:c==="__v_isReadonly"?t:c==="__v_raw"?r:Reflect.get(Li(i,c)&&c in r?i:r,c,f)}const p4={get:Xw(!1,!1)},m4={get:Xw(!1,!0)},_4={get:Xw(!0,!1)},nk=new WeakMap,rk=new WeakMap,sk=new WeakMap,g4=new WeakMap;function y4(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function v4(t){return t.__v_skip||!Object.isExtensible(t)?0:y4(jV(t))}function fm(t){return Bp(t)?t:Yw(t,!1,ik,p4,nk)}function x4(t){return Yw(t,!1,l4,m4,rk)}function ok(t){return Yw(t,!0,a4,_4,sk)}function Yw(t,e,i,r,c){if(!Mn(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const f=c.get(t);if(f)return f;const y=v4(t);if(y===0)return t;const l=new Proxy(t,y===2?r:i);return c.set(t,l),l}function Lh(t){return Bp(t)?Lh(t.__v_raw):!!(t&&t.__v_isReactive)}function Bp(t){return!!(t&&t.__v_isReadonly)}function ak(t){return!!(t&&t.__v_isShallow)}function lk(t){return Lh(t)||Bp(t)}function Zi(t){const e=t&&t.__v_raw;return e?Zi(e):t}function ck(t){return Zg(t,"__v_skip",!0),t}const Up=t=>Mn(t)?fm(t):t,Jw=t=>Mn(t)?ok(t):t;function uk(t){wl&&to&&(t=Zi(t),Q2(t.dep||(t.dep=Ww())))}function hk(t,e){t=Zi(t),t.dep&&gb(t.dep)}function lr(t){return!!(t&&t.__v_isRef===!0)}function dk(t){return fk(t,!1)}function b4(t){return fk(t,!0)}function fk(t,e){return lr(t)?t:new w4(t,e)}class w4{constructor(e,i){this.__v_isShallow=i,this.dep=void 0,this.__v_isRef=!0,this._rawValue=i?e:Zi(e),this._value=i?e:Up(e)}get value(){return uk(this),this._value}set value(e){e=this.__v_isShallow?e:Zi(e),Fp(e,this._rawValue)&&(this._rawValue=e,this._value=this.__v_isShallow?e:Up(e),hk(this))}}function wp(t){return lr(t)?t.value:t}const E4={get:(t,e,i)=>wp(Reflect.get(t,e,i)),set:(t,e,i,r)=>{const c=t[e];return lr(c)&&!lr(i)?(c.value=i,!0):Reflect.set(t,e,i,r)}};function pk(t){return Lh(t)?t:new Proxy(t,E4)}class T4{constructor(e,i,r,c){this._setter=i,this.dep=void 0,this.__v_isRef=!0,this._dirty=!0,this.effect=new Hw(e,()=>{this._dirty||(this._dirty=!0,hk(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!c,this.__v_isReadonly=r}get value(){const e=Zi(this);return uk(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function I4(t,e,i=!1){let r,c;const f=mi(t);return f?(r=t,c=oo):(r=t.get,c=t.set),new T4(r,c,f||!c,i)}function El(t,e,i,r){let c;try{c=r?t(...r):t()}catch(f){iv(f,e,i)}return c}function ao(t,e,i,r){if(mi(t)){const f=El(t,e,i,r);return f&&H2(f)&&f.catch(y=>{iv(y,e,i)}),f}const c=[];for(let f=0;f<t.length;f++)c.push(ao(t[f],e,i,r));return c}function iv(t,e,i,r=!0){const c=e?e.vnode:null;if(e){let f=e.parent;const y=e.proxy,l=i;for(;f;){const C=f.ec;if(C){for(let L=0;L<C.length;L++)if(C[L](t,y,l)===!1)return}f=f.parent}const I=e.appContext.config.errorHandler;if(I){El(I,null,10,[t,y,l]);return}}S4(t,i,c,r)}function S4(t,e,i,r=!0){console.error(t)}let Yg=!1,yb=!1;const gs=[];let ya=0;const Ep=[];let dp=null,Eh=0;const Tp=[];let ml=null,Th=0;const mk=Promise.resolve();let Qw=null,vb=null;function _k(t){const e=Qw||mk;return t?e.then(this?t.bind(this):t):e}function A4(t){let e=ya+1,i=gs.length;for(;e<i;){const r=e+i>>>1;Vp(gs[r])<t?e=r+1:i=r}return e}function gk(t){(!gs.length||!gs.includes(t,Yg&&t.allowRecurse?ya+1:ya))&&t!==vb&&(t.id==null?gs.push(t):gs.splice(A4(t.id),0,t),yk())}function yk(){!Yg&&!yb&&(yb=!0,Qw=mk.then(bk))}function C4(t){const e=gs.indexOf(t);e>ya&&gs.splice(e,1)}function vk(t,e,i,r){Xt(t)?i.push(...t):(!e||!e.includes(t,t.allowRecurse?r+1:r))&&i.push(t),yk()}function M4(t){vk(t,dp,Ep,Eh)}function k4(t){vk(t,ml,Tp,Th)}function e1(t,e=null){if(Ep.length){for(vb=e,dp=[...new Set(Ep)],Ep.length=0,Eh=0;Eh<dp.length;Eh++)dp[Eh]();dp=null,Eh=0,vb=null,e1(t,e)}}function xk(t){if(Tp.length){const e=[...new Set(Tp)];if(Tp.length=0,ml){ml.push(...e);return}for(ml=e,ml.sort((i,r)=>Vp(i)-Vp(r)),Th=0;Th<ml.length;Th++)ml[Th]();ml=null,Th=0}}const Vp=t=>t.id==null?1/0:t.id;function bk(t){yb=!1,Yg=!0,e1(t),gs.sort((i,r)=>Vp(i)-Vp(r));const e=oo;try{for(ya=0;ya<gs.length;ya++){const i=gs[ya];i&&i.active!==!1&&El(i,null,14)}}finally{ya=0,gs.length=0,xk(),Yg=!1,Qw=null,(gs.length||Ep.length||Tp.length)&&bk(t)}}function D4(t,e,...i){if(t.isUnmounted)return;const r=t.vnode.props||on;let c=i;const f=e.startsWith("update:"),y=f&&e.slice(7);if(y&&y in r){const L=`${y==="modelValue"?"model":y}Modifiers`,{number:R,trim:$}=r[L]||on;$?c=i.map(J=>J.trim()):R&&(c=i.map(Xg))}let l,I=r[l=I0(e)]||r[l=I0(qo(e))];!I&&f&&(I=r[l=I0(pd(e))]),I&&ao(I,t,6,c);const C=r[l+"Once"];if(C){if(!t.emitted)t.emitted={};else if(t.emitted[l])return;t.emitted[l]=!0,ao(C,t,6,c)}}function wk(t,e,i=!1){const r=e.emitsCache,c=r.get(t);if(c!==void 0)return c;const f=t.emits;let y={},l=!1;if(!mi(t)){const I=C=>{const L=wk(C,e,!0);L&&(l=!0,Gr(y,L))};!i&&e.mixins.length&&e.mixins.forEach(I),t.extends&&I(t.extends),t.mixins&&t.mixins.forEach(I)}return!f&&!l?(r.set(t,null),null):(Xt(f)?f.forEach(I=>y[I]=null):Gr(y,f),r.set(t,y),y)}function nv(t,e){return!t||!Xy(e)?!1:(e=e.slice(2).replace(/Once$/,""),Li(t,e[0].toLowerCase()+e.slice(1))||Li(t,pd(e))||Li(t,e))}let ro=null,rv=null;function Jg(t){const e=ro;return ro=t,rv=t&&t.type.__scopeId||null,e}function GY(t){rv=t}function qY(){rv=null}function P4(t,e=ro,i){if(!e||t._n)return t;const r=(...c)=>{r._d&&fA(-1);const f=Jg(e),y=t(...c);return Jg(f),r._d&&fA(1),y};return r._n=!0,r._c=!0,r._d=!0,r}function S0(t){const{type:e,vnode:i,proxy:r,withProxy:c,props:f,propsOptions:[y],slots:l,attrs:I,emit:C,render:L,renderCache:R,data:$,setupState:J,ctx:pe,inheritAttrs:Re}=t;let we,Be;const nt=Jg(t);try{if(i.shapeFlag&4){const lt=c||r;we=No(L.call(lt,lt,R,f,J,$,pe)),Be=I}else{const lt=e;we=No(lt.length>1?lt(f,{attrs:I,slots:l,emit:C}):lt(f,null)),Be=e.props?I:R4(I)}}catch(lt){Ip.length=0,iv(lt,t,1),we=as(Zc)}let yt=we;if(Be&&Re!==!1){const lt=Object.keys(Be),{shapeFlag:zt}=yt;lt.length&&zt&7&&(y&&lt.some($w)&&(Be=L4(Be,y)),yt=$p(yt,Be))}return i.dirs&&(yt.dirs=yt.dirs?yt.dirs.concat(i.dirs):i.dirs),i.transition&&(yt.transition=i.transition),we=yt,Jg(nt),we}const R4=t=>{let e;for(const i in t)(i==="class"||i==="style"||Xy(i))&&((e||(e={}))[i]=t[i]);return e},L4=(t,e)=>{const i={};for(const r in t)(!$w(r)||!(r.slice(9)in e))&&(i[r]=t[r]);return i};function O4(t,e,i){const{props:r,children:c,component:f}=t,{props:y,children:l,patchFlag:I}=e,C=f.emitsOptions;if(e.dirs||e.transition)return!0;if(i&&I>=0){if(I&1024)return!0;if(I&16)return r?rA(r,y,C):!!y;if(I&8){const L=e.dynamicProps;for(let R=0;R<L.length;R++){const $=L[R];if(y[$]!==r[$]&&!nv(C,$))return!0}}}else return(c||l)&&(!l||!l.$stable)?!0:r===y?!1:r?y?rA(r,y,C):!0:!!y;return!1}function rA(t,e,i){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let c=0;c<r.length;c++){const f=r[c];if(e[f]!==t[f]&&!nv(i,f))return!0}return!1}function z4({vnode:t,parent:e},i){for(;e&&e.subTree===t;)(t=e.vnode).el=i,e=e.parent}const N4=t=>t.__isSuspense;function F4(t,e){e&&e.pendingBranch?Xt(t)?e.effects.push(...t):e.effects.push(t):k4(t)}function Lg(t,e){if(sr){let i=sr.provides;const r=sr.parent&&sr.parent.provides;r===i&&(i=sr.provides=Object.create(r)),i[t]=e}}function Vo(t,e,i=!1){const r=sr||ro;if(r){const c=r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides;if(c&&t in c)return c[t];if(arguments.length>1)return i&&mi(e)?e.call(r.proxy):e}}const sA={};function Og(t,e,i){return Ek(t,e,i)}function Ek(t,e,{immediate:i,deep:r,flush:c,onTrack:f,onTrigger:y}=on){const l=sr;let I,C=!1,L=!1;if(lr(t)?(I=()=>t.value,C=ak(t)):Lh(t)?(I=()=>t,r=!0):Xt(t)?(L=!0,C=t.some(Lh),I=()=>t.map(Be=>{if(lr(Be))return Be.value;if(Lh(Be))return Dc(Be);if(mi(Be))return El(Be,l,2)})):mi(t)?e?I=()=>El(t,l,2):I=()=>{if(!(l&&l.isUnmounted))return R&&R(),ao(t,l,3,[$])}:I=oo,e&&r){const Be=I;I=()=>Dc(Be())}let R,$=Be=>{R=we.onStop=()=>{El(Be,l,4)}};if(jp)return $=oo,e?i&&ao(e,l,3,[I(),L?[]:void 0,$]):I(),oo;let J=L?[]:sA;const pe=()=>{if(!!we.active)if(e){const Be=we.run();(r||C||(L?Be.some((nt,yt)=>Fp(nt,J[yt])):Fp(Be,J)))&&(R&&R(),ao(e,l,3,[Be,J===sA?void 0:J,$]),J=Be)}else we.run()};pe.allowRecurse=!!e;let Re;c==="sync"?Re=pe:c==="post"?Re=()=>ns(pe,l&&l.suspense):Re=()=>{!l||l.isMounted?M4(pe):pe()};const we=new Hw(I,Re);return e?i?pe():J=we.run():c==="post"?ns(we.run.bind(we),l&&l.suspense):we.run(),()=>{we.stop(),l&&l.scope&&jw(l.scope.effects,we)}}function B4(t,e,i){const r=this.proxy,c=Jn(t)?t.includes(".")?Tk(r,t):()=>r[t]:t.bind(r,r);let f;mi(e)?f=e:(f=e.handler,i=e);const y=sr;Zh(this);const l=Ek(c,f.bind(r),i);return y?Zh(y):$c(),l}function Tk(t,e){const i=e.split(".");return()=>{let r=t;for(let c=0;c<i.length&&r;c++)r=r[i[c]];return r}}function Dc(t,e){if(!Mn(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),lr(t))Dc(t.value,e);else if(Xt(t))for(let i=0;i<t.length;i++)Dc(t[i],e);else if(Yy(t)||Rh(t))t.forEach(i=>{Dc(i,e)});else if(Z2(t))for(const i in t)Dc(t[i],e);return t}function Ik(t){return mi(t)?{setup:t,name:t.name}:t}const xb=t=>!!t.type.__asyncLoader,Sk=t=>t.type.__isKeepAlive;function U4(t,e){Ak(t,"a",e)}function V4(t,e){Ak(t,"da",e)}function Ak(t,e,i=sr){const r=t.__wdc||(t.__wdc=()=>{let c=i;for(;c;){if(c.isDeactivated)return;c=c.parent}return t()});if(sv(e,r,i),i){let c=i.parent;for(;c&&c.parent;)Sk(c.parent.vnode)&&$4(r,e,i,c),c=c.parent}}function $4(t,e,i,r){const c=sv(e,t,r,!0);Mk(()=>{jw(r[e],c)},i)}function sv(t,e,i=sr,r=!1){if(i){const c=i[t]||(i[t]=[]),f=e.__weh||(e.__weh=(...y)=>{if(i.isUnmounted)return;md(),Zh(i);const l=ao(e,i,t,y);return $c(),_d(),l});return r?c.unshift(f):c.push(f),f}}const Da=t=>(e,i=sr)=>(!jp||t==="sp")&&sv(t,e,i),j4=Da("bm"),Ck=Da("m"),G4=Da("bu"),q4=Da("u"),W4=Da("bum"),Mk=Da("um"),H4=Da("sp"),K4=Da("rtg"),Z4=Da("rtc");function X4(t,e=sr){sv("ec",t,e)}let bb=!0;function Y4(t){const e=Dk(t),i=t.proxy,r=t.ctx;bb=!1,e.beforeCreate&&oA(e.beforeCreate,t,"bc");const{data:c,computed:f,methods:y,watch:l,provide:I,inject:C,created:L,beforeMount:R,mounted:$,beforeUpdate:J,updated:pe,activated:Re,deactivated:we,beforeDestroy:Be,beforeUnmount:nt,destroyed:yt,unmounted:lt,render:zt,renderTracked:rt,renderTriggered:Wt,errorCaptured:hi,serverPrefetch:_i,expose:Ci,inheritAttrs:Ht,components:$i,directives:Xi,filters:Nn}=e;if(C&&J4(C,r,null,t.appContext.config.unwrapInjectedRef),y)for(const Zt in y){const Qt=y[Zt];mi(Qt)&&(r[Zt]=Qt.bind(i))}if(c){const Zt=c.call(i,i);Mn(Zt)&&(t.data=fm(Zt))}if(bb=!0,f)for(const Zt in f){const Qt=f[Zt],Ui=mi(Qt)?Qt.bind(i,i):mi(Qt.get)?Qt.get.bind(i,i):oo,Bn=!mi(Qt)&&mi(Qt.set)?Qt.set.bind(i):oo,Ji=Fo({get:Ui,set:Bn});Object.defineProperty(r,Zt,{enumerable:!0,configurable:!0,get:()=>Ji.value,set:vn=>Ji.value=vn})}if(l)for(const Zt in l)kk(l[Zt],r,i,Zt);if(I){const Zt=mi(I)?I.call(i):I;Reflect.ownKeys(Zt).forEach(Qt=>{Lg(Qt,Zt[Qt])})}L&&oA(L,t,"c");function si(Zt,Qt){Xt(Qt)?Qt.forEach(Ui=>Zt(Ui.bind(i))):Qt&&Zt(Qt.bind(i))}if(si(j4,R),si(Ck,$),si(G4,J),si(q4,pe),si(U4,Re),si(V4,we),si(X4,hi),si(Z4,rt),si(K4,Wt),si(W4,nt),si(Mk,lt),si(H4,_i),Xt(Ci))if(Ci.length){const Zt=t.exposed||(t.exposed={});Ci.forEach(Qt=>{Object.defineProperty(Zt,Qt,{get:()=>i[Qt],set:Ui=>i[Qt]=Ui})})}else t.exposed||(t.exposed={});zt&&t.render===oo&&(t.render=zt),Ht!=null&&(t.inheritAttrs=Ht),$i&&(t.components=$i),Xi&&(t.directives=Xi)}function J4(t,e,i=oo,r=!1){Xt(t)&&(t=wb(t));for(const c in t){const f=t[c];let y;Mn(f)?"default"in f?y=Vo(f.from||c,f.default,!0):y=Vo(f.from||c):y=Vo(f),lr(y)&&r?Object.defineProperty(e,c,{enumerable:!0,configurable:!0,get:()=>y.value,set:l=>y.value=l}):e[c]=y}}function oA(t,e,i){ao(Xt(t)?t.map(r=>r.bind(e.proxy)):t.bind(e.proxy),e,i)}function kk(t,e,i,r){const c=r.includes(".")?Tk(i,r):()=>i[r];if(Jn(t)){const f=e[t];mi(f)&&Og(c,f)}else if(mi(t))Og(c,t.bind(i));else if(Mn(t))if(Xt(t))t.forEach(f=>kk(f,e,i,r));else{const f=mi(t.handler)?t.handler.bind(i):e[t.handler];mi(f)&&Og(c,f,t)}}function Dk(t){const e=t.type,{mixins:i,extends:r}=e,{mixins:c,optionsCache:f,config:{optionMergeStrategies:y}}=t.appContext,l=f.get(e);let I;return l?I=l:!c.length&&!i&&!r?I=e:(I={},c.length&&c.forEach(C=>Qg(I,C,y,!0)),Qg(I,e,y)),f.set(e,I),I}function Qg(t,e,i,r=!1){const{mixins:c,extends:f}=e;f&&Qg(t,f,i,!0),c&&c.forEach(y=>Qg(t,y,i,!0));for(const y in e)if(!(r&&y==="expose")){const l=Q4[y]||i&&i[y];t[y]=l?l(t[y],e[y]):e[y]}return t}const Q4={data:aA,props:Ic,emits:Ic,methods:Ic,computed:Ic,beforeCreate:Fr,created:Fr,beforeMount:Fr,mounted:Fr,beforeUpdate:Fr,updated:Fr,beforeDestroy:Fr,beforeUnmount:Fr,destroyed:Fr,unmounted:Fr,activated:Fr,deactivated:Fr,errorCaptured:Fr,serverPrefetch:Fr,components:Ic,directives:Ic,watch:t5,provide:aA,inject:e5};function aA(t,e){return e?t?function(){return Gr(mi(t)?t.call(this,this):t,mi(e)?e.call(this,this):e)}:e:t}function e5(t,e){return Ic(wb(t),wb(e))}function wb(t){if(Xt(t)){const e={};for(let i=0;i<t.length;i++)e[t[i]]=t[i];return e}return t}function Fr(t,e){return t?[...new Set([].concat(t,e))]:e}function Ic(t,e){return t?Gr(Gr(Object.create(null),t),e):e}function t5(t,e){if(!t)return e;if(!e)return t;const i=Gr(Object.create(null),t);for(const r in e)i[r]=Fr(t[r],e[r]);return i}function i5(t,e,i,r=!1){const c={},f={};Zg(f,ov,1),t.propsDefaults=Object.create(null),Pk(t,e,c,f);for(const y in t.propsOptions[0])y in c||(c[y]=void 0);i?t.props=r?c:x4(c):t.type.props?t.props=c:t.props=f,t.attrs=f}function n5(t,e,i,r){const{props:c,attrs:f,vnode:{patchFlag:y}}=t,l=Zi(c),[I]=t.propsOptions;let C=!1;if((r||y>0)&&!(y&16)){if(y&8){const L=t.vnode.dynamicProps;for(let R=0;R<L.length;R++){let $=L[R];if(nv(t.emitsOptions,$))continue;const J=e[$];if(I)if(Li(f,$))J!==f[$]&&(f[$]=J,C=!0);else{const pe=qo($);c[pe]=Eb(I,l,pe,J,t,!1)}else J!==f[$]&&(f[$]=J,C=!0)}}}else{Pk(t,e,c,f)&&(C=!0);let L;for(const R in l)(!e||!Li(e,R)&&((L=pd(R))===R||!Li(e,L)))&&(I?i&&(i[R]!==void 0||i[L]!==void 0)&&(c[R]=Eb(I,l,R,void 0,t,!0)):delete c[R]);if(f!==l)for(const R in f)(!e||!Li(e,R)&&!0)&&(delete f[R],C=!0)}C&&Ca(t,"set","$attrs")}function Pk(t,e,i,r){const[c,f]=t.propsOptions;let y=!1,l;if(e)for(let I in e){if(Pg(I))continue;const C=e[I];let L;c&&Li(c,L=qo(I))?!f||!f.includes(L)?i[L]=C:(l||(l={}))[L]=C:nv(t.emitsOptions,I)||(!(I in r)||C!==r[I])&&(r[I]=C,y=!0)}if(f){const I=Zi(i),C=l||on;for(let L=0;L<f.length;L++){const R=f[L];i[R]=Eb(c,I,R,C[R],t,!Li(C,R))}}return y}function Eb(t,e,i,r,c,f){const y=t[i];if(y!=null){const l=Li(y,"default");if(l&&r===void 0){const I=y.default;if(y.type!==Function&&mi(I)){const{propsDefaults:C}=c;i in C?r=C[i]:(Zh(c),r=C[i]=I.call(null,e),$c())}else r=I}y[0]&&(f&&!l?r=!1:y[1]&&(r===""||r===pd(i))&&(r=!0))}return r}function Rk(t,e,i=!1){const r=e.propsCache,c=r.get(t);if(c)return c;const f=t.props,y={},l=[];let I=!1;if(!mi(t)){const L=R=>{I=!0;const[$,J]=Rk(R,e,!0);Gr(y,$),J&&l.push(...J)};!i&&e.mixins.length&&e.mixins.forEach(L),t.extends&&L(t.extends),t.mixins&&t.mixins.forEach(L)}if(!f&&!I)return r.set(t,Ph),Ph;if(Xt(f))for(let L=0;L<f.length;L++){const R=qo(f[L]);lA(R)&&(y[R]=on)}else if(f)for(const L in f){const R=qo(L);if(lA(R)){const $=f[L],J=y[R]=Xt($)||mi($)?{type:$}:$;if(J){const pe=hA(Boolean,J.type),Re=hA(String,J.type);J[0]=pe>-1,J[1]=Re<0||pe<Re,(pe>-1||Li(J,"default"))&&l.push(R)}}}const C=[y,l];return r.set(t,C),C}function lA(t){return t[0]!=="$"}function cA(t){const e=t&&t.toString().match(/^\s*function (\w+)/);return e?e[1]:t===null?"null":""}function uA(t,e){return cA(t)===cA(e)}function hA(t,e){return Xt(e)?e.findIndex(i=>uA(i,t)):mi(e)&&uA(e,t)?0:-1}const Lk=t=>t[0]==="_"||t==="$stable",t1=t=>Xt(t)?t.map(No):[No(t)],r5=(t,e,i)=>{const r=P4((...c)=>t1(e(...c)),i);return r._c=!1,r},Ok=(t,e,i)=>{const r=t._ctx;for(const c in t){if(Lk(c))continue;const f=t[c];if(mi(f))e[c]=r5(c,f,r);else if(f!=null){const y=t1(f);e[c]=()=>y}}},zk=(t,e)=>{const i=t1(e);t.slots.default=()=>i},s5=(t,e)=>{if(t.vnode.shapeFlag&32){const i=e._;i?(t.slots=Zi(e),Zg(e,"_",i)):Ok(e,t.slots={})}else t.slots={},e&&zk(t,e);Zg(t.slots,ov,1)},o5=(t,e,i)=>{const{vnode:r,slots:c}=t;let f=!0,y=on;if(r.shapeFlag&32){const l=e._;l?i&&l===1?f=!1:(Gr(c,e),!i&&l===1&&delete c._):(f=!e.$stable,Ok(e,c)),y=e}else e&&(zk(t,e),y={default:1});if(f)for(const l in c)!Lk(l)&&!(l in y)&&delete c[l]};function WY(t,e){const i=ro;if(i===null)return t;const r=av(i)||i.proxy,c=t.dirs||(t.dirs=[]);for(let f=0;f<e.length;f++){let[y,l,I,C=on]=e[f];mi(y)&&(y={mounted:y,updated:y}),y.deep&&Dc(l),c.push({dir:y,instance:r,value:l,oldValue:void 0,arg:I,modifiers:C})}return t}function wc(t,e,i,r){const c=t.dirs,f=e&&e.dirs;for(let y=0;y<c.length;y++){const l=c[y];f&&(l.oldValue=f[y].value);let I=l.dir[r];I&&(md(),ao(I,i,8,[t.el,l,t,e]),_d())}}function Nk(){return{app:null,config:{isNativeTag:UV,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let a5=0;function l5(t,e){return function(r,c=null){mi(r)||(r=Object.assign({},r)),c!=null&&!Mn(c)&&(c=null);const f=Nk(),y=new Set;let l=!1;const I=f.app={_uid:a5++,_component:r,_props:c,_container:null,_context:f,_instance:null,version:D5,get config(){return f.config},set config(C){},use(C,...L){return y.has(C)||(C&&mi(C.install)?(y.add(C),C.install(I,...L)):mi(C)&&(y.add(C),C(I,...L))),I},mixin(C){return f.mixins.includes(C)||f.mixins.push(C),I},component(C,L){return L?(f.components[C]=L,I):f.components[C]},directive(C,L){return L?(f.directives[C]=L,I):f.directives[C]},mount(C,L,R){if(!l){const $=as(r,c);return $.appContext=f,L&&e?e($,C):t($,C,R),l=!0,I._container=C,C.__vue_app__=I,av($.component)||$.component.proxy}},unmount(){l&&(t(null,I._container),delete I._container.__vue_app__)},provide(C,L){return f.provides[C]=L,I}};return I}}function Tb(t,e,i,r,c=!1){if(Xt(t)){t.forEach(($,J)=>Tb($,e&&(Xt(e)?e[J]:e),i,r,c));return}if(xb(r)&&!c)return;const f=r.shapeFlag&4?av(r.component)||r.component.proxy:r.el,y=c?null:f,{i:l,r:I}=t,C=e&&e.r,L=l.refs===on?l.refs={}:l.refs,R=l.setupState;if(C!=null&&C!==I&&(Jn(C)?(L[C]=null,Li(R,C)&&(R[C]=null)):lr(C)&&(C.value=null)),mi(I))El(I,l,12,[y,L]);else{const $=Jn(I),J=lr(I);if($||J){const pe=()=>{if(t.f){const Re=$?L[I]:I.value;c?Xt(Re)&&jw(Re,f):Xt(Re)?Re.includes(f)||Re.push(f):$?(L[I]=[f],Li(R,I)&&(R[I]=L[I])):(I.value=[f],t.k&&(L[t.k]=I.value))}else $?(L[I]=y,Li(R,I)&&(R[I]=y)):lr(I)&&(I.value=y,t.k&&(L[t.k]=y))};y?(pe.id=-1,ns(pe,i)):pe()}}}const ns=F4;function c5(t){return u5(t)}function u5(t,e){const i=WV();i.__VUE__=!0;const{insert:r,remove:c,patchProp:f,createElement:y,createText:l,createComment:I,setText:C,setElementText:L,parentNode:R,nextSibling:$,setScopeId:J=oo,cloneNode:pe,insertStaticContent:Re}=t,we=(se,me,Ie,Ue=null,De=null,Ye=null,ut=!1,je=null,Je=!!me.dynamicChildren)=>{if(se===me)return;se&&!np(se,me)&&(Ue=bt(se),Kt(se,De,Ye,!0),se=null),me.patchFlag===-2&&(Je=!1,me.dynamicChildren=null);const{type:qe,ref:Pt,shapeFlag:wt}=me;switch(qe){case i1:Be(se,me,Ie,Ue);break;case Zc:nt(se,me,Ie,Ue);break;case zg:se==null&&yt(me,Ie,Ue,ut);break;case ga:Xi(se,me,Ie,Ue,De,Ye,ut,je,Je);break;default:wt&1?rt(se,me,Ie,Ue,De,Ye,ut,je,Je):wt&6?Nn(se,me,Ie,Ue,De,Ye,ut,je,Je):(wt&64||wt&128)&&qe.process(se,me,Ie,Ue,De,Ye,ut,je,Je,xi)}Pt!=null&&De&&Tb(Pt,se&&se.ref,Ye,me||se,!me)},Be=(se,me,Ie,Ue)=>{if(se==null)r(me.el=l(me.children),Ie,Ue);else{const De=me.el=se.el;me.children!==se.children&&C(De,me.children)}},nt=(se,me,Ie,Ue)=>{se==null?r(me.el=I(me.children||""),Ie,Ue):me.el=se.el},yt=(se,me,Ie,Ue)=>{[se.el,se.anchor]=Re(se.children,me,Ie,Ue,se.el,se.anchor)},lt=({el:se,anchor:me},Ie,Ue)=>{let De;for(;se&&se!==me;)De=$(se),r(se,Ie,Ue),se=De;r(me,Ie,Ue)},zt=({el:se,anchor:me})=>{let Ie;for(;se&&se!==me;)Ie=$(se),c(se),se=Ie;c(me)},rt=(se,me,Ie,Ue,De,Ye,ut,je,Je)=>{ut=ut||me.type==="svg",se==null?Wt(me,Ie,Ue,De,Ye,ut,je,Je):Ci(se,me,De,Ye,ut,je,Je)},Wt=(se,me,Ie,Ue,De,Ye,ut,je)=>{let Je,qe;const{type:Pt,props:wt,shapeFlag:Ct,transition:Rt,patchFlag:Yt,dirs:di}=se;if(se.el&&pe!==void 0&&Yt===-1)Je=se.el=pe(se.el);else{if(Je=se.el=y(se.type,Ye,wt&&wt.is,wt),Ct&8?L(Je,se.children):Ct&16&&_i(se.children,Je,null,Ue,De,Ye&&Pt!=="foreignObject",ut,je),di&&wc(se,null,Ue,"created"),wt){for(const Mi in wt)Mi!=="value"&&!Pg(Mi)&&f(Je,Mi,null,wt[Mi],Ye,se.children,Ue,De,tt);"value"in wt&&f(Je,"value",null,wt.value),(qe=wt.onVnodeBeforeMount)&&Lo(qe,Ue,se)}hi(Je,se,se.scopeId,ut,Ue)}di&&wc(se,null,Ue,"beforeMount");const fi=(!De||De&&!De.pendingBranch)&&Rt&&!Rt.persisted;fi&&Rt.beforeEnter(Je),r(Je,me,Ie),((qe=wt&&wt.onVnodeMounted)||fi||di)&&ns(()=>{qe&&Lo(qe,Ue,se),fi&&Rt.enter(Je),di&&wc(se,null,Ue,"mounted")},De)},hi=(se,me,Ie,Ue,De)=>{if(Ie&&J(se,Ie),Ue)for(let Ye=0;Ye<Ue.length;Ye++)J(se,Ue[Ye]);if(De){let Ye=De.subTree;if(me===Ye){const ut=De.vnode;hi(se,ut,ut.scopeId,ut.slotScopeIds,De.parent)}}},_i=(se,me,Ie,Ue,De,Ye,ut,je,Je=0)=>{for(let qe=Je;qe<se.length;qe++){const Pt=se[qe]=je?_l(se[qe]):No(se[qe]);we(null,Pt,me,Ie,Ue,De,Ye,ut,je)}},Ci=(se,me,Ie,Ue,De,Ye,ut)=>{const je=me.el=se.el;let{patchFlag:Je,dynamicChildren:qe,dirs:Pt}=me;Je|=se.patchFlag&16;const wt=se.props||on,Ct=me.props||on;let Rt;Ie&&Ec(Ie,!1),(Rt=Ct.onVnodeBeforeUpdate)&&Lo(Rt,Ie,me,se),Pt&&wc(me,se,Ie,"beforeUpdate"),Ie&&Ec(Ie,!0);const Yt=De&&me.type!=="foreignObject";if(qe?Ht(se.dynamicChildren,qe,je,Ie,Ue,Yt,Ye):ut||Ui(se,me,je,null,Ie,Ue,Yt,Ye,!1),Je>0){if(Je&16)$i(je,me,wt,Ct,Ie,Ue,De);else if(Je&2&&wt.class!==Ct.class&&f(je,"class",null,Ct.class,De),Je&4&&f(je,"style",wt.style,Ct.style,De),Je&8){const di=me.dynamicProps;for(let fi=0;fi<di.length;fi++){const Mi=di[fi],Un=wt[Mi],pr=Ct[Mi];(pr!==Un||Mi==="value")&&f(je,Mi,Un,pr,De,se.children,Ie,Ue,tt)}}Je&1&&se.children!==me.children&&L(je,me.children)}else!ut&&qe==null&&$i(je,me,wt,Ct,Ie,Ue,De);((Rt=Ct.onVnodeUpdated)||Pt)&&ns(()=>{Rt&&Lo(Rt,Ie,me,se),Pt&&wc(me,se,Ie,"updated")},Ue)},Ht=(se,me,Ie,Ue,De,Ye,ut)=>{for(let je=0;je<me.length;je++){const Je=se[je],qe=me[je],Pt=Je.el&&(Je.type===ga||!np(Je,qe)||Je.shapeFlag&70)?R(Je.el):Ie;we(Je,qe,Pt,null,Ue,De,Ye,ut,!0)}},$i=(se,me,Ie,Ue,De,Ye,ut)=>{if(Ie!==Ue){for(const je in Ue){if(Pg(je))continue;const Je=Ue[je],qe=Ie[je];Je!==qe&&je!=="value"&&f(se,je,qe,Je,ut,me.children,De,Ye,tt)}if(Ie!==on)for(const je in Ie)!Pg(je)&&!(je in Ue)&&f(se,je,Ie[je],null,ut,me.children,De,Ye,tt);"value"in Ue&&f(se,"value",Ie.value,Ue.value)}},Xi=(se,me,Ie,Ue,De,Ye,ut,je,Je)=>{const qe=me.el=se?se.el:l(""),Pt=me.anchor=se?se.anchor:l("");let{patchFlag:wt,dynamicChildren:Ct,slotScopeIds:Rt}=me;Rt&&(je=je?je.concat(Rt):Rt),se==null?(r(qe,Ie,Ue),r(Pt,Ie,Ue),_i(me.children,Ie,Pt,De,Ye,ut,je,Je)):wt>0&&wt&64&&Ct&&se.dynamicChildren?(Ht(se.dynamicChildren,Ct,Ie,De,Ye,ut,je),(me.key!=null||De&&me===De.subTree)&&Fk(se,me,!0)):Ui(se,me,Ie,Pt,De,Ye,ut,je,Je)},Nn=(se,me,Ie,Ue,De,Ye,ut,je,Je)=>{me.slotScopeIds=je,se==null?me.shapeFlag&512?De.ctx.activate(me,Ie,Ue,ut,Je):Fn(me,Ie,Ue,De,Ye,ut,Je):si(se,me,Je)},Fn=(se,me,Ie,Ue,De,Ye,ut)=>{const je=se.component=T5(se,Ue,De);if(Sk(se)&&(je.ctx.renderer=xi),I5(je),je.asyncDep){if(De&&De.registerDep(je,Zt),!se.el){const Je=je.subTree=as(Zc);nt(null,Je,me,Ie)}return}Zt(je,se,me,Ie,De,Ye,ut)},si=(se,me,Ie)=>{const Ue=me.component=se.component;if(O4(se,me,Ie))if(Ue.asyncDep&&!Ue.asyncResolved){Qt(Ue,me,Ie);return}else Ue.next=me,C4(Ue.update),Ue.update();else me.component=se.component,me.el=se.el,Ue.vnode=me},Zt=(se,me,Ie,Ue,De,Ye,ut)=>{const je=()=>{if(se.isMounted){let{next:Pt,bu:wt,u:Ct,parent:Rt,vnode:Yt}=se,di=Pt,fi;Ec(se,!1),Pt?(Pt.el=Yt.el,Qt(se,Pt,ut)):Pt=Yt,wt&&Rg(wt),(fi=Pt.props&&Pt.props.onVnodeBeforeUpdate)&&Lo(fi,Rt,Pt,Yt),Ec(se,!0);const Mi=S0(se),Un=se.subTree;se.subTree=Mi,we(Un,Mi,R(Un.el),bt(Un),se,De,Ye),Pt.el=Mi.el,di===null&&z4(se,Mi.el),Ct&&ns(Ct,De),(fi=Pt.props&&Pt.props.onVnodeUpdated)&&ns(()=>Lo(fi,Rt,Pt,Yt),De)}else{let Pt;const{el:wt,props:Ct}=me,{bm:Rt,m:Yt,parent:di}=se,fi=xb(me);if(Ec(se,!1),Rt&&Rg(Rt),!fi&&(Pt=Ct&&Ct.onVnodeBeforeMount)&&Lo(Pt,di,me),Ec(se,!0),wt&&ct){const Mi=()=>{se.subTree=S0(se),ct(wt,se.subTree,se,De,null)};fi?me.type.__asyncLoader().then(()=>!se.isUnmounted&&Mi()):Mi()}else{const Mi=se.subTree=S0(se);we(null,Mi,Ie,Ue,se,De,Ye),me.el=Mi.el}if(Yt&&ns(Yt,De),!fi&&(Pt=Ct&&Ct.onVnodeMounted)){const Mi=me;ns(()=>Lo(Pt,di,Mi),De)}me.shapeFlag&256&&se.a&&ns(se.a,De),se.isMounted=!0,me=Ie=Ue=null}},Je=se.effect=new Hw(je,()=>gk(se.update),se.scope),qe=se.update=Je.run.bind(Je);qe.id=se.uid,Ec(se,!0),qe()},Qt=(se,me,Ie)=>{me.component=se;const Ue=se.vnode.props;se.vnode=me,se.next=null,n5(se,me.props,Ue,Ie),o5(se,me.children,Ie),md(),e1(void 0,se.update),_d()},Ui=(se,me,Ie,Ue,De,Ye,ut,je,Je=!1)=>{const qe=se&&se.children,Pt=se?se.shapeFlag:0,wt=me.children,{patchFlag:Ct,shapeFlag:Rt}=me;if(Ct>0){if(Ct&128){Ji(qe,wt,Ie,Ue,De,Ye,ut,je,Je);return}else if(Ct&256){Bn(qe,wt,Ie,Ue,De,Ye,ut,je,Je);return}}Rt&8?(Pt&16&&tt(qe,De,Ye),wt!==qe&&L(Ie,wt)):Pt&16?Rt&16?Ji(qe,wt,Ie,Ue,De,Ye,ut,je,Je):tt(qe,De,Ye,!0):(Pt&8&&L(Ie,""),Rt&16&&_i(wt,Ie,Ue,De,Ye,ut,je,Je))},Bn=(se,me,Ie,Ue,De,Ye,ut,je,Je)=>{se=se||Ph,me=me||Ph;const qe=se.length,Pt=me.length,wt=Math.min(qe,Pt);let Ct;for(Ct=0;Ct<wt;Ct++){const Rt=me[Ct]=Je?_l(me[Ct]):No(me[Ct]);we(se[Ct],Rt,Ie,null,De,Ye,ut,je,Je)}qe>Pt?tt(se,De,Ye,!0,!1,wt):_i(me,Ie,Ue,De,Ye,ut,je,Je,wt)},Ji=(se,me,Ie,Ue,De,Ye,ut,je,Je)=>{let qe=0;const Pt=me.length;let wt=se.length-1,Ct=Pt-1;for(;qe<=wt&&qe<=Ct;){const Rt=se[qe],Yt=me[qe]=Je?_l(me[qe]):No(me[qe]);if(np(Rt,Yt))we(Rt,Yt,Ie,null,De,Ye,ut,je,Je);else break;qe++}for(;qe<=wt&&qe<=Ct;){const Rt=se[wt],Yt=me[Ct]=Je?_l(me[Ct]):No(me[Ct]);if(np(Rt,Yt))we(Rt,Yt,Ie,null,De,Ye,ut,je,Je);else break;wt--,Ct--}if(qe>wt){if(qe<=Ct){const Rt=Ct+1,Yt=Rt<Pt?me[Rt].el:Ue;for(;qe<=Ct;)we(null,me[qe]=Je?_l(me[qe]):No(me[qe]),Ie,Yt,De,Ye,ut,je,Je),qe++}}else if(qe>Ct)for(;qe<=wt;)Kt(se[qe],De,Ye,!0),qe++;else{const Rt=qe,Yt=qe,di=new Map;for(qe=Yt;qe<=Ct;qe++){const kn=me[qe]=Je?_l(me[qe]):No(me[qe]);kn.key!=null&&di.set(kn.key,qe)}let fi,Mi=0;const Un=Ct-Yt+1;let pr=!1,$s=0;const js=new Array(Un);for(qe=0;qe<Un;qe++)js[qe]=0;for(qe=Rt;qe<=wt;qe++){const kn=se[qe];if(Mi>=Un){Kt(kn,De,Ye,!0);continue}let Vn;if(kn.key!=null)Vn=di.get(kn.key);else for(fi=Yt;fi<=Ct;fi++)if(js[fi-Yt]===0&&np(kn,me[fi])){Vn=fi;break}Vn===void 0?Kt(kn,De,Ye,!0):(js[Vn-Yt]=qe+1,Vn>=$s?$s=Vn:pr=!0,we(kn,me[Vn],Ie,null,De,Ye,ut,je,Je),Mi++)}const Zo=pr?h5(js):Ph;for(fi=Zo.length-1,qe=Un-1;qe>=0;qe--){const kn=Yt+qe,Vn=me[kn],Xo=kn+1<Pt?me[kn+1].el:Ue;js[qe]===0?we(null,Vn,Ie,Xo,De,Ye,ut,je,Je):pr&&(fi<0||qe!==Zo[fi]?vn(Vn,Ie,Xo,2):fi--)}}},vn=(se,me,Ie,Ue,De=null)=>{const{el:Ye,type:ut,transition:je,children:Je,shapeFlag:qe}=se;if(qe&6){vn(se.component.subTree,me,Ie,Ue);return}if(qe&128){se.suspense.move(me,Ie,Ue);return}if(qe&64){ut.move(se,me,Ie,xi);return}if(ut===ga){r(Ye,me,Ie);for(let wt=0;wt<Je.length;wt++)vn(Je[wt],me,Ie,Ue);r(se.anchor,me,Ie);return}if(ut===zg){lt(se,me,Ie);return}if(Ue!==2&&qe&1&&je)if(Ue===0)je.beforeEnter(Ye),r(Ye,me,Ie),ns(()=>je.enter(Ye),De);else{const{leave:wt,delayLeave:Ct,afterLeave:Rt}=je,Yt=()=>r(Ye,me,Ie),di=()=>{wt(Ye,()=>{Yt(),Rt&&Rt()})};Ct?Ct(Ye,Yt,di):di()}else r(Ye,me,Ie)},Kt=(se,me,Ie,Ue=!1,De=!1)=>{const{type:Ye,props:ut,ref:je,children:Je,dynamicChildren:qe,shapeFlag:Pt,patchFlag:wt,dirs:Ct}=se;if(je!=null&&Tb(je,null,Ie,se,!0),Pt&256){me.ctx.deactivate(se);return}const Rt=Pt&1&&Ct,Yt=!xb(se);let di;if(Yt&&(di=ut&&ut.onVnodeBeforeUnmount)&&Lo(di,me,se),Pt&6)_t(se.component,Ie,Ue);else{if(Pt&128){se.suspense.unmount(Ie,Ue);return}Rt&&wc(se,null,me,"beforeUnmount"),Pt&64?se.type.remove(se,me,Ie,De,xi,Ue):qe&&(Ye!==ga||wt>0&&wt&64)?tt(qe,me,Ie,!1,!0):(Ye===ga&&wt&384||!De&&Pt&16)&&tt(Je,me,Ie),Ue&&Yi(se)}(Yt&&(di=ut&&ut.onVnodeUnmounted)||Rt)&&ns(()=>{di&&Lo(di,me,se),Rt&&wc(se,null,me,"unmounted")},Ie)},Yi=se=>{const{type:me,el:Ie,anchor:Ue,transition:De}=se;if(me===ga){ze(Ie,Ue);return}if(me===zg){zt(se);return}const Ye=()=>{c(Ie),De&&!De.persisted&&De.afterLeave&&De.afterLeave()};if(se.shapeFlag&1&&De&&!De.persisted){const{leave:ut,delayLeave:je}=De,Je=()=>ut(Ie,Ye);je?je(se.el,Ye,Je):Je()}else Ye()},ze=(se,me)=>{let Ie;for(;se!==me;)Ie=$(se),c(se),se=Ie;c(me)},_t=(se,me,Ie)=>{const{bum:Ue,scope:De,update:Ye,subTree:ut,um:je}=se;Ue&&Rg(Ue),De.stop(),Ye&&(Ye.active=!1,Kt(ut,se,me,Ie)),je&&ns(je,me),ns(()=>{se.isUnmounted=!0},me),me&&me.pendingBranch&&!me.isUnmounted&&se.asyncDep&&!se.asyncResolved&&se.suspenseId===me.pendingId&&(me.deps--,me.deps===0&&me.resolve())},tt=(se,me,Ie,Ue=!1,De=!1,Ye=0)=>{for(let ut=Ye;ut<se.length;ut++)Kt(se[ut],me,Ie,Ue,De)},bt=se=>se.shapeFlag&6?bt(se.component.subTree):se.shapeFlag&128?se.suspense.next():$(se.anchor||se.el),yi=(se,me,Ie)=>{se==null?me._vnode&&Kt(me._vnode,null,null,!0):we(me._vnode||null,se,me,null,null,null,Ie),xk(),me._vnode=se},xi={p:we,um:Kt,m:vn,r:Yi,mt:Fn,mc:_i,pc:Ui,pbc:Ht,n:bt,o:t};let Ut,ct;return e&&([Ut,ct]=e(xi)),{render:yi,hydrate:Ut,createApp:l5(yi,Ut)}}function Ec({effect:t,update:e},i){t.allowRecurse=e.allowRecurse=i}function Fk(t,e,i=!1){const r=t.children,c=e.children;if(Xt(r)&&Xt(c))for(let f=0;f<r.length;f++){const y=r[f];let l=c[f];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=c[f]=_l(c[f]),l.el=y.el),i||Fk(y,l))}}function h5(t){const e=t.slice(),i=[0];let r,c,f,y,l;const I=t.length;for(r=0;r<I;r++){const C=t[r];if(C!==0){if(c=i[i.length-1],t[c]<C){e[r]=c,i.push(r);continue}for(f=0,y=i.length-1;f<y;)l=f+y>>1,t[i[l]]<C?f=l+1:y=l;C<t[i[f]]&&(f>0&&(e[r]=i[f-1]),i[f]=r)}}for(f=i.length,y=i[f-1];f-- >0;)i[f]=y,y=e[y];return i}const d5=t=>t.__isTeleport,Bk="components";function f5(t,e){return m5(Bk,t,!0,e)||t}const p5=Symbol();function m5(t,e,i=!0,r=!1){const c=ro||sr;if(c){const f=c.type;if(t===Bk){const l=M5(f);if(l&&(l===e||l===qo(e)||l===ev(qo(e))))return f}const y=dA(c[t]||f[t],e)||dA(c.appContext[t],e);return!y&&r?f:y}}function dA(t,e){return t&&(t[e]||t[qo(e)]||t[ev(qo(e))])}const ga=Symbol(void 0),i1=Symbol(void 0),Zc=Symbol(void 0),zg=Symbol(void 0),Ip=[];let Vc=null;function Uk(t=!1){Ip.push(Vc=t?null:[])}function _5(){Ip.pop(),Vc=Ip[Ip.length-1]||null}let ey=1;function fA(t){ey+=t}function Vk(t){return t.dynamicChildren=ey>0?Vc||Ph:null,_5(),ey>0&&Vc&&Vc.push(t),t}function HY(t,e,i,r,c,f){return Vk(Gk(t,e,i,r,c,f,!0))}function $k(t,e,i,r,c){return Vk(as(t,e,i,r,c,!0))}function Ib(t){return t?t.__v_isVNode===!0:!1}function np(t,e){return t.type===e.type&&t.key===e.key}const ov="__vInternal",jk=({key:t})=>t!=null?t:null,Ng=({ref:t,ref_key:e,ref_for:i})=>t!=null?Jn(t)||lr(t)||mi(t)?{i:ro,r:t,k:e,f:!!i}:t:null;function Gk(t,e=null,i=null,r=0,c=null,f=t===ga?0:1,y=!1,l=!1){const I={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&jk(e),ref:e&&Ng(e),scopeId:rv,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:f,patchFlag:r,dynamicProps:c,dynamicChildren:null,appContext:null};return l?(n1(I,i),f&128&&t.normalize(I)):i&&(I.shapeFlag|=Jn(i)?8:16),ey>0&&!y&&Vc&&(I.patchFlag>0||f&6)&&I.patchFlag!==32&&Vc.push(I),I}const as=g5;function g5(t,e=null,i=null,r=0,c=null,f=!1){if((!t||t===p5)&&(t=Zc),Ib(t)){const l=$p(t,e,!0);return i&&n1(l,i),l}if(k5(t)&&(t=t.__vccOpts),e){e=y5(e);let{class:l,style:I}=e;l&&!Jn(l)&&(e.class=Vw(l)),Mn(I)&&(lk(I)&&!Xt(I)&&(I=Gr({},I)),e.style=Uw(I))}const y=Jn(t)?1:N4(t)?128:d5(t)?64:Mn(t)?4:mi(t)?2:0;return Gk(t,e,i,r,c,y,f,!0)}function y5(t){return t?lk(t)||ov in t?Gr({},t):t:null}function $p(t,e,i=!1){const{props:r,ref:c,patchFlag:f,children:y}=t,l=e?x5(r||{},e):r;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:l,key:l&&jk(l),ref:e&&e.ref?i&&c?Xt(c)?c.concat(Ng(e)):[c,Ng(e)]:Ng(e):c,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:y,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==ga?f===-1?16:f|16:f,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&$p(t.ssContent),ssFallback:t.ssFallback&&$p(t.ssFallback),el:t.el,anchor:t.anchor}}function v5(t=" ",e=0){return as(i1,null,t,e)}function KY(t,e){const i=as(zg,null,t);return i.staticCount=e,i}function ZY(t="",e=!1){return e?(Uk(),$k(Zc,null,t)):as(Zc,null,t)}function No(t){return t==null||typeof t=="boolean"?as(Zc):Xt(t)?as(ga,null,t.slice()):typeof t=="object"?_l(t):as(i1,null,String(t))}function _l(t){return t.el===null||t.memo?t:$p(t)}function n1(t,e){let i=0;const{shapeFlag:r}=t;if(e==null)e=null;else if(Xt(e))i=16;else if(typeof e=="object")if(r&65){const c=e.default;c&&(c._c&&(c._d=!1),n1(t,c()),c._c&&(c._d=!0));return}else{i=32;const c=e._;!c&&!(ov in e)?e._ctx=ro:c===3&&ro&&(ro.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else mi(e)?(e={default:e,_ctx:ro},i=32):(e=String(e),r&64?(i=16,e=[v5(e)]):i=8);t.children=e,t.shapeFlag|=i}function x5(...t){const e={};for(let i=0;i<t.length;i++){const r=t[i];for(const c in r)if(c==="class")e.class!==r.class&&(e.class=Vw([e.class,r.class]));else if(c==="style")e.style=Uw([e.style,r.style]);else if(Xy(c)){const f=e[c],y=r[c];y&&f!==y&&!(Xt(f)&&f.includes(y))&&(e[c]=f?[].concat(f,y):y)}else c!==""&&(e[c]=r[c])}return e}function Lo(t,e,i,r=null){ao(t,e,7,[i,r])}function XY(t,e,i,r){let c;const f=i&&i[r];if(Xt(t)||Jn(t)){c=new Array(t.length);for(let y=0,l=t.length;y<l;y++)c[y]=e(t[y],y,void 0,f&&f[y])}else if(typeof t=="number"){c=new Array(t);for(let y=0;y<t;y++)c[y]=e(y+1,y,void 0,f&&f[y])}else if(Mn(t))if(t[Symbol.iterator])c=Array.from(t,(y,l)=>e(y,l,void 0,f&&f[l]));else{const y=Object.keys(t);c=new Array(y.length);for(let l=0,I=y.length;l<I;l++){const C=y[l];c[l]=e(t[C],C,l,f&&f[l])}}else c=[];return i&&(i[r]=c),c}const Sb=t=>t?qk(t)?av(t)||t.proxy:Sb(t.parent):null,ty=Gr(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Sb(t.parent),$root:t=>Sb(t.root),$emit:t=>t.emit,$options:t=>Dk(t),$forceUpdate:t=>()=>gk(t.update),$nextTick:t=>_k.bind(t.proxy),$watch:t=>B4.bind(t)}),b5={get({_:t},e){const{ctx:i,setupState:r,data:c,props:f,accessCache:y,type:l,appContext:I}=t;let C;if(e[0]!=="$"){const J=y[e];if(J!==void 0)switch(J){case 1:return r[e];case 2:return c[e];case 4:return i[e];case 3:return f[e]}else{if(r!==on&&Li(r,e))return y[e]=1,r[e];if(c!==on&&Li(c,e))return y[e]=2,c[e];if((C=t.propsOptions[0])&&Li(C,e))return y[e]=3,f[e];if(i!==on&&Li(i,e))return y[e]=4,i[e];bb&&(y[e]=0)}}const L=ty[e];let R,$;if(L)return e==="$attrs"&&Es(t,"get",e),L(t);if((R=l.__cssModules)&&(R=R[e]))return R;if(i!==on&&Li(i,e))return y[e]=4,i[e];if($=I.config.globalProperties,Li($,e))return $[e]},set({_:t},e,i){const{data:r,setupState:c,ctx:f}=t;return c!==on&&Li(c,e)?(c[e]=i,!0):r!==on&&Li(r,e)?(r[e]=i,!0):Li(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(f[e]=i,!0)},has({_:{data:t,setupState:e,accessCache:i,ctx:r,appContext:c,propsOptions:f}},y){let l;return!!i[y]||t!==on&&Li(t,y)||e!==on&&Li(e,y)||(l=f[0])&&Li(l,y)||Li(r,y)||Li(ty,y)||Li(c.config.globalProperties,y)},defineProperty(t,e,i){return i.get!=null?t._.accessCache[e]=0:Li(i,"value")&&this.set(t,e,i.value,null),Reflect.defineProperty(t,e,i)}},w5=Nk();let E5=0;function T5(t,e,i){const r=t.type,c=(e?e.appContext:t.appContext)||w5,f={uid:E5++,vnode:t,type:r,parent:e,appContext:c,root:null,next:null,subTree:null,effect:null,update:null,scope:new HV(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(c.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Rk(r,c),emitsOptions:wk(r,c),emit:null,emitted:null,propsDefaults:on,inheritAttrs:r.inheritAttrs,ctx:on,data:on,props:on,attrs:on,slots:on,refs:on,setupState:on,setupContext:null,suspense:i,suspenseId:i?i.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return f.ctx={_:f},f.root=e?e.root:f,f.emit=D4.bind(null,f),t.ce&&t.ce(f),f}let sr=null;const Zh=t=>{sr=t,t.scope.on()},$c=()=>{sr&&sr.scope.off(),sr=null};function qk(t){return t.vnode.shapeFlag&4}let jp=!1;function I5(t,e=!1){jp=e;const{props:i,children:r}=t.vnode,c=qk(t);i5(t,i,c,e),s5(t,r);const f=c?S5(t,e):void 0;return jp=!1,f}function S5(t,e){const i=t.type;t.accessCache=Object.create(null),t.proxy=ck(new Proxy(t.ctx,b5));const{setup:r}=i;if(r){const c=t.setupContext=r.length>1?C5(t):null;Zh(t),md();const f=El(r,t,0,[t.props,c]);if(_d(),$c(),H2(f)){if(f.then($c,$c),e)return f.then(y=>{pA(t,y,e)}).catch(y=>{iv(y,t,0)});t.asyncDep=f}else pA(t,f,e)}else Wk(t,e)}function pA(t,e,i){mi(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Mn(e)&&(t.setupState=pk(e)),Wk(t,i)}let mA;function Wk(t,e,i){const r=t.type;if(!t.render){if(!e&&mA&&!r.render){const c=r.template;if(c){const{isCustomElement:f,compilerOptions:y}=t.appContext.config,{delimiters:l,compilerOptions:I}=r,C=Gr(Gr({isCustomElement:f,delimiters:l},y),I);r.render=mA(c,C)}}t.render=r.render||oo}Zh(t),md(),Y4(t),_d(),$c()}function A5(t){return new Proxy(t.attrs,{get(e,i){return Es(t,"get","$attrs"),e[i]}})}function C5(t){const e=r=>{t.exposed=r||{}};let i;return{get attrs(){return i||(i=A5(t))},slots:t.slots,emit:t.emit,expose:e}}function av(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(pk(ck(t.exposed)),{get(e,i){if(i in e)return e[i];if(i in ty)return ty[i](t)}}))}function M5(t){return mi(t)&&t.displayName||t.name}function k5(t){return mi(t)&&"__vccOpts"in t}const Fo=(t,e)=>I4(t,e,jp);function Hk(t,e,i){const r=arguments.length;return r===2?Mn(e)&&!Xt(e)?Ib(e)?as(t,null,[e]):as(t,e):as(t,null,e):(r>3?i=Array.prototype.slice.call(arguments,2):r===3&&Ib(i)&&(i=[i]),as(t,e,i))}const D5="3.2.33",P5="http://www.w3.org/2000/svg",Mc=typeof document!="undefined"?document:null,_A=Mc&&Mc.createElement("template"),R5={insert:(t,e,i)=>{e.insertBefore(t,i||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,i,r)=>{const c=e?Mc.createElementNS(P5,t):Mc.createElement(t,i?{is:i}:void 0);return t==="select"&&r&&r.multiple!=null&&c.setAttribute("multiple",r.multiple),c},createText:t=>Mc.createTextNode(t),createComment:t=>Mc.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Mc.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},cloneNode(t){const e=t.cloneNode(!0);return"_value"in t&&(e._value=t._value),e},insertStaticContent(t,e,i,r,c,f){const y=i?i.previousSibling:e.lastChild;if(c&&(c===f||c.nextSibling))for(;e.insertBefore(c.cloneNode(!0),i),!(c===f||!(c=c.nextSibling)););else{_A.innerHTML=r?`<svg>${t}</svg>`:t;const l=_A.content;if(r){const I=l.firstChild;for(;I.firstChild;)l.appendChild(I.firstChild);l.removeChild(I)}e.insertBefore(l,i)}return[y?y.nextSibling:e.firstChild,i?i.previousSibling:e.lastChild]}};function L5(t,e,i){const r=t._vtc;r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?t.removeAttribute("class"):i?t.setAttribute("class",e):t.className=e}function O5(t,e,i){const r=t.style,c=Jn(i);if(i&&!c){for(const f in i)Ab(r,f,i[f]);if(e&&!Jn(e))for(const f in e)i[f]==null&&Ab(r,f,"")}else{const f=r.display;c?e!==i&&(r.cssText=i):e&&t.removeAttribute("style"),"_vod"in t&&(r.display=f)}}const gA=/\s*!important$/;function Ab(t,e,i){if(Xt(i))i.forEach(r=>Ab(t,e,r));else if(i==null&&(i=""),e.startsWith("--"))t.setProperty(e,i);else{const r=z5(t,e);gA.test(i)?t.setProperty(pd(r),i.replace(gA,""),"important"):t[r]=i}}const yA=["Webkit","Moz","ms"],A0={};function z5(t,e){const i=A0[e];if(i)return i;let r=qo(e);if(r!=="filter"&&r in t)return A0[e]=r;r=ev(r);for(let c=0;c<yA.length;c++){const f=yA[c]+r;if(f in t)return A0[e]=f}return e}const vA="http://www.w3.org/1999/xlink";function N5(t,e,i,r,c){if(r&&e.startsWith("xlink:"))i==null?t.removeAttributeNS(vA,e.slice(6,e.length)):t.setAttributeNS(vA,e,i);else{const f=LV(e);i==null||f&&!q2(i)?t.removeAttribute(e):t.setAttribute(e,f?"":i)}}function F5(t,e,i,r,c,f,y){if(e==="innerHTML"||e==="textContent"){r&&y(r,c,f),t[e]=i==null?"":i;return}if(e==="value"&&t.tagName!=="PROGRESS"&&!t.tagName.includes("-")){t._value=i;const I=i==null?"":i;(t.value!==I||t.tagName==="OPTION")&&(t.value=I),i==null&&t.removeAttribute(e);return}let l=!1;if(i===""||i==null){const I=typeof t[e];I==="boolean"?i=q2(i):i==null&&I==="string"?(i="",l=!0):I==="number"&&(i=0,l=!0)}try{t[e]=i}catch{}l&&t.removeAttribute(e)}const[Kk,B5]=(()=>{let t=Date.now,e=!1;if(typeof window!="undefined"){Date.now()>document.createEvent("Event").timeStamp&&(t=()=>performance.now());const i=navigator.userAgent.match(/firefox\/(\d+)/i);e=!!(i&&Number(i[1])<=53)}return[t,e]})();let Cb=0;const U5=Promise.resolve(),V5=()=>{Cb=0},$5=()=>Cb||(U5.then(V5),Cb=Kk());function kc(t,e,i,r){t.addEventListener(e,i,r)}function j5(t,e,i,r){t.removeEventListener(e,i,r)}function G5(t,e,i,r,c=null){const f=t._vei||(t._vei={}),y=f[e];if(r&&y)y.value=r;else{const[l,I]=q5(e);if(r){const C=f[e]=W5(r,c);kc(t,l,C,I)}else y&&(j5(t,l,y,I),f[e]=void 0)}}const xA=/(?:Once|Passive|Capture)$/;function q5(t){let e;if(xA.test(t)){e={};let i;for(;i=t.match(xA);)t=t.slice(0,t.length-i[0].length),e[i[0].toLowerCase()]=!0}return[pd(t.slice(2)),e]}function W5(t,e){const i=r=>{const c=r.timeStamp||Kk();(B5||c>=i.attached-1)&&ao(H5(r,i.value),e,5,[r])};return i.value=t,i.attached=$5(),i}function H5(t,e){if(Xt(e)){const i=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{i.call(t),t._stopped=!0},e.map(r=>c=>!c._stopped&&r&&r(c))}else return e}const bA=/^on[a-z]/,K5=(t,e,i,r,c=!1,f,y,l,I)=>{e==="class"?L5(t,r,c):e==="style"?O5(t,i,r):Xy(e)?$w(e)||G5(t,e,i,r,y):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Z5(t,e,r,c))?F5(t,e,r,f,y,l,I):(e==="true-value"?t._trueValue=r:e==="false-value"&&(t._falseValue=r),N5(t,e,r,c))};function Z5(t,e,i,r){return r?!!(e==="innerHTML"||e==="textContent"||e in t&&bA.test(e)&&mi(i)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA"||bA.test(e)&&Jn(i)?!1:e in t}const iy=t=>{const e=t.props["onUpdate:modelValue"];return Xt(e)?i=>Rg(e,i):e};function X5(t){t.target.composing=!0}function wA(t){const e=t.target;e.composing&&(e.composing=!1,Y5(e,"input"))}function Y5(t,e){const i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0),t.dispatchEvent(i)}const YY={created(t,{modifiers:{lazy:e,trim:i,number:r}},c){t._assign=iy(c);const f=r||c.props&&c.props.type==="number";kc(t,e?"change":"input",y=>{if(y.target.composing)return;let l=t.value;i?l=l.trim():f&&(l=Xg(l)),t._assign(l)}),i&&kc(t,"change",()=>{t.value=t.value.trim()}),e||(kc(t,"compositionstart",X5),kc(t,"compositionend",wA),kc(t,"change",wA))},mounted(t,{value:e}){t.value=e==null?"":e},beforeUpdate(t,{value:e,modifiers:{lazy:i,trim:r,number:c}},f){if(t._assign=iy(f),t.composing||document.activeElement===t&&(i||r&&t.value.trim()===e||(c||t.type==="number")&&Xg(t.value)===e))return;const y=e==null?"":e;t.value!==y&&(t.value=y)}},JY={deep:!0,created(t,{value:e,modifiers:{number:i}},r){const c=Yy(e);kc(t,"change",()=>{const f=Array.prototype.filter.call(t.options,y=>y.selected).map(y=>i?Xg(ny(y)):ny(y));t._assign(t.multiple?c?new Set(f):f:f[0])}),t._assign=iy(r)},mounted(t,{value:e}){EA(t,e)},beforeUpdate(t,e,i){t._assign=iy(i)},updated(t,{value:e}){EA(t,e)}};function EA(t,e){const i=t.multiple;if(!(i&&!Xt(e)&&!Yy(e))){for(let r=0,c=t.options.length;r<c;r++){const f=t.options[r],y=ny(f);if(i)Xt(e)?f.selected=BV(e,y)>-1:f.selected=e.has(y);else if(Zy(ny(f),e)){t.selectedIndex!==r&&(t.selectedIndex=r);return}}!i&&t.selectedIndex!==-1&&(t.selectedIndex=-1)}}function ny(t){return"_value"in t?t._value:t.value}const J5=["ctrl","shift","alt","meta"],Q5={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>J5.some(i=>t[`${i}Key`]&&!e.includes(i))},QY=(t,e)=>(i,...r)=>{for(let c=0;c<e.length;c++){const f=Q5[e[c]];if(f&&f(i,e))return}return t(i,...r)},e$=Gr({patchProp:K5},R5);let TA;function t$(){return TA||(TA=c5(e$))}const i$=(...t)=>{const e=t$().createApp(...t),{mount:i}=e;return e.mount=r=>{const c=n$(r);if(!c)return;const f=e._component;!mi(f)&&!f.render&&!f.template&&(f.template=c.innerHTML),c.innerHTML="";const y=i(c,!1,c instanceof SVGElement);return c instanceof Element&&(c.removeAttribute("v-cloak"),c.setAttribute("data-v-app","")),y},e};function n$(t){return Jn(t)?document.querySelector(t):t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zk={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xt=function(t,e){if(!t)throw gd(e)},gd=function(t){return new Error("Firebase Database ("+Zk.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xk=function(t){const e=[];let i=0;for(let r=0;r<t.length;r++){let c=t.charCodeAt(r);c<128?e[i++]=c:c<2048?(e[i++]=c>>6|192,e[i++]=c&63|128):(c&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(c=65536+((c&1023)<<10)+(t.charCodeAt(++r)&1023),e[i++]=c>>18|240,e[i++]=c>>12&63|128,e[i++]=c>>6&63|128,e[i++]=c&63|128):(e[i++]=c>>12|224,e[i++]=c>>6&63|128,e[i++]=c&63|128)}return e},r$=function(t){const e=[];let i=0,r=0;for(;i<t.length;){const c=t[i++];if(c<128)e[r++]=String.fromCharCode(c);else if(c>191&&c<224){const f=t[i++];e[r++]=String.fromCharCode((c&31)<<6|f&63)}else if(c>239&&c<365){const f=t[i++],y=t[i++],l=t[i++],I=((c&7)<<18|(f&63)<<12|(y&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(I>>10)),e[r++]=String.fromCharCode(56320+(I&1023))}else{const f=t[i++],y=t[i++];e[r++]=String.fromCharCode((c&15)<<12|(f&63)<<6|y&63)}}return e.join("")},r1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let c=0;c<t.length;c+=3){const f=t[c],y=c+1<t.length,l=y?t[c+1]:0,I=c+2<t.length,C=I?t[c+2]:0,L=f>>2,R=(f&3)<<4|l>>4;let $=(l&15)<<2|C>>6,J=C&63;I||(J=64,y||($=64)),r.push(i[L],i[R],i[$],i[J])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Xk(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):r$(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let c=0;c<t.length;){const f=i[t.charAt(c++)],l=c<t.length?i[t.charAt(c)]:0;++c;const C=c<t.length?i[t.charAt(c)]:64;++c;const R=c<t.length?i[t.charAt(c)]:64;if(++c,f==null||l==null||C==null||R==null)throw Error();const $=f<<2|l>>4;if(r.push($),C!==64){const J=l<<4&240|C>>2;if(r.push(J),R!==64){const pe=C<<6&192|R;r.push(pe)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},Yk=function(t){const e=Xk(t);return r1.encodeByteArray(e,!0)},Jk=function(t){return Yk(t).replace(/\./g,"")},Mb=function(t){try{return r1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s$(t){return Qk(void 0,t)}function Qk(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const i=e;return new Date(i.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const i in e)!e.hasOwnProperty(i)||!o$(i)||(t[i]=Qk(t[i],e[i]));return t}function o$(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,r)=>{i?this.reject(i):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,r))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function lv(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Qn())}function o1(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function a1(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function a$(){return Qn().indexOf("Electron/")>=0}function eD(){const t=Qn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function l$(){return Qn().indexOf("MSAppHost/")>=0}function tD(){return Zk.NODE_ADMIN===!0}function iD(){return typeof indexedDB=="object"}function nD(){return new Promise((t,e)=>{try{let i=!0;const r="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(r);c.onsuccess=()=>{c.result.close(),i||self.indexedDB.deleteDatabase(r),t(!0)},c.onupgradeneeded=()=>{i=!1},c.onerror=()=>{var f;e(((f=c.error)===null||f===void 0?void 0:f.message)||"")}}catch(i){e(i)}})}function c$(){return!(typeof navigator=="undefined"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u$="FirebaseError";class Ko extends Error{constructor(e,i,r){super(i),this.code=e,this.customData=r,this.name=u$,Object.setPrototypeOf(this,Ko.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,fu.prototype.create)}}class fu{constructor(e,i,r){this.service=e,this.serviceName=i,this.errors=r}create(e,...i){const r=i[0]||{},c=`${this.service}/${e}`,f=this.errors[e],y=f?h$(f,r):"Error",l=`${this.serviceName}: ${y} (${c}).`;return new Ko(c,l,r)}}function h$(t,e){return t.replace(d$,(i,r)=>{const c=e[r];return c!=null?String(c):`<${r}?>`})}const d$=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gp(t){return JSON.parse(t)}function or(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rD=function(t){let e={},i={},r={},c="";try{const f=t.split(".");e=Gp(Mb(f[0])||""),i=Gp(Mb(f[1])||""),c=f[2],r=i.d||{},delete i.d}catch{}return{header:e,claims:i,data:r,signature:c}},f$=function(t){const e=rD(t),i=e.claims;return!!i&&typeof i=="object"&&i.hasOwnProperty("iat")},p$=function(t){const e=rD(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pa(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Xh(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function kb(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function ry(t,e,i){const r={};for(const c in t)Object.prototype.hasOwnProperty.call(t,c)&&(r[c]=e.call(i,t[c],c,t));return r}function sy(t,e){if(t===e)return!0;const i=Object.keys(t),r=Object.keys(e);for(const c of i){if(!r.includes(c))return!1;const f=t[c],y=e[c];if(IA(f)&&IA(y)){if(!sy(f,y))return!1}else if(f!==y)return!1}for(const c of r)if(!i.includes(c))return!1;return!0}function IA(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yd(t){const e=[];for(const[i,r]of Object.entries(t))Array.isArray(r)?r.forEach(c=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function fp(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[c,f]=r.split("=");e[decodeURIComponent(c)]=decodeURIComponent(f)}}),e}function pp(t){const e=t.indexOf("?");if(!e)return"";const i=t.indexOf("#",e);return t.substring(e,i>0?i:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m${constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,i){i||(i=0);const r=this.W_;if(typeof e=="string")for(let R=0;R<16;R++)r[R]=e.charCodeAt(i)<<24|e.charCodeAt(i+1)<<16|e.charCodeAt(i+2)<<8|e.charCodeAt(i+3),i+=4;else for(let R=0;R<16;R++)r[R]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i+=4;for(let R=16;R<80;R++){const $=r[R-3]^r[R-8]^r[R-14]^r[R-16];r[R]=($<<1|$>>>31)&4294967295}let c=this.chain_[0],f=this.chain_[1],y=this.chain_[2],l=this.chain_[3],I=this.chain_[4],C,L;for(let R=0;R<80;R++){R<40?R<20?(C=l^f&(y^l),L=1518500249):(C=f^y^l,L=1859775393):R<60?(C=f&y|l&(f|y),L=2400959708):(C=f^y^l,L=3395469782);const $=(c<<5|c>>>27)+C+I+L+r[R]&4294967295;I=l,l=y,y=(f<<30|f>>>2)&4294967295,f=c,c=$}this.chain_[0]=this.chain_[0]+c&4294967295,this.chain_[1]=this.chain_[1]+f&4294967295,this.chain_[2]=this.chain_[2]+y&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+I&4294967295}update(e,i){if(e==null)return;i===void 0&&(i=e.length);const r=i-this.blockSize;let c=0;const f=this.buf_;let y=this.inbuf_;for(;c<i;){if(y===0)for(;c<=r;)this.compress_(e,c),c+=this.blockSize;if(typeof e=="string"){for(;c<i;)if(f[y]=e.charCodeAt(c),++y,++c,y===this.blockSize){this.compress_(f),y=0;break}}else for(;c<i;)if(f[y]=e[c],++y,++c,y===this.blockSize){this.compress_(f),y=0;break}}this.inbuf_=y,this.total_+=i}digest(){const e=[];let i=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let c=this.blockSize-1;c>=56;c--)this.buf_[c]=i&255,i/=256;this.compress_(this.buf_);let r=0;for(let c=0;c<5;c++)for(let f=24;f>=0;f-=8)e[r]=this.chain_[c]>>f&255,++r;return e}}function _$(t,e){const i=new g$(t,e);return i.subscribe.bind(i)}class g${constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,r){let c;if(e===void 0&&i===void 0&&r===void 0)throw new Error("Missing Observer.");y$(e,["next","error","complete"])?c=e:c={next:e,error:i,complete:r},c.next===void 0&&(c.next=C0),c.error===void 0&&(c.error=C0),c.complete===void 0&&(c.complete=C0);const f=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),f}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(r){typeof console!="undefined"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function y$(t,e){if(typeof t!="object"||t===null)return!1;for(const i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}function C0(){}function v$(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x$=function(t){const e=[];let i=0;for(let r=0;r<t.length;r++){let c=t.charCodeAt(r);if(c>=55296&&c<=56319){const f=c-55296;r++,xt(r<t.length,"Surrogate pair missing trail surrogate.");const y=t.charCodeAt(r)-56320;c=65536+(f<<10)+y}c<128?e[i++]=c:c<2048?(e[i++]=c>>6|192,e[i++]=c&63|128):c<65536?(e[i++]=c>>12|224,e[i++]=c>>6&63|128,e[i++]=c&63|128):(e[i++]=c>>18|240,e[i++]=c>>12&63|128,e[i++]=c>>6&63|128,e[i++]=c&63|128)}return e},cv=function(t){let e=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,i++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b$=1e3,w$=2,E$=4*60*60*1e3,T$=.5;function SA(t,e=b$,i=w$){const r=e*Math.pow(i,t),c=Math.round(T$*r*(Math.random()-.5)*2);return Math.min(E$,r+c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ts(t){return t&&t._delegate?t._delegate:t}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mp(t,e){return new Promise((i,r)=>{t.onsuccess=c=>{i(c.target.result)},t.onerror=c=>{var f;r(`${e}: ${(f=c.target.error)===null||f===void 0?void 0:f.message}`)}})}class AA{constructor(e){this._db=e,this.objectStoreNames=this._db.objectStoreNames}transaction(e,i="readonly"){return new sD(this._db.transaction.call(this._db,e,i))}createObjectStore(e,i){return new oD(this._db.createObjectStore(e,i))}close(){this._db.close()}}class sD{constructor(e){this._transaction=e,this.complete=new Promise((i,r)=>{this._transaction.oncomplete=function(){i()},this._transaction.onerror=()=>{r(this._transaction.error)},this._transaction.onabort=()=>{r(this._transaction.error)}})}objectStore(e){return new oD(this._transaction.objectStore(e))}}class oD{constructor(e){this._store=e}index(e){return new CA(this._store.index(e))}createIndex(e,i,r){return new CA(this._store.createIndex(e,i,r))}get(e){const i=this._store.get(e);return mp(i,"Error reading from IndexedDB")}put(e,i){const r=this._store.put(e,i);return mp(r,"Error writing to IndexedDB")}delete(e){const i=this._store.delete(e);return mp(i,"Error deleting from IndexedDB")}clear(){const e=this._store.clear();return mp(e,"Error clearing IndexedDB object store")}}class CA{constructor(e){this._index=e}get(e){const i=this._index.get(e);return mp(i,"Error reading from IndexedDB")}}function aD(t,e,i){return new Promise((r,c)=>{try{const f=indexedDB.open(t,e);f.onsuccess=y=>{r(new AA(y.target.result))},f.onerror=y=>{var l;c(`Error opening indexedDB: ${(l=y.target.error)===null||l===void 0?void 0:l.message}`)},f.onupgradeneeded=y=>{i(new AA(f.result),y.oldVersion,y.newVersion,new sD(f.transaction))}}catch(f){c(`Error opening indexedDB: ${f.message}`)}})}class Is{constructor(e,i,r){this.name=e,this.instanceFactory=i,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I${constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const r=new s1;if(this.instancesDeferred.set(i,r),this.isInitialized(i)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:i});c&&r.resolve(c)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),c=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(f){if(c)return null;throw f}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(A$(e))try{this.getOrInitializeService({instanceIdentifier:Sc})}catch{}for(const[i,r]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);try{const f=this.getOrInitializeService({instanceIdentifier:c});r.resolve(f)}catch{}}}}clearInstance(e=Sc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Sc){return this.instances.has(e)}getOptions(e=Sc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:r,options:i});for(const[f,y]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(f);r===l&&y.resolve(c)}return c}onInit(e,i){var r;const c=this.normalizeInstanceIdentifier(i),f=(r=this.onInitCallbacks.get(c))!==null&&r!==void 0?r:new Set;f.add(e),this.onInitCallbacks.set(c,f);const y=this.instances.get(c);return y&&e(y,c),()=>{f.delete(e)}}invokeOnInitCallbacks(e,i){const r=this.onInitCallbacks.get(i);if(!!r)for(const c of r)try{c(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:S$(e),options:i}),this.instances.set(e,r),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Sc){return this.component?this.component.multipleInstances?e:Sc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function S$(t){return t===Sc?void 0:t}function A$(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C${constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new I$(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Oi;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Oi||(Oi={}));const M$={debug:Oi.DEBUG,verbose:Oi.VERBOSE,info:Oi.INFO,warn:Oi.WARN,error:Oi.ERROR,silent:Oi.SILENT},k$=Oi.INFO,D$={[Oi.DEBUG]:"log",[Oi.VERBOSE]:"log",[Oi.INFO]:"info",[Oi.WARN]:"warn",[Oi.ERROR]:"error"},P$=(t,e,...i)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),c=D$[e];if(c)console[c](`[${r}]  ${t.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class vd{constructor(e){this.name=e,this._logLevel=k$,this._logHandler=P$,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Oi))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?M$[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Oi.DEBUG,...e),this._logHandler(this,Oi.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Oi.VERBOSE,...e),this._logHandler(this,Oi.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Oi.INFO,...e),this._logHandler(this,Oi.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Oi.WARN,...e),this._logHandler(this,Oi.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Oi.ERROR,...e),this._logHandler(this,Oi.ERROR,...e)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R${constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(L$(i)){const r=i.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(i=>i).join(" ")}}function L$(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Db="@firebase/app",MA="0.7.22";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1=new vd("@firebase/app"),O$="@firebase/app-compat",z$="@firebase/analytics-compat",N$="@firebase/analytics",F$="@firebase/app-check-compat",B$="@firebase/app-check",U$="@firebase/auth",V$="@firebase/auth-compat",$$="@firebase/database",j$="@firebase/database-compat",G$="@firebase/functions",q$="@firebase/functions-compat",W$="@firebase/installations",H$="@firebase/installations-compat",K$="@firebase/messaging",Z$="@firebase/messaging-compat",X$="@firebase/performance",Y$="@firebase/performance-compat",J$="@firebase/remote-config",Q$="@firebase/remote-config-compat",ej="@firebase/storage",tj="@firebase/storage-compat",ij="@firebase/firestore",nj="@firebase/firestore-compat",rj="firebase",sj="9.7.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lD="[DEFAULT]",oj={[Db]:"fire-core",[O$]:"fire-core-compat",[N$]:"fire-analytics",[z$]:"fire-analytics-compat",[B$]:"fire-app-check",[F$]:"fire-app-check-compat",[U$]:"fire-auth",[V$]:"fire-auth-compat",[$$]:"fire-rtdb",[j$]:"fire-rtdb-compat",[G$]:"fire-fn",[q$]:"fire-fn-compat",[W$]:"fire-iid",[H$]:"fire-iid-compat",[K$]:"fire-fcm",[Z$]:"fire-fcm-compat",[X$]:"fire-perf",[Y$]:"fire-perf-compat",[J$]:"fire-rc",[Q$]:"fire-rc-compat",[ej]:"fire-gcs",[tj]:"fire-gcs-compat",[ij]:"fire-fst",[nj]:"fire-fst-compat","fire-js":"fire-js",[rj]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy=new Map,Pb=new Map;function aj(t,e){try{t.container.addComponent(e)}catch(i){l1.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,i)}}function Ns(t){const e=t.name;if(Pb.has(e))return l1.debug(`There were multiple attempts to register component ${e}.`),!1;Pb.set(e,t);for(const i of oy.values())aj(i,t);return!0}function xd(t,e){const i=t.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lj={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["storage-delete"]:"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."},Xc=new fu("app","Firebase",lj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{constructor(e,i,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Is("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Xc.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pu=sj;function uj(t,e={}){typeof e!="object"&&(e={name:e});const i=Object.assign({name:lD,automaticDataCollectionEnabled:!1},e),r=i.name;if(typeof r!="string"||!r)throw Xc.create("bad-app-name",{appName:String(r)});const c=oy.get(r);if(c){if(sy(t,c.options)&&sy(i,c.config))return c;throw Xc.create("duplicate-app",{appName:r})}const f=new C$(r);for(const l of Pb.values())f.addComponent(l);const y=new cj(t,i,f);return oy.set(r,y),y}function c1(t=lD){const e=oy.get(t);if(!e)throw Xc.create("no-app",{appName:t});return e}function Ir(t,e,i){var r;let c=(r=oj[t])!==null&&r!==void 0?r:t;i&&(c+=`-${i}`);const f=c.match(/\s|\//),y=e.match(/\s|\//);if(f||y){const l=[`Unable to register library "${c}" with version "${e}":`];f&&l.push(`library name "${c}" contains illegal characters (whitespace or "/")`),f&&y&&l.push("and"),y&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),l1.warn(l.join(" "));return}Ns(new Is(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hj="firebase-heartbeat-database",dj=1,qp="firebase-heartbeat-store";let M0=null;function cD(){return M0||(M0=aD(hj,dj,(t,e)=>{switch(e){case 0:t.createObjectStore(qp)}}).catch(t=>{throw Xc.create("storage-open",{originalErrorMessage:t.message})})),M0}async function fj(t){try{return(await cD()).transaction(qp).objectStore(qp).get(uD(t))}catch(e){throw Xc.create("storage-get",{originalErrorMessage:e.message})}}async function kA(t,e){try{const r=(await cD()).transaction(qp,"readwrite");return await r.objectStore(qp).put(e,uD(t)),r.complete}catch(i){throw Xc.create("storage-set",{originalErrorMessage:i.message})}}function uD(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pj=1024,mj=30*24*60*60*1e3;class _j{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new yj(i),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=DA();if(this._heartbeatsCache===null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(c=>c.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(c=>{const f=new Date(c.date).valueOf();return Date.now()-f<=mj}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache===null||this._heartbeatsCache.heartbeats.length===0)return"";const e=DA(),{heartbeatsToSend:i,unsentEntries:r}=gj(this._heartbeatsCache.heartbeats),c=Jk(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),c}}function DA(){return new Date().toISOString().substring(0,10)}function gj(t,e=pj){const i=[];let r=t.slice();for(const c of t){const f=i.find(y=>y.agent===c.agent);if(f){if(f.dates.push(c.date),PA(i)>e){f.dates.pop();break}}else if(i.push({agent:c.agent,dates:[c.date]}),PA(i)>e){i.pop();break}r=r.slice(1)}return{heartbeatsToSend:i,unsentEntries:r}}class yj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return iD()?nD().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await fj(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const c=await this.read();return kA(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const c=await this.read();return kA(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function PA(t){return Jk(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vj(t){Ns(new Is("platform-logger",e=>new R$(e),"PRIVATE")),Ns(new Is("heartbeat",e=>new _j(e),"PRIVATE")),Ir(Db,MA,t),Ir(Db,MA,"esm2017"),Ir("fire-js","")}vj("");function u1(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,r=Object.getOwnPropertySymbols(t);c<r.length;c++)e.indexOf(r[c])<0&&Object.prototype.propertyIsEnumerable.call(t,r[c])&&(i[r[c]]=t[r[c]]);return i}function hD(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const xj=hD,dD=new fu("auth","Firebase",hD());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RA=new vd("@firebase/auth");function Fg(t,...e){RA.logLevel<=Oi.ERROR&&RA.error(`Auth (${pu}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fs(t,...e){throw h1(t,...e)}function $o(t,...e){return h1(t,...e)}function fD(t,e,i){const r=Object.assign(Object.assign({},xj()),{[e]:i});return new fu("auth","Firebase",r).create(e,{appName:t.name})}function bj(t,e,i){const r=i;if(!(e instanceof r))throw r.name!==e.constructor.name&&Fs(t,"argument-error"),fD(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function h1(t,...e){if(typeof t!="string"){const i=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(i,...r)}return dD.create(t,...e)}function ii(t,e,...i){if(!t)throw h1(e,...i)}function xa(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Fg(e),new Error(e)}function Ma(t,e){t||xa(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LA=new Map;function ba(t){Ma(t instanceof Function,"Expected a class definition");let e=LA.get(t);return e?(Ma(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,LA.set(t,e),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wj(t,e){const i=xd(t,"auth");if(i.isInitialized()){const c=i.getImmediate(),f=i.getOptions();if(sy(f,e!=null?e:{}))return c;Fs(c,"already-initialized")}return i.initialize({options:e})}function Ej(t,e){const i=(e==null?void 0:e.persistence)||[],r=(Array.isArray(i)?i:[i]).map(ba);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rb(){var t;return typeof self!="undefined"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function Tj(){return OA()==="http:"||OA()==="https:"}function OA(){var t;return typeof self!="undefined"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ij(){return typeof navigator!="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Tj()||o1()||"connection"in navigator)?navigator.onLine:!0}function Sj(){if(typeof navigator=="undefined")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(e,i){this.shortDelay=e,this.longDelay=i,Ma(i>e,"Short delay should be less than long delay!"),this.isMobile=lv()||a1()}get(){return Ij()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d1(t,e){Ma(t.emulator,"Emulator should always be set here");const{url:i}=t.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pD{static initialize(e,i,r){this.fetchImpl=e,i&&(this.headersImpl=i),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self!="undefined"&&"fetch"in self)return self.fetch;xa("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self!="undefined"&&"Headers"in self)return self.Headers;xa("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self!="undefined"&&"Response"in self)return self.Response;xa("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aj={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cj=new pm(3e4,6e4);function mm(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function _m(t,e,i,r,c={}){return mD(t,c,async()=>{let f={},y={};r&&(e==="GET"?y=r:f={body:JSON.stringify(r)});const l=yd(Object.assign({key:t.config.apiKey},y)).slice(1),I=await t._getAdditionalHeaders();return I["Content-Type"]="application/json",t.languageCode&&(I["X-Firebase-Locale"]=t.languageCode),pD.fetch()(_D(t,t.config.apiHost,i,l),Object.assign({method:e,headers:I,referrerPolicy:"no-referrer"},f))})}async function mD(t,e,i){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},Aj),e);try{const c=new Mj(t),f=await Promise.race([i(),c.promise]);c.clearNetworkTimeout();const y=await f.json();if("needConfirmation"in y)throw k0(t,"account-exists-with-different-credential",y);if(f.ok&&!("errorMessage"in y))return y;{const l=f.ok?y.errorMessage:y.error.message,[I,C]=l.split(" : ");if(I==="FEDERATED_USER_ID_ALREADY_LINKED")throw k0(t,"credential-already-in-use",y);if(I==="EMAIL_EXISTS")throw k0(t,"email-already-in-use",y);const L=r[I]||I.toLowerCase().replace(/[_\s]+/g,"-");if(C)throw fD(t,L,C);Fs(t,L)}}catch(c){if(c instanceof Ko)throw c;Fs(t,"network-request-failed")}}async function gm(t,e,i,r,c={}){const f=await _m(t,e,i,r,c);return"mfaPendingCredential"in f&&Fs(t,"multi-factor-auth-required",{_serverResponse:f}),f}function _D(t,e,i,r){const c=`${e}${i}?${r}`;return t.config.emulator?d1(t.config,c):`${t.config.apiScheme}://${c}`}class Mj{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,r)=>{this.timer=setTimeout(()=>r($o(this.auth,"network-request-failed")),Cj.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function k0(t,e,i){const r={appName:t.name};i.email&&(r.email=i.email),i.phoneNumber&&(r.phoneNumber=i.phoneNumber);const c=$o(t,e,r);return c.customData._tokenResponse=i,c}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kj(t,e){return _m(t,"POST","/v1/accounts:delete",e)}async function Dj(t,e){return _m(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sp(t){if(!!t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Pj(t,e=!1){const i=Ts(t),r=await i.getIdToken(e),c=f1(r);ii(c&&c.exp&&c.auth_time&&c.iat,i.auth,"internal-error");const f=typeof c.firebase=="object"?c.firebase:void 0,y=f==null?void 0:f.sign_in_provider;return{claims:c,token:r,authTime:Sp(D0(c.auth_time)),issuedAtTime:Sp(D0(c.iat)),expirationTime:Sp(D0(c.exp)),signInProvider:y||null,signInSecondFactor:(f==null?void 0:f.sign_in_second_factor)||null}}function D0(t){return Number(t)*1e3}function f1(t){const[e,i,r]=t.split(".");if(e===void 0||i===void 0||r===void 0)return Fg("JWT malformed, contained fewer than 3 sections"),null;try{const c=Mb(i);return c?JSON.parse(c):(Fg("Failed to decode base64 JWT payload"),null)}catch(c){return Fg("Caught error parsing JWT payload as JSON",c),null}}function Rj(t){const e=f1(t);return ii(e,"internal-error"),ii(typeof e.exp!="undefined","internal-error"),ii(typeof e.iat!="undefined","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wp(t,e,i=!1){if(i)return e;try{return await e}catch(r){throw r instanceof Ko&&Lj(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function Lj({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oj{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const c=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=Sp(this.lastLoginAt),this.creationTime=Sp(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ay(t){var e;const i=t.auth,r=await t.getIdToken(),c=await Wp(t,Dj(i,{idToken:r}));ii(c==null?void 0:c.users.length,i,"internal-error");const f=c.users[0];t._notifyReloadListener(f);const y=!((e=f.providerUserInfo)===null||e===void 0)&&e.length?Fj(f.providerUserInfo):[],l=Nj(t.providerData,y),I=t.isAnonymous,C=!(t.email&&f.passwordHash)&&!(l!=null&&l.length),L=I?C:!1,R={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:l,metadata:new gD(f.createdAt,f.lastLoginAt),isAnonymous:L};Object.assign(t,R)}async function zj(t){const e=Ts(t);await ay(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Nj(t,e){return[...t.filter(r=>!e.some(c=>c.providerId===r.providerId)),...e]}function Fj(t){return t.map(e=>{var{providerId:i}=e,r=u1(e,["providerId"]);return{providerId:i,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bj(t,e){const i=await mD(t,{},async()=>{const r=yd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:f}=t.config,y=_D(t,c,"/v1/token",`key=${f}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",pD.fetch()(y,{method:"POST",headers:l,body:r})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ii(e.idToken,"internal-error"),ii(typeof e.idToken!="undefined","internal-error"),ii(typeof e.refreshToken!="undefined","internal-error");const i="expiresIn"in e&&typeof e.expiresIn!="undefined"?Number(e.expiresIn):Rj(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}async getToken(e,i=!1){return ii(!this.accessToken||this.refreshToken,e,"user-token-expired"),!i&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:r,refreshToken:c,expiresIn:f}=await Bj(e,i);this.updateTokensAndExpiration(r,c,Number(f))}updateTokensAndExpiration(e,i,r){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,i){const{refreshToken:r,accessToken:c,expirationTime:f}=i,y=new Hp;return r&&(ii(typeof r=="string","internal-error",{appName:e}),y.refreshToken=r),c&&(ii(typeof c=="string","internal-error",{appName:e}),y.accessToken=c),f&&(ii(typeof f=="number","internal-error",{appName:e}),y.expirationTime=f),y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Hp,this.toJSON())}_performRefresh(){return xa("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dl(t,e){ii(typeof t=="string"||typeof t=="undefined","internal-error",{appName:e})}class jc{constructor(e){var{uid:i,auth:r,stsTokenManager:c}=e,f=u1(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Oj(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=r,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new gD(f.createdAt||void 0,f.lastLoginAt||void 0)}async getIdToken(e){const i=await Wp(this,this.stsTokenManager.getToken(this.auth,e));return ii(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return Pj(this,e)}reload(){return zj(this)}_assign(e){this!==e&&(ii(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new jc(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){ii(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),i&&await ay(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Wp(this,kj(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var r,c,f,y,l,I,C,L;const R=(r=i.displayName)!==null&&r!==void 0?r:void 0,$=(c=i.email)!==null&&c!==void 0?c:void 0,J=(f=i.phoneNumber)!==null&&f!==void 0?f:void 0,pe=(y=i.photoURL)!==null&&y!==void 0?y:void 0,Re=(l=i.tenantId)!==null&&l!==void 0?l:void 0,we=(I=i._redirectEventId)!==null&&I!==void 0?I:void 0,Be=(C=i.createdAt)!==null&&C!==void 0?C:void 0,nt=(L=i.lastLoginAt)!==null&&L!==void 0?L:void 0,{uid:yt,emailVerified:lt,isAnonymous:zt,providerData:rt,stsTokenManager:Wt}=i;ii(yt&&Wt,e,"internal-error");const hi=Hp.fromJSON(this.name,Wt);ii(typeof yt=="string",e,"internal-error"),dl(R,e.name),dl($,e.name),ii(typeof lt=="boolean",e,"internal-error"),ii(typeof zt=="boolean",e,"internal-error"),dl(J,e.name),dl(pe,e.name),dl(Re,e.name),dl(we,e.name),dl(Be,e.name),dl(nt,e.name);const _i=new jc({uid:yt,auth:e,email:$,emailVerified:lt,displayName:R,isAnonymous:zt,photoURL:pe,phoneNumber:J,tenantId:Re,stsTokenManager:hi,createdAt:Be,lastLoginAt:nt});return rt&&Array.isArray(rt)&&(_i.providerData=rt.map(Ci=>Object.assign({},Ci))),we&&(_i._redirectEventId=we),_i}static async _fromIdTokenResponse(e,i,r=!1){const c=new Hp;c.updateFromServerResponse(i);const f=new jc({uid:i.localId,auth:e,stsTokenManager:c,isAnonymous:r});return await ay(f),f}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}yD.type="NONE";const zA=yD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bg(t,e,i){return`firebase:${t}:${e}:${i}`}class Oh{constructor(e,i,r){this.persistence=e,this.auth=i,this.userKey=r;const{config:c,name:f}=this.auth;this.fullUserKey=Bg(this.userKey,c.apiKey,f),this.fullPersistenceKey=Bg("persistence",c.apiKey,f),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?jc._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,r="authUser"){if(!i.length)return new Oh(ba(zA),e,r);const c=(await Promise.all(i.map(async C=>{if(await C._isAvailable())return C}))).filter(C=>C);let f=c[0]||ba(zA);const y=Bg(r,e.config.apiKey,e.name);let l=null;for(const C of i)try{const L=await C._get(y);if(L){const R=jc._fromJSON(e,L);C!==f&&(l=R),f=C;break}}catch{}const I=c.filter(C=>C._shouldAllowMigration);return!f._shouldAllowMigration||!I.length?new Oh(f,e,r):(f=I[0],l&&await f._set(y,l.toJSON()),await Promise.all(i.map(async C=>{if(C!==f)try{await C._remove(y)}catch{}})),new Oh(f,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NA(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(bD(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(vD(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ED(e))return"Blackberry";if(TD(e))return"Webos";if(p1(e))return"Safari";if((e.includes("chrome/")||xD(e))&&!e.includes("edge/"))return"Chrome";if(wD(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(i);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function vD(t=Qn()){return/firefox\//i.test(t)}function p1(t=Qn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function xD(t=Qn()){return/crios\//i.test(t)}function bD(t=Qn()){return/iemobile/i.test(t)}function wD(t=Qn()){return/android/i.test(t)}function ED(t=Qn()){return/blackberry/i.test(t)}function TD(t=Qn()){return/webos/i.test(t)}function uv(t=Qn()){return/iphone|ipad|ipod/i.test(t)}function Uj(t=Qn()){var e;return uv(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Vj(){return eD()&&document.documentMode===10}function ID(t=Qn()){return uv(t)||wD(t)||TD(t)||ED(t)||/windows phone/i.test(t)||bD(t)}function $j(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SD(t,e=[]){let i;switch(t){case"Browser":i=NA(Qn());break;case"Worker":i=`${NA(Qn())}-${t}`;break;default:i=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${pu}/${r}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jj{constructor(e,i,r){this.app=e,this.heartbeatServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new FA(this),this.idTokenSubscription=new FA(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dD,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=ba(i)),this._initializationPromise=this.queue(async()=>{var r,c;if(!this._deleted&&(this.persistenceManager=await Oh.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var i;let r=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const c=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,f=r==null?void 0:r._redirectEventId,y=await this.tryRedirectSignIn(e);(!c||c===f)&&(y==null?void 0:y.user)&&(r=y.user)}return r?r._redirectEventId?(ii(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)):this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await ay(e)}catch(i){if(i.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Sj()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const i=e?Ts(e):null;return i&&ii(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&ii(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(ba(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new fu("auth","Firebase",e())}onAuthStateChanged(e,i,r){return this.registerStateListener(this.authStateSubscription,e,i,r)}onIdTokenChanged(e,i,r){return this.registerStateListener(this.idTokenSubscription,e,i,r)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const r=await this.getOrInitRedirectPersistenceManager(i);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&ba(e)||this._popupRedirectResolver;ii(i,this,"argument-error"),this.redirectPersistenceManager=await Oh.create(this,[ba(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,r;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,r,c){if(this._deleted)return()=>{};const f=typeof i=="function"?i:i.next.bind(i),y=this._isInitialized?Promise.resolve():this._initializationPromise;return ii(y,this,"internal-error"),y.then(()=>f(this.currentUser)),typeof i=="function"?e.addObserver(i,r,c):e.addObserver(i)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ii(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=SD(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());return r&&(i["X-Firebase-Client"]=r),i}}function ym(t){return Ts(t)}class FA{constructor(e){this.auth=e,this.observer=null,this.addObserver=_$(i=>this.observer=i)}get next(){return ii(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return xa("not implemented")}_getIdTokenResponse(e){return xa("not implemented")}_linkToIdToken(e,i){return xa("not implemented")}_getReauthenticationResolver(e){return xa("not implemented")}}async function Gj(t,e){return _m(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qj(t,e){return gm(t,"POST","/v1/accounts:signInWithPassword",mm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wj(t,e){return gm(t,"POST","/v1/accounts:signInWithEmailLink",mm(t,e))}async function Hj(t,e){return gm(t,"POST","/v1/accounts:signInWithEmailLink",mm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp extends m1{constructor(e,i,r,c=null){super("password",r),this._email=e,this._password=i,this._tenantId=c}static _fromEmailAndPassword(e,i){return new Kp(e,i,"password")}static _fromEmailAndCode(e,i,r=null){return new Kp(e,i,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if((i==null?void 0:i.email)&&(i==null?void 0:i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return qj(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return Wj(e,{email:this._email,oobCode:this._password});default:Fs(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":return Gj(e,{idToken:i,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return Hj(e,{idToken:i,email:this._email,oobCode:this._password});default:Fs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zh(t,e){return gm(t,"POST","/v1/accounts:signInWithIdp",mm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kj="http://localhost";class Yc extends m1{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new Yc(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):Fs("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:c}=i,f=u1(i,["providerId","signInMethod"]);if(!r||!c)return null;const y=new Yc(r,c);return y.idToken=f.idToken||void 0,y.accessToken=f.accessToken||void 0,y.secret=f.secret,y.nonce=f.nonce,y.pendingToken=f.pendingToken||null,y}_getIdTokenResponse(e){const i=this.buildRequest();return zh(e,i)}_linkToIdToken(e,i){const r=this.buildRequest();return r.idToken=i,zh(e,r)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,zh(e,i)}buildRequest(){const e={requestUri:Kj,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=yd(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zj(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Xj(t){const e=fp(pp(t)).link,i=e?fp(pp(e)).deep_link_id:null,r=fp(pp(t)).deep_link_id;return(r?fp(pp(r)).link:null)||r||i||e||t}class _1{constructor(e){var i,r,c,f,y,l;const I=fp(pp(e)),C=(i=I.apiKey)!==null&&i!==void 0?i:null,L=(r=I.oobCode)!==null&&r!==void 0?r:null,R=Zj((c=I.mode)!==null&&c!==void 0?c:null);ii(C&&L&&R,"argument-error"),this.apiKey=C,this.operation=R,this.code=L,this.continueUrl=(f=I.continueUrl)!==null&&f!==void 0?f:null,this.languageCode=(y=I.languageCode)!==null&&y!==void 0?y:null,this.tenantId=(l=I.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const i=Xj(e);try{return new _1(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd{constructor(){this.providerId=bd.PROVIDER_ID}static credential(e,i){return Kp._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const r=_1.parseLink(i);return ii(r,"argument-error"),Kp._fromEmailAndCode(e,r.code,r.tenantId)}}bd.PROVIDER_ID="password";bd.EMAIL_PASSWORD_SIGN_IN_METHOD="password";bd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g1{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vm extends g1{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl extends vm{constructor(){super("facebook.com")}static credential(e){return Yc._fromParams({providerId:yl.PROVIDER_ID,signInMethod:yl.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yl.credentialFromTaggedObject(e)}static credentialFromError(e){return yl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return yl.credential(e.oauthAccessToken)}catch{return null}}}yl.FACEBOOK_SIGN_IN_METHOD="facebook.com";yl.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vl extends vm{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return Yc._fromParams({providerId:vl.PROVIDER_ID,signInMethod:vl.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return vl.credentialFromTaggedObject(e)}static credentialFromError(e){return vl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:r}=e;if(!i&&!r)return null;try{return vl.credential(i,r)}catch{return null}}}vl.GOOGLE_SIGN_IN_METHOD="google.com";vl.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xl extends vm{constructor(){super("github.com")}static credential(e){return Yc._fromParams({providerId:xl.PROVIDER_ID,signInMethod:xl.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xl.credentialFromTaggedObject(e)}static credentialFromError(e){return xl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xl.credential(e.oauthAccessToken)}catch{return null}}}xl.GITHUB_SIGN_IN_METHOD="github.com";xl.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl extends vm{constructor(){super("twitter.com")}static credential(e,i){return Yc._fromParams({providerId:bl.PROVIDER_ID,signInMethod:bl.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return bl.credentialFromTaggedObject(e)}static credentialFromError(e){return bl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:r}=e;if(!i||!r)return null;try{return bl.credential(i,r)}catch{return null}}}bl.TWITTER_SIGN_IN_METHOD="twitter.com";bl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yj(t,e){return gm(t,"POST","/v1/accounts:signUp",mm(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,r,c=!1){const f=await jc._fromIdTokenResponse(e,r,c),y=BA(r);return new Jc({user:f,providerId:y,_tokenResponse:r,operationType:i})}static async _forOperation(e,i,r){await e._updateTokensIfNecessary(r,!0);const c=BA(r);return new Jc({user:e,providerId:c,_tokenResponse:r,operationType:i})}}function BA(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly extends Ko{constructor(e,i,r,c){var f;super(i.code,i.message),this.operationType=r,this.user=c,Object.setPrototypeOf(this,ly.prototype),this.customData={appName:e.name,tenantId:(f=e.tenantId)!==null&&f!==void 0?f:void 0,_serverResponse:i.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,i,r,c){return new ly(e,i,r,c)}}function AD(t,e,i,r){return(e==="reauthenticate"?i._getReauthenticationResolver(t):i._getIdTokenResponse(t)).catch(f=>{throw f.code==="auth/multi-factor-auth-required"?ly._fromErrorAndOperation(t,f,e,r):f})}async function Jj(t,e,i=!1){const r=await Wp(t,e._linkToIdToken(t.auth,await t.getIdToken()),i);return Jc._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qj(t,e,i=!1){const{auth:r}=t,c="reauthenticate";try{const f=await Wp(t,AD(r,c,e,t),i);ii(f.idToken,r,"internal-error");const y=f1(f.idToken);ii(y,r,"internal-error");const{sub:l}=y;return ii(t.uid===l,r,"user-mismatch"),Jc._forOperation(t,c,f)}catch(f){throw(f==null?void 0:f.code)==="auth/user-not-found"&&Fs(r,"user-mismatch"),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CD(t,e,i=!1){const r="signIn",c=await AD(t,r,e),f=await Jc._fromIdTokenResponse(t,r,c);return i||await t._updateCurrentUser(f.user),f}async function e6(t,e){return CD(ym(t),e)}async function e7(t,e,i){const r=ym(t),c=await Yj(r,{returnSecureToken:!0,email:e,password:i}),f=await Jc._fromIdTokenResponse(r,"signIn",c);return await r._updateCurrentUser(f.user),f}function t7(t,e,i){return e6(Ts(t),bd.credential(e,i))}function t6(t,e,i,r){return Ts(t).onAuthStateChanged(e,i,r)}const cy="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MD{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(cy,"1"),this.storage.removeItem(cy),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i6(){const t=Qn();return p1(t)||uv(t)}const n6=1e3,r6=10;class kD extends MD{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=i6()&&$j(),this.fallbackToPolling=ID(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const r=this.storage.getItem(i),c=this.localCache[i];r!==c&&e(i,c,r)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((y,l,I)=>{this.notifyListeners(y,I)});return}const r=e.key;if(i?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const y=this.storage.getItem(r);if(e.newValue!==y)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!i)return}const c=()=>{const y=this.storage.getItem(r);!i&&this.localCache[r]===y||this.notifyListeners(r,y)},f=this.storage.getItem(r);Vj()&&f!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,r6):c()}notifyListeners(e,i){this.localCache[e]=i;const r=this.listeners[e];if(r)for(const c of Array.from(r))c(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:r}),!0)})},n6)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}kD.type="LOCAL";const s6=kD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD extends MD{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}DD.type="SESSION";const PD=DD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o6(t){return Promise.all(t.map(async e=>{try{const i=await e;return{fulfilled:!0,value:i}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(c=>c.isListeningto(e));if(i)return i;const r=new hv(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:r,eventType:c,data:f}=i.data,y=this.handlersMap[c];if(!(y!=null&&y.size))return;i.ports[0].postMessage({status:"ack",eventId:r,eventType:c});const l=Array.from(y).map(async C=>C(i.origin,f)),I=await o6(l);i.ports[0].postMessage({status:"done",eventId:r,eventType:c,response:I})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}hv.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y1(t="",e=10){let i="";for(let r=0;r<e;r++)i+=Math.floor(Math.random()*10);return t+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a6{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,r=50){const c=typeof MessageChannel!="undefined"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let f,y;return new Promise((l,I)=>{const C=y1("",20);c.port1.start();const L=setTimeout(()=>{I(new Error("unsupported_event"))},r);y={messageChannel:c,onMessage(R){const $=R;if($.data.eventId===C)switch($.data.status){case"ack":clearTimeout(L),f=setTimeout(()=>{I(new Error("timeout"))},3e3);break;case"done":clearTimeout(f),l($.data.response);break;default:clearTimeout(L),clearTimeout(f),I(new Error("invalid_response"));break}}},this.handlers.add(y),c.port1.addEventListener("message",y.onMessage),this.target.postMessage({eventType:e,eventId:C,data:i},[c.port2])}).finally(()=>{y&&this.removeMessageHandler(y)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jo(){return window}function l6(t){jo().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RD(){return typeof jo().WorkerGlobalScope!="undefined"&&typeof jo().importScripts=="function"}async function c6(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function u6(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function h6(){return RD()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LD="firebaseLocalStorageDb",d6=1,uy="firebaseLocalStorage",OD="fbase_key";class xm{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function dv(t,e){return t.transaction([uy],e?"readwrite":"readonly").objectStore(uy)}function f6(){const t=indexedDB.deleteDatabase(LD);return new xm(t).toPromise()}function Lb(){const t=indexedDB.open(LD,d6);return new Promise((e,i)=>{t.addEventListener("error",()=>{i(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(uy,{keyPath:OD})}catch(c){i(c)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(uy)?e(r):(r.close(),await f6(),e(await Lb()))})})}async function UA(t,e,i){const r=dv(t,!0).put({[OD]:e,value:i});return new xm(r).toPromise()}async function p6(t,e){const i=dv(t,!1).get(e),r=await new xm(i).toPromise();return r===void 0?null:r.value}function VA(t,e){const i=dv(t,!0).delete(e);return new xm(i).toPromise()}const m6=800,_6=3;class zD{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Lb(),this.db)}async _withRetries(e){let i=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(i++>_6)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return RD()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=hv._getInstance(h6()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await c6(),!this.activeServiceWorker)return;this.sender=new a6(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);!r||((e=r[0])===null||e===void 0?void 0:e.fulfilled)&&((i=r[0])===null||i===void 0?void 0:i.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||u6()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Lb();return await UA(e,cy,"1"),await VA(e,cy),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(r=>UA(r,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(r=>p6(r,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>VA(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const f=dv(c,!1).getAll();return new xm(f).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],r=new Set;for(const{fbase_key:c,value:f}of e)r.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(f)&&(this.notifyListeners(c,f),i.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!r.has(c)&&(this.notifyListeners(c,null),i.push(c));return i}notifyListeners(e,i){this.localCache[e]=i;const r=this.listeners[e];if(r)for(const c of Array.from(r))c(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),m6)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}zD.type="LOCAL";const g6=zD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y6(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}function v6(t){return new Promise((e,i)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=c=>{const f=$o("internal-error");f.customData=c,i(f)},r.type="text/javascript",r.charset="UTF-8",y6().appendChild(r)})}function x6(t){return`__${t}${Math.floor(Math.random()*1e6)}`}new pm(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ND(t,e){return e?ba(e):(ii(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1 extends m1{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return zh(e,this._buildIdpRequest())}_linkToIdToken(e,i){return zh(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return zh(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function b6(t){return CD(t.auth,new v1(t),t.bypassAuthState)}function w6(t){const{auth:e,user:i}=t;return ii(i,e,"internal-error"),Qj(i,new v1(t),t.bypassAuthState)}async function E6(t){const{auth:e,user:i}=t;return ii(i,e,"internal-error"),Jj(i,new v1(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(e,i,r,c,f=!1){this.auth=e,this.resolver=r,this.user=c,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:r,postBody:c,tenantId:f,error:y,type:l}=e;if(y){this.reject(y);return}const I={auth:this.auth,requestUri:i,sessionId:r,tenantId:f||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(I))}catch(C){this.reject(C)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return b6;case"linkViaPopup":case"linkViaRedirect":return E6;case"reauthViaPopup":case"reauthViaRedirect":return w6;default:Fs(this.auth,"internal-error")}}resolve(e){Ma(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ma(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T6=new pm(2e3,1e4);async function i7(t,e,i){const r=ym(t);bj(t,e,g1);const c=ND(r,i);return new Pc(r,"signInViaPopup",e,c).executeNotNull()}class Pc extends FD{constructor(e,i,r,c,f){super(e,i,c,f),this.provider=r,this.authWindow=null,this.pollId=null,Pc.currentPopupAction&&Pc.currentPopupAction.cancel(),Pc.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ii(e,this.auth,"internal-error"),e}async onExecution(){Ma(this.filter.length===1,"Popup operations only handle one event");const e=y1();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject($o(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject($o(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Pc.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,r;if(!((r=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject($o(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,T6.get())};e()}}Pc.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I6="pendingRedirect",P0=new Map;class S6 extends FD{constructor(e,i,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,r),this.eventId=null}async execute(){let e=P0.get(this.auth._key());if(!e){try{const r=await A6(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(i){e=()=>Promise.reject(i)}P0.set(this.auth._key(),e)}return this.bypassAuthState||P0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function A6(t,e){const i=M6(e),r=C6(t);if(!await r._isAvailable())return!1;const c=await r._get(i)==="true";return await r._remove(i),c}function C6(t){return ba(t._redirectPersistence)}function M6(t){return Bg(I6,t.config.apiKey,t.name)}async function k6(t,e,i=!1){const r=ym(t),c=ND(r,e),y=await new S6(r,c,i).execute();return y&&!i&&(delete y.user._redirectEventId,await r._persistUserIfCurrent(y.user),await r._setRedirectUser(null,e)),y}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D6=10*60*1e3;class P6{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(i=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!R6(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var r;if(e.error&&!BD(e)){const c=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";i.onError($o(this.auth,c))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const r=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=D6&&this.cachedEventUids.clear(),this.cachedEventUids.has($A(e))}saveEventToCache(e){this.cachedEventUids.add($A(e)),this.lastProcessedEventTime=Date.now()}}function $A(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function BD({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function R6(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return BD(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L6(t,e={}){return _m(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O6=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,z6=/^https?/;async function N6(t){if(t.config.emulator)return;const{authorizedDomains:e}=await L6(t);for(const i of e)try{if(F6(i))return}catch{}Fs(t,"unauthorized-domain")}function F6(t){const e=Rb(),{protocol:i,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const y=new URL(t);return y.hostname===""&&r===""?i==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&y.hostname===r}if(!z6.test(i))return!1;if(O6.test(t))return r===t;const c=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B6=new pm(3e4,6e4);function jA(){const t=jo().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let i=0;i<t.CP.length;i++)t.CP[i]=null}}function U6(t){return new Promise((e,i)=>{var r,c,f;function y(){jA(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{jA(),i($o(t,"network-request-failed"))},timeout:B6.get()})}if(!((c=(r=jo().gapi)===null||r===void 0?void 0:r.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((f=jo().gapi)===null||f===void 0)&&f.load)y();else{const l=x6("iframefcb");return jo()[l]=()=>{gapi.load?y():i($o(t,"network-request-failed"))},v6(`https://apis.google.com/js/api.js?onload=${l}`).catch(I=>i(I))}}).catch(e=>{throw Ug=null,e})}let Ug=null;function V6(t){return Ug=Ug||U6(t),Ug}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $6=new pm(5e3,15e3),j6="__/auth/iframe",G6="emulator/auth/iframe",q6={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},W6=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function H6(t){const e=t.config;ii(e.authDomain,t,"auth-domain-config-required");const i=e.emulator?d1(e,G6):`https://${t.config.authDomain}/${j6}`,r={apiKey:e.apiKey,appName:t.name,v:pu},c=W6.get(t.config.apiHost);c&&(r.eid=c);const f=t._getFrameworks();return f.length&&(r.fw=f.join(",")),`${i}?${yd(r).slice(1)}`}async function K6(t){const e=await V6(t),i=jo().gapi;return ii(i,t,"internal-error"),e.open({where:document.body,url:H6(t),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:q6,dontclear:!0},r=>new Promise(async(c,f)=>{await r.restyle({setHideOnLeave:!1});const y=$o(t,"network-request-failed"),l=jo().setTimeout(()=>{f(y)},$6.get());function I(){jo().clearTimeout(l),c(r)}r.ping(I).then(I,()=>{f(y)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z6={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},X6=500,Y6=600,J6="_blank",Q6="http://localhost";class GA{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function eG(t,e,i,r=X6,c=Y6){const f=Math.max((window.screen.availHeight-c)/2,0).toString(),y=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const I=Object.assign(Object.assign({},Z6),{width:r.toString(),height:c.toString(),top:f,left:y}),C=Qn().toLowerCase();i&&(l=xD(C)?J6:i),vD(C)&&(e=e||Q6,I.scrollbars="yes");const L=Object.entries(I).reduce(($,[J,pe])=>`${$}${J}=${pe},`,"");if(Uj(C)&&l!=="_self")return tG(e||"",l),new GA(null);const R=window.open(e||"",l,L);ii(R,t,"popup-blocked");try{R.focus()}catch{}return new GA(R)}function tG(t,e){const i=document.createElement("a");i.href=t,i.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iG="__/auth/handler",nG="emulator/auth/handler";function qA(t,e,i,r,c,f){ii(t.config.authDomain,t,"auth-domain-config-required"),ii(t.config.apiKey,t,"invalid-api-key");const y={apiKey:t.config.apiKey,appName:t.name,authType:i,redirectUrl:r,v:pu,eventId:c};if(e instanceof g1){e.setDefaultLanguage(t.languageCode),y.providerId=e.providerId||"",kb(e.getCustomParameters())||(y.customParameters=JSON.stringify(e.getCustomParameters()));for(const[I,C]of Object.entries(f||{}))y[I]=C}if(e instanceof vm){const I=e.getScopes().filter(C=>C!=="");I.length>0&&(y.scopes=I.join(","))}t.tenantId&&(y.tid=t.tenantId);const l=y;for(const I of Object.keys(l))l[I]===void 0&&delete l[I];return`${rG(t)}?${yd(l).slice(1)}`}function rG({config:t}){return t.emulator?d1(t,nG):`https://${t.authDomain}/${iG}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R0="webStorageSupport";class sG{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=PD,this._completeRedirectFn=k6}async _openPopup(e,i,r,c){var f;Ma((f=this.eventManagers[e._key()])===null||f===void 0?void 0:f.manager,"_initialize() not called before _openPopup()");const y=qA(e,i,r,Rb(),c);return eG(e,y,y1())}async _openRedirect(e,i,r,c){return await this._originValidation(e),l6(qA(e,i,r,Rb(),c)),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:c,promise:f}=this.eventManagers[i];return c?Promise.resolve(c):(Ma(f,"If manager is not set, promise should be"),f)}const r=this.initAndGetManager(e);return this.eventManagers[i]={promise:r},r.catch(()=>{delete this.eventManagers[i]}),r}async initAndGetManager(e){const i=await K6(e),r=new P6(e);return i.register("authEvent",c=>(ii(c==null?void 0:c.authEvent,e,"invalid-auth-event"),{status:r.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=i,r}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(R0,{type:R0},c=>{var f;const y=(f=c==null?void 0:c[0])===null||f===void 0?void 0:f[R0];y!==void 0&&i(!!y),Fs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=N6(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return ID()||p1()||uv()}}const oG=sG;var WA="@firebase/auth",HA="0.19.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aG{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(r=>{var c;e(((c=r)===null||c===void 0?void 0:c.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);!i||(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){ii(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lG(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function cG(t){Ns(new Is("auth",(e,{options:i})=>{const r=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),{apiKey:f,authDomain:y}=r.options;return((l,I)=>{ii(f&&!f.includes(":"),"invalid-api-key",{appName:l.name}),ii(!(y!=null&&y.includes(":")),"argument-error",{appName:l.name});const C={apiKey:f,authDomain:y,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:SD(t)},L=new jj(l,I,C);return Ej(L,i),L})(r,c)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,r)=>{e.getProvider("auth-internal").initialize()})),Ns(new Is("auth-internal",e=>{const i=ym(e.getProvider("auth").getImmediate());return(r=>new aG(r))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ir(WA,HA,lG(t)),Ir(WA,HA,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UD(t=c1()){const e=xd(t,"auth");return e.isInitialized()?e.getImmediate():wj(t,{popupRedirectResolver:oG,persistence:[g6,s6,PD]})}cG("Browser");/*!
  * vue-router v4.0.15
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const VD=typeof Symbol=="function"&&typeof Symbol.toStringTag=="symbol",wd=t=>VD?Symbol(t):"_vr_"+t,uG=wd("rvlm"),KA=wd("rvd"),fv=wd("r"),x1=wd("rl"),Ob=wd("rvl"),Ih=typeof window!="undefined";function hG(t){return t.__esModule||VD&&t[Symbol.toStringTag]==="Module"}const sn=Object.assign;function L0(t,e){const i={};for(const r in e){const c=e[r];i[r]=Array.isArray(c)?c.map(t):t(c)}return i}const Ap=()=>{},dG=/\/$/,fG=t=>t.replace(dG,"");function O0(t,e,i="/"){let r,c={},f="",y="";const l=e.indexOf("?"),I=e.indexOf("#",l>-1?l:0);return l>-1&&(r=e.slice(0,l),f=e.slice(l+1,I>-1?I:e.length),c=t(f)),I>-1&&(r=r||e.slice(0,I),y=e.slice(I,e.length)),r=gG(r!=null?r:e,i),{fullPath:r+(f&&"?")+f+y,path:r,query:c,hash:y}}function pG(t,e){const i=e.query?t(e.query):"";return e.path+(i&&"?")+i+(e.hash||"")}function ZA(t,e){return!e||!t.toLowerCase().startsWith(e.toLowerCase())?t:t.slice(e.length)||"/"}function mG(t,e,i){const r=e.matched.length-1,c=i.matched.length-1;return r>-1&&r===c&&Yh(e.matched[r],i.matched[c])&&$D(e.params,i.params)&&t(e.query)===t(i.query)&&e.hash===i.hash}function Yh(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function $D(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const i in t)if(!_G(t[i],e[i]))return!1;return!0}function _G(t,e){return Array.isArray(t)?XA(t,e):Array.isArray(e)?XA(e,t):t===e}function XA(t,e){return Array.isArray(e)?t.length===e.length&&t.every((i,r)=>i===e[r]):t.length===1&&t[0]===e}function gG(t,e){if(t.startsWith("/"))return t;if(!t)return e;const i=e.split("/"),r=t.split("/");let c=i.length-1,f,y;for(f=0;f<r.length;f++)if(y=r[f],!(c===1||y==="."))if(y==="..")c--;else break;return i.slice(0,c).join("/")+"/"+r.slice(f-(f===r.length?1:0)).join("/")}var Zp;(function(t){t.pop="pop",t.push="push"})(Zp||(Zp={}));var Cp;(function(t){t.back="back",t.forward="forward",t.unknown=""})(Cp||(Cp={}));function yG(t){if(!t)if(Ih){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),fG(t)}const vG=/^[^#]+#/;function xG(t,e){return t.replace(vG,"#")+e}function bG(t,e){const i=document.documentElement.getBoundingClientRect(),r=t.getBoundingClientRect();return{behavior:e.behavior,left:r.left-i.left-(e.left||0),top:r.top-i.top-(e.top||0)}}const pv=()=>({left:window.pageXOffset,top:window.pageYOffset});function wG(t){let e;if("el"in t){const i=t.el,r=typeof i=="string"&&i.startsWith("#"),c=typeof i=="string"?r?document.getElementById(i.slice(1)):document.querySelector(i):i;if(!c)return;e=bG(c,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.pageXOffset,e.top!=null?e.top:window.pageYOffset)}function YA(t,e){return(history.state?history.state.position-e:-1)+t}const zb=new Map;function EG(t,e){zb.set(t,e)}function TG(t){const e=zb.get(t);return zb.delete(t),e}let IG=()=>location.protocol+"//"+location.host;function jD(t,e){const{pathname:i,search:r,hash:c}=e,f=t.indexOf("#");if(f>-1){let l=c.includes(t.slice(f))?t.slice(f).length:1,I=c.slice(l);return I[0]!=="/"&&(I="/"+I),ZA(I,"")}return ZA(i,t)+r+c}function SG(t,e,i,r){let c=[],f=[],y=null;const l=({state:$})=>{const J=jD(t,location),pe=i.value,Re=e.value;let we=0;if($){if(i.value=J,e.value=$,y&&y===pe){y=null;return}we=Re?$.position-Re.position:0}else r(J);c.forEach(Be=>{Be(i.value,pe,{delta:we,type:Zp.pop,direction:we?we>0?Cp.forward:Cp.back:Cp.unknown})})};function I(){y=i.value}function C($){c.push($);const J=()=>{const pe=c.indexOf($);pe>-1&&c.splice(pe,1)};return f.push(J),J}function L(){const{history:$}=window;!$.state||$.replaceState(sn({},$.state,{scroll:pv()}),"")}function R(){for(const $ of f)$();f=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",L)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",L),{pauseListeners:I,listen:C,destroy:R}}function JA(t,e,i,r=!1,c=!1){return{back:t,current:e,forward:i,replaced:r,position:window.history.length,scroll:c?pv():null}}function AG(t){const{history:e,location:i}=window,r={value:jD(t,i)},c={value:e.state};c.value||f(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function f(I,C,L){const R=t.indexOf("#"),$=R>-1?(i.host&&document.querySelector("base")?t:t.slice(R))+I:IG()+t+I;try{e[L?"replaceState":"pushState"](C,"",$),c.value=C}catch(J){console.error(J),i[L?"replace":"assign"]($)}}function y(I,C){const L=sn({},e.state,JA(c.value.back,I,c.value.forward,!0),C,{position:c.value.position});f(I,L,!0),r.value=I}function l(I,C){const L=sn({},c.value,e.state,{forward:I,scroll:pv()});f(L.current,L,!0);const R=sn({},JA(r.value,I,null),{position:L.position+1},C);f(I,R,!1),r.value=I}return{location:r,state:c,push:l,replace:y}}function CG(t){t=yG(t);const e=AG(t),i=SG(t,e.state,e.location,e.replace);function r(f,y=!0){y||i.pauseListeners(),history.go(f)}const c=sn({location:"",base:t,go:r,createHref:xG.bind(null,t)},e,i);return Object.defineProperty(c,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(c,"state",{enumerable:!0,get:()=>e.state.value}),c}function MG(t){return typeof t=="string"||t&&typeof t=="object"}function GD(t){return typeof t=="string"||typeof t=="symbol"}const fl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},qD=wd("nf");var QA;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(QA||(QA={}));function Jh(t,e){return sn(new Error,{type:t,[qD]:!0},e)}function pl(t,e){return t instanceof Error&&qD in t&&(e==null||!!(t.type&e))}const eC="[^/]+?",kG={sensitive:!1,strict:!1,start:!0,end:!0},DG=/[.+*?^${}()[\]/\\]/g;function PG(t,e){const i=sn({},kG,e),r=[];let c=i.start?"^":"";const f=[];for(const C of t){const L=C.length?[]:[90];i.strict&&!C.length&&(c+="/");for(let R=0;R<C.length;R++){const $=C[R];let J=40+(i.sensitive?.25:0);if($.type===0)R||(c+="/"),c+=$.value.replace(DG,"\\$&"),J+=40;else if($.type===1){const{value:pe,repeatable:Re,optional:we,regexp:Be}=$;f.push({name:pe,repeatable:Re,optional:we});const nt=Be||eC;if(nt!==eC){J+=10;try{new RegExp(`(${nt})`)}catch(lt){throw new Error(`Invalid custom RegExp for param "${pe}" (${nt}): `+lt.message)}}let yt=Re?`((?:${nt})(?:/(?:${nt}))*)`:`(${nt})`;R||(yt=we&&C.length<2?`(?:/${yt})`:"/"+yt),we&&(yt+="?"),c+=yt,J+=20,we&&(J+=-8),Re&&(J+=-20),nt===".*"&&(J+=-50)}L.push(J)}r.push(L)}if(i.strict&&i.end){const C=r.length-1;r[C][r[C].length-1]+=.7000000000000001}i.strict||(c+="/?"),i.end?c+="$":i.strict&&(c+="(?:/|$)");const y=new RegExp(c,i.sensitive?"":"i");function l(C){const L=C.match(y),R={};if(!L)return null;for(let $=1;$<L.length;$++){const J=L[$]||"",pe=f[$-1];R[pe.name]=J&&pe.repeatable?J.split("/"):J}return R}function I(C){let L="",R=!1;for(const $ of t){(!R||!L.endsWith("/"))&&(L+="/"),R=!1;for(const J of $)if(J.type===0)L+=J.value;else if(J.type===1){const{value:pe,repeatable:Re,optional:we}=J,Be=pe in C?C[pe]:"";if(Array.isArray(Be)&&!Re)throw new Error(`Provided param "${pe}" is an array but it is not repeatable (* or + modifiers)`);const nt=Array.isArray(Be)?Be.join("/"):Be;if(!nt)if(we)$.length<2&&t.length>1&&(L.endsWith("/")?L=L.slice(0,-1):R=!0);else throw new Error(`Missing required param "${pe}"`);L+=nt}}return L}return{re:y,score:r,keys:f,parse:l,stringify:I}}function RG(t,e){let i=0;for(;i<t.length&&i<e.length;){const r=e[i]-t[i];if(r)return r;i++}return t.length<e.length?t.length===1&&t[0]===40+40?-1:1:t.length>e.length?e.length===1&&e[0]===40+40?1:-1:0}function LG(t,e){let i=0;const r=t.score,c=e.score;for(;i<r.length&&i<c.length;){const f=RG(r[i],c[i]);if(f)return f;i++}return c.length-r.length}const OG={type:0,value:""},zG=/[a-zA-Z0-9_]/;function NG(t){if(!t)return[[]];if(t==="/")return[[OG]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(J){throw new Error(`ERR (${i})/"${C}": ${J}`)}let i=0,r=i;const c=[];let f;function y(){f&&c.push(f),f=[]}let l=0,I,C="",L="";function R(){!C||(i===0?f.push({type:0,value:C}):i===1||i===2||i===3?(f.length>1&&(I==="*"||I==="+")&&e(`A repeatable param (${C}) must be alone in its segment. eg: '/:ids+.`),f.push({type:1,value:C,regexp:L,repeatable:I==="*"||I==="+",optional:I==="*"||I==="?"})):e("Invalid state to consume buffer"),C="")}function $(){C+=I}for(;l<t.length;){if(I=t[l++],I==="\\"&&i!==2){r=i,i=4;continue}switch(i){case 0:I==="/"?(C&&R(),y()):I===":"?(R(),i=1):$();break;case 4:$(),i=r;break;case 1:I==="("?i=2:zG.test(I)?$():(R(),i=0,I!=="*"&&I!=="?"&&I!=="+"&&l--);break;case 2:I===")"?L[L.length-1]=="\\"?L=L.slice(0,-1)+I:i=3:L+=I;break;case 3:R(),i=0,I!=="*"&&I!=="?"&&I!=="+"&&l--,L="";break;default:e("Unknown state");break}}return i===2&&e(`Unfinished custom RegExp for param "${C}"`),R(),y(),c}function FG(t,e,i){const r=PG(NG(t.path),i),c=sn(r,{record:t,parent:e,children:[],alias:[]});return e&&!c.record.aliasOf==!e.record.aliasOf&&e.children.push(c),c}function BG(t,e){const i=[],r=new Map;e=iC({strict:!1,end:!0,sensitive:!1},e);function c(L){return r.get(L)}function f(L,R,$){const J=!$,pe=VG(L);pe.aliasOf=$&&$.record;const Re=iC(e,L),we=[pe];if("alias"in L){const yt=typeof L.alias=="string"?[L.alias]:L.alias;for(const lt of yt)we.push(sn({},pe,{components:$?$.record.components:pe.components,path:lt,aliasOf:$?$.record:pe}))}let Be,nt;for(const yt of we){const{path:lt}=yt;if(R&&lt[0]!=="/"){const zt=R.record.path,rt=zt[zt.length-1]==="/"?"":"/";yt.path=R.record.path+(lt&&rt+lt)}if(Be=FG(yt,R,Re),$?$.alias.push(Be):(nt=nt||Be,nt!==Be&&nt.alias.push(Be),J&&L.name&&!tC(Be)&&y(L.name)),"children"in pe){const zt=pe.children;for(let rt=0;rt<zt.length;rt++)f(zt[rt],Be,$&&$.children[rt])}$=$||Be,I(Be)}return nt?()=>{y(nt)}:Ap}function y(L){if(GD(L)){const R=r.get(L);R&&(r.delete(L),i.splice(i.indexOf(R),1),R.children.forEach(y),R.alias.forEach(y))}else{const R=i.indexOf(L);R>-1&&(i.splice(R,1),L.record.name&&r.delete(L.record.name),L.children.forEach(y),L.alias.forEach(y))}}function l(){return i}function I(L){let R=0;for(;R<i.length&&LG(L,i[R])>=0&&(L.record.path!==i[R].record.path||!WD(L,i[R]));)R++;i.splice(R,0,L),L.record.name&&!tC(L)&&r.set(L.record.name,L)}function C(L,R){let $,J={},pe,Re;if("name"in L&&L.name){if($=r.get(L.name),!$)throw Jh(1,{location:L});Re=$.record.name,J=sn(UG(R.params,$.keys.filter(nt=>!nt.optional).map(nt=>nt.name)),L.params),pe=$.stringify(J)}else if("path"in L)pe=L.path,$=i.find(nt=>nt.re.test(pe)),$&&(J=$.parse(pe),Re=$.record.name);else{if($=R.name?r.get(R.name):i.find(nt=>nt.re.test(R.path)),!$)throw Jh(1,{location:L,currentLocation:R});Re=$.record.name,J=sn({},R.params,L.params),pe=$.stringify(J)}const we=[];let Be=$;for(;Be;)we.unshift(Be.record),Be=Be.parent;return{name:Re,path:pe,params:J,matched:we,meta:jG(we)}}return t.forEach(L=>f(L)),{addRoute:f,resolve:C,removeRoute:y,getRoutes:l,getRecordMatcher:c}}function UG(t,e){const i={};for(const r of e)r in t&&(i[r]=t[r]);return i}function VG(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:$G(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||{}:{default:t.component}}}function $G(t){const e={},i=t.props||!1;if("component"in t)e.default=i;else for(const r in t.components)e[r]=typeof i=="boolean"?i:i[r];return e}function tC(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function jG(t){return t.reduce((e,i)=>sn(e,i.meta),{})}function iC(t,e){const i={};for(const r in t)i[r]=r in e?e[r]:t[r];return i}function WD(t,e){return e.children.some(i=>i===t||WD(t,i))}const HD=/#/g,GG=/&/g,qG=/\//g,WG=/=/g,HG=/\?/g,KD=/\+/g,KG=/%5B/g,ZG=/%5D/g,ZD=/%5E/g,XG=/%60/g,XD=/%7B/g,YG=/%7C/g,YD=/%7D/g,JG=/%20/g;function b1(t){return encodeURI(""+t).replace(YG,"|").replace(KG,"[").replace(ZG,"]")}function QG(t){return b1(t).replace(XD,"{").replace(YD,"}").replace(ZD,"^")}function Nb(t){return b1(t).replace(KD,"%2B").replace(JG,"+").replace(HD,"%23").replace(GG,"%26").replace(XG,"`").replace(XD,"{").replace(YD,"}").replace(ZD,"^")}function eq(t){return Nb(t).replace(WG,"%3D")}function tq(t){return b1(t).replace(HD,"%23").replace(HG,"%3F")}function iq(t){return t==null?"":tq(t).replace(qG,"%2F")}function hy(t){try{return decodeURIComponent(""+t)}catch{}return""+t}function nq(t){const e={};if(t===""||t==="?")return e;const r=(t[0]==="?"?t.slice(1):t).split("&");for(let c=0;c<r.length;++c){const f=r[c].replace(KD," "),y=f.indexOf("="),l=hy(y<0?f:f.slice(0,y)),I=y<0?null:hy(f.slice(y+1));if(l in e){let C=e[l];Array.isArray(C)||(C=e[l]=[C]),C.push(I)}else e[l]=I}return e}function nC(t){let e="";for(let i in t){const r=t[i];if(i=eq(i),r==null){r!==void 0&&(e+=(e.length?"&":"")+i);continue}(Array.isArray(r)?r.map(f=>f&&Nb(f)):[r&&Nb(r)]).forEach(f=>{f!==void 0&&(e+=(e.length?"&":"")+i,f!=null&&(e+="="+f))})}return e}function rq(t){const e={};for(const i in t){const r=t[i];r!==void 0&&(e[i]=Array.isArray(r)?r.map(c=>c==null?null:""+c):r==null?r:""+r)}return e}function rp(){let t=[];function e(r){return t.push(r),()=>{const c=t.indexOf(r);c>-1&&t.splice(c,1)}}function i(){t=[]}return{add:e,list:()=>t,reset:i}}function gl(t,e,i,r,c){const f=r&&(r.enterCallbacks[c]=r.enterCallbacks[c]||[]);return()=>new Promise((y,l)=>{const I=R=>{R===!1?l(Jh(4,{from:i,to:e})):R instanceof Error?l(R):MG(R)?l(Jh(2,{from:e,to:R})):(f&&r.enterCallbacks[c]===f&&typeof R=="function"&&f.push(R),y())},C=t.call(r&&r.instances[c],e,i,I);let L=Promise.resolve(C);t.length<3&&(L=L.then(I)),L.catch(R=>l(R))})}function z0(t,e,i,r){const c=[];for(const f of t)for(const y in f.components){let l=f.components[y];if(!(e!=="beforeRouteEnter"&&!f.instances[y]))if(sq(l)){const C=(l.__vccOpts||l)[e];C&&c.push(gl(C,i,r,f,y))}else{let I=l();c.push(()=>I.then(C=>{if(!C)return Promise.reject(new Error(`Couldn't resolve component "${y}" at "${f.path}"`));const L=hG(C)?C.default:C;f.components[y]=L;const $=(L.__vccOpts||L)[e];return $&&gl($,i,r,f,y)()}))}}return c}function sq(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function rC(t){const e=Vo(fv),i=Vo(x1),r=Fo(()=>e.resolve(wp(t.to))),c=Fo(()=>{const{matched:I}=r.value,{length:C}=I,L=I[C-1],R=i.matched;if(!L||!R.length)return-1;const $=R.findIndex(Yh.bind(null,L));if($>-1)return $;const J=sC(I[C-2]);return C>1&&sC(L)===J&&R[R.length-1].path!==J?R.findIndex(Yh.bind(null,I[C-2])):$}),f=Fo(()=>c.value>-1&&cq(i.params,r.value.params)),y=Fo(()=>c.value>-1&&c.value===i.matched.length-1&&$D(i.params,r.value.params));function l(I={}){return lq(I)?e[wp(t.replace)?"replace":"push"](wp(t.to)).catch(Ap):Promise.resolve()}return{route:r,href:Fo(()=>r.value.href),isActive:f,isExactActive:y,navigate:l}}const oq=Ik({name:"RouterLink",props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:rC,setup(t,{slots:e}){const i=fm(rC(t)),{options:r}=Vo(fv),c=Fo(()=>({[oC(t.activeClass,r.linkActiveClass,"router-link-active")]:i.isActive,[oC(t.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:i.isExactActive}));return()=>{const f=e.default&&e.default(i);return t.custom?f:Hk("a",{"aria-current":i.isExactActive?t.ariaCurrentValue:null,href:i.href,onClick:i.navigate,class:c.value},f)}}}),aq=oq;function lq(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function cq(t,e){for(const i in e){const r=e[i],c=t[i];if(typeof r=="string"){if(r!==c)return!1}else if(!Array.isArray(c)||c.length!==r.length||r.some((f,y)=>f!==c[y]))return!1}return!0}function sC(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const oC=(t,e,i)=>t!=null?t:e!=null?e:i,uq=Ik({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:i}){const r=Vo(Ob),c=Fo(()=>t.route||r.value),f=Vo(KA,0),y=Fo(()=>c.value.matched[f]);Lg(KA,f+1),Lg(uG,y),Lg(Ob,c);const l=dk();return Og(()=>[l.value,y.value,t.name],([I,C,L],[R,$,J])=>{C&&(C.instances[L]=I,$&&$!==C&&I&&I===R&&(C.leaveGuards.size||(C.leaveGuards=$.leaveGuards),C.updateGuards.size||(C.updateGuards=$.updateGuards))),I&&C&&(!$||!Yh(C,$)||!R)&&(C.enterCallbacks[L]||[]).forEach(pe=>pe(I))},{flush:"post"}),()=>{const I=c.value,C=y.value,L=C&&C.components[t.name],R=t.name;if(!L)return aC(i.default,{Component:L,route:I});const $=C.props[t.name],J=$?$===!0?I.params:typeof $=="function"?$(I):$:null,Re=Hk(L,sn({},J,e,{onVnodeUnmounted:we=>{we.component.isUnmounted&&(C.instances[R]=null)},ref:l}));return aC(i.default,{Component:Re,route:I})||Re}}});function aC(t,e){if(!t)return null;const i=t(e);return i.length===1?i[0]:i}const hq=uq;function dq(t){const e=BG(t.routes,t),i=t.parseQuery||nq,r=t.stringifyQuery||nC,c=t.history,f=rp(),y=rp(),l=rp(),I=b4(fl);let C=fl;Ih&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const L=L0.bind(null,ze=>""+ze),R=L0.bind(null,iq),$=L0.bind(null,hy);function J(ze,_t){let tt,bt;return GD(ze)?(tt=e.getRecordMatcher(ze),bt=_t):bt=ze,e.addRoute(bt,tt)}function pe(ze){const _t=e.getRecordMatcher(ze);_t&&e.removeRoute(_t)}function Re(){return e.getRoutes().map(ze=>ze.record)}function we(ze){return!!e.getRecordMatcher(ze)}function Be(ze,_t){if(_t=sn({},_t||I.value),typeof ze=="string"){const ct=O0(i,ze,_t.path),se=e.resolve({path:ct.path},_t),me=c.createHref(ct.fullPath);return sn(ct,se,{params:$(se.params),hash:hy(ct.hash),redirectedFrom:void 0,href:me})}let tt;if("path"in ze)tt=sn({},ze,{path:O0(i,ze.path,_t.path).path});else{const ct=sn({},ze.params);for(const se in ct)ct[se]==null&&delete ct[se];tt=sn({},ze,{params:R(ze.params)}),_t.params=R(_t.params)}const bt=e.resolve(tt,_t),yi=ze.hash||"";bt.params=L($(bt.params));const xi=pG(r,sn({},ze,{hash:QG(yi),path:bt.path})),Ut=c.createHref(xi);return sn({fullPath:xi,hash:yi,query:r===nC?rq(ze.query):ze.query||{}},bt,{redirectedFrom:void 0,href:Ut})}function nt(ze){return typeof ze=="string"?O0(i,ze,I.value.path):sn({},ze)}function yt(ze,_t){if(C!==ze)return Jh(8,{from:_t,to:ze})}function lt(ze){return Wt(ze)}function zt(ze){return lt(sn(nt(ze),{replace:!0}))}function rt(ze){const _t=ze.matched[ze.matched.length-1];if(_t&&_t.redirect){const{redirect:tt}=_t;let bt=typeof tt=="function"?tt(ze):tt;return typeof bt=="string"&&(bt=bt.includes("?")||bt.includes("#")?bt=nt(bt):{path:bt},bt.params={}),sn({query:ze.query,hash:ze.hash,params:ze.params},bt)}}function Wt(ze,_t){const tt=C=Be(ze),bt=I.value,yi=ze.state,xi=ze.force,Ut=ze.replace===!0,ct=rt(tt);if(ct)return Wt(sn(nt(ct),{state:yi,force:xi,replace:Ut}),_t||tt);const se=tt;se.redirectedFrom=_t;let me;return!xi&&mG(r,bt,tt)&&(me=Jh(16,{to:se,from:bt}),Bn(bt,bt,!0,!1)),(me?Promise.resolve(me):_i(se,bt)).catch(Ie=>pl(Ie)?pl(Ie,2)?Ie:Ui(Ie):Zt(Ie,se,bt)).then(Ie=>{if(Ie){if(pl(Ie,2))return Wt(sn(nt(Ie.to),{state:yi,force:xi,replace:Ut}),_t||se)}else Ie=Ht(se,bt,!0,Ut,yi);return Ci(se,bt,Ie),Ie})}function hi(ze,_t){const tt=yt(ze,_t);return tt?Promise.reject(tt):Promise.resolve()}function _i(ze,_t){let tt;const[bt,yi,xi]=fq(ze,_t);tt=z0(bt.reverse(),"beforeRouteLeave",ze,_t);for(const ct of bt)ct.leaveGuards.forEach(se=>{tt.push(gl(se,ze,_t))});const Ut=hi.bind(null,ze,_t);return tt.push(Ut),vh(tt).then(()=>{tt=[];for(const ct of f.list())tt.push(gl(ct,ze,_t));return tt.push(Ut),vh(tt)}).then(()=>{tt=z0(yi,"beforeRouteUpdate",ze,_t);for(const ct of yi)ct.updateGuards.forEach(se=>{tt.push(gl(se,ze,_t))});return tt.push(Ut),vh(tt)}).then(()=>{tt=[];for(const ct of ze.matched)if(ct.beforeEnter&&!_t.matched.includes(ct))if(Array.isArray(ct.beforeEnter))for(const se of ct.beforeEnter)tt.push(gl(se,ze,_t));else tt.push(gl(ct.beforeEnter,ze,_t));return tt.push(Ut),vh(tt)}).then(()=>(ze.matched.forEach(ct=>ct.enterCallbacks={}),tt=z0(xi,"beforeRouteEnter",ze,_t),tt.push(Ut),vh(tt))).then(()=>{tt=[];for(const ct of y.list())tt.push(gl(ct,ze,_t));return tt.push(Ut),vh(tt)}).catch(ct=>pl(ct,8)?ct:Promise.reject(ct))}function Ci(ze,_t,tt){for(const bt of l.list())bt(ze,_t,tt)}function Ht(ze,_t,tt,bt,yi){const xi=yt(ze,_t);if(xi)return xi;const Ut=_t===fl,ct=Ih?history.state:{};tt&&(bt||Ut?c.replace(ze.fullPath,sn({scroll:Ut&&ct&&ct.scroll},yi)):c.push(ze.fullPath,yi)),I.value=ze,Bn(ze,_t,tt,Ut),Ui()}let $i;function Xi(){$i||($i=c.listen((ze,_t,tt)=>{const bt=Be(ze),yi=rt(bt);if(yi){Wt(sn(yi,{replace:!0}),bt).catch(Ap);return}C=bt;const xi=I.value;Ih&&EG(YA(xi.fullPath,tt.delta),pv()),_i(bt,xi).catch(Ut=>pl(Ut,12)?Ut:pl(Ut,2)?(Wt(Ut.to,bt).then(ct=>{pl(ct,20)&&!tt.delta&&tt.type===Zp.pop&&c.go(-1,!1)}).catch(Ap),Promise.reject()):(tt.delta&&c.go(-tt.delta,!1),Zt(Ut,bt,xi))).then(Ut=>{Ut=Ut||Ht(bt,xi,!1),Ut&&(tt.delta?c.go(-tt.delta,!1):tt.type===Zp.pop&&pl(Ut,20)&&c.go(-1,!1)),Ci(bt,xi,Ut)}).catch(Ap)}))}let Nn=rp(),Fn=rp(),si;function Zt(ze,_t,tt){Ui(ze);const bt=Fn.list();return bt.length?bt.forEach(yi=>yi(ze,_t,tt)):console.error(ze),Promise.reject(ze)}function Qt(){return si&&I.value!==fl?Promise.resolve():new Promise((ze,_t)=>{Nn.add([ze,_t])})}function Ui(ze){return si||(si=!ze,Xi(),Nn.list().forEach(([_t,tt])=>ze?tt(ze):_t()),Nn.reset()),ze}function Bn(ze,_t,tt,bt){const{scrollBehavior:yi}=t;if(!Ih||!yi)return Promise.resolve();const xi=!tt&&TG(YA(ze.fullPath,0))||(bt||!tt)&&history.state&&history.state.scroll||null;return _k().then(()=>yi(ze,_t,xi)).then(Ut=>Ut&&wG(Ut)).catch(Ut=>Zt(Ut,ze,_t))}const Ji=ze=>c.go(ze);let vn;const Kt=new Set;return{currentRoute:I,addRoute:J,removeRoute:pe,hasRoute:we,getRoutes:Re,resolve:Be,options:t,push:lt,replace:zt,go:Ji,back:()=>Ji(-1),forward:()=>Ji(1),beforeEach:f.add,beforeResolve:y.add,afterEach:l.add,onError:Fn.add,isReady:Qt,install(ze){const _t=this;ze.component("RouterLink",aq),ze.component("RouterView",hq),ze.config.globalProperties.$router=_t,Object.defineProperty(ze.config.globalProperties,"$route",{enumerable:!0,get:()=>wp(I)}),Ih&&!vn&&I.value===fl&&(vn=!0,lt(c.location).catch(yi=>{}));const tt={};for(const yi in fl)tt[yi]=Fo(()=>I.value[yi]);ze.provide(fv,_t),ze.provide(x1,fm(tt)),ze.provide(Ob,I);const bt=ze.unmount;Kt.add(ze),ze.unmount=function(){Kt.delete(ze),Kt.size<1&&(C=fl,$i&&$i(),$i=null,I.value=fl,vn=!1,si=!1),bt()}}}}function vh(t){return t.reduce((e,i)=>e.then(()=>i()),Promise.resolve())}function fq(t,e){const i=[],r=[],c=[],f=Math.max(e.matched.length,t.matched.length);for(let y=0;y<f;y++){const l=e.matched[y];l&&(t.matched.find(C=>Yh(C,l))?r.push(l):i.push(l));const I=t.matched[y];I&&(e.matched.find(C=>Yh(C,I))||c.push(I))}return[i,r,c]}function pq(){return Vo(fv)}function n7(){return Vo(x1)}var mq=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},JD={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(mq,function(){var i,r,c;function f(l,I){if(!i)i=I;else if(!r)r=I;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",L={};i(L),c=I(L),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}f(["exports"],function(l){var I="2.8.2",C=L;function L(o,n,a,u){this.cx=3*o,this.bx=3*(a-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=u,this.p2x=a,this.p2y=u}L.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},L.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},L.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},L.prototype.solveCurveX=function(o,n){var a,u,d,m,g;for(n===void 0&&(n=1e-6),d=o,g=0;g<8;g++){if(m=this.sampleCurveX(d)-o,Math.abs(m)<n)return d;var v=this.sampleCurveDerivativeX(d);if(Math.abs(v)<1e-6)break;d-=m/v}if((d=o)<(a=0))return a;if(d>(u=1))return u;for(;a<u;){if(m=this.sampleCurveX(d),Math.abs(m-o)<n)return d;o>m?a=d:u=d,d=.5*(u-a)+a}return d},L.prototype.solve=function(o,n){return this.sampleCurveY(this.solveCurveX(o,n))};var R=$;function $(o,n){this.x=o,this.y=n}$.prototype={clone:function(){return new $(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,n){return this.clone()._rotateAround(o,n)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var n=o.x-this.x,a=o.y-this.y;return n*n+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,n){return Math.atan2(this.x*n-this.y*o,this.x*o+this.y*n)},_matMult:function(o){var n=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=n,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var n=Math.cos(o),a=Math.sin(o),u=a*this.x+n*this.y;return this.x=n*this.x-a*this.y,this.y=u,this},_rotateAround:function(o,n){var a=Math.cos(o),u=Math.sin(o),d=n.y+u*(this.x-n.x)+a*(this.y-n.y);return this.x=n.x+a*(this.x-n.x)-u*(this.y-n.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},$.convert=function(o){return o instanceof $?o:Array.isArray(o)?new $(o[0],o[1]):o};var J=typeof self!="undefined"?self:{};const pe=Math.PI/180,Re=180/Math.PI;function we(o){return o*pe}function Be(o){return o*Re}const nt=[[0,0],[1,0],[1,1],[0,1]];function yt(o){if(o<=0)return 0;if(o>=1)return 1;const n=o*o,a=n*o;return 4*(o<.5?a:3*(o-n)+a-.75)}function lt(o,n,a,u){const d=new C(o,n,a,u);return function(m){return d.solve(m)}}const zt=lt(.25,.1,.25,1);function rt(o,n,a){return Math.min(a,Math.max(n,o))}function Wt(o,n,a){return(a=rt((a-o)/(n-o),0,1))*a*(3-2*a)}function hi(o,n,a){const u=a-n,d=((o-n)%u+u)%u+n;return d===n?a:d}function _i(o,n,a){if(!o.length)return a(null,[]);let u=o.length;const d=new Array(o.length);let m=null;o.forEach((g,v)=>{n(g,(w,T)=>{w&&(m=w),d[v]=T,--u==0&&a(m,d)})})}function Ci(o){const n=[];for(const a in o)n.push(o[a]);return n}function Ht(o,...n){for(const a of n)for(const u in a)o[u]=a[u];return o}let $i=1;function Xi(){return $i++}function Nn(){return function o(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Fn(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function si(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Zt(o,n){o.forEach(a=>{n[a]&&(n[a]=n[a].bind(n))})}function Qt(o,n){return o.indexOf(n,o.length-n.length)!==-1}function Ui(o,n,a){const u={};for(const d in o)u[d]=n.call(a||this,o[d],d,o);return u}function Bn(o,n,a){const u={};for(const d in o)n.call(a||this,o[d],d,o)&&(u[d]=o[d]);return u}function Ji(o){return Array.isArray(o)?o.map(Ji):typeof o=="object"&&o?Ui(o,Ji):o}const vn={};function Kt(o){vn[o]||(typeof console!="undefined"&&console.warn(o),vn[o]=!0)}function Yi(o,n,a){return(a.y-o.y)*(n.x-o.x)>(n.y-o.y)*(a.x-o.x)}function ze(o){let n=0;for(let a,u,d=0,m=o.length,g=m-1;d<m;g=d++)a=o[d],u=o[g],n+=(u.x-a.x)*(a.y+u.y);return n}function _t(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function tt(o){const n={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,d,m)=>{const g=d||m;return n[u]=!g||g.toLowerCase(),""}),n["max-age"]){const a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n}let bt,yi,xi,Ut,ct=null;function se(o){if(ct==null){const n=o.navigator?o.navigator.userAgent:null;ct=!!o.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return ct}function me(o){try{const n=J[o];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}const Ie={now:()=>xi!==void 0?xi:J.performance.now(),setNow(o){xi=o},restoreNow(){xi=void 0},frame(o){const n=J.requestAnimationFrame(o);return{cancel:()=>J.cancelAnimationFrame(n)}},getImageData(o,n=0){const{width:a,height:u}=o;Ut||(Ut=J.document.createElement("canvas"));const d=Ut.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return(a>Ut.width||u>Ut.height)&&(Ut.width=a,Ut.height=u),d.clearRect(-n,-n,a+2*n,u+2*n),d.drawImage(o,0,0,a,u),d.getImageData(-n,-n,a+2*n,u+2*n)},resolveURL:o=>(bt||(bt=J.document.createElement("a")),bt.href=o,bt.href),get devicePixelRatio(){return J.devicePixelRatio},get prefersReducedMotion(){return!!J.matchMedia&&(yi==null&&(yi=J.matchMedia("(prefers-reduced-motion: reduce)")),yi.matches)}};let Ue;const De={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Ue==null){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ue={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):o}catch{Ue=o}}return Ue},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ye={supported:!1,testSupport:function(o){!Je&&je&&(qe?Pt(o):ut=o)}};let ut,je,Je=!1,qe=!1;function Pt(o){const n=o.createTexture();o.bindTexture(o.TEXTURE_2D,n);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,je),o.isContextLost())return;Ye.supported=!0}catch{}o.deleteTexture(n),Je=!0}J.document&&(je=J.document.createElement("img"),je.onload=function(){ut&&Pt(ut),ut=null,qe=!0},je.onerror=function(){Je=!0,ut=null},je.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const wt="01",Ct="NO_ACCESS_TOKEN";function Rt(o){return o.indexOf("mapbox:")===0}function Yt(o){return De.API_URL_REGEX.test(o)}const di=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function fi(o){const n=o.match(di);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Mi(o){const n=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${n}`}function Un(o){if(!o)return null;const n=o.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(J.atob(n[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class pr{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const a=Un(De.ACCESS_TOKEN);let u="";return u=a&&a.u?J.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(d,m)=>String.fromCharCode(Number("0x"+m)))):De.ACCESS_TOKEN||"",n?`mapbox.eventData.${n}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const n=me("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{const d=J.localStorage.getItem(a);d&&(this.eventData=JSON.parse(d));const m=J.localStorage.getItem(u);m&&(this.anonId=m)}catch{Kt("Unable to read from LocalStorage")}}saveEventData(){const n=me("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{J.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&J.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{Kt("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,a,u,d){if(!De.EVENTS_URL)return;const m=fi(De.EVENTS_URL);m.params.push(`access_token=${d||De.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:wt,userId:this.anonId},v=a?Ht(g,a):g,w={url:Mi(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=le(w,T=>{this.pendingRequest=null,u(T),this.saveEventData(),this.processRequests(d)})}queueRequest(n,a){this.queue.push(n),this.processRequests(a)}}const $s=new class extends pr{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,n){De.EVENTS_URL&&De.ACCESS_TOKEN&&Array.isArray(o)&&o.some(a=>Rt(a)||Yt(a))&&this.queueRequest(Date.now(),n)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Un(De.ACCESS_TOKEN),a=n?n.u:De.ACCESS_TOKEN;let u=a!==this.eventData.tokenU;si(this.anonId)||(this.anonId=Nn(),u=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),g=new Date(d),v=(d-this.eventData.lastSuccess)/864e5;u=u||v>=1||v<-1||m.getDate()!==g.getDate()}else u=!0;u?this.postEvent(d,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=d,this.eventData.tokenU=a)},o):this.processRequests()}},js=$s.postTurnstileEvent.bind($s),Zo=new class extends pr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,n,a,u){this.skuToken=n,this.errorCb=u,De.EVENTS_URL&&(a||De.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Ct)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),si(this.anonId)||(this.anonId=Nn()),this.postEvent(a,{skuToken:this.skuToken},u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},o))}},kn=Zo.postMapLoadEvent.bind(Zo),Vn=new class extends pr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,n,a,u){if(!De.API_URL||!De.SESSION_PATH)return;const d=fi(De.API_URL+De.SESSION_PATH);d.params.push(`sku=${n||""}`),d.params.push(`access_token=${u||De.ACCESS_TOKEN||""}`);const m={url:Mi(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ge(m,g=>{this.pendingRequest=null,a(g),this.saveEventData(),this.processRequests(u)})}getSessionAPI(o,n,a,u){this.skuToken=n,this.errorCb=u,De.SESSION_PATH&&De.API_URL&&(a||De.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Ct)))}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:a}=this.queue.shift();n&&this.success[n]||this.getSession(a,this.skuToken,u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},o)}},Xo=Vn.getSessionAPI.bind(Vn),Yo=new Set,vu="mapbox-tiles";let us,fo,Jo=500,Qo=50;function Ra(){J.caches&&!us&&(us=J.caches.open(vu))}function Nl(o){const n=o.indexOf("?");return n<0?o:o.slice(0,n)}let La=1/0;const Y={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Y);class N extends Error{constructor(n,a,u){a===401&&Yt(u)&&(n+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(n),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const U=_t()?()=>self.worker&&self.worker.referrer:()=>(J.location.protocol==="blob:"?J.parent:J).location.href,K=function(o,n){if(!(/^file:/.test(a=o.url)||/^file:/.test(U())&&!/^\w+:/.test(a))){if(J.fetch&&J.Request&&J.AbortController&&J.Request.prototype.hasOwnProperty("signal"))return function(u,d){const m=new J.AbortController,g=new J.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:U(),signal:m.signal});let v=!1,w=!1;const T=(A=g.url).indexOf("sku=")>0&&Yt(A);var A;u.type==="json"&&g.headers.set("Accept","application/json");const M=(z,B,j)=>{if(w)return;if(z&&z.message!=="SecurityError"&&Kt(z),B&&j)return D(B);const W=Date.now();J.fetch(g).then(X=>{if(X.ok){const oe=T?X.clone():null;return D(X,oe,W)}return d(new N(X.statusText,X.status,u.url))}).catch(X=>{X.code!==20&&d(new Error(X.message))})},D=(z,B,j)=>{(u.type==="arrayBuffer"?z.arrayBuffer():u.type==="json"?z.json():z.text()).then(W=>{w||(B&&j&&function(X,oe,ce){if(Ra(),!us)return;const he={status:oe.status,statusText:oe.statusText,headers:new J.Headers};oe.headers.forEach((Se,Ce)=>he.headers.set(Ce,Se));const de=tt(oe.headers.get("Cache-Control")||"");if(de["no-store"])return;de["max-age"]&&he.headers.set("Expires",new Date(ce+1e3*de["max-age"]).toUTCString());const fe=he.headers.get("Expires");fe&&(new Date(fe).getTime()-ce<42e4||function(Se,Ce){if(fo===void 0)try{new Response(new ReadableStream),fo=!0}catch{fo=!1}fo?Ce(Se.body):Se.blob().then(Ce)}(oe,Se=>{const Ce=new J.Response(Se,he);Ra(),us&&us.then(Le=>Le.put(Nl(X.url),Ce)).catch(Le=>Kt(Le.message))}))}(g,B,j),v=!0,d(null,W,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(W=>{w||d(new Error(W.message))})};return T?function(z,B){if(Ra(),!us)return B(null);const j=Nl(z.url);us.then(W=>{W.match(j).then(X=>{const oe=function(ce){if(!ce)return!1;const he=new Date(ce.headers.get("Expires")||0),de=tt(ce.headers.get("Cache-Control")||"");return he>Date.now()&&!de["no-cache"]}(X);W.delete(j),oe&&W.put(j,X.clone()),B(null,X,oe)}).catch(B)}).catch(B)}(g,M):M(null,null),{cancel:()=>{w=!0,v||m.abort()}}}(o,n);if(_t()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,n,void 0,!0)}var a;return function(u,d){const m=new J.XMLHttpRequest;m.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const g in u.headers)m.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=u.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(u.type==="json")try{g=JSON.parse(m.response)}catch(v){return d(v)}d(null,g,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else d(new N(m.statusText,m.status,u.url))},m.send(u.body),{cancel:()=>m.abort()}}(o,n)},ne=function(o,n){return K(Ht(o,{type:"arrayBuffer"}),n)},le=function(o,n){return K(Ht(o,{method:"POST"}),n)},ge=function(o,n){return K(Ht(o,{method:"GET"}),n)};function _e(o){const n=J.document.createElement("a");return n.href=o,n.protocol===J.document.location.protocol&&n.host===J.document.location.host}const ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let xe,Oe;xe=[],Oe=0;const it=function(o,n){if(Ye.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Oe>=De.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:o,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return xe.push(m),m}Oe++;let a=!1;const u=()=>{if(!a)for(a=!0,Oe--;xe.length&&Oe<De.MAX_PARALLEL_IMAGE_REQUESTS;){const m=xe.shift(),{requestParameters:g,callback:v,cancelled:w}=m;w||(m.cancel=it(g,v).cancel)}},d=ne(o,(m,g,v,w)=>{u(),m?n(m):g&&(J.createImageBitmap?function(T,A){const M=new J.Blob([new Uint8Array(T)],{type:"image/png"});J.createImageBitmap(M).then(D=>{A(null,D)}).catch(D=>{A(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(T,A)=>n(T,A,v,w)):function(T,A){const M=new J.Image,D=J.URL;M.onload=()=>{A(null,M),D.revokeObjectURL(M.src),M.onload=null,J.requestAnimationFrame(()=>{M.src=ue})},M.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new J.Blob([new Uint8Array(T)],{type:"image/png"});M.src=T.byteLength?D.createObjectURL(z):ue}(g,(T,A)=>n(T,A,v,w)))});return{cancel:()=>{d.cancel(),u()}}};function Fe(o,n,a){a[o]&&a[o].indexOf(n)!==-1||(a[o]=a[o]||[],a[o].push(n))}function kt(o,n,a){if(a&&a[o]){const u=a[o].indexOf(n);u!==-1&&a[o].splice(u,1)}}class Tt{constructor(n,a={}){Ht(this,a),this.type=n}}class It extends Tt{constructor(n,a={}){super("error",Ht({error:n},a))}}class Lt{on(n,a){return this._listeners=this._listeners||{},Fe(n,a,this._listeners),this}off(n,a){return kt(n,a,this._listeners),kt(n,a,this._oneTimeListeners),this}once(n,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Fe(n,a,this._oneTimeListeners),this):new Promise(u=>this.once(n,u))}fire(n,a){typeof n=="string"&&(n=new Tt(n,a||{}));const u=n.type;if(this.listens(u)){n.target=this;const d=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const v of d)v.call(this,n);const m=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const v of m)kt(u,v,this._oneTimeListeners),v.call(this,n);const g=this._eventedParent;g&&(Ht(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(n))}else n instanceof It&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,a){return this._eventedParent=n,this._eventedParentData=a,this}}var be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ei(o,...n){for(const a of n)for(const u in a)o[u]=a[u];return o}function gt(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function bi(o){if(Array.isArray(o))return o.map(bi);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const n={};for(const a in o)n[a]=bi(o[a]);return n}return gt(o)}class Ti extends Error{constructor(n,a){super(a),this.message=a,this.key=n}}class ea{constructor(n,a=[]){this.parent=n,this.bindings={};for(const[u,d]of a)this.bindings[u]=d}concat(n){return new ea(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Gs={kind:"null"},Qe={kind:"number"},li={kind:"string"},ei={kind:"boolean"},Cs={kind:"color"},ta={kind:"object"},ri={kind:"value"},ia={kind:"collator"},Oa={kind:"formatted"},ir={kind:"resolvedImage"};function qr(o,n){return{kind:"array",itemType:o,N:n}}function tn(o){if(o.kind==="array"){const n=tn(o.itemType);return typeof o.N=="number"?`array<${n}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${n}>`}return o.kind}const Hv=[Gs,Qe,li,ei,Cs,Oa,ta,qr(ri),ir];function Fl(o,n){if(n.kind==="error")return null;if(o.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Fl(o.itemType,n.itemType))&&(typeof o.N!="number"||o.N===n.N))return null}else{if(o.kind===n.kind)return null;if(o.kind==="value"){for(const a of Hv)if(!Fl(a,n))return null}}return`Expected ${tn(o)} but found ${tn(n)} instead.`}function xu(o,n){return n.some(a=>a.kind===o.kind)}function za(o,n){return n.some(a=>a==="null"?o===null:a==="array"?Array.isArray(o):a==="object"?o&&!Array.isArray(o)&&typeof o=="object":a===typeof o)}function bu(o){var n={exports:{}};return o(n,n.exports),n.exports}var Ld=bu(function(o,n){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function u(v){return(v=Math.round(v))<0?0:v>255?255:v}function d(v){return u(v[v.length-1]==="%"?parseFloat(v)/100*255:parseInt(v))}function m(v){return(w=v[v.length-1]==="%"?parseFloat(v)/100:parseFloat(v))<0?0:w>1?1:w;var w}function g(v,w,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?v+(w-v)*T*6:2*T<1?w:3*T<2?v+(w-v)*(2/3-T)*6:v}try{n.parseCSSColor=function(v){var w,T=v.replace(/ /g,"").toLowerCase();if(T in a)return a[T].slice();if(T[0]==="#")return T.length===4?(w=parseInt(T.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:T.length===7&&(w=parseInt(T.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var A=T.indexOf("("),M=T.indexOf(")");if(A!==-1&&M+1===T.length){var D=T.substr(0,A),z=T.substr(A+1,M-(A+1)).split(","),B=1;switch(D){case"rgba":if(z.length!==4)return null;B=m(z.pop());case"rgb":return z.length!==3?null:[d(z[0]),d(z[1]),d(z[2]),B];case"hsla":if(z.length!==4)return null;B=m(z.pop());case"hsl":if(z.length!==3)return null;var j=(parseFloat(z[0])%360+360)%360/360,W=m(z[1]),X=m(z[2]),oe=X<=.5?X*(W+1):X+W-X*W,ce=2*X-oe;return[u(255*g(ce,oe,j+1/3)),u(255*g(ce,oe,j)),u(255*g(ce,oe,j-1/3)),B];default:return null}}return null}}catch{}});class wi{constructor(n,a,u,d=1){this.r=n,this.g=a,this.b=u,this.a=d}static parse(n){if(!n)return;if(n instanceof wi)return n;if(typeof n!="string")return;const a=Ld.parseCSSColor(n);return a?new wi(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[n,a,u,d]=this.toArray();return`rgba(${Math.round(n)},${Math.round(a)},${Math.round(u)},${d})`}toArray(){const{r:n,g:a,b:u,a:d}=this;return d===0?[0,0,0,0]:[255*n/d,255*a/d,255*u/d,d]}}wi.black=new wi(0,0,0,1),wi.white=new wi(1,1,1,1),wi.transparent=new wi(0,0,0,0),wi.red=new wi(1,0,0,1),wi.blue=new wi(0,0,1,1);class Na{constructor(n,a,u){this.sensitivity=n?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,a){return this.collator.compare(n,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Od{constructor(n,a,u,d,m){this.text=n.normalize?n.normalize():n,this.image=a,this.scale=u,this.fontStack=d,this.textColor=m}}class Tn{constructor(n){this.sections=n}static fromString(n){return new Tn([new Od(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Tn?n:Tn.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const a of this.sections){if(a.image){n.push(["image",a.image.name]);continue}n.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toArray())),n.push(u)}return n}}class Cr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Cr({name:n,available:!1}):null}serialize(){return["image",this.name]}}function hs(o,n,a,u){return typeof o=="number"&&o>=0&&o<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[o,n,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[o,n,a,u]:[o,n,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function wu(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof wi||o instanceof Na||o instanceof Tn||o instanceof Cr)return!0;if(Array.isArray(o)){for(const n of o)if(!wu(n))return!1;return!0}if(typeof o=="object"){for(const n in o)if(!wu(o[n]))return!1;return!0}return!1}function xn(o){if(o===null)return Gs;if(typeof o=="string")return li;if(typeof o=="boolean")return ei;if(typeof o=="number")return Qe;if(o instanceof wi)return Cs;if(o instanceof Na)return ia;if(o instanceof Tn)return Oa;if(o instanceof Cr)return ir;if(Array.isArray(o)){const n=o.length;let a;for(const u of o){const d=xn(u);if(a){if(a===d)continue;a=ri;break}a=d}return qr(a||ri,n)}return ta}function qs(o){const n=typeof o;return o===null?"":n==="string"||n==="number"||n==="boolean"?String(o):o instanceof wi||o instanceof Tn||o instanceof Cr?o.toString():JSON.stringify(o)}class Ws{constructor(n,a){this.type=n,this.value=a}static parse(n,a){if(n.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!wu(n[1]))return a.error("invalid value");const u=n[1];let d=xn(u);const m=a.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new Ws(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof wi?["rgba"].concat(this.value.toArray()):this.value instanceof Tn?this.value.serialize():this.value}}class $n{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const zd={string:li,number:Qe,boolean:ei,object:ta};class ds{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let u,d=1;const m=n[0];if(m==="array"){let v,w;if(n.length>2){const T=n[1];if(typeof T!="string"||!(T in zd)||T==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);v=zd[T],d++}else v=ri;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return a.error('The length argument to "array" must be a positive integer literal',2);w=n[2],d++}u=qr(v,w)}else u=zd[m];const g=[];for(;d<n.length;d++){const v=a.parse(n[d],d,ri);if(!v)return null;g.push(v)}return new ds(u,g)}evaluate(n){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(n);if(!Fl(this.type,xn(u)))return u;if(a===this.args.length-1)throw new $n(`Expected value to be of type ${tn(this.type)}, but found ${tn(xn(u))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,a=[n.kind];if(n.kind==="array"){const u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);const d=n.N;(typeof d=="number"||this.args.length>1)&&a.push(d)}}return a.concat(this.args.map(u=>u.serialize()))}}class Fa{constructor(n){this.type=Oa,this.sections=n}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const u=n[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");const d=[];let m=!1;for(let g=1;g<=n.length-1;++g){const v=n[g];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let w=null;if(v["font-scale"]&&(w=a.parse(v["font-scale"],1,Qe),!w))return null;let T=null;if(v["text-font"]&&(T=a.parse(v["text-font"],1,qr(li)),!T))return null;let A=null;if(v["text-color"]&&(A=a.parse(v["text-color"],1,Cs),!A))return null;const M=d[d.length-1];M.scale=w,M.font=T,M.textColor=A}else{const w=a.parse(n[g],1,ri);if(!w)return null;const T=w.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:w,scale:null,font:null,textColor:null})}}return new Fa(d)}evaluate(n){return new Tn(this.sections.map(a=>{const u=a.content.evaluate(n);return xn(u)===ir?new Od("",u,null,null,null):new Od(qs(u),null,a.scale?a.scale.evaluate(n):null,a.font?a.font.evaluate(n).join(","):null,a.textColor?a.textColor.evaluate(n):null)}))}eachChild(n){for(const a of this.sections)n(a.content),a.scale&&n(a.scale),a.font&&n(a.font),a.textColor&&n(a.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const a of this.sections){n.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),n.push(u)}return n}}class Ba{constructor(n){this.type=ir,this.input=n}static parse(n,a){if(n.length!==2)return a.error("Expected two arguments.");const u=a.parse(n[1],1,li);return u?new Ba(u):a.error("No image name provided.")}evaluate(n){const a=this.input.evaluate(n),u=Cr.fromString(a);return u&&n.availableImages&&(u.available=n.availableImages.indexOf(a)>-1),u}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Kv={"to-boolean":ei,"to-color":Cs,"to-number":Qe,"to-string":li};class fs{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const u=n[0];if((u==="to-boolean"||u==="to-string")&&n.length!==2)return a.error("Expected one argument.");const d=Kv[u],m=[];for(let g=1;g<n.length;g++){const v=a.parse(n[g],g,ri);if(!v)return null;m.push(v)}return new fs(d,m)}evaluate(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){let a,u;for(const d of this.args){if(a=d.evaluate(n),u=null,a instanceof wi)return a;if(typeof a=="string"){const m=n.parseColor(a);if(m)return m}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:hs(a[0],a[1],a[2],a[3]),!u))return new wi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new $n(u||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const u of this.args){if(a=u.evaluate(n),a===null)return 0;const d=Number(a);if(!isNaN(d))return d}throw new $n(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Tn.fromString(qs(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?Cr.fromString(qs(this.args[0].evaluate(n))):qs(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Fa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ba(this.args[0]).serialize();const n=[`to-${this.type.kind}`];return this.eachChild(a=>{n.push(a.serialize())}),n}}const Zv=["Unknown","Point","LineString","Polygon"];class Vm{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Zv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-n[0])+this.featureDistanceData.bearing[1]*(d*a-n[1])}return 0}parseColor(n){let a=this._parseColorCache[n];return a||(a=this._parseColorCache[n]=wi.parse(n)),a}}class Mr{constructor(n,a,u,d){this.name=n,this.type=a,this._evaluate=u,this.args=d}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,a){const u=n[0],d=Mr.definitions[u];if(!d)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,g=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,v=g.filter(([T])=>!Array.isArray(T)||T.length===n.length-1);let w=null;for(const[T,A]of v){w=new mo(a.registry,a.path,null,a.scope);const M=[];let D=!1;for(let z=1;z<n.length;z++){const B=n[z],j=Array.isArray(T)?T[z-1]:T.type,W=w.parse(B,1+M.length,j);if(!W){D=!0;break}M.push(W)}if(!D)if(Array.isArray(T)&&T.length!==M.length)w.error(`Expected ${T.length} arguments, but found ${M.length} instead.`);else{for(let z=0;z<M.length;z++){const B=Array.isArray(T)?T[z]:T.type,j=M[z];w.concat(z+1).checkSubtype(B,j.type)}if(w.errors.length===0)return new Mr(u,m,A,M)}}if(v.length===1)a.errors.push(...w.errors);else{const T=(v.length?v:g).map(([M])=>{return D=M,Array.isArray(D)?`(${D.map(tn).join(", ")})`:`(${tn(D.type)}...)`;var D}).join(" | "),A=[];for(let M=1;M<n.length;M++){const D=a.parse(n[M],1+A.length);if(!D)return null;A.push(tn(D.type))}a.error(`Expected arguments of type ${T}, but found (${A.join(", ")}) instead.`)}return null}static register(n,a){Mr.definitions=a;for(const u in a)n[u]=Mr}}class Eu{constructor(n,a,u){this.type=ia,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=a}static parse(n,a){if(n.length!==2)return a.error("Expected one argument.");const u=n[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");const d=a.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,ei);if(!d)return null;const m=a.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,ei);if(!m)return null;let g=null;return u.locale&&(g=a.parse(u.locale,1,li),!g)?null:new Eu(d,m,g)}evaluate(n){return new Na(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}const po=8192;function Nd(o,n){o[0]=Math.min(o[0],n[0]),o[1]=Math.min(o[1],n[1]),o[2]=Math.max(o[2],n[0]),o[3]=Math.max(o[3],n[1])}function Tu(o,n){return!(o[0]<=n[0]||o[2]>=n[2]||o[1]<=n[1]||o[3]>=n[3])}function $m(o,n){const a=(180+o[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,d=Math.pow(2,n.z);return[Math.round(a*d*po),Math.round(u*d*po)]}function Iu(o,n,a){const u=o[0]-n[0],d=o[1]-n[1],m=o[0]-a[0],g=o[1]-a[1];return u*g-m*d==0&&u*m<=0&&d*g<=0}function Fd(o,n){let a=!1;for(let g=0,v=n.length;g<v;g++){const w=n[g];for(let T=0,A=w.length;T<A-1;T++){if(Iu(o,w[T],w[T+1]))return!1;(d=w[T])[1]>(u=o)[1]!=(m=w[T+1])[1]>u[1]&&u[0]<(m[0]-d[0])*(u[1]-d[1])/(m[1]-d[1])+d[0]&&(a=!a)}}var u,d,m;return a}function Xv(o,n){for(let a=0;a<n.length;a++)if(Fd(o,n[a]))return!0;return!1}function jm(o,n,a,u){const d=u[0]-a[0],m=u[1]-a[1],g=(o[0]-a[0])*m-d*(o[1]-a[1]),v=(n[0]-a[0])*m-d*(n[1]-a[1]);return g>0&&v<0||g<0&&v>0}function Yv(o,n,a){for(const T of a)for(let A=0;A<T.length-1;++A)if((v=[(g=T[A+1])[0]-(m=T[A])[0],g[1]-m[1]])[0]*(w=[(d=n)[0]-(u=o)[0],d[1]-u[1]])[1]-v[1]*w[0]!=0&&jm(u,d,m,g)&&jm(m,g,u,d))return!0;var u,d,m,g,v,w;return!1}function Gm(o,n){for(let a=0;a<o.length;++a)if(!Fd(o[a],n))return!1;for(let a=0;a<o.length-1;++a)if(Yv(o[a],o[a+1],n))return!1;return!0}function Jv(o,n){for(let a=0;a<n.length;a++)if(Gm(o,n[a]))return!0;return!1}function Su(o,n,a){const u=[];for(let d=0;d<o.length;d++){const m=[];for(let g=0;g<o[d].length;g++){const v=$m(o[d][g],a);Nd(n,v),m.push(v)}u.push(m)}return u}function Bl(o,n,a){const u=[];for(let d=0;d<o.length;d++){const m=Su(o[d],n,a);u.push(m)}return u}function qm(o,n,a,u){if(o[0]<a[0]||o[0]>a[2]){const d=.5*u;let m=o[0]-a[0]>d?-u:a[0]-o[0]>d?u:0;m===0&&(m=o[0]-a[2]>d?-u:a[2]-o[0]>d?u:0),o[0]+=m}Nd(n,o)}function Wm(o,n,a,u){const d=Math.pow(2,u.z)*po,m=[u.x*po,u.y*po],g=[];if(!o)return g;for(const v of o)for(const w of v){const T=[w.x+m[0],w.y+m[1]];qm(T,n,a,d),g.push(T)}return g}function Hm(o,n,a,u){const d=Math.pow(2,u.z)*po,m=[u.x*po,u.y*po],g=[];if(!o)return g;for(const w of o){const T=[];for(const A of w){const M=[A.x+m[0],A.y+m[1]];Nd(n,M),T.push(M)}g.push(T)}if(n[2]-n[0]<=d/2){(v=n)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of g)for(const T of w)qm(T,n,a,d)}var v;return g}class na{constructor(n,a){this.type=ei,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(wu(n[1])){const u=n[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const m=u.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new na(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new na(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new na(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,u){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const v=Su(u.coordinates,m,g),w=Wm(a.geometry(),d,m,g);if(!Tu(d,m))return!1;for(const T of w)if(!Fd(T,v))return!1}if(u.type==="MultiPolygon"){const v=Bl(u.coordinates,m,g),w=Wm(a.geometry(),d,m,g);if(!Tu(d,m))return!1;for(const T of w)if(!Xv(T,v))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,u){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const v=Su(u.coordinates,m,g),w=Hm(a.geometry(),d,m,g);if(!Tu(d,m))return!1;for(const T of w)if(!Gm(T,v))return!1}if(u.type==="MultiPolygon"){const v=Bl(u.coordinates,m,g),w=Hm(a.geometry(),d,m,g);if(!Tu(d,m))return!1;for(const T of w)if(!Jv(T,v))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function mr(o){if(o instanceof Mr&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof na)return!1;let n=!0;return o.eachChild(a=>{n&&!mr(a)&&(n=!1)}),n}function Ul(o){if(o instanceof Mr&&o.name==="feature-state")return!1;let n=!0;return o.eachChild(a=>{n&&!Ul(a)&&(n=!1)}),n}function Vl(o,n){if(o instanceof Mr&&n.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild(u=>{a&&!Vl(u,n)&&(a=!1)}),a}class ra{constructor(n,a){this.type=a.type,this.name=n,this.boundExpression=a}static parse(n,a){if(n.length!==2||typeof n[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const u=n[1];return a.scope.has(u)?new ra(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class mo{constructor(n,a=[],u,d=new ea,m=[]){this.registry=n,this.path=a,this.key=a.map(g=>`[${g}]`).join(""),this.scope=d,this.errors=m,this.expectedType=u}parse(n,a,u,d,m={}){return a?this.concat(a,u,d)._parse(n,m):this._parse(n,m)}_parse(n,a){function u(d,m,g){return g==="assert"?new ds(m,[d]):g==="coerce"?new fs(m,[d]):d}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=n[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let g=m.parse(n,this);if(!g)return null;if(this.expectedType){const v=this.expectedType,w=g.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(v,w))return null}else g=u(g,v,a.typeAnnotation||"coerce");else g=u(g,v,a.typeAnnotation||"assert")}if(!(g instanceof Ws)&&g.type.kind!=="resolvedImage"&&Au(g)){const v=new Vm;try{g=new Ws(g.type,g.evaluate(v))}catch(w){return this.error(w.message),null}}return g}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,a,u){const d=typeof n=="number"?this.path.concat(n):this.path,m=u?this.scope.concat(u):this.scope;return new mo(this.registry,d,a||null,m,this.errors)}error(n,...a){const u=`${this.key}${a.map(d=>`[${d}]`).join("")}`;this.errors.push(new Ti(u,n))}checkSubtype(n,a){const u=Fl(n,a);return u&&this.error(u),u}}function Au(o){if(o instanceof ra)return Au(o.boundExpression);if(o instanceof Mr&&o.name==="error"||o instanceof Eu||o instanceof na)return!1;const n=o instanceof fs||o instanceof ds;let a=!0;return o.eachChild(u=>{a=n?a&&Au(u):a&&u instanceof Ws}),!!a&&mr(o)&&Vl(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function $l(o,n){const a=o.length-1;let u,d,m=0,g=a,v=0;for(;m<=g;)if(v=Math.floor((m+g)/2),u=o[v],d=o[v+1],u<=n){if(v===a||n<d)return v;m=v+1}else{if(!(u>n))throw new $n("Input is not a number.");g=v-1}return 0}class jl{constructor(n,a,u){this.type=n,this.input=a,this.labels=[],this.outputs=[];for(const[d,m]of u)this.labels.push(d),this.outputs.push(m)}static parse(n,a){if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(n[1],1,Qe);if(!u)return null;const d=[];let m=null;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);for(let g=1;g<n.length;g+=2){const v=g===1?-1/0:n[g],w=n[g+1],T=g,A=g+1;if(typeof v!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(d.length&&d[d.length-1][0]>=v)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const M=a.parse(w,A,m);if(!M)return null;m=m||M.type,d.push([v,M])}return new jl(m,u,d)}evaluate(n){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(n);const d=this.input.evaluate(n);if(d<=a[0])return u[0].evaluate(n);const m=a.length;return d>=a[m-1]?u[m-1].evaluate(n):u[$l(a,d)].evaluate(n)}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&n.push(this.labels[a]),n.push(this.outputs[a].serialize());return n}}function At(o,n,a){return o*(1-a)+n*a}var Cu=Object.freeze({__proto__:null,number:At,color:function(o,n,a){return new wi(At(o.r,n.r,a),At(o.g,n.g,a),At(o.b,n.b,a),At(o.a,n.a,a))},array:function(o,n,a){return o.map((u,d)=>At(u,n[d],a))}});const Km=.95047,Zm=1.08883,Bd=4/29,Ud=6/29,Vd=3*Ud*Ud,Xm=Math.PI/180,Ym=180/Math.PI;function Mu(o){return o>.008856451679035631?Math.pow(o,1/3):o/Vd+Bd}function _o(o){return o>Ud?o*o*o:Vd*(o-Bd)}function Ua(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function $d(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function ku(o){const n=$d(o.r),a=$d(o.g),u=$d(o.b),d=Mu((.4124564*n+.3575761*a+.1804375*u)/Km),m=Mu((.2126729*n+.7151522*a+.072175*u)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Mu((.0193339*n+.119192*a+.9503041*u)/Zm)),alpha:o.a}}function jd(o){let n=(o.l+16)/116,a=isNaN(o.a)?n:n+o.a/500,u=isNaN(o.b)?n:n-o.b/200;return n=1*_o(n),a=Km*_o(a),u=Zm*_o(u),new wi(Ua(3.2404542*a-1.5371385*n-.4985314*u),Ua(-.969266*a+1.8760108*n+.041556*u),Ua(.0556434*a-.2040259*n+1.0572252*u),o.alpha)}function Qv(o,n,a){const u=n-o;return o+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const Gl={forward:ku,reverse:jd,interpolate:function(o,n,a){return{l:At(o.l,n.l,a),a:At(o.a,n.a,a),b:At(o.b,n.b,a),alpha:At(o.alpha,n.alpha,a)}}},ql={forward:function(o){const{l:n,a,b:u}=ku(o),d=Math.atan2(u,a)*Ym;return{h:d<0?d+360:d,c:Math.sqrt(a*a+u*u),l:n,alpha:o.a}},reverse:function(o){const n=o.h*Xm,a=o.c;return jd({l:o.l,a:Math.cos(n)*a,b:Math.sin(n)*a,alpha:o.alpha})},interpolate:function(o,n,a){return{h:Qv(o.h,n.h,a),c:At(o.c,n.c,a),l:At(o.l,n.l,a),alpha:At(o.alpha,n.alpha,a)}}};var Gd=Object.freeze({__proto__:null,lab:Gl,hcl:ql});class kr{constructor(n,a,u,d,m){this.type=n,this.operator=a,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[g,v]of m)this.labels.push(g),this.outputs.push(v)}static interpolationFactor(n,a,u,d){let m=0;if(n.name==="exponential")m=Du(a,n.base,u,d);else if(n.name==="linear")m=Du(a,1,u,d);else if(n.name==="cubic-bezier"){const g=n.controlPoints;m=new C(g[0],g[1],g[2],g[3]).solve(Du(a,1,u,d))}return m}static parse(n,a){let[u,d,m,...g]=n;if(!Array.isArray(d)||d.length===0)return a.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const T=d[1];if(typeof T!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:T}}else{if(d[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const T=d.slice(1);if(T.length!==4||T.some(A=>typeof A!="number"||A<0||A>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:T}}}if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(m=a.parse(m,2,Qe),!m)return null;const v=[];let w=null;u==="interpolate-hcl"||u==="interpolate-lab"?w=Cs:a.expectedType&&a.expectedType.kind!=="value"&&(w=a.expectedType);for(let T=0;T<g.length;T+=2){const A=g[T],M=g[T+1],D=T+3,z=T+4;if(typeof A!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(v.length&&v[v.length-1][0]>=A)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=a.parse(M,z,w);if(!B)return null;w=w||B.type,v.push([A,B])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new kr(w,u,d,m,v):a.error(`Type ${tn(w)} is not interpolatable.`)}evaluate(n){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(n);const d=this.input.evaluate(n);if(d<=a[0])return u[0].evaluate(n);const m=a.length;if(d>=a[m-1])return u[m-1].evaluate(n);const g=$l(a,d),v=kr.interpolationFactor(this.interpolation,d,a[g],a[g+1]),w=u[g].evaluate(n),T=u[g+1].evaluate(n);return this.operator==="interpolate"?Cu[this.type.kind.toLowerCase()](w,T,v):this.operator==="interpolate-hcl"?ql.reverse(ql.interpolate(ql.forward(w),ql.forward(T),v)):Gl.reverse(Gl.interpolate(Gl.forward(w),Gl.forward(T),v))}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,n,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function Du(o,n,a,u){const d=u-a,m=o-a;return d===0?0:n===1?m/d:(Math.pow(n,m)-1)/(Math.pow(n,d)-1)}class Wl{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expectected at least one argument.");let u=null;const d=a.expectedType;d&&d.kind!=="value"&&(u=d);const m=[];for(const v of n.slice(1)){const w=a.parse(v,1+m.length,u,void 0,{typeAnnotation:"omit"});if(!w)return null;u=u||w.type,m.push(w)}const g=d&&m.some(v=>Fl(d,v.type));return new Wl(g?ri:u,m)}evaluate(n){let a,u=null,d=0;for(const m of this.args){if(d++,u=m.evaluate(n),u&&u instanceof Cr&&!u.available&&(a||(a=u),u=null,d===this.args.length))return a;if(u!==null)break}return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class Hl{constructor(n,a){this.type=a.type,this.bindings=[].concat(n),this.result=a}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const a of this.bindings)n(a[1]);n(this.result)}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const u=[];for(let m=1;m<n.length-1;m+=2){const g=n[m];if(typeof g!="string")return a.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return a.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=a.parse(n[m+1],m+1);if(!v)return null;u.push([g,v])}const d=a.parse(n[n.length-1],n.length-1,a.expectedType,u);return d?new Hl(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[a,u]of this.bindings)n.push(a,u.serialize());return n.push(this.result.serialize()),n}}class qd{constructor(n,a,u){this.type=n,this.index=a,this.input=u}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=a.parse(n[1],1,Qe),d=a.parse(n[2],2,qr(a.expectedType||ri));return u&&d?new qd(d.type.itemType,u,d):null}evaluate(n){const a=this.index.evaluate(n),u=this.input.evaluate(n);if(a<0)throw new $n(`Array index out of bounds: ${a} < 0.`);if(a>=u.length)throw new $n(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a!==Math.floor(a))throw new $n(`Array index must be an integer, but found ${a} instead.`);return u[a]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Pu{constructor(n,a){this.type=ei,this.needle=n,this.haystack=a}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=a.parse(n[1],1,ri),d=a.parse(n[2],2,ri);return u&&d?xu(u.type,[ei,li,Qe,Gs,ri])?new Pu(u,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${tn(u.type)} instead`):null}evaluate(n){const a=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(u==null)return!1;if(!za(a,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${tn(xn(a))} instead.`);if(!za(u,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${tn(xn(u))} instead.`);return u.indexOf(a)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ru{constructor(n,a,u){this.type=Qe,this.needle=n,this.haystack=a,this.fromIndex=u}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=a.parse(n[1],1,ri),d=a.parse(n[2],2,ri);if(!u||!d)return null;if(!xu(u.type,[ei,li,Qe,Gs,ri]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${tn(u.type)} instead`);if(n.length===4){const m=a.parse(n[3],3,Qe);return m?new Ru(u,d,m):null}return new Ru(u,d)}evaluate(n){const a=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!za(a,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${tn(xn(a))} instead.`);if(!za(u,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${tn(xn(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(n);return u.indexOf(a,d)}return u.indexOf(a)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Lu{constructor(n,a,u,d,m,g){this.inputType=n,this.type=a,this.input=u,this.cases=d,this.outputs=m,this.otherwise=g}static parse(n,a){if(n.length<5)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return a.error("Expected an even number of arguments.");let u,d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const m={},g=[];for(let T=2;T<n.length-1;T+=2){let A=n[T];const M=n[T+1];Array.isArray(A)||(A=[A]);const D=a.concat(T);if(A.length===0)return D.error("Expected at least one branch label.");for(const B of A){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(u){if(D.checkSubtype(u,xn(B)))return null}else u=xn(B);if(m[String(B)]!==void 0)return D.error("Branch labels must be unique.");m[String(B)]=g.length}const z=a.parse(M,T,d);if(!z)return null;d=d||z.type,g.push(z)}const v=a.parse(n[1],1,ri);if(!v)return null;const w=a.parse(n[n.length-1],n.length-1,d);return w?v.type.kind!=="value"&&a.concat(1).checkSubtype(u,v.type)?null:new Lu(u,d,v,m,g,w):null}evaluate(n){const a=this.input.evaluate(n);return(xn(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],d={};for(const g of a){const v=d[this.cases[g]];v===void 0?(d[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[v][1].push(g)}const m=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,v]of u)n.push(v.length===1?m(v[0]):v.map(m)),n.push(this.outputs[g].serialize());return n.push(this.otherwise.serialize()),n}}class Ou{constructor(n,a,u){this.type=n,this.branches=a,this.otherwise=u}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);const d=[];for(let g=1;g<n.length-1;g+=2){const v=a.parse(n[g],g,ei);if(!v)return null;const w=a.parse(n[g+1],g+1,u);if(!w)return null;d.push([v,w]),u=u||w.type}const m=a.parse(n[n.length-1],n.length-1,u);return m?new Ou(u,d,m):null}evaluate(n){for(const[a,u]of this.branches)if(a.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[a,u]of this.branches)n(a),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class zu{constructor(n,a,u,d){this.type=n,this.input=a,this.beginIndex=u,this.endIndex=d}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=a.parse(n[1],1,ri),d=a.parse(n[2],2,Qe);if(!u||!d)return null;if(!xu(u.type,[qr(ri),li,ri]))return a.error(`Expected first argument to be of type array or string, but found ${tn(u.type)} instead`);if(n.length===4){const m=a.parse(n[3],3,Qe);return m?new zu(u.type,u,d,m):null}return new zu(u.type,u,d)}evaluate(n){const a=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!za(a,["string","array"]))throw new $n(`Expected first argument to be of type array or string, but found ${tn(xn(a))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(n);return a.slice(u,d)}return a.slice(u)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Jm(o,n){return o==="=="||o==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Qm(o,n,a,u){return u.compare(n,a)===0}function Va(o,n,a){const u=o!=="=="&&o!=="!=";return class QD{constructor(m,g,v){this.type=ei,this.lhs=m,this.rhs=g,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const v=m[0];let w=g.parse(m[1],1,ri);if(!w)return null;if(!Jm(v,w.type))return g.concat(1).error(`"${v}" comparisons are not supported for type '${tn(w.type)}'.`);let T=g.parse(m[2],2,ri);if(!T)return null;if(!Jm(v,T.type))return g.concat(2).error(`"${v}" comparisons are not supported for type '${tn(T.type)}'.`);if(w.type.kind!==T.type.kind&&w.type.kind!=="value"&&T.type.kind!=="value")return g.error(`Cannot compare types '${tn(w.type)}' and '${tn(T.type)}'.`);u&&(w.type.kind==="value"&&T.type.kind!=="value"?w=new ds(T.type,[w]):w.type.kind!=="value"&&T.type.kind==="value"&&(T=new ds(w.type,[T])));let A=null;if(m.length===4){if(w.type.kind!=="string"&&T.type.kind!=="string"&&w.type.kind!=="value"&&T.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(m[3],3,ia),!A)return null}return new QD(w,T,A)}evaluate(m){const g=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(u&&this.hasUntypedArgument){const w=xn(g),T=xn(v);if(w.kind!==T.kind||w.kind!=="string"&&w.kind!=="number")throw new $n(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${w.kind}, ${T.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const w=xn(g),T=xn(v);if(w.kind!=="string"||T.kind!=="string")return n(m,g,v)}return this.collator?a(m,g,v,this.collator.evaluate(m)):n(m,g,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[o];return this.eachChild(g=>{m.push(g.serialize())}),m}}}const ex=Va("==",function(o,n,a){return n===a},Qm),tx=Va("!=",function(o,n,a){return n!==a},function(o,n,a,u){return!Qm(0,n,a,u)}),e_=Va("<",function(o,n,a){return n<a},function(o,n,a,u){return u.compare(n,a)<0}),ix=Va(">",function(o,n,a){return n>a},function(o,n,a,u){return u.compare(n,a)>0}),nx=Va("<=",function(o,n,a){return n<=a},function(o,n,a,u){return u.compare(n,a)<=0}),rx=Va(">=",function(o,n,a){return n>=a},function(o,n,a,u){return u.compare(n,a)>=0});class Wd{constructor(n,a,u,d,m){this.type=li,this.number=n,this.locale=a,this.currency=u,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(n,a){if(n.length!==3)return a.error("Expected two arguments.");const u=a.parse(n[1],1,Qe);if(!u)return null;const d=n[2];if(typeof d!="object"||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=a.parse(d.locale,1,li),!m))return null;let g=null;if(d.currency&&(g=a.parse(d.currency,1,li),!g))return null;let v=null;if(d["min-fraction-digits"]&&(v=a.parse(d["min-fraction-digits"],1,Qe),!v))return null;let w=null;return d["max-fraction-digits"]&&(w=a.parse(d["max-fraction-digits"],1,Qe),!w)?null:new Wd(u,m,g,v,w)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Nu{constructor(n){this.type=Qe,this.input=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=a.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${tn(u.type)} instead.`):new Nu(u):null}evaluate(n){const a=this.input.evaluate(n);if(typeof a=="string"||Array.isArray(a))return a.length;throw new $n(`Expected value to be of type string or array, but found ${tn(xn(a))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(a=>{n.push(a.serialize())}),n}}const sa={"==":ex,"!=":tx,">":ix,"<":e_,">=":rx,"<=":nx,array:ds,at:qd,boolean:ds,case:Ou,coalesce:Wl,collator:Eu,format:Fa,image:Ba,in:Pu,"index-of":Ru,interpolate:kr,"interpolate-hcl":kr,"interpolate-lab":kr,length:Nu,let:Hl,literal:Ws,match:Lu,number:ds,"number-format":Wd,object:ds,slice:zu,step:jl,string:ds,"to-boolean":fs,"to-color":fs,"to-number":fs,"to-string":fs,var:ra,within:na};function Hd(o,[n,a,u,d]){n=n.evaluate(o),a=a.evaluate(o),u=u.evaluate(o);const m=d?d.evaluate(o):1,g=hs(n,a,u,m);if(g)throw new $n(g);return new wi(n/255*m,a/255*m,u/255*m,m)}function t_(o,n){return o in n}function Kd(o,n){const a=n[o];return a===void 0?null:a}function go(o){return{type:o}}function Zd(o){return{result:"success",value:o}}function oa(o){return{result:"error",value:o}}function $a(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function i_(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Xd(o){return!!o.expression&&o.expression.interpolated}function ki(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function aa(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function n_(o){return o}function Yd(o,n){const a=n.type==="color",u=o.stops&&typeof o.stops[0][0]=="object",d=u||!(u||o.property!==void 0),m=o.type||(Xd(n)?"exponential":"interval");if(a&&((o=Ei({},o)).stops&&(o.stops=o.stops.map(T=>[T[0],wi.parse(T[1])])),o.default=wi.parse(o.default?o.default:n.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Gd[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let g,v,w;if(m==="exponential")g=Jd;else if(m==="interval")g=ox;else if(m==="categorical"){g=sx,v=Object.create(null);for(const T of o.stops)v[T[0]]=T[1];w=typeof o.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=r_}if(u){const T={},A=[];for(let z=0;z<o.stops.length;z++){const B=o.stops[z],j=B[0].zoom;T[j]===void 0&&(T[j]={zoom:j,type:o.type,property:o.property,default:o.default,stops:[]},A.push(j)),T[j].stops.push([B[0].value,B[1]])}const M=[];for(const z of A)M.push([T[z].zoom,Yd(T[z],n)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:kr.interpolationFactor.bind(void 0,D),zoomStops:M.map(z=>z[0]),evaluate:({zoom:z},B)=>Jd({stops:M,base:o.base},n,z).evaluate(z,B)}}if(d){const T=m==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:kr.interpolationFactor.bind(void 0,T),zoomStops:o.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(o,n,A,v,w)}}return{kind:"source",evaluate(T,A){const M=A&&A.properties?A.properties[o.property]:void 0;return M===void 0?Kl(o.default,n.default):g(o,n,M,v,w)}}}function Kl(o,n,a){return o!==void 0?o:n!==void 0?n:a!==void 0?a:void 0}function sx(o,n,a,u,d){return Kl(typeof a===d?u[a]:void 0,o.default,n.default)}function ox(o,n,a){if(ki(a)!=="number")return Kl(o.default,n.default);const u=o.stops.length;if(u===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[u-1][0])return o.stops[u-1][1];const d=$l(o.stops.map(m=>m[0]),a);return o.stops[d][1]}function Jd(o,n,a){const u=o.base!==void 0?o.base:1;if(ki(a)!=="number")return Kl(o.default,n.default);const d=o.stops.length;if(d===1||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[d-1][0])return o.stops[d-1][1];const m=$l(o.stops.map(A=>A[0]),a),g=function(A,M,D,z){const B=z-D,j=A-D;return B===0?0:M===1?j/B:(Math.pow(M,j)-1)/(Math.pow(M,B)-1)}(a,u,o.stops[m][0],o.stops[m+1][0]),v=o.stops[m][1],w=o.stops[m+1][1];let T=Cu[n.type]||n_;if(o.colorSpace&&o.colorSpace!=="rgb"){const A=Gd[o.colorSpace];T=(M,D)=>A.reverse(A.interpolate(A.forward(M),A.forward(D),g))}return typeof v.evaluate=="function"?{evaluate(...A){const M=v.evaluate.apply(void 0,A),D=w.evaluate.apply(void 0,A);if(M!==void 0&&D!==void 0)return T(M,D,g)}}:T(v,w,g)}function r_(o,n,a){return n.type==="color"?a=wi.parse(a):n.type==="formatted"?a=Tn.fromString(a.toString()):n.type==="resolvedImage"?a=Cr.fromString(a.toString()):ki(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0),Kl(a,o.default,n.default)}Mr.register(sa,{error:[{kind:"error"},[li],(o,[n])=>{throw new $n(n.evaluate(o))}],typeof:[li,[ri],(o,[n])=>tn(xn(n.evaluate(o)))],"to-rgba":[qr(Qe,4),[Cs],(o,[n])=>n.evaluate(o).toArray()],rgb:[Cs,[Qe,Qe,Qe],Hd],rgba:[Cs,[Qe,Qe,Qe,Qe],Hd],has:{type:ei,overloads:[[[li],(o,[n])=>t_(n.evaluate(o),o.properties())],[[li,ta],(o,[n,a])=>t_(n.evaluate(o),a.evaluate(o))]]},get:{type:ri,overloads:[[[li],(o,[n])=>Kd(n.evaluate(o),o.properties())],[[li,ta],(o,[n,a])=>Kd(n.evaluate(o),a.evaluate(o))]]},"feature-state":[ri,[li],(o,[n])=>Kd(n.evaluate(o),o.featureState||{})],properties:[ta,[],o=>o.properties()],"geometry-type":[li,[],o=>o.geometryType()],id:[ri,[],o=>o.id()],zoom:[Qe,[],o=>o.globals.zoom],pitch:[Qe,[],o=>o.globals.pitch||0],"distance-from-center":[Qe,[],o=>o.distanceFromCenter()],"heatmap-density":[Qe,[],o=>o.globals.heatmapDensity||0],"line-progress":[Qe,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[Qe,[],o=>o.globals.skyRadialProgress||0],accumulated:[ri,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Qe,go(Qe),(o,n)=>{let a=0;for(const u of n)a+=u.evaluate(o);return a}],"*":[Qe,go(Qe),(o,n)=>{let a=1;for(const u of n)a*=u.evaluate(o);return a}],"-":{type:Qe,overloads:[[[Qe,Qe],(o,[n,a])=>n.evaluate(o)-a.evaluate(o)],[[Qe],(o,[n])=>-n.evaluate(o)]]},"/":[Qe,[Qe,Qe],(o,[n,a])=>n.evaluate(o)/a.evaluate(o)],"%":[Qe,[Qe,Qe],(o,[n,a])=>n.evaluate(o)%a.evaluate(o)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(o,[n,a])=>Math.pow(n.evaluate(o),a.evaluate(o))],sqrt:[Qe,[Qe],(o,[n])=>Math.sqrt(n.evaluate(o))],log10:[Qe,[Qe],(o,[n])=>Math.log(n.evaluate(o))/Math.LN10],ln:[Qe,[Qe],(o,[n])=>Math.log(n.evaluate(o))],log2:[Qe,[Qe],(o,[n])=>Math.log(n.evaluate(o))/Math.LN2],sin:[Qe,[Qe],(o,[n])=>Math.sin(n.evaluate(o))],cos:[Qe,[Qe],(o,[n])=>Math.cos(n.evaluate(o))],tan:[Qe,[Qe],(o,[n])=>Math.tan(n.evaluate(o))],asin:[Qe,[Qe],(o,[n])=>Math.asin(n.evaluate(o))],acos:[Qe,[Qe],(o,[n])=>Math.acos(n.evaluate(o))],atan:[Qe,[Qe],(o,[n])=>Math.atan(n.evaluate(o))],min:[Qe,go(Qe),(o,n)=>Math.min(...n.map(a=>a.evaluate(o)))],max:[Qe,go(Qe),(o,n)=>Math.max(...n.map(a=>a.evaluate(o)))],abs:[Qe,[Qe],(o,[n])=>Math.abs(n.evaluate(o))],round:[Qe,[Qe],(o,[n])=>{const a=n.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[Qe,[Qe],(o,[n])=>Math.floor(n.evaluate(o))],ceil:[Qe,[Qe],(o,[n])=>Math.ceil(n.evaluate(o))],"filter-==":[ei,[li,ri],(o,[n,a])=>o.properties()[n.value]===a.value],"filter-id-==":[ei,[ri],(o,[n])=>o.id()===n.value],"filter-type-==":[ei,[li],(o,[n])=>o.geometryType()===n.value],"filter-<":[ei,[li,ri],(o,[n,a])=>{const u=o.properties()[n.value],d=a.value;return typeof u==typeof d&&u<d}],"filter-id-<":[ei,[ri],(o,[n])=>{const a=o.id(),u=n.value;return typeof a==typeof u&&a<u}],"filter->":[ei,[li,ri],(o,[n,a])=>{const u=o.properties()[n.value],d=a.value;return typeof u==typeof d&&u>d}],"filter-id->":[ei,[ri],(o,[n])=>{const a=o.id(),u=n.value;return typeof a==typeof u&&a>u}],"filter-<=":[ei,[li,ri],(o,[n,a])=>{const u=o.properties()[n.value],d=a.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[ei,[ri],(o,[n])=>{const a=o.id(),u=n.value;return typeof a==typeof u&&a<=u}],"filter->=":[ei,[li,ri],(o,[n,a])=>{const u=o.properties()[n.value],d=a.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[ei,[ri],(o,[n])=>{const a=o.id(),u=n.value;return typeof a==typeof u&&a>=u}],"filter-has":[ei,[ri],(o,[n])=>n.value in o.properties()],"filter-has-id":[ei,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[ei,[qr(li)],(o,[n])=>n.value.indexOf(o.geometryType())>=0],"filter-id-in":[ei,[qr(ri)],(o,[n])=>n.value.indexOf(o.id())>=0],"filter-in-small":[ei,[li,qr(ri)],(o,[n,a])=>a.value.indexOf(o.properties()[n.value])>=0],"filter-in-large":[ei,[li,qr(ri)],(o,[n,a])=>function(u,d,m,g){for(;m<=g;){const v=m+g>>1;if(d[v]===u)return!0;d[v]>u?g=v-1:m=v+1}return!1}(o.properties()[n.value],a.value,0,a.value.length-1)],all:{type:ei,overloads:[[[ei,ei],(o,[n,a])=>n.evaluate(o)&&a.evaluate(o)],[go(ei),(o,n)=>{for(const a of n)if(!a.evaluate(o))return!1;return!0}]]},any:{type:ei,overloads:[[[ei,ei],(o,[n,a])=>n.evaluate(o)||a.evaluate(o)],[go(ei),(o,n)=>{for(const a of n)if(a.evaluate(o))return!0;return!1}]]},"!":[ei,[ei],(o,[n])=>!n.evaluate(o)],"is-supported-script":[ei,[li],(o,[n])=>{const a=o.globals&&o.globals.isSupportedScript;return!a||a(n.evaluate(o))}],upcase:[li,[li],(o,[n])=>n.evaluate(o).toUpperCase()],downcase:[li,[li],(o,[n])=>n.evaluate(o).toLowerCase()],concat:[li,go(ri),(o,n)=>n.map(a=>qs(a.evaluate(o))).join("")],"resolved-locale":[li,[ia],(o,[n])=>n.evaluate(o).resolvedLocale()]});class Fu{constructor(n,a){this.expression=n,this._warningHistory={},this._evaluator=new Vm,this._defaultValue=a?function(u){return u.type==="color"&&aa(u.default)?new wi(0,0,0,0):u.type==="color"?wi.parse(u.default)||null:u.default===void 0?null:u.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(n,a,u,d,m,g,v,w){return this._evaluator.globals=n,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(n,a,u,d,m,g,v,w){this._evaluator.globals=n,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new $n(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console!="undefined"&&console.warn(T.message)),this._defaultValue}}}function ja(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in sa}function Zl(o,n){const a=new mo(sa,[],n?function(d){const m={color:Cs,string:li,number:Qe,enum:li,boolean:ei,formatted:Oa,resolvedImage:ir};return d.type==="array"?qr(m[d.value]||ri,d.length):m[d.type]}(n):void 0),u=a.parse(o,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Zd(new Fu(u,n)):oa(a.errors)}class Qd{constructor(n,a){this.kind=n,this._styleExpression=a,this.isStateDependent=n!=="constant"&&!Ul(a.expression)}evaluateWithoutErrorHandling(n,a,u,d,m,g){return this._styleExpression.evaluateWithoutErrorHandling(n,a,u,d,m,g)}evaluate(n,a,u,d,m,g){return this._styleExpression.evaluate(n,a,u,d,m,g)}}class ef{constructor(n,a,u,d){this.kind=n,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=n!=="camera"&&!Ul(a.expression),this.interpolationType=d}evaluateWithoutErrorHandling(n,a,u,d,m,g){return this._styleExpression.evaluateWithoutErrorHandling(n,a,u,d,m,g)}evaluate(n,a,u,d,m,g){return this._styleExpression.evaluate(n,a,u,d,m,g)}interpolationFactor(n,a,u){return this.interpolationType?kr.interpolationFactor(this.interpolationType,n,a,u):0}}function s_(o,n){if((o=Zl(o,n)).result==="error")return o;const a=o.value.expression,u=mr(a);if(!u&&!$a(n))return oa([new Ti("","data expressions not supported")]);const d=Vl(a,["zoom","pitch","distance-from-center"]);if(!d&&!i_(n))return oa([new Ti("","zoom expressions not supported")]);const m=Uu(a);return m||d?m instanceof Ti?oa([m]):m instanceof kr&&!Xd(n)?oa([new Ti("",'"interpolate" expressions cannot be used with this property')]):Zd(m?new ef(u?"camera":"composite",o.value,m.labels,m instanceof kr?m.interpolation:void 0):new Qd(u?"constant":"source",o.value)):oa([new Ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Bu{constructor(n,a){this._parameters=n,this._specification=a,Ei(this,Yd(this._parameters,this._specification))}static deserialize(n){return new Bu(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Uu(o){let n=null;if(o instanceof Hl)n=Uu(o.result);else if(o instanceof Wl){for(const a of o.args)if(n=Uu(a),n)break}else(o instanceof jl||o instanceof kr)&&o.input instanceof Mr&&o.input.name==="zoom"&&(n=o);return n instanceof Ti||o.eachChild(a=>{const u=Uu(a);u instanceof Ti?n=u:!n&&u?n=new Ti("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&u&&n!==u&&(n=new Ti("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}class st{constructor(n,a,u,d){this.message=(n?`${n}: `:"")+u,d&&(this.identifier=d),a!=null&&a.__line__&&(this.line=a.__line__)}}function Wr(o){const n=o.key,a=o.value,u=o.valueSpec||{},d=o.objectElementValidators||{},m=o.style,g=o.styleSpec;let v=[];const w=ki(a);if(w!=="object")return[new st(n,a,`object expected, ${w} found`)];for(const T in a){const A=T.split(".")[0],M=u[A]||u["*"];let D;d[A]?D=d[A]:u[A]?D=Cn:d["*"]?D=d["*"]:u["*"]&&(D=Cn),D?v=v.concat(D({key:(n&&`${n}.`)+T,value:a[T],valueSpec:M,style:m,styleSpec:g,object:a,objectKey:T},a)):v.push(new st(n,a[T],`unknown property "${T}"`))}for(const T in u)d[T]||u[T].required&&u[T].default===void 0&&a[T]===void 0&&v.push(new st(n,a,`missing required property "${T}"`));return v}function Xl(o){const n=o.value,a=o.valueSpec,u=o.style,d=o.styleSpec,m=o.key,g=o.arrayElementValidator||Cn;if(ki(n)!=="array")return[new st(m,n,`array expected, ${ki(n)} found`)];if(a.length&&n.length!==a.length)return[new st(m,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new st(m,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let v={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};d.$version<7&&(v.function=a.function),ki(a.value)==="object"&&(v=a.value);let w=[];for(let T=0;T<n.length;T++)w=w.concat(g({array:n,arrayIndex:T,value:n[T],valueSpec:v,style:u,styleSpec:d,key:`${m}[${T}]`}));return w}function o_(o){const n=o.key,a=o.value,u=o.valueSpec;let d=ki(a);if(d==="number"&&a!=a&&(d="NaN"),d!=="number")return[new st(n,a,`number expected, ${d} found`)];if("minimum"in u){let m=u.minimum;if(ki(u.minimum)==="array"&&(m=u.minimum[o.arrayIndex]),a<m)return[new st(n,a,`${a} is less than the minimum value ${m}`)]}if("maximum"in u){let m=u.maximum;if(ki(u.maximum)==="array"&&(m=u.maximum[o.arrayIndex]),a>m)return[new st(n,a,`${a} is greater than the maximum value ${m}`)]}return[]}function a_(o){const n=o.valueSpec,a=gt(o.value.type);let u,d,m,g={};const v=a!=="categorical"&&o.value.property===void 0,w=!v,T=ki(o.value.stops)==="array"&&ki(o.value.stops[0])==="array"&&ki(o.value.stops[0][0])==="object",A=Wr({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(z){if(a==="identity")return[new st(z.key,z.value,'identity function may not have a "stops" property')];let B=[];const j=z.value;return B=B.concat(Xl({key:z.key,value:j,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:M})),ki(j)==="array"&&j.length===0&&B.push(new st(z.key,j,"array must have at least one stop")),B},default:function(z){return Cn({key:z.key,value:z.value,valueSpec:n,style:z.style,styleSpec:z.styleSpec})}}});return a==="identity"&&v&&A.push(new st(o.key,o.value,'missing required property "property"')),a==="identity"||o.value.stops||A.push(new st(o.key,o.value,'missing required property "stops"')),a==="exponential"&&o.valueSpec.expression&&!Xd(o.valueSpec)&&A.push(new st(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(w&&!$a(o.valueSpec)?A.push(new st(o.key,o.value,"property functions not supported")):v&&!i_(o.valueSpec)&&A.push(new st(o.key,o.value,"zoom functions not supported"))),a!=="categorical"&&!T||o.value.property!==void 0||A.push(new st(o.key,o.value,'"property" property is required')),A;function M(z){let B=[];const j=z.value,W=z.key;if(ki(j)!=="array")return[new st(W,j,`array expected, ${ki(j)} found`)];if(j.length!==2)return[new st(W,j,`array length 2 expected, length ${j.length} found`)];if(T){if(ki(j[0])!=="object")return[new st(W,j,`object expected, ${ki(j[0])} found`)];if(j[0].zoom===void 0)return[new st(W,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new st(W,j,"object stop key must have value")];const X=gt(j[0].zoom);if(typeof X!="number")return[new st(W,j[0].zoom,"stop zoom values must be numbers")];if(m&&m>X)return[new st(W,j[0].zoom,"stop zoom values must appear in ascending order")];X!==m&&(m=X,d=void 0,g={}),B=B.concat(Wr({key:`${W}[0]`,value:j[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:o_,value:D}}))}else B=B.concat(D({key:`${W}[0]`,value:j[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},j));return ja(bi(j[1]))?B.concat([new st(`${W}[1]`,j[1],"expressions are not allowed in function stops.")]):B.concat(Cn({key:`${W}[1]`,value:j[1],valueSpec:n,style:z.style,styleSpec:z.styleSpec}))}function D(z,B){const j=ki(z.value),W=gt(z.value),X=z.value!==null?z.value:B;if(u){if(j!==u)return[new st(z.key,X,`${j} stop domain type must match previous stop domain type ${u}`)]}else u=j;if(j!=="number"&&j!=="string"&&j!=="boolean"&&typeof W!="number"&&typeof W!="string"&&typeof W!="boolean")return[new st(z.key,X,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&a!=="categorical"){let oe=`number expected, ${j} found`;return $a(n)&&a===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new st(z.key,X,oe)]}return a!=="categorical"||j!=="number"||typeof W=="number"&&isFinite(W)&&Math.floor(W)===W?a!=="categorical"&&j==="number"&&typeof W=="number"&&typeof d=="number"&&d!==void 0&&W<d?[new st(z.key,X,"stop domain values must appear in ascending order")]:(d=W,a==="categorical"&&W in g?[new st(z.key,X,"stop domain values must be unique")]:(g[W]=!0,[])):[new st(z.key,X,`integer expected, found ${String(W)}`)]}}function Ga(o){const n=(o.expressionContext==="property"?s_:Zl)(bi(o.value),o.valueSpec);if(n.result==="error")return n.value.map(u=>new st(`${o.key}${u.key}`,o.value,u.message));const a=n.value.expression||n.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!a.outputDefined())return[new st(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Ul(a))return[new st(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter")return Hs(a,o);if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Vl(a,["zoom","feature-state"]))return[new st(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!mr(a))return[new st(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hs(o,n){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const d of n.valueSpec.expression.parameters)a.delete(d);if(a.size===0)return[];const u=[];return o instanceof Mr&&a.has(o.name)?[new st(n.key,n.value,`["${o.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(o.eachChild(d=>{u.push(...Hs(d,n))}),u)}function Yl(o){const n=o.key,a=o.value,u=o.valueSpec,d=[];return Array.isArray(u.values)?u.values.indexOf(gt(a))===-1&&d.push(new st(n,a,`expected one of [${u.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(u.values).indexOf(gt(a))===-1&&d.push(new st(n,a,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(a)} found`)),d}function yo(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const n of o.slice(1))if(!yo(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function vo(o,n="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yo(o)||(o=Jl(o));const a=o;let u=!0;try{u=function(T){if(!xo(T))return T;let A=bi(T);return l_(A),A=tf(A),A}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}const d=be[`filter_${n}`],m=Zl(u,d);let g=null;if(m.result==="error")throw new Error(m.value.map(T=>`${T.key}: ${T.message}`).join(", "));g=(T,A,M)=>m.value.evaluate(T,A,{},M);let v=null,w=null;if(u!==a){const T=Zl(a,d);if(T.result==="error")throw new Error(T.value.map(A=>`${A.key}: ${A.message}`).join(", "));v=(A,M,D,z,B)=>T.value.evaluate(A,M,{},D,void 0,void 0,z,B),w=!mr(T.value.expression)}return g=g,{filter:g,dynamicFilter:v||void 0,needGeometry:Vu(u),needFeature:!!w}}function tf(o){if(!Array.isArray(o))return o;const n=function(a){if(c_.has(a[0])){for(let u=1;u<a.length;u++)if(xo(a[u]))return!0}return a}(o);return n===!0?n:n.map(a=>tf(a))}function l_(o){let n=!1;const a=[];if(o[0]==="case"){for(let u=1;u<o.length-1;u+=2)n=n||xo(o[u]),a.push(o[u+1]);a.push(o[o.length-1])}else if(o[0]==="match"){n=n||xo(o[1]);for(let u=2;u<o.length-1;u+=2)a.push(o[u+1]);a.push(o[o.length-1])}else if(o[0]==="step"){n=n||xo(o[1]);for(let u=1;u<o.length-1;u+=2)a.push(o[u+1])}n&&(o.length=0,o.push("any",...a));for(let u=1;u<o.length;u++)l_(o[u])}function xo(o){if(!Array.isArray(o))return!1;if((n=o[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let a=1;a<o.length;a++)if(xo(o[a]))return!0;return!1}const c_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function nf(o,n){return o<n?-1:o>n?1:0}function Vu(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let n=1;n<o.length;n++)if(Vu(o[n]))return!0;return!1}function Jl(o){if(!o)return!0;const n=o[0];return o.length<=1?n!=="any":n==="=="?Ql(o[1],o[2],"=="):n==="!="?ec(Ql(o[1],o[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Ql(o[1],o[2],n):n==="any"?(a=o.slice(1),["any"].concat(a.map(Jl))):n==="all"?["all"].concat(o.slice(1).map(Jl)):n==="none"?["all"].concat(o.slice(1).map(Jl).map(ec)):n==="in"?rf(o[1],o.slice(2)):n==="!in"?ec(rf(o[1],o.slice(2))):n==="has"?sf(o[1]):n==="!has"?ec(sf(o[1])):n!=="within"||o;var a}function Ql(o,n,a){switch(o){case"$type":return[`filter-type-${a}`,n];case"$id":return[`filter-id-${a}`,n];default:return[`filter-${a}`,o,n]}}function rf(o,n){if(n.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(a=>typeof a!=typeof n[0])?["filter-in-large",o,["literal",n.sort(nf)]]:["filter-in-small",o,["literal",n]]}}function sf(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function ec(o){return["!",o]}function bo(o){return yo(bi(o.value))?Ga(Ei({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):of(o)}function of(o){const n=o.value,a=o.key;if(ki(n)!=="array")return[new st(a,n,`array expected, ${ki(n)} found`)];const u=o.styleSpec;let d,m=[];if(n.length<1)return[new st(a,n,"filter array must have at least 1 element")];switch(m=m.concat(Yl({key:`${a}[0]`,value:n[0],valueSpec:u.filter_operator,style:o.style,styleSpec:o.styleSpec})),gt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&gt(n[1])==="$type"&&m.push(new st(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&m.push(new st(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(d=ki(n[1]),d!=="string"&&m.push(new st(`${a}[1]`,n[1],`string expected, ${d} found`)));for(let g=2;g<n.length;g++)d=ki(n[g]),gt(n[1])==="$type"?m=m.concat(Yl({key:`${a}[${g}]`,value:n[g],valueSpec:u.geometry_type,style:o.style,styleSpec:o.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&m.push(new st(`${a}[${g}]`,n[g],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let g=1;g<n.length;g++)m=m.concat(of({key:`${a}[${g}]`,value:n[g],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":d=ki(n[1]),n.length!==2?m.push(new st(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):d!=="string"&&m.push(new st(`${a}[1]`,n[1],`string expected, ${d} found`));break;case"within":d=ki(n[1]),n.length!==2?m.push(new st(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):d!=="object"&&m.push(new st(`${a}[1]`,n[1],`object expected, ${d} found`))}return m}function af(o,n){const a=o.key,u=o.style,d=o.styleSpec,m=o.value,g=o.objectKey,v=d[`${n}_${o.layerType}`];if(!v)return[];const w=g.match(/^(.*)-transition$/);if(n==="paint"&&w&&v[w[1]]&&v[w[1]].transition)return Cn({key:a,value:m,valueSpec:d.transition,style:u,styleSpec:d});const T=o.valueSpec||v[g];if(!T)return[new st(a,m,`unknown property "${g}"`)];let A;if(ki(m)==="string"&&$a(T)&&!T.tokens&&(A=/^{([^}]+)}$/.exec(m)))return[new st(a,m,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const M=[];return o.layerType==="symbol"&&(g==="text-field"&&u&&!u.glyphs&&M.push(new st(a,m,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&aa(bi(m))&&gt(m.type)==="identity"&&M.push(new st(a,m,'"text-font" does not support identity functions'))),M.concat(Cn({key:o.key,value:m,valueSpec:T,style:u,styleSpec:d,expressionContext:"property",propertyType:n,propertyKey:g}))}function $u(o){return af(o,"paint")}function lf(o){return af(o,"layout")}function u_(o){let n=[];const a=o.value,u=o.key,d=o.style,m=o.styleSpec;a.type||a.ref||n.push(new st(u,a,'either "type" or "ref" is required'));let g=gt(a.type);const v=gt(a.ref);if(a.id){const w=gt(a.id);for(let T=0;T<o.arrayIndex;T++){const A=d.layers[T];gt(A.id)===w&&n.push(new st(u,a.id,`duplicate layer id "${a.id}", previously used at line ${A.id.__line__}`))}}if("ref"in a){let w;["type","source","source-layer","filter","layout"].forEach(T=>{T in a&&n.push(new st(u,a[T],`"${T}" is prohibited for ref layers`))}),d.layers.forEach(T=>{gt(T.id)===v&&(w=T)}),w?w.ref?n.push(new st(u,a.ref,"ref cannot reference another ref layer")):g=gt(w.type):typeof v=="string"&&n.push(new st(u,a.ref,`ref layer "${v}" not found`))}else if(g!=="background"&&g!=="sky")if(a.source){const w=d.sources&&d.sources[a.source],T=w&&gt(w.type);w?T==="vector"&&g==="raster"?n.push(new st(u,a.source,`layer "${a.id}" requires a raster source`)):T==="raster"&&g!=="raster"?n.push(new st(u,a.source,`layer "${a.id}" requires a vector source`)):T!=="vector"||a["source-layer"]?T==="raster-dem"&&g!=="hillshade"?n.push(new st(u,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!a.paint||!a.paint["line-gradient"]||T==="geojson"&&w.lineMetrics||n.push(new st(u,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new st(u,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new st(u,a.source,`source "${a.source}" not found`))}else n.push(new st(u,a,'missing required property "source"'));return n=n.concat(Wr({key:u,value:a,valueSpec:m.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Cn({key:`${u}.type`,value:a.type,valueSpec:m.layer.type,style:o.style,styleSpec:o.styleSpec,object:a,objectKey:"type"}),filter:w=>bo(Ei({layerType:g},w)),layout:w=>Wr({layer:a,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":T=>lf(Ei({layerType:g},T))}}),paint:w=>Wr({layer:a,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":T=>$u(Ei({layerType:g},T))}})}})),n}function Ks(o){const n=o.value,a=o.key,u=ki(n);return u!=="string"?[new st(a,n,`string expected, ${u} found`)]:[]}const h_={promoteId:function({key:o,value:n}){if(ki(n)==="string")return Ks({key:o,value:n});{const a=[];for(const u in n)a.push(...Ks({key:`${o}.${u}`,value:n[u]}));return a}}};function d_(o){const n=o.value,a=o.key,u=o.styleSpec,d=o.style;if(!n.type)return[new st(a,n,'"type" is required')];const m=gt(n.type);let g;switch(m){case"vector":case"raster":case"raster-dem":return g=Wr({key:a,value:n,valueSpec:u[`source_${m.replace("-","_")}`],style:o.style,styleSpec:u,objectElementValidators:h_}),g;case"geojson":if(g=Wr({key:a,value:n,valueSpec:u.source_geojson,style:d,styleSpec:u,objectElementValidators:h_}),n.cluster)for(const v in n.clusterProperties){const[w,T]=n.clusterProperties[v],A=typeof w=="string"?[w,["accumulated"],["get",v]]:w;g.push(...Ga({key:`${a}.${v}.map`,value:T,expressionContext:"cluster-map"})),g.push(...Ga({key:`${a}.${v}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return g;case"video":return Wr({key:a,value:n,valueSpec:u.source_video,style:d,styleSpec:u});case"image":return Wr({key:a,value:n,valueSpec:u.source_image,style:d,styleSpec:u});case"canvas":return[new st(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yl({key:`${a}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:u})}}function f_(o){const n=o.value,a=o.styleSpec,u=a.light,d=o.style;let m=[];const g=ki(n);if(n===void 0)return m;if(g!=="object")return m=m.concat([new st("light",n,`object expected, ${g} found`)]),m;for(const v in n){const w=v.match(/^(.*)-transition$/);m=m.concat(w&&u[w[1]]&&u[w[1]].transition?Cn({key:v,value:n[v],valueSpec:a.transition,style:d,styleSpec:a}):u[v]?Cn({key:v,value:n[v],valueSpec:u[v],style:d,styleSpec:a}):[new st(v,n[v],`unknown property "${v}"`)])}return m}function p_(o){const n=o.value,a=o.key,u=o.style,d=o.styleSpec,m=d.terrain;let g=[];const v=ki(n);if(n===void 0)return g;if(v!=="object")return g=g.concat([new st("terrain",n,`object expected, ${v} found`)]),g;for(const w in n){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&m[T[1]]&&m[T[1]].transition?Cn({key:w,value:n[w],valueSpec:d.transition,style:u,styleSpec:d}):m[w]?Cn({key:w,value:n[w],valueSpec:m[w],style:u,styleSpec:d}):[new st(w,n[w],`unknown property "${w}"`)])}if(n.source){const w=u.sources&&u.sources[n.source],T=w&&gt(w.type);w?T!=="raster-dem"&&g.push(new st(a,n.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):g.push(new st(a,n.source,`source "${n.source}" not found`))}else g.push(new st(a,n,'terrain is missing required property "source"'));return g}function m_(o){const n=o.value,a=o.style,u=o.styleSpec,d=u.fog;let m=[];const g=ki(n);if(n===void 0)return m;if(g!=="object")return m=m.concat([new st("fog",n,`object expected, ${g} found`)]),m;for(const v in n){const w=v.match(/^(.*)-transition$/);m=m.concat(w&&d[w[1]]&&d[w[1]].transition?Cn({key:v,value:n[v],valueSpec:u.transition,style:a,styleSpec:u}):d[v]?Cn({key:v,value:n[v],valueSpec:d[v],style:a,styleSpec:u}):[new st(v,n[v],`unknown property "${v}"`)])}return m}const tc={"*":()=>[],array:Xl,boolean:function(o){const n=o.value,a=o.key,u=ki(n);return u!=="boolean"?[new st(a,n,`boolean expected, ${u} found`)]:[]},number:o_,color:function(o){const n=o.key,a=o.value,u=ki(a);return u!=="string"?[new st(n,a,`color expected, ${u} found`)]:Ld.parseCSSColor(a)===null?[new st(n,a,`color expected, "${a}" found`)]:[]},enum:Yl,filter:bo,function:a_,layer:u_,object:Wr,source:d_,light:f_,terrain:p_,fog:m_,string:Ks,formatted:function(o){return Ks(o).length===0?[]:Ga(o)},resolvedImage:function(o){return Ks(o).length===0?[]:Ga(o)},projection:function(o){const n=o.value,a=o.styleSpec,u=a.projection,d=o.style;let m=[];const g=ki(n);if(g==="object")for(const v in n)m=m.concat(Cn({key:v,value:n[v],valueSpec:u[v],style:d,styleSpec:a}));else g!=="string"&&(m=m.concat([new st("projection",n,`object or string expected, ${g} found`)]));return m}};function Cn(o){const n=o.value,a=o.valueSpec,u=o.styleSpec;return a.expression&&aa(gt(n))?a_(o):a.expression&&ja(bi(n))?Ga(o):a.type&&tc[a.type]?tc[a.type](o):Wr(Ei({},o,{valueSpec:a.type?u[a.type]:a}))}function Dr(o){const n=o.value,a=o.key,u=Ks(o);return u.length||(n.indexOf("{fontstack}")===-1&&u.push(new st(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&u.push(new st(a,n,'"glyphs" url must include a "{range}" token'))),u}function ic(o,n=be){return Zs(Cn({key:"",value:o,valueSpec:n.$root,styleSpec:n,style:o,objectElementValidators:{glyphs:Dr,"*":()=>[]}}))}const ax=o=>Zs($u(o)),lx=o=>Zs(lf(o));function Zs(o){return o.slice().sort((n,a)=>n.line&&a.line?n.line-a.line:0)}function __(o,n){let a=!1;if(n&&n.length)for(const u of n)o.fire(new It(new Error(u.message))),a=!0;return a}var wo=Ms;function Ms(o,n,a){var u=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var d=new Int32Array(this.arrayBuffer);o=d[0],this.d=(n=d[1])+2*(a=d[2]);for(var m=0;m<this.d*this.d;m++){var g=d[3+m],v=d[3+m+1];u.push(g===v?null:d.subarray(g,v))}var w=d[3+u.length+1];this.keys=d.subarray(d[3+u.length],w),this.bboxes=d.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*a;for(var T=0;T<this.d*this.d;T++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=o,this.padding=a,this.scale=n/o,this.uid=0;var A=a/n*o;this.min=-A,this.max=o+A}Ms.prototype.insert=function(o,n,a,u,d){this._forEachCell(n,a,u,d,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(d)},Ms.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ms.prototype._insertCell=function(o,n,a,u,d,m){this.cells[d].push(m)},Ms.prototype.query=function(o,n,a,u,d){var m=this.min,g=this.max;if(o<=m&&n<=m&&g<=a&&g<=u&&!d)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(o,n,a,u,this._queryCell,v,{},d),v},Ms.prototype._queryCell=function(o,n,a,u,d,m,g,v){var w=this.cells[d];if(w!==null)for(var T=this.keys,A=this.bboxes,M=0;M<w.length;M++){var D=w[M];if(g[D]===void 0){var z=4*D;(v?v(A[z+0],A[z+1],A[z+2],A[z+3]):o<=A[z+2]&&n<=A[z+3]&&a>=A[z+0]&&u>=A[z+1])?(g[D]=!0,m.push(T[D])):g[D]=!1}}},Ms.prototype._forEachCell=function(o,n,a,u,d,m,g,v){for(var w=this._convertToCellCoord(o),T=this._convertToCellCoord(n),A=this._convertToCellCoord(a),M=this._convertToCellCoord(u),D=w;D<=A;D++)for(var z=T;z<=M;z++){var B=this.d*z+D;if((!v||v(this._convertFromCellCoord(D),this._convertFromCellCoord(z),this._convertFromCellCoord(D+1),this._convertFromCellCoord(z+1)))&&d.call(this,o,n,a,u,B,m,g,v))return}},Ms.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},Ms.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},Ms.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,n=3+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var d=new Int32Array(n+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var m=n,g=0;g<o.length;g++){var v=o[g];d[3+g]=m,d.set(v,m),m+=v.length}return d[3+o.length]=m,d.set(this.keys,m),d[3+o.length+1]=m+=this.keys.length,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer};const qa={};function at(o,n,a={}){Object.defineProperty(o,"_classRegistryKey",{value:n,writeable:!1}),qa[n]={klass:o,omit:a.omit||[]}}at(Object,"Object"),wo.serialize=function(o,n){const a=o.toArrayBuffer();return n&&n.push(a),{buffer:a}},wo.deserialize=function(o){return new wo(o.buffer)},Object.defineProperty(wo,"name",{value:"Grid"}),at(wo,"Grid"),at(wi,"Color"),at(Error,"Error"),at(N,"AJAXError"),at(Cr,"ResolvedImage"),at(Bu,"StylePropertyFunction"),at(Fu,"StyleExpression",{omit:["_evaluator"]}),at(ef,"ZoomDependentExpression"),at(Qd,"ZoomConstantExpression"),at(Mr,"CompoundExpression",{omit:["_evaluate"]});for(const o in sa)qa[sa[o]._classRegistryKey]||at(sa[o],`Expression${o}`);function g_(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function ju(o){return J.ImageBitmap&&o instanceof J.ImageBitmap}function nc(o,n){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(g_(o)||ju(o))return n&&n.push(o),o;if(ArrayBuffer.isView(o)){const a=o;return n&&n.push(a.buffer),a}if(o instanceof J.ImageData)return n&&n.push(o.data.buffer),o;if(Array.isArray(o)){const a=[];for(const u of o)a.push(nc(u,n));return a}if(typeof o=="object"){const a=o.constructor,u=a._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const d=a.serialize?a.serialize(o,n):{};if(!a.serialize){for(const m in o)o.hasOwnProperty(m)&&(qa[u].omit.indexOf(m)>=0||(d[m]=nc(o[m],n)));o instanceof Error&&(d.message=o.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof o)}function Wa(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||g_(o)||ju(o)||ArrayBuffer.isView(o)||o instanceof J.ImageData)return o;if(Array.isArray(o))return o.map(Wa);if(typeof o=="object"){const n=o.$name||"Object",{klass:a}=qa[n];if(!a)throw new Error(`can't deserialize unregistered class ${n}`);if(a.deserialize)return a.deserialize(o);const u=Object.create(a.prototype);for(const d of Object.keys(o))d!=="$name"&&(u[d]=Wa(o[d]));return u}throw new Error("can't deserialize object of type "+typeof o)}class cf{constructor(){this.first=!0}update(n,a){const u=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=a),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=u,!0))}}const y_=o=>o>=1536&&o<=1791,Gu=o=>o>=1872&&o<=1919,rc=o=>o>=2208&&o<=2303,uf=o=>o>=11904&&o<=12031,v_=o=>o>=12032&&o<=12255,hf=o=>o>=12272&&o<=12287,qu=o=>o>=12288&&o<=12351,sc=o=>o>=12352&&o<=12447,Wu=o=>o>=12448&&o<=12543,x_=o=>o>=12544&&o<=12591,b_=o=>o>=12704&&o<=12735,w_=o=>o>=12736&&o<=12783,df=o=>o>=12784&&o<=12799,E_=o=>o>=12800&&o<=13055,T_=o=>o>=13056&&o<=13311,I_=o=>o>=13312&&o<=19903,ff=o=>o>=19968&&o<=40959,S_=o=>o>=40960&&o<=42127,A_=o=>o>=42128&&o<=42191,C_=o=>o>=44032&&o<=55215,oc=o=>o>=63744&&o<=64255,pf=o=>o>=64336&&o<=65023,M_=o=>o>=65040&&o<=65055,Ha=o=>o>=65072&&o<=65103,k_=o=>o>=65104&&o<=65135,Hu=o=>o>=65136&&o<=65279,mf=o=>o>=65280&&o<=65519;function Ku(o){for(const n of o)if(Zu(n.charCodeAt(0)))return!0;return!1}function D_(o){for(const n of o)if(!P_(n.charCodeAt(0)))return!1;return!0}function P_(o){return!(y_(o)||Gu(o)||rc(o)||pf(o)||Hu(o))}function Zu(o){return!(o!==746&&o!==747&&(o<4352||!(b_(o)||x_(o)||Ha(o)&&!(o>=65097&&o<=65103)||oc(o)||T_(o)||uf(o)||w_(o)||!(!qu(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||I_(o)||ff(o)||E_(o)||(n=>n>=12592&&n<=12687)(o)||(n=>n>=43360&&n<=43391)(o)||(n=>n>=55216&&n<=55295)(o)||(n=>n>=4352&&n<=4607)(o)||C_(o)||sc(o)||hf(o)||(n=>n>=12688&&n<=12703)(o)||v_(o)||df(o)||Wu(o)&&o!==12540||!(!mf(o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!k_(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(n=>n>=5120&&n<=5759)(o)||(n=>n>=6320&&n<=6399)(o)||M_(o)||(n=>n>=19904&&n<=19967)(o)||S_(o)||A_(o))))}function Xu(o){return!(Zu(o)||function(n){return!!((a=>a>=128&&a<=255)(n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||(a=>a>=8192&&a<=8303)(n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||(a=>a>=8448&&a<=8527)(n)||(a=>a>=8528&&a<=8591)(n)||(a=>a>=8960&&a<=9215)(n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||(a=>a>=9216&&a<=9279)(n)&&n!==9251||(a=>a>=9280&&a<=9311)(n)||(a=>a>=9312&&a<=9471)(n)||(a=>a>=9632&&a<=9727)(n)||(a=>a>=9728&&a<=9983)(n)&&!(n>=9754&&n<=9759)||(a=>a>=11008&&a<=11263)(n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||qu(n)||Wu(n)||(a=>a>=57344&&a<=63743)(n)||Ha(n)||k_(n)||mf(n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(o))}function Yu(o){return o>=1424&&o<=2303||pf(o)||Hu(o)}function cx(o,n){return!(!n&&Yu(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(a=>a>=6016&&a<=6143)(o))}function ux(o){for(const n of o)if(Yu(n.charCodeAt(0)))return!0;return!1}const _f="deferred",ac="loading",gf="loaded";let yf=null,_r="unavailable",Pr=null;const lc=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(_r="error"),yf&&yf(o)};function la(){vf.fire(new Tt("pluginStateChange",{pluginStatus:_r,pluginURL:Pr}))}const vf=new Lt,Ju=function(){return _r},Ka=function(){if(_r!==_f||!Pr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_r=ac,la(),Pr&&ne({url:Pr},o=>{o?lc(o):(_r=gf,la())})},Hr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_r===gf||Hr.applyArabicShaping!=null,isLoading:()=>_r===ac,setState(o){_r=o.pluginStatus,Pr=o.pluginURL},isParsed:()=>Hr.applyArabicShaping!=null&&Hr.processBidirectionalText!=null&&Hr.processStyledBidirectionalText!=null,getPluginURL:()=>Pr};class Gi{constructor(n,a){this.zoom=n,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cf,this.transition={},this.pitch=0)}isSupportedScript(n){return function(a,u){for(const d of a)if(!cx(d.charCodeAt(0),u))return!1;return!0}(n,Hr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,a=n-Math.floor(n),u=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*a}}}class cc{constructor(n,a){this.property=n,this.value=a,this.expression=function(u,d){if(aa(u))return new Bu(u,d);if(ja(u)){const m=s_(u,d);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=u;return typeof u=="string"&&d.type==="color"&&(m=wi.parse(u)),{kind:"constant",evaluate:()=>m}}}(a===void 0?n.specification.default:a,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,a,u){return this.property.possiblyEvaluate(this,n,a,u)}}class Za{constructor(n){this.property=n,this.value=new cc(n,void 0)}transitioned(n,a){return new s(this.property,this.value,a,Ht({},n.transition,this.transition),n.now)}untransitioned(){return new s(this.property,this.value,null,{},0)}}class p{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Ji(this._values[n].value.value)}setValue(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new Za(this._values[n].property)),this._values[n].value=new cc(this._values[n].property,a===null?void 0:Ji(a))}getTransition(n){return Ji(this._values[n].transition)}setTransition(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new Za(this._values[n].property)),this._values[n].transition=Ji(a)||void 0}serialize(){const n={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(n[a]=u);const d=this.getTransition(a);d!==void 0&&(n[`${a}-transition`]=d)}return n}transitioned(n,a){const u=new h(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(n,a._values[d]);return u}untransitioned(){const n=new h(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].untransitioned();return n}}class s{constructor(n,a,u,d,m){const g=d.delay||0,v=d.duration||0;m=m||0,this.property=n,this.value=a,this.begin=m+g,this.end=this.begin+v,n.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(n,a,u){const d=n.now||0,m=this.value.possiblyEvaluate(n,a,u),g=this.prior;if(g){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return g.possiblyEvaluate(n,a,u);{const v=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(n,a,u),m,yt(v))}}return m}}class h{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,a,u){const d=new b(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(n,a,u);return d}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class _{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return Ji(this._values[n].value)}setValue(n,a){this._values[n]=new cc(this._values[n].property,a===null?void 0:Ji(a))}serialize(){const n={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(n[a]=u)}return n}possiblyEvaluate(n,a,u){const d=new b(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(n,a,u);return d}}class x{constructor(n,a,u){this.property=n,this.value=a,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,a,u,d){return this.property.evaluate(this.value,this.parameters,n,a,u,d)}}class b{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class E{constructor(n){this.specification=n}possiblyEvaluate(n,a){return n.expression.evaluate(a)}interpolate(n,a,u){const d=Cu[this.specification.type];return d?d(n,a,u):n}}class S{constructor(n,a){this.specification=n,this.overrides=a}possiblyEvaluate(n,a,u,d){return new x(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(a,null,{},u,d)}:n.expression,a)}interpolate(n,a,u){if(n.value.kind!=="constant"||a.value.kind!=="constant")return n;if(n.value.value===void 0||a.value.value===void 0)return new x(this,{kind:"constant",value:void 0},n.parameters);const d=Cu[this.specification.type];return d?new x(this,{kind:"constant",value:d(n.value.value,a.value.value,u)},n.parameters):n}evaluate(n,a,u,d,m,g){return n.kind==="constant"?n.value:n.evaluate(a,u,d,m,g)}}class k extends S{possiblyEvaluate(n,a,u,d){if(n.value===void 0)return new x(this,{kind:"constant",value:void 0},a);if(n.expression.kind==="constant"){const m=n.expression.evaluate(a,null,{},u,d),g=n.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,v=this._calculate(g,g,g,a);return new x(this,{kind:"constant",value:v},a)}if(n.expression.kind==="camera"){const m=this._calculate(n.expression.evaluate({zoom:a.zoom-1}),n.expression.evaluate({zoom:a.zoom}),n.expression.evaluate({zoom:a.zoom+1}),a);return new x(this,{kind:"constant",value:m},a)}return new x(this,n.expression,a)}evaluate(n,a,u,d,m,g){if(n.kind==="source"){const v=n.evaluate(a,u,d,m,g);return this._calculate(v,v,v,a)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(a.zoom)-1},u,d),n.evaluate({zoom:Math.floor(a.zoom)},u,d),n.evaluate({zoom:Math.floor(a.zoom)+1},u,d),a):n.value}_calculate(n,a,u,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:n,to:a,other:u}:{from:u,to:a,other:n}}interpolate(n){return n}}class P{constructor(n){this.specification=n}possiblyEvaluate(n,a,u,d){if(n.value!==void 0){if(n.expression.kind==="constant"){const m=n.expression.evaluate(a,null,{},u,d);return this._calculate(m,m,m,a)}return this._calculate(n.expression.evaluate(new Gi(Math.floor(a.zoom-1),a)),n.expression.evaluate(new Gi(Math.floor(a.zoom),a)),n.expression.evaluate(new Gi(Math.floor(a.zoom+1),a)),a)}}_calculate(n,a,u,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:n,to:a}:{from:u,to:a}}interpolate(n){return n}}class O{constructor(n){this.specification=n}possiblyEvaluate(n,a,u,d){return!!n.expression.evaluate(a,null,{},u,d)}interpolate(){return!1}}class F{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in n){const u=n[a];u.specification.overridable&&this.overridableProperties.push(a);const d=this.defaultPropertyValues[a]=new cc(u,void 0),m=this.defaultTransitionablePropertyValues[a]=new Za(u);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=d.possiblyEvaluate({})}}}function G(o,n){return 256*(o=rt(Math.floor(o),0,255))+rt(Math.floor(n),0,255)}at(S,"DataDrivenProperty"),at(E,"DataConstantProperty"),at(k,"CrossFadedDataDrivenProperty"),at(P,"CrossFadedProperty"),at(O,"ColorRampProperty");const H={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class q{constructor(n,a){this._structArray=n,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class V{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,a){return n._trim(),a&&(n.isTransferred=!0,a.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const a=Object.create(this.prototype);return a.arrayBuffer=n.arrayBuffer,a.length=n.length,a.capacity=n.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ie(o,n=1){let a=0,u=0;return{members:o.map(d=>{const m=H[d.type].BYTES_PER_ELEMENT,g=a=Z(a,Math.max(n,m)),v=d.components||1;return u=Math.max(u,m),a+=m*v,{name:d.name,type:d.type,components:v,offset:g}}),size:Z(a,Math.max(u,n)),alignment:n}}function Z(o,n){return Math.ceil(o/n)*n}class ee extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a){const u=this.length;return this.resize(u+1),this.emplace(u,n,a)}emplace(n,a,u){const d=2*n;return this.int16[d+0]=a,this.int16[d+1]=u,n}}ee.prototype.bytesPerElement=4,at(ee,"StructArrayLayout2i4");class te extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,n,a,u)}emplace(n,a,u,d){const m=3*n;return this.int16[m+0]=a,this.int16[m+1]=u,this.int16[m+2]=d,n}}te.prototype.bytesPerElement=6,at(te,"StructArrayLayout3i6");class re extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,n,a,u,d)}emplace(n,a,u,d,m){const g=4*n;return this.int16[g+0]=a,this.int16[g+1]=u,this.int16[g+2]=d,this.int16[g+3]=m,n}}re.prototype.bytesPerElement=8,at(re,"StructArrayLayout4i8");class Q extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,a,u,d,m,g,v)}emplace(n,a,u,d,m,g,v,w){const T=6*n,A=12*n,M=3*n;return this.int16[T+0]=a,this.int16[T+1]=u,this.uint8[A+4]=d,this.uint8[A+5]=m,this.uint8[A+6]=g,this.uint8[A+7]=v,this.float32[M+2]=w,n}}Q.prototype.bytesPerElement=12,at(Q,"StructArrayLayout2i4ub1f12");class ae extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,n,a,u,d)}emplace(n,a,u,d,m){const g=4*n;return this.float32[g+0]=a,this.float32[g+1]=u,this.float32[g+2]=d,this.float32[g+3]=m,n}}ae.prototype.bytesPerElement=16,at(ae,"StructArrayLayout4f16");class ye extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v,w,T,A){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,u,d,m,g,v,w,T,A)}emplace(n,a,u,d,m,g,v,w,T,A,M){const D=10*n;return this.uint16[D+0]=a,this.uint16[D+1]=u,this.uint16[D+2]=d,this.uint16[D+3]=m,this.uint16[D+4]=g,this.uint16[D+5]=v,this.uint16[D+6]=w,this.uint16[D+7]=T,this.uint16[D+8]=A,this.uint16[D+9]=M,n}}ye.prototype.bytesPerElement=20,at(ye,"StructArrayLayout10ui20");class Te extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,n,a,u,d,m,g,v,w)}emplace(n,a,u,d,m,g,v,w,T){const A=8*n;return this.uint16[A+0]=a,this.uint16[A+1]=u,this.uint16[A+2]=d,this.uint16[A+3]=m,this.uint16[A+4]=g,this.uint16[A+5]=v,this.uint16[A+6]=w,this.uint16[A+7]=T,n}}Te.prototype.bytesPerElement=16,at(Te,"StructArrayLayout8ui16");class Me extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g){const v=this.length;return this.resize(v+1),this.emplace(v,n,a,u,d,m,g)}emplace(n,a,u,d,m,g,v){const w=6*n;return this.int16[w+0]=a,this.int16[w+1]=u,this.int16[w+2]=d,this.int16[w+3]=m,this.int16[w+4]=g,this.int16[w+5]=v,n}}Me.prototype.bytesPerElement=12,at(Me,"StructArrayLayout6i12");class Ae extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W){const X=this.length;return this.resize(X+1),this.emplace(X,n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W)}emplace(n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W,X){const oe=16*n;return this.int16[oe+0]=a,this.int16[oe+1]=u,this.int16[oe+2]=d,this.int16[oe+3]=m,this.uint16[oe+4]=g,this.uint16[oe+5]=v,this.uint16[oe+6]=w,this.uint16[oe+7]=T,this.int16[oe+8]=A,this.int16[oe+9]=M,this.int16[oe+10]=D,this.int16[oe+11]=z,this.int16[oe+12]=B,this.int16[oe+13]=j,this.int16[oe+14]=W,this.int16[oe+15]=X,n}}Ae.prototype.bytesPerElement=32,at(Ae,"StructArrayLayout4i4ui4i4i32");class We extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,n,a,u)}emplace(n,a,u,d){const m=3*n;return this.float32[m+0]=a,this.float32[m+1]=u,this.float32[m+2]=d,n}}We.prototype.bytesPerElement=12,at(We,"StructArrayLayout3f12");class ve extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint32[1*n+0]=a,n}}ve.prototype.bytesPerElement=4,at(ve,"StructArrayLayout1ul4");class He extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v,w,T,A,M,D,z){const B=this.length;return this.resize(B+1),this.emplace(B,n,a,u,d,m,g,v,w,T,A,M,D,z)}emplace(n,a,u,d,m,g,v,w,T,A,M,D,z,B){const j=20*n,W=10*n;return this.int16[j+0]=a,this.int16[j+1]=u,this.int16[j+2]=d,this.int16[j+3]=m,this.int16[j+4]=g,this.float32[W+3]=v,this.float32[W+4]=w,this.float32[W+5]=T,this.float32[W+6]=A,this.int16[j+14]=M,this.uint32[W+8]=D,this.uint16[j+18]=z,this.uint16[j+19]=B,n}}He.prototype.bytesPerElement=40,at(He,"StructArrayLayout5i4f1i1ul2ui40");class $e extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,a,u,d,m,g,v)}emplace(n,a,u,d,m,g,v,w){const T=8*n;return this.int16[T+0]=a,this.int16[T+1]=u,this.int16[T+2]=d,this.int16[T+4]=m,this.int16[T+5]=g,this.int16[T+6]=v,this.int16[T+7]=w,n}}$e.prototype.bytesPerElement=16,at($e,"StructArrayLayout3i2i2i16");class mt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,n,a,u,d,m)}emplace(n,a,u,d,m,g){const v=4*n,w=8*n;return this.float32[v+0]=a,this.float32[v+1]=u,this.float32[v+2]=d,this.int16[w+6]=m,this.int16[w+7]=g,n}}mt.prototype.bytesPerElement=16,at(mt,"StructArrayLayout2f1f2i16");class ke extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,n,a,u,d)}emplace(n,a,u,d,m){const g=12*n,v=3*n;return this.uint8[g+0]=a,this.uint8[g+1]=u,this.float32[v+1]=d,this.float32[v+2]=m,n}}ke.prototype.bytesPerElement=12,at(ke,"StructArrayLayout2ub2f12");class ht extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,n,a,u)}emplace(n,a,u,d){const m=3*n;return this.uint16[m+0]=a,this.uint16[m+1]=u,this.uint16[m+2]=d,n}}ht.prototype.bytesPerElement=6,at(ht,"StructArrayLayout3ui6");class St extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W,X,oe,ce,he,de){const fe=this.length;return this.resize(fe+1),this.emplace(fe,n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W,X,oe,ce,he,de)}emplace(n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W,X,oe,ce,he,de,fe){const Se=30*n,Ce=15*n,Le=60*n;return this.int16[Se+0]=a,this.int16[Se+1]=u,this.int16[Se+2]=d,this.float32[Ce+2]=m,this.float32[Ce+3]=g,this.uint16[Se+8]=v,this.uint16[Se+9]=w,this.uint32[Ce+5]=T,this.uint32[Ce+6]=A,this.uint32[Ce+7]=M,this.uint16[Se+16]=D,this.uint16[Se+17]=z,this.uint16[Se+18]=B,this.float32[Ce+10]=j,this.float32[Ce+11]=W,this.uint8[Le+48]=X,this.uint8[Le+49]=oe,this.uint8[Le+50]=ce,this.uint32[Ce+13]=he,this.int16[Se+28]=de,this.uint8[Le+58]=fe,n}}St.prototype.bytesPerElement=60,at(St,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class dt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W,X,oe,ce,he,de,fe,Se,Ce,Le,Ne,Ee,Pe,Ve,Ze){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W,X,oe,ce,he,de,fe,Se,Ce,Le,Ne,Ee,Pe,Ve,Ze)}emplace(n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W,X,oe,ce,he,de,fe,Se,Ce,Le,Ne,Ee,Pe,Ve,Ze,Ge){const Ke=38*n,Nt=19*n;return this.int16[Ke+0]=a,this.int16[Ke+1]=u,this.int16[Ke+2]=d,this.float32[Nt+2]=m,this.float32[Nt+3]=g,this.int16[Ke+8]=v,this.int16[Ke+9]=w,this.int16[Ke+10]=T,this.int16[Ke+11]=A,this.int16[Ke+12]=M,this.int16[Ke+13]=D,this.uint16[Ke+14]=z,this.uint16[Ke+15]=B,this.uint16[Ke+16]=j,this.uint16[Ke+17]=W,this.uint16[Ke+18]=X,this.uint16[Ke+19]=oe,this.uint16[Ke+20]=ce,this.uint16[Ke+21]=he,this.uint16[Ke+22]=de,this.uint16[Ke+23]=fe,this.uint16[Ke+24]=Se,this.uint16[Ke+25]=Ce,this.uint16[Ke+26]=Le,this.uint16[Ke+27]=Ne,this.uint16[Ke+28]=Ee,this.uint32[Nt+15]=Pe,this.float32[Nt+16]=Ve,this.float32[Nt+17]=Ze,this.float32[Nt+18]=Ge,n}}dt.prototype.bytesPerElement=76,at(dt,"StructArrayLayout3i2f6i15ui1ul3f76");class ft extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.float32[1*n+0]=a,n}}ft.prototype.bytesPerElement=4,at(ft,"StructArrayLayout1f4");class Dt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,a,u,d,m,g,v)}emplace(n,a,u,d,m,g,v,w){const T=7*n;return this.float32[T+0]=a,this.float32[T+1]=u,this.float32[T+2]=d,this.float32[T+3]=m,this.float32[T+4]=g,this.float32[T+5]=v,this.float32[T+6]=w,n}}Dt.prototype.bytesPerElement=28,at(Dt,"StructArrayLayout7f28");class Gt extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,n,a,u,d,m)}emplace(n,a,u,d,m,g){const v=5*n;return this.float32[v+0]=a,this.float32[v+1]=u,this.float32[v+2]=d,this.float32[v+3]=m,this.float32[v+4]=g,n}}Gt.prototype.bytesPerElement=20,at(Gt,"StructArrayLayout5f20");class Et extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,n,a,u,d)}emplace(n,a,u,d,m){const g=6*n;return this.uint32[3*n+0]=a,this.uint16[g+2]=u,this.uint16[g+3]=d,this.uint16[g+4]=m,n}}Et.prototype.bytesPerElement=12,at(Et,"StructArrayLayout1ul3ui12");class Ot extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a){const u=this.length;return this.resize(u+1),this.emplace(u,n,a)}emplace(n,a,u){const d=2*n;return this.uint16[d+0]=a,this.uint16[d+1]=u,n}}Ot.prototype.bytesPerElement=4,at(Ot,"StructArrayLayout2ui4");class pi extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint16[1*n+0]=a,n}}pi.prototype.bytesPerElement=2,at(pi,"StructArrayLayout1ui2");class nn extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a){const u=this.length;return this.resize(u+1),this.emplace(u,n,a)}emplace(n,a,u){const d=2*n;return this.float32[d+0]=a,this.float32[d+1]=u,n}}nn.prototype.bytesPerElement=8,at(nn,"StructArrayLayout2f8");class Gn extends V{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,u,d,m,g,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,a,u,d,m,g,v)}emplace(n,a,u,d,m,g,v,w){const T=8*n,A=4*n;return this.int16[T+0]=a,this.int16[T+1]=u,this.int16[T+2]=d,this.int16[T+3]=m,this.int16[T+4]=g,this.int16[T+5]=v,this.float32[A+3]=w,n}}Gn.prototype.bytesPerElement=16,at(Gn,"StructArrayLayout6i1f16");class qn extends q{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}qn.prototype.size=12;class Rr extends Me{get(n){return new qn(this,n)}}at(Rr,"FillExtrusionExtArray");class ps extends q{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ps.prototype.size=40;class Xs extends He{get(n){return new ps(this,n)}}at(Xs,"CollisionBoxArray");class Eo extends q{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}Eo.prototype.size=60;class Ys extends St{get(n){return new Eo(this,n)}}at(Ys,"PlacedSymbolArray");class an extends q{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(n){this._structArray.uint32[this._pos4+15]=n}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}an.prototype.size=76;class un extends dt{get(n){return new an(this,n)}}at(un,"SymbolInstanceArray");class Ii extends ft{getoffsetX(n){return this.float32[1*n+0]}}at(Ii,"GlyphOffsetArray");class bn extends te{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}at(bn,"SymbolLineVertexArray");class Lr extends q{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Lr.prototype.size=12;class rn extends Et{get(n){return new Lr(this,n)}}at(rn,"FeatureIndexArray");class Kr extends q{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Kr.prototype.size=4;class uc extends Ot{get(n){return new Kr(this,n)}}at(uc,"FillExtrusionCentroidArray");class Or extends q{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}Or.prototype.size=16;class ca extends Gn{get(n){return new Or(this,n)}}at(ca,"CircleGlobeExtArray");const R_=ie([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),xf=ie([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Xa=bu(function(o){o.exports=function(n,a){var u,d,m,g,v,w,T,A;for(d=n.length-(u=3&n.length),m=a,v=3432918353,w=461845907,A=0;A<d;)T=255&n.charCodeAt(A)|(255&n.charCodeAt(++A))<<8|(255&n.charCodeAt(++A))<<16|(255&n.charCodeAt(++A))<<24,++A,m=27492+(65535&(g=5*(65535&(m=(m^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(T=0,u){case 3:T^=(255&n.charCodeAt(A+2))<<16;case 2:T^=(255&n.charCodeAt(A+1))<<8;case 1:m^=T=(65535&(T=(T=(65535&(T^=255&n.charCodeAt(A)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return m^=n.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),hx=bu(function(o){o.exports=function(n,a){for(var u,d=n.length,m=a^d,g=0;d>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(g)|(255&n.charCodeAt(++g))<<8|(255&n.charCodeAt(++g))<<16|(255&n.charCodeAt(++g))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),d-=4,++g;switch(d){case 3:m^=(255&n.charCodeAt(g+2))<<16;case 2:m^=(255&n.charCodeAt(g+1))<<8;case 1:m=1540483477*(65535&(m^=255&n.charCodeAt(g)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),To=Xa,bf=hx;To.murmur3=Xa,To.murmur2=bf;class L_{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,a,u,d){this.ids.push(GE(n)),this.positions.push(a,u,d)}getPositions(n){const a=GE(n);let u=0,d=this.ids.length-1;for(;u<d;){const g=u+d>>1;this.ids[g]>=a?d=g:u=g+1}const m=[];for(;this.ids[u]===a;)m.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return m}static serialize(n,a){const u=new Float64Array(n.ids),d=new Uint32Array(n.positions);return dx(u,d,0,u.length-1),a&&a.push(u.buffer,d.buffer),{ids:u,positions:d}}static deserialize(n){const a=new L_;return a.ids=n.ids,a.positions=n.positions,a.indexed=!0,a}}function GE(o){const n=+o;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:To(String(o))}function dx(o,n,a,u){for(;a<u;){const d=o[a+u>>1];let m=a-1,g=u+1;for(;;){do m++;while(o[m]<d);do g--;while(o[g]>d);if(m>=g)break;O_(o,m,g),O_(n,3*m,3*g),O_(n,3*m+1,3*g+1),O_(n,3*m+2,3*g+2)}g-a<u-g?(dx(o,n,a,g),a=g+1):(dx(o,n,g+1,u),u=g)}}function O_(o,n,a){const u=o[n];o[n]=o[a],o[a]=u}at(L_,"FeaturePositionMap");class ua{constructor(n,a){this.gl=n.gl,this.location=a}}class z_ extends ua{constructor(n,a){super(n,a),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class qE extends ua{constructor(n,a){super(n,a),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class WE extends ua{constructor(n,a){super(n,a),this.current=wi.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const $O=new Float32Array(16),jO=new Float32Array(9),GO=new Float32Array(4);function fx(o){return[G(255*o.r,255*o.g),G(255*o.b,255*o.a)]}class wf{constructor(n,a,u){this.value=n,this.uniformNames=a.map(d=>`u_${d}`),this.type=u}setUniform(n,a,u){n.set(u.constantOr(this.value))}getBinding(n,a,u){return this.type==="color"?new WE(n,a):new z_(n,a)}}class Qu{constructor(n,a){this.uniformNames=a.map(u=>`u_${u}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,a){this.pixelRatioFrom=a.pixelRatio||1,this.pixelRatioTo=n.pixelRatio||1,this.patternFrom=a.tl.concat(a.br),this.patternTo=n.tl.concat(n.br)}setUniform(n,a,u,d){const m=d==="u_pattern_to"||d==="u_dash_to"?this.patternTo:d==="u_pattern_from"||d==="u_dash_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&n.set(m)}getBinding(n,a,u){return u==="u_pattern_from"||u==="u_pattern_to"||u==="u_dash_from"||u==="u_dash_to"?new qE(n,a):new z_(n,a)}}class ha{constructor(n,a,u,d){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(m=>({name:`a_${m}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(n,a,u,d,m,g){const v=this.paintVertexArray.length,w=this.expression.evaluate(new Gi(0),a,{},m,d,g);this.paintVertexArray.resize(n),this._setPaintValue(v,n,w)}updatePaintArray(n,a,u,d,m){const g=this.expression.evaluate({zoom:0},u,d,void 0,m);this._setPaintValue(n,a,g)}_setPaintValue(n,a,u){if(this.type==="color"){const d=fx(u);for(let m=n;m<a;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=n;d<a;d++)this.paintVertexArray.emplace(d,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Js{constructor(n,a,u,d,m,g){this.expression=n,this.uniformNames=a.map(v=>`u_${v}_t`),this.type=u,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(n,a,u,d,m,g){const v=this.expression.evaluate(new Gi(this.zoom),a,{},m,d,g),w=this.expression.evaluate(new Gi(this.zoom+1),a,{},m,d,g),T=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(T,n,v,w)}updatePaintArray(n,a,u,d,m){const g=this.expression.evaluate({zoom:this.zoom},u,d,void 0,m),v=this.expression.evaluate({zoom:this.zoom+1},u,d,void 0,m);this._setPaintValue(n,a,g,v)}_setPaintValue(n,a,u,d){if(this.type==="color"){const m=fx(u),g=fx(d);for(let v=n;v<a;v++)this.paintVertexArray.emplace(v,m[0],m[1],g[0],g[1])}else{for(let m=n;m<a;m++)this.paintVertexArray.emplace(m,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,a){const u=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,d=rt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);n.set(d)}getBinding(n,a,u){return new z_(n,a)}}class Ya{constructor(n,a,u,d,m,g,v){this.expression=n,this.type=u,this.useIntegerZoom=d,this.zoom=m,this.layerId=v,this.paintVertexAttributes=(u==="array"?xf:R_).members;for(let w=0;w<a.length;++w);this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(n,a,u){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(d,n,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(n,a,u,d,m,g){this._setPaintValues(n,a,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(n,a,u,d){if(!d||!u)return;const{min:m,mid:g,max:v}=u,w=d[m],T=d[g],A=d[v];if(w&&T&&A)for(let M=n;M<a;M++)this._setPaintValue(this.zoomInPaintVertexArray,M,T,w),this._setPaintValue(this.zoomOutPaintVertexArray,M,T,A)}_setPaintValue(n,a,u,d){n.emplace(a,u.tl[0],u.tl[1],u.br[0],u.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1],u.pixelRatio,d.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ja{constructor(n,a,u=()=>!0){this.binders={},this._buffers=[];const d=[];for(const m in n.paint._values){if(!u(m))continue;const g=n.paint.get(m);if(!(g instanceof x&&$a(g.property.specification)))continue;const v=WO(m,n.type),w=g.value,T=g.property.specification.type,A=g.property.useIntegerZoom,M=g.property.specification["property-type"],D=M==="cross-faded"||M==="cross-faded-data-driven",z=String(m)==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||z)if(w.kind==="source"||z||D){const B=HE(m,T,"source");this.binders[m]=D?new Ya(w,v,T,A,a,B,n.id):new ha(w,v,T,B),d.push(`/a_${m}`)}else{const B=HE(m,T,"composite");this.binders[m]=new Js(w,v,T,A,a,B),d.push(`/z_${m}`)}else this.binders[m]=D?new Qu(w.value,v):new wf(w.value,v,T),d.push(`/u_${m}`)}this.cacheKey=d.sort().join("")}getMaxValue(n){const a=this.binders[n];return a instanceof ha||a instanceof Js?a.maxValue:0}populatePaintArrays(n,a,u,d,m,g){for(const v in this.binders){const w=this.binders[v];(w instanceof ha||w instanceof Js||w instanceof Ya)&&w.populatePaintArray(n,a,u,d,m,g)}}setConstantPatternPositions(n,a){for(const u in this.binders){const d=this.binders[u];d instanceof Qu&&d.setConstantPatternPositions(n,a)}}updatePaintArrays(n,a,u,d,m,g){let v=!1;for(const w in n){const T=a.getPositions(w);for(const A of T){const M=u.feature(A.index);for(const D in this.binders){const z=this.binders[D];if((z instanceof ha||z instanceof Js||z instanceof Ya)&&z.expression.isStateDependent===!0){const B=d.paint.get(D);z.expression=B.value,z.updatePaintArray(A.start,A.end,M,n[w],m,g),v=!0}}}}return v}defines(){const n=[];for(const a in this.binders){const u=this.binders[a];(u instanceof wf||u instanceof Qu)&&n.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return n}getBinderAttributes(){const n=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof ha||u instanceof Js||u instanceof Ya)for(let d=0;d<u.paintVertexAttributes.length;d++)n.push(u.paintVertexAttributes[d].name)}return n}getBinderUniforms(){const n=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof wf||u instanceof Qu||u instanceof Js)for(const d of u.uniformNames)n.push(d)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,a){const u=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof wf||m instanceof Qu||m instanceof Js){for(const g of m.uniformNames)if(a[g]){const v=m.getBinding(n,a[g],g);u.push({name:g,property:d,binding:v})}}}return u}setUniforms(n,a,u,d){for(const{name:m,property:g,binding:v}of a)this.binders[g].setUniform(v,d,u.get(g),m)}updatePaintBuffers(n){this._buffers=[];for(const a in this.binders){const u=this.binders[a];if(n&&u instanceof Ya){const d=n.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(u instanceof ha||u instanceof Js)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}}upload(n){for(const a in this.binders){const u=this.binders[a];(u instanceof ha||u instanceof Js||u instanceof Ya)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const a=this.binders[n];(a instanceof ha||a instanceof Js||a instanceof Ya)&&a.destroy()}}}class hc{constructor(n,a,u=()=>!0){this.programConfigurations={};for(const d of n)this.programConfigurations[d.id]=new Ja(d,a,u);this.needsUpload=!1,this._featureMap=new L_,this._bufferOffset=0}populatePaintArrays(n,a,u,d,m,g,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(n,a,d,m,g,v);a.id!==void 0&&this._featureMap.add(a.id,u,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,a,u,d,m){for(const g of u)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(n,this._featureMap,a,g,d,m)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const qO={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function WO(o,n){return qO[o]||[o.replace(`${n}-`,"").replace(/-/g,"_")]}const HO={"line-pattern":{source:ye,composite:ye},"fill-pattern":{source:ye,composite:ye},"fill-extrusion-pattern":{source:ye,composite:ye},"line-dasharray":{source:Te,composite:Te}},KO={color:{source:nn,composite:ae},number:{source:ft,composite:nn}};function HE(o,n,a){const u=HO[o];return u&&u[a]||KO[n][a]}at(wf,"ConstantBinder"),at(Qu,"CrossFadedConstantBinder"),at(ha,"SourceExpressionBinder"),at(Ya,"CrossFadedCompositeBinder"),at(Js,"CompositeExpressionBinder"),at(Ja,"ProgramConfiguration",{omit:["_buffers"]}),at(hc,"ProgramConfigurationSet");const N_="-transition";class Qs extends Lt{constructor(n,a){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,n.type!=="custom"&&(this.metadata=(n=n).metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),a.layout&&(this._unevaluatedLayout=new _(a.layout)),a.paint)){this._transitionablePaint=new p(a.paint);for(const u in n.paint)this.setPaintProperty(u,n.paint[u],{validate:!1});for(const u in n.layout)this.setLayoutProperty(u,n.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new b(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,a,u={}){a!=null&&this._validate(lx,`layers.${this.id}.layout.${n}`,n,a,u)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,a):this.visibility=a)}getPaintProperty(n){return Qt(n,N_)?this._transitionablePaint.getTransition(n.slice(0,-N_.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,a,u={}){if(a!=null&&this._validate(ax,`layers.${this.id}.paint.${n}`,n,a,u))return!1;if(Qt(n,N_))return this._transitionablePaint.setTransition(n.slice(0,-N_.length),a||void 0),!1;{const d=this._transitionablePaint._values[n],m=d.property.specification["property-type"]==="cross-faded-data-driven",g=d.value.isDataDriven(),v=d.value;this._transitionablePaint.setValue(n,a),this._handleSpecialPaintPropertyUpdate(n);const w=this._transitionablePaint._values[n].value;return w.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(n,v,w)}}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getProgramConfiguration(n){return null}_handleOverridablePaintPropertyUpdate(n,a,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,a){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,a)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Bn(n,(a,u)=>!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length))}_validate(n,a,u,d,m={}){return(!m||m.validate!==!1)&&__(this,n.call(ic,{key:a,layerType:this.type,objectKey:u,value:d,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const a=this.paint.get(n);if(a instanceof x&&$a(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=vo(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const ZO=ie([{name:"a_pos",components:2,type:"Int16"}],4),XO=ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class hn{constructor(n=[]){this.segments=n}prepareSegment(n,a,u,d){let m=this.segments[this.segments.length-1];return n>hn.MAX_VERTEX_ARRAY_LENGTH&&Kt(`Max vertices per segment is ${hn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!m||m.vertexLength+n>hn.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const n of this.segments)for(const a in n.vaos)n.vaos[a].destroy()}static simpleSegment(n,a,u,d){return new hn([{vertexOffset:n,primitiveOffset:a,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}hn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,at(hn,"SegmentVector");var $t=8192;class Qa{constructor(n,a){n&&(a?this.setSouthWest(n).setNorthEast(a):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof Fi?new Fi(n.lng,n.lat):Fi.convert(n),this}setSouthWest(n){return this._sw=n instanceof Fi?new Fi(n.lng,n.lat):Fi.convert(n),this}extend(n){const a=this._sw,u=this._ne;let d,m;if(n instanceof Fi)d=n,m=n;else{if(!(n instanceof Qa))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Qa.convert(n)):this.extend(Fi.convert(n)):this;if(d=n._sw,m=n._ne,!d||!m)return this}return a||u?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new Fi(d.lng,d.lat),this._ne=new Fi(m.lng,m.lat)),this}getCenter(){return new Fi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Fi(this.getWest(),this.getNorth())}getSouthEast(){return new Fi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:a,lat:u}=Fi.convert(n);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(n){return!n||n instanceof Qa?n:new Qa(n)}}const px=63710088e-1;class Fi{constructor(n,a){if(isNaN(n)||isNaN(a))throw new Error(`Invalid LngLat object: (${n}, ${a})`);if(this.lng=+n,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Fi(hi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const a=Math.PI/180,u=this.lat*a,d=n.lat*a,m=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((n.lng-this.lng)*a);return px*Math.acos(Math.min(m,1))}toBounds(n=0){const a=360*n/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new Qa(new Fi(this.lng-u,this.lat-a),new Fi(this.lng+u,this.lat+a))}static convert(n){if(n instanceof Fi)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Fi(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Fi(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const KE=2*Math.PI*px;function mx(o){return KE*Math.cos(o*Math.PI/180)}function Ef(o){return(180+o)/360}function eh(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function th(o,n){return o/mx(n)}function ks(o){return 360*o-180}function Wn(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function ZE(o,n){return o*mx(Wn(n))}const Io=85.051129;class F_{constructor(n,a,u=0){this.x=+n,this.y=+a,this.z=+u}static fromLngLat(n,a=0){const u=Fi.convert(n);return new F_(Ef(u.lng),eh(u.lat),th(a,u.lat))}toLngLat(){return new Fi(ks(this.x),Wn(this.y))}toAltitude(){return ZE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/KE*(n=Wn(this.y),1/Math.cos(n*Math.PI/180));var n}}function _x(o,n,a,u,d,m,g,v,w){const T=(n+u)/2,A=(a+d)/2,M=new R(T,A);v(M),function(D,z,B,j,W,X){const oe=B-W,ce=j-X;return Math.abs((j-z)*oe-(B-D)*ce)/Math.hypot(oe,ce)}(M.x,M.y,m.x,m.y,g.x,g.y)>=w?(_x(o,n,a,T,A,m,M,v,w),_x(o,T,A,u,d,M,g,v,w)):o.push(g)}function YO(o,n,a){let u=o[0],d=u.x,m=u.y;n(u);const g=[u];for(let v=1;v<o.length;v++){const w=o[v],{x:T,y:A}=w;n(w),_x(g,d,m,T,A,u,w,n,a),d=T,m=A,u=w}return g}const gx=Math.pow(2,14)-1,XE=-gx-1;function JO(o,n){const a=Math.round(o.x*n),u=Math.round(o.y*n);return o.x=rt(a,XE,gx),o.y=rt(u,XE,gx),(a<o.x||a>o.x+1||u<o.y||u>o.y+1)&&Kt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function da(o,n,a){const u=o.loadGeometry(),d=o.extent,m=$t/d;if(n&&a&&a.projection.isReprojectedInTileSpace){const g=1<<n.z,{scale:v,x:w,y:T,projection:A}=a,M=D=>{const z=ks((n.x+D.x/d)/g),B=Wn((n.y+D.y/d)/g),j=A.project(z,B);D.x=(j.x*v-w)*d,D.y=(j.y*v-T)*d};for(let D=0;D<u.length;D++)if(o.type!==1)u[D]=YO(u[D],M,1);else{const z=[];for(const B of u[D])B.x<0||B.x>=d||B.y<0||B.y>=d||(M(B),z.push(B));u[D]=z}}for(const g of u)for(const v of g)JO(v,m);return u}function dc(o,n){return{type:o.type,id:o.id,properties:o.properties,geometry:n?da(o):[]}}function B_(o,n,a,u,d){o.emplaceBack(2*n+(u+1)/2,2*a+(d+1)/2)}function U_(o,n,a,u){o.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384,u)}class yx{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new ee,this.indexArray=new ht,this.segments=new hn,this.programConfigurations=new hc(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,u,d){const m=this.layers[0],g=[];let v=null;m.type==="circle"&&(v=m.layout.get("circle-sort-key"));for(const{feature:T,id:A,index:M,sourceLayerIndex:D}of n){const z=this.layers[0]._featureFilter.needGeometry,B=dc(T,z);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),B,u))continue;const j=v?v.evaluate(B,{},u):void 0,W={id:A,properties:T.properties,type:T.type,sourceLayerIndex:D,index:M,geometry:z?B.geometry:da(T,u,d),patterns:{},sortKey:j};g.push(W)}v&&g.sort((T,A)=>T.sortKey-A.sortKey);let w=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new ca,w=d.projection);for(const T of g){const{geometry:A,index:M,sourceLayerIndex:D}=T,z=n[M].feature;this.addFeature(T,A,M,a.availableImages,u,w),a.featureIndex.insert(z,A,M,D,this.index)}}update(n,a,u,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ZO.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,XO.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,a,u,d,m,g){for(const v of a)for(const w of v){const T=w.x,A=w.y;if(T<0||T>=$t||A<0||A>=$t)continue;if(g){const z=g.projectTilePoint(T,A,m),B=g.upVector(m,T,A),j=Wn((A/$t+m.y)/(1<<m.z)),W=g.pixelsPerMeter(j,1)/th(1,j),X=this.globeExtVertexArray;U_(X,z,B,W),U_(X,z,B,W),U_(X,z,B,W),U_(X,z,B,W)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),D=M.vertexLength;B_(this.layoutVertexArray,T,A,-1,-1),B_(this.layoutVertexArray,T,A,1,-1),B_(this.layoutVertexArray,T,A,1,1),B_(this.layoutVertexArray,T,A,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},d,m)}}function YE(o,n){for(let a=0;a<o.length;a++)if(ih(n,o[a]))return!0;for(let a=0;a<n.length;a++)if(ih(o,n[a]))return!0;return!!vx(o,n)}function QO(o,n,a){return!!ih(o,n)||!!xx(n,o,a)}function JE(o,n){if(o.length===1)return eT(n,o[0]);for(let a=0;a<n.length;a++){const u=n[a];for(let d=0;d<u.length;d++)if(ih(o,u[d]))return!0}for(let a=0;a<o.length;a++)if(eT(n,o[a]))return!0;for(let a=0;a<n.length;a++)if(vx(o,n[a]))return!0;return!1}function ez(o,n,a){if(o.length>1){if(vx(o,n))return!0;for(let u=0;u<n.length;u++)if(xx(n[u],o,a))return!0}for(let u=0;u<o.length;u++)if(xx(o[u],n,a))return!0;return!1}function vx(o,n){if(o.length===0||n.length===0)return!1;for(let a=0;a<o.length-1;a++){const u=o[a],d=o[a+1];for(let m=0;m<n.length-1;m++)if(tz(u,d,n[m],n[m+1]))return!0}return!1}function tz(o,n,a,u){return Yi(o,a,u)!==Yi(n,a,u)&&Yi(o,n,a)!==Yi(o,n,u)}function xx(o,n,a){const u=a*a;if(n.length===1)return o.distSqr(n[0])<u;for(let d=1;d<n.length;d++)if(QE(o,n[d-1],n[d])<u)return!0;return!1}function QE(o,n,a){const u=n.distSqr(a);if(u===0)return o.distSqr(n);const d=((o.x-n.x)*(a.x-n.x)+(o.y-n.y)*(a.y-n.y))/u;return o.distSqr(d<0?n:d>1?a:a.sub(n)._mult(d)._add(n))}function eT(o,n){let a,u,d,m=!1;for(let g=0;g<o.length;g++){a=o[g];for(let v=0,w=a.length-1;v<a.length;w=v++)u=a[v],d=a[w],u.y>n.y!=d.y>n.y&&n.x<(d.x-u.x)*(n.y-u.y)/(d.y-u.y)+u.x&&(m=!m)}return m}function ih(o,n){let a=!1;for(let u=0,d=o.length-1;u<o.length;d=u++){const m=o[u],g=o[d];m.y>n.y!=g.y>n.y&&n.x<(g.x-m.x)*(n.y-m.y)/(g.y-m.y)+m.x&&(a=!a)}return a}function tT(o,n,a,u,d){for(const g of o)if(n<=g.x&&a<=g.y&&u>=g.x&&d>=g.y)return!0;const m=[new R(n,a),new R(n,d),new R(u,d),new R(u,a)];if(o.length>2){for(const g of m)if(ih(o,g))return!0}for(let g=0;g<o.length-1;g++)if(iz(o[g],o[g+1],m))return!0;return!1}function iz(o,n,a){const u=a[0],d=a[2];if(o.x<u.x&&n.x<u.x||o.x>d.x&&n.x>d.x||o.y<u.y&&n.y<u.y||o.y>d.y&&n.y>d.y)return!1;const m=Yi(o,n,a[0]);return m!==Yi(o,n,a[1])||m!==Yi(o,n,a[2])||m!==Yi(o,n,a[3])}function nh(o,n,a){const u=n.paint.get(o).value;return u.kind==="constant"?u.value:a.programConfigurations.get(n.id).getMaxValue(o)}function V_(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function iT(o,n,a,u,d){if(!n[0]&&!n[1])return o;const m=R.convert(n)._mult(d);a==="viewport"&&m._rotate(-u);const g=[];for(let v=0;v<o.length;v++)g.push(o[v].sub(m));return g}function nT(o,n,a,u){const d=R.convert(o)._mult(u);return n==="viewport"&&d._rotate(-a),d}at(yx,"CircleBucket",{omit:["layers"]});const nz=new F({"circle-sort-key":new S(be.layout_circle["circle-sort-key"])});var rz={paint:new F({"circle-radius":new S(be.paint_circle["circle-radius"]),"circle-color":new S(be.paint_circle["circle-color"]),"circle-blur":new S(be.paint_circle["circle-blur"]),"circle-opacity":new S(be.paint_circle["circle-opacity"]),"circle-translate":new E(be.paint_circle["circle-translate"]),"circle-translate-anchor":new E(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new E(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new E(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new S(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new S(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new S(be.paint_circle["circle-stroke-opacity"])}),layout:nz},bx=1e-6,Zr=typeof Float32Array!="undefined"?Float32Array:Array;function rT(){var o=new Zr(9);return Zr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function So(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function wx(o,n,a){var u=n[0],d=n[1],m=n[2],g=n[3],v=n[4],w=n[5],T=n[6],A=n[7],M=n[8],D=n[9],z=n[10],B=n[11],j=n[12],W=n[13],X=n[14],oe=n[15],ce=a[0],he=a[1],de=a[2],fe=a[3];return o[0]=ce*u+he*v+de*M+fe*j,o[1]=ce*d+he*w+de*D+fe*W,o[2]=ce*m+he*T+de*z+fe*X,o[3]=ce*g+he*A+de*B+fe*oe,o[4]=(ce=a[4])*u+(he=a[5])*v+(de=a[6])*M+(fe=a[7])*j,o[5]=ce*d+he*w+de*D+fe*W,o[6]=ce*m+he*T+de*z+fe*X,o[7]=ce*g+he*A+de*B+fe*oe,o[8]=(ce=a[8])*u+(he=a[9])*v+(de=a[10])*M+(fe=a[11])*j,o[9]=ce*d+he*w+de*D+fe*W,o[10]=ce*m+he*T+de*z+fe*X,o[11]=ce*g+he*A+de*B+fe*oe,o[12]=(ce=a[12])*u+(he=a[13])*v+(de=a[14])*M+(fe=a[15])*j,o[13]=ce*d+he*w+de*D+fe*W,o[14]=ce*m+he*T+de*z+fe*X,o[15]=ce*g+he*A+de*B+fe*oe,o}function fc(o,n,a){var u,d,m,g,v,w,T,A,M,D,z,B,j=a[0],W=a[1],X=a[2];return n===o?(o[12]=n[0]*j+n[4]*W+n[8]*X+n[12],o[13]=n[1]*j+n[5]*W+n[9]*X+n[13],o[14]=n[2]*j+n[6]*W+n[10]*X+n[14],o[15]=n[3]*j+n[7]*W+n[11]*X+n[15]):(d=n[1],m=n[2],g=n[3],v=n[4],w=n[5],T=n[6],A=n[7],M=n[8],D=n[9],z=n[10],B=n[11],o[0]=u=n[0],o[1]=d,o[2]=m,o[3]=g,o[4]=v,o[5]=w,o[6]=T,o[7]=A,o[8]=M,o[9]=D,o[10]=z,o[11]=B,o[12]=u*j+v*W+M*X+n[12],o[13]=d*j+w*W+D*X+n[13],o[14]=m*j+T*W+z*X+n[14],o[15]=g*j+A*W+B*X+n[15]),o}function el(o,n,a){var u=a[0],d=a[1],m=a[2];return o[0]=n[0]*u,o[1]=n[1]*u,o[2]=n[2]*u,o[3]=n[3]*u,o[4]=n[4]*d,o[5]=n[5]*d,o[6]=n[6]*d,o[7]=n[7]*d,o[8]=n[8]*m,o[9]=n[9]*m,o[10]=n[10]*m,o[11]=n[11]*m,o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o}function Ex(o,n,a){var u=Math.sin(a),d=Math.cos(a),m=n[4],g=n[5],v=n[6],w=n[7],T=n[8],A=n[9],M=n[10],D=n[11];return n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[4]=m*d+T*u,o[5]=g*d+A*u,o[6]=v*d+M*u,o[7]=w*d+D*u,o[8]=T*d-m*u,o[9]=A*d-g*u,o[10]=M*d-v*u,o[11]=D*d-w*u,o}function Tx(o,n,a){var u=Math.sin(a),d=Math.cos(a),m=n[0],g=n[1],v=n[2],w=n[3],T=n[8],A=n[9],M=n[10],D=n[11];return n!==o&&(o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=m*d-T*u,o[1]=g*d-A*u,o[2]=v*d-M*u,o[3]=w*d-D*u,o[8]=m*u+T*d,o[9]=g*u+A*d,o[10]=v*u+M*d,o[11]=w*u+D*d,o}Math.hypot||(Math.hypot=function(){for(var o=0,n=arguments.length;n--;)o+=arguments[n]*arguments[n];return Math.sqrt(o)});var sz=wx;function Ix(){var o=new Zr(3);return Zr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function sT(o){var n=new Zr(3);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n}function oT(o){return Math.hypot(o[0],o[1],o[2])}function Tf(o,n,a){var u=new Zr(3);return u[0]=o,u[1]=n,u[2]=a,u}function aT(o,n,a){return o[0]=n[0]+a[0],o[1]=n[1]+a[1],o[2]=n[2]+a[2],o}function lT(o,n,a){return o[0]=n[0]-a[0],o[1]=n[1]-a[1],o[2]=n[2]-a[2],o}function cT(o,n,a){return o[0]=n[0]*a[0],o[1]=n[1]*a[1],o[2]=n[2]*a[2],o}function Sx(o,n,a){return o[0]=Math.min(n[0],a[0]),o[1]=Math.min(n[1],a[1]),o[2]=Math.min(n[2],a[2]),o}function Ax(o,n,a){return o[0]=Math.max(n[0],a[0]),o[1]=Math.max(n[1],a[1]),o[2]=Math.max(n[2],a[2]),o}function If(o,n,a){return o[0]=n[0]*a,o[1]=n[1]*a,o[2]=n[2]*a,o}function Cx(o,n,a,u){return o[0]=n[0]+a[0]*u,o[1]=n[1]+a[1]*u,o[2]=n[2]+a[2]*u,o}function Sf(o,n){var a=n[0],u=n[1],d=n[2],m=a*a+u*u+d*d;return m>0&&(m=1/Math.sqrt(m)),o[0]=n[0]*m,o[1]=n[1]*m,o[2]=n[2]*m,o}function Af(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]}function uT(o,n,a){var u=n[0],d=n[1],m=n[2],g=a[0],v=a[1],w=a[2];return o[0]=d*w-m*v,o[1]=m*g-u*w,o[2]=u*v-d*g,o}function pc(o,n,a){var u=n[0],d=n[1],m=n[2],g=a[3]*u+a[7]*d+a[11]*m+a[15];return o[0]=(a[0]*u+a[4]*d+a[8]*m+a[12])/(g=g||1),o[1]=(a[1]*u+a[5]*d+a[9]*m+a[13])/g,o[2]=(a[2]*u+a[6]*d+a[10]*m+a[14])/g,o}function hT(o,n,a){var u=a[0],d=a[1],m=a[2],g=n[0],v=n[1],w=n[2],T=d*w-m*v,A=m*g-u*w,M=u*v-d*g,D=d*M-m*A,z=m*T-u*M,B=u*A-d*T,j=2*a[3];return A*=j,M*=j,z*=2,B*=2,o[0]=g+(T*=j)+(D*=2),o[1]=v+A+z,o[2]=w+M+B,o}var Cf,rh=lT,oz=cT,az=oT;function sh(o,n,a){var u=n[0],d=n[1],m=n[2],g=n[3];return o[0]=a[0]*u+a[4]*d+a[8]*m+a[12]*g,o[1]=a[1]*u+a[5]*d+a[9]*m+a[13]*g,o[2]=a[2]*u+a[6]*d+a[10]*m+a[14]*g,o[3]=a[3]*u+a[7]*d+a[11]*m+a[15]*g,o}function dT(){var o=new Zr(4);return Zr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function fT(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function pT(o,n,a){a*=.5;var u=n[0],d=n[1],m=n[2],g=n[3],v=Math.sin(a),w=Math.cos(a);return o[0]=u*w+g*v,o[1]=d*w+m*v,o[2]=m*w-d*v,o[3]=g*w-u*v,o}Ix(),Cf=new Zr(4),Zr!=Float32Array&&(Cf[0]=0,Cf[1]=0,Cf[2]=0,Cf[3]=0),Ix(),Tf(1,0,0),Tf(0,1,0),dT(),dT(),rT();class Mx{constructor(n,a){this.points=n,this.planes=a}static fromInvProjectionMatrix(n,a,u,d){const m=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const T=sh([],w,n),A=1/T[3]/a*m;return function(M,D,z){return M[0]=D[0]*z[0],M[1]=D[1]*z[1],M[2]=D[2]*z[2],M[3]=D[3]*z[3],M}(T,T,[A,A,d?1/T[3]:A,A])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const T=Sf([],uT([],rh([],g[w[0]],g[w[1]]),rh([],g[w[2]],g[w[1]]))),A=-Af(T,g[w[1]]);return T.concat(A)});return new Mx(g,v)}}class ms{constructor(n,a){this.min=n,this.max=a,this.center=If([],aT([],this.min,this.max),.5)}quadrant(n){const a=[n%2==0,n<2],u=sT(this.min),d=sT(this.max);for(let m=0;m<a.length;m++)u[m]=a[m]?this.min[m]:this.center[m],d[m]=a[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new ms(u,d)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,a=this.max;return[[n[0],n[1],n[2]],[a[0],n[1],n[2]],[a[0],a[1],n[2]],[n[0],a[1],n[2]],[n[0],n[1],a[2]],[a[0],n[1],a[2]],[a[0],a[1],a[2]],[n[0],a[1],a[2]]]}intersects(n){const a=this.getCorners();let u=!0;for(let d=0;d<n.planes.length;d++){const m=n.planes[d];let g=0;for(let v=0;v<a.length;v++)g+=Af(m,a[v])+m[3]>=0;if(g===0)return 0;g!==a.length&&(u=!1)}if(u)return 2;for(let d=0;d<3;d++){let m=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let v=0;v<n.points.length;v++){const w=n.points[v][d]-this.min[d];m=Math.min(m,w),g=Math.max(g,w)}if(g<0||m>this.max[d]-this.min[d])return 0}return 1}}function mT(o,n,a,u,d,m,g,v,w){if(m&&o.queryGeometry.isAboveHorizon)return!1;m&&(w*=o.pixelToTileUnitsFactor);for(const T of n)for(const A of T){const M=A.add(v),D=d&&a.elevation?a.elevation.exaggeration()*d.getElevationAt(M.x,M.y,!0):0,z=m?M:lz(M,D,u),B=m?o.tilespaceRays.map(W=>uz(W,D)):o.queryGeometry.screenGeometry,j=sh([],[A.x,A.y,D,1],u);if(!g&&m?w*=j[3]/a.cameraToCenterDistance:g&&!m&&(w*=a.cameraToCenterDistance/j[3]),QO(B,z,w))return!0}return!1}function lz(o,n,a){const u=sh([],[o.x,o.y,n,1],a);return new R(u[0]/u[3],u[1]/u[3])}const _T=Tf(0,0,0),cz=Tf(0,0,1);function uz(o,n){const a=Ix();return _T[2]=n,o.intersectsPlane(_T,cz,a),new R(a[0],a[1])}class gT extends yx{}function yT(o,{width:n,height:a},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==n*a*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(n*a*u);return o.width=n,o.height=a,o.data=d,o}function vT(o,n,a){const{width:u,height:d}=n;u===o.width&&d===o.height||(kx(o,n,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,u),height:Math.min(o.height,d)},a),o.width=u,o.height=d,o.data=n.data)}function kx(o,n,a,u,d,m){if(d.width===0||d.height===0)return n;if(d.width>o.width||d.height>o.height||a.x>o.width-d.width||a.y>o.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>n.width||d.height>n.height||u.x>n.width-d.width||u.y>n.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const g=o.data,v=n.data;for(let w=0;w<d.height;w++){const T=((a.y+w)*o.width+a.x)*m,A=((u.y+w)*n.width+u.x)*m;for(let M=0;M<d.width*m;M++)v[A+M]=g[T+M]}return n}at(gT,"HeatmapBucket",{omit:["layers"]});class fa{constructor(n,a){yT(this,n,1,a)}resize(n){vT(this,new fa(n),1)}clone(){return new fa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,u,d,m){kx(n,a,u,d,m,1)}}class Xr{constructor(n,a){yT(this,n,4,a)}resize(n){vT(this,new Xr(n),4)}replace(n,a){a?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Xr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,u,d,m){kx(n,a,u,d,m,4)}}at(fa,"AlphaImage"),at(Xr,"RGBAImage");var hz={paint:new F({"heatmap-radius":new S(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new S(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new E(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new O(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new E(be.paint_heatmap["heatmap-opacity"])})};function Dx(o){const n={},a=o.resolution||256,u=o.clips?o.clips.length:1,d=o.image||new Xr({width:a,height:u}),m=(g,v,w)=>{n[o.evaluationKey]=w;const T=o.expression.evaluate(n);d.data[g+v+0]=Math.floor(255*T.r/T.a),d.data[g+v+1]=Math.floor(255*T.g/T.a),d.data[g+v+2]=Math.floor(255*T.b/T.a),d.data[g+v+3]=Math.floor(255*T.a)};if(o.clips)for(let g=0,v=0;g<u;++g,v+=4*a)for(let w=0,T=0;w<a;w++,T+=4){const A=w/(a-1),{start:M,end:D}=o.clips[g];m(v,T,M*(1-A)+D*A)}else for(let g=0,v=0;g<a;g++,v+=4)m(0,v,g/(a-1));return d}var dz={paint:new F({"hillshade-illumination-direction":new E(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new E(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new E(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new E(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new E(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new E(be.paint_hillshade["hillshade-accent-color"])})};const fz=ie([{name:"a_pos",components:2,type:"Int16"}],4),{members:pz}=fz;var $_=j_,mz=j_;function j_(o,n,a){a=a||2;var u,d,m,g,v,w,T,A=n&&n.length,M=A?n[0]*a:o.length,D=xT(o,0,M,a,!0),z=[];if(!D||D.next===D.prev)return z;if(A&&(D=function(j,W,X,oe){var ce,he,de,fe=[];for(ce=0,he=W.length;ce<he;ce++)(de=xT(j,W[ce]*oe,ce<he-1?W[ce+1]*oe:j.length,oe,!1))===de.next&&(de.steiner=!0),fe.push(Ez(de));for(fe.sort(xz),ce=0;ce<fe.length;ce++)X=tl(X=bz(fe[ce],X),X.next);return X}(o,n,D,a)),o.length>80*a){u=m=o[0],d=g=o[1];for(var B=a;B<M;B+=a)(v=o[B])<u&&(u=v),(w=o[B+1])<d&&(d=w),v>m&&(m=v),w>g&&(g=w);T=(T=Math.max(m-u,g-d))!==0?1/T:0}return Mf(D,z,a,u,d,T),z}function xT(o,n,a,u,d){var m,g;if(d===Lx(o,n,a,u)>0)for(m=n;m<a;m+=u)g=ET(m,o[m],o[m+1],g);else for(m=a-u;m>=n;m-=u)g=ET(m,o[m],o[m+1],g);return g&&G_(g,g.next)&&(Df(g),g=g.next),g}function tl(o,n){if(!o)return o;n||(n=o);var a,u=o;do if(a=!1,u.steiner||!G_(u,u.next)&&wn(u.prev,u,u.next)!==0)u=u.next;else{if(Df(u),(u=n=u.prev)===u.next)break;a=!0}while(a||u!==n);return n}function Mf(o,n,a,u,d,m,g){if(o){!g&&m&&function(A,M,D,z){var B=A;do B.z===null&&(B.z=Px(B.x,B.y,M,D,z)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function(j){var W,X,oe,ce,he,de,fe,Se,Ce=1;do{for(X=j,j=null,he=null,de=0;X;){for(de++,oe=X,fe=0,W=0;W<Ce&&(fe++,oe=oe.nextZ);W++);for(Se=Ce;fe>0||Se>0&&oe;)fe!==0&&(Se===0||!oe||X.z<=oe.z)?(ce=X,X=X.nextZ,fe--):(ce=oe,oe=oe.nextZ,Se--),he?he.nextZ=ce:j=ce,ce.prevZ=he,he=ce;X=oe}he.nextZ=null,Ce*=2}while(de>1)}(B)}(o,u,d,m);for(var v,w,T=o;o.prev!==o.next;)if(v=o.prev,w=o.next,m?gz(o,u,d,m):_z(o))n.push(v.i/a),n.push(o.i/a),n.push(w.i/a),Df(o),o=w.next,T=w.next;else if((o=w)===T){g?g===1?Mf(o=yz(tl(o),n,a),n,a,u,d,m,2):g===2&&vz(o,n,a,u,d,m):Mf(tl(o),n,a,u,d,m,1);break}}}function _z(o){var n=o.prev,a=o,u=o.next;if(wn(n,a,u)>=0)return!1;for(var d=o.next.next;d!==o.prev;){if(oh(n.x,n.y,a.x,a.y,u.x,u.y,d.x,d.y)&&wn(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function gz(o,n,a,u){var d=o.prev,m=o,g=o.next;if(wn(d,m,g)>=0)return!1;for(var v=d.x>m.x?d.x>g.x?d.x:g.x:m.x>g.x?m.x:g.x,w=d.y>m.y?d.y>g.y?d.y:g.y:m.y>g.y?m.y:g.y,T=Px(d.x<m.x?d.x<g.x?d.x:g.x:m.x<g.x?m.x:g.x,d.y<m.y?d.y<g.y?d.y:g.y:m.y<g.y?m.y:g.y,n,a,u),A=Px(v,w,n,a,u),M=o.prevZ,D=o.nextZ;M&&M.z>=T&&D&&D.z<=A;){if(M!==o.prev&&M!==o.next&&oh(d.x,d.y,m.x,m.y,g.x,g.y,M.x,M.y)&&wn(M.prev,M,M.next)>=0||(M=M.prevZ,D!==o.prev&&D!==o.next&&oh(d.x,d.y,m.x,m.y,g.x,g.y,D.x,D.y)&&wn(D.prev,D,D.next)>=0))return!1;D=D.nextZ}for(;M&&M.z>=T;){if(M!==o.prev&&M!==o.next&&oh(d.x,d.y,m.x,m.y,g.x,g.y,M.x,M.y)&&wn(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;D&&D.z<=A;){if(D!==o.prev&&D!==o.next&&oh(d.x,d.y,m.x,m.y,g.x,g.y,D.x,D.y)&&wn(D.prev,D,D.next)>=0)return!1;D=D.nextZ}return!0}function yz(o,n,a){var u=o;do{var d=u.prev,m=u.next.next;!G_(d,m)&&bT(d,u,u.next,m)&&kf(d,m)&&kf(m,d)&&(n.push(d.i/a),n.push(u.i/a),n.push(m.i/a),Df(u),Df(u.next),u=o=m),u=u.next}while(u!==o);return tl(u)}function vz(o,n,a,u,d,m){var g=o;do{for(var v=g.next.next;v!==g.prev;){if(g.i!==v.i&&Tz(g,v)){var w=wT(g,v);return g=tl(g,g.next),w=tl(w,w.next),Mf(g,n,a,u,d,m),void Mf(w,n,a,u,d,m)}v=v.next}g=g.next}while(g!==o)}function xz(o,n){return o.x-n.x}function bz(o,n){var a=function(m,g){var v,w=g,T=m.x,A=m.y,M=-1/0;do{if(A<=w.y&&A>=w.next.y&&w.next.y!==w.y){var D=w.x+(A-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(D<=T&&D>M){if(M=D,D===T){if(A===w.y)return w;if(A===w.next.y)return w.next}v=w.x<w.next.x?w:w.next}}w=w.next}while(w!==g);if(!v)return null;if(T===M)return v;var z,B=v,j=v.x,W=v.y,X=1/0;w=v;do T>=w.x&&w.x>=j&&T!==w.x&&oh(A<W?T:M,A,j,W,A<W?M:T,A,w.x,w.y)&&(z=Math.abs(A-w.y)/(T-w.x),kf(w,m)&&(z<X||z===X&&(w.x>v.x||w.x===v.x&&wz(v,w)))&&(v=w,X=z)),w=w.next;while(w!==B);return v}(o,n);if(!a)return n;var u=wT(a,o),d=tl(a,a.next);return tl(u,u.next),n===a?d:n}function wz(o,n){return wn(o.prev,o,n.prev)<0&&wn(n.next,o,o.next)<0}function Px(o,n,a,u,d){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-a)*d)|o<<8))|o<<4))|o<<2))|o<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-u)*d)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Ez(o){var n=o,a=o;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==o);return a}function oh(o,n,a,u,d,m,g,v){return(d-g)*(n-v)-(o-g)*(m-v)>=0&&(o-g)*(u-v)-(a-g)*(n-v)>=0&&(a-g)*(m-v)-(d-g)*(u-v)>=0}function Tz(o,n){return o.next.i!==n.i&&o.prev.i!==n.i&&!function(a,u){var d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==u.i&&d.next.i!==u.i&&bT(d,d.next,a,u))return!0;d=d.next}while(d!==a);return!1}(o,n)&&(kf(o,n)&&kf(n,o)&&function(a,u){var d=a,m=!1,g=(a.x+u.x)/2,v=(a.y+u.y)/2;do d.y>v!=d.next.y>v&&d.next.y!==d.y&&g<(d.next.x-d.x)*(v-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==a);return m}(o,n)&&(wn(o.prev,o,n.prev)||wn(o,n.prev,n))||G_(o,n)&&wn(o.prev,o,o.next)>0&&wn(n.prev,n,n.next)>0)}function wn(o,n,a){return(n.y-o.y)*(a.x-n.x)-(n.x-o.x)*(a.y-n.y)}function G_(o,n){return o.x===n.x&&o.y===n.y}function bT(o,n,a,u){var d=W_(wn(o,n,a)),m=W_(wn(o,n,u)),g=W_(wn(a,u,o)),v=W_(wn(a,u,n));return d!==m&&g!==v||!(d!==0||!q_(o,a,n))||!(m!==0||!q_(o,u,n))||!(g!==0||!q_(a,o,u))||!(v!==0||!q_(a,n,u))}function q_(o,n,a){return n.x<=Math.max(o.x,a.x)&&n.x>=Math.min(o.x,a.x)&&n.y<=Math.max(o.y,a.y)&&n.y>=Math.min(o.y,a.y)}function W_(o){return o>0?1:o<0?-1:0}function kf(o,n){return wn(o.prev,o,o.next)<0?wn(o,n,o.next)>=0&&wn(o,o.prev,n)>=0:wn(o,n,o.prev)<0||wn(o,o.next,n)<0}function wT(o,n){var a=new Rx(o.i,o.x,o.y),u=new Rx(n.i,n.x,n.y),d=o.next,m=n.prev;return o.next=n,n.prev=o,a.next=d,d.prev=a,u.next=a,a.prev=u,m.next=u,u.prev=m,u}function ET(o,n,a,u){var d=new Rx(o,n,a);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function Df(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Rx(o,n,a){this.i=o,this.x=n,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lx(o,n,a,u){for(var d=0,m=n,g=a-u;m<a;m+=u)d+=(o[g]-o[m])*(o[m+1]+o[g+1]),g=m;return d}function Iz(o,n,a,u,d){TT(o,n,a||0,u||o.length-1,d||Sz)}function TT(o,n,a,u,d){for(;u>a;){if(u-a>600){var m=u-a+1,g=n-a+1,v=Math.log(m),w=.5*Math.exp(2*v/3),T=.5*Math.sqrt(v*w*(m-w)/m)*(g-m/2<0?-1:1);TT(o,n,Math.max(a,Math.floor(n-g*w/m+T)),Math.min(u,Math.floor(n+(m-g)*w/m+T)),d)}var A=o[n],M=a,D=u;for(Pf(o,a,n),d(o[u],A)>0&&Pf(o,a,u);M<D;){for(Pf(o,M,D),M++,D--;d(o[M],A)<0;)M++;for(;d(o[D],A)>0;)D--}d(o[a],A)===0?Pf(o,a,D):Pf(o,++D,u),D<=n&&(a=D+1),n<=D&&(u=D-1)}}function Pf(o,n,a){var u=o[n];o[n]=o[a],o[a]=u}function Sz(o,n){return o<n?-1:o>n?1:0}function Ox(o,n){const a=o.length;if(a<=1)return[o];const u=[];let d,m;for(let g=0;g<a;g++){const v=ze(o[g]);v!==0&&(o[g].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(d&&u.push(d),d=[o[g]]):d.push(o[g]))}if(d&&u.push(d),n>1)for(let g=0;g<u.length;g++)u[g].length<=n||(Iz(u[g],n,1,u[g].length-1,Az),u[g]=u[g].slice(0,n));return u}function Az(o,n){return n.area-o.area}function zx(o,n,a){const u=a.patternDependencies;let d=!1;for(const m of n){const g=m.paint.get(`${o}-pattern`);g.isConstant()||(d=!0);const v=g.constantOr(null);v&&(d=!0,u[v.to]=!0,u[v.from]=!0)}return d}function Nx(o,n,a,u,d){const m=d.patternDependencies;for(const g of n){const v=g.paint.get(`${o}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:u-1},a,{},d.availableImages),T=v.evaluate({zoom:u},a,{},d.availableImages),A=v.evaluate({zoom:u+1},a,{},d.availableImages);w=w&&w.name?w.name:w,T=T&&T.name?T.name:T,A=A&&A.name?A.name:A,m[w]=!0,m[T]=!0,m[A]=!0,a.patterns[g.id]={min:w,mid:T,max:A}}}return a}j_.deviation=function(o,n,a,u){var d=n&&n.length,m=Math.abs(Lx(o,0,d?n[0]*a:o.length,a));if(d)for(var g=0,v=n.length;g<v;g++)m-=Math.abs(Lx(o,n[g]*a,g<v-1?n[g+1]*a:o.length,a));var w=0;for(g=0;g<u.length;g+=3){var T=u[g]*a,A=u[g+1]*a,M=u[g+2]*a;w+=Math.abs((o[T]-o[M])*(o[A+1]-o[T+1])-(o[T]-o[A])*(o[M+1]-o[T+1]))}return m===0&&w===0?0:Math.abs((w-m)/m)},j_.flatten=function(o){for(var n=o[0][0].length,a={vertices:[],holes:[],dimensions:n},u=0,d=0;d<o.length;d++){for(var m=0;m<o[d].length;m++)for(var g=0;g<n;g++)a.vertices.push(o[d][m][g]);d>0&&a.holes.push(u+=o[d-1].length)}return a},$_.default=mz;class H_{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ee,this.indexArray=new ht,this.indexArray2=new Ot,this.programConfigurations=new hc(n.layers,n.zoom),this.segments=new hn,this.segments2=new hn,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=n.projection}populate(n,a,u,d){this.hasPattern=zx("fill",this.layers,a);const m=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:v,id:w,index:T,sourceLayerIndex:A}of n){const M=this.layers[0]._featureFilter.needGeometry,D=dc(v,M);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),D,u))continue;const z=m?m.evaluate(D,{},u,a.availableImages):void 0,B={id:w,properties:v.properties,type:v.type,sourceLayerIndex:A,index:T,geometry:M?D.geometry:da(v,u,d),patterns:{},sortKey:z};g.push(B)}m&&g.sort((v,w)=>v.sortKey-w.sortKey);for(const v of g){const{geometry:w,index:T,sourceLayerIndex:A}=v;if(this.hasPattern){const M=Nx("fill",this.layers,v,this.zoom,a);this.patternFeatures.push(M)}else this.addFeature(v,w,T,u,{},a.availableImages);a.featureIndex.insert(n[T].feature,w,T,A,this.index)}}update(n,a,u,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,u,d)}addFeatures(n,a,u,d,m){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,pz),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,a,u,d,m,g=[]){for(const v of Ox(a,500)){let w=0;for(const B of v)w+=B.length;const T=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),A=T.vertexLength,M=[],D=[];for(const B of v){if(B.length===0)continue;B!==v[0]&&D.push(M.length/2);const j=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),W=j.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(W+B.length-1,W),M.push(B[0].x),M.push(B[0].y);for(let X=1;X<B.length;X++)this.layoutVertexArray.emplaceBack(B[X].x,B[X].y),this.indexArray2.emplaceBack(W+X-1,W+X),M.push(B[X].x),M.push(B[X].y);j.vertexLength+=B.length,j.primitiveLength+=B.length}const z=$_(M,D);for(let B=0;B<z.length;B+=3)this.indexArray.emplaceBack(A+z[B],A+z[B+1],A+z[B+2]);T.vertexLength+=w,T.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,m,g,d)}}at(H_,"FillBucket",{omit:["layers","patternFeatures"]});const Cz=new F({"fill-sort-key":new S(be.layout_fill["fill-sort-key"])});var Mz={paint:new F({"fill-antialias":new E(be.paint_fill["fill-antialias"]),"fill-opacity":new S(be.paint_fill["fill-opacity"]),"fill-color":new S(be.paint_fill["fill-color"]),"fill-outline-color":new S(be.paint_fill["fill-outline-color"]),"fill-translate":new E(be.paint_fill["fill-translate"]),"fill-translate-anchor":new E(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new k(be.paint_fill["fill-pattern"])}),layout:Cz};const kz=ie([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Dz=ie([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Pz=ie([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Rz}=kz;var IT=ah;function ah(o,n,a,u,d){this.properties={},this.extent=a,this.type=0,this._pbf=o,this._geometry=-1,this._keys=u,this._values=d,o.readFields(Lz,this,n)}function Lz(o,n,a){o==1?n.id=a.readVarint():o==2?function(u,d){for(var m=u.readVarint()+u.pos;u.pos<m;){var g=d._keys[u.readVarint()],v=d._values[u.readVarint()];d.properties[g]=v}}(a,n):o==3?n.type=a.readVarint():o==4&&(n._geometry=a.pos)}function Oz(o){for(var n,a,u=0,d=0,m=o.length,g=m-1;d<m;g=d++)u+=((a=o[g]).x-(n=o[d]).x)*(n.y+a.y);return u}ah.types=["Unknown","Point","LineString","Polygon"],ah.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var n,a=o.readVarint()+o.pos,u=1,d=0,m=0,g=0,v=[];o.pos<a;){if(d<=0){var w=o.readVarint();u=7&w,d=w>>3}if(d--,u===1||u===2)m+=o.readSVarint(),g+=o.readSVarint(),u===1&&(n&&v.push(n),n=[]),n.push(new R(m,g));else{if(u!==7)throw new Error("unknown command "+u);n&&n.push(n[0].clone())}}return n&&v.push(n),v},ah.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var n=o.readVarint()+o.pos,a=1,u=0,d=0,m=0,g=1/0,v=-1/0,w=1/0,T=-1/0;o.pos<n;){if(u<=0){var A=o.readVarint();a=7&A,u=A>>3}if(u--,a===1||a===2)(d+=o.readSVarint())<g&&(g=d),d>v&&(v=d),(m+=o.readSVarint())<w&&(w=m),m>T&&(T=m);else if(a!==7)throw new Error("unknown command "+a)}return[g,w,v,T]},ah.prototype.toGeoJSON=function(o,n,a){var u,d,m=this.extent*Math.pow(2,a),g=this.extent*o,v=this.extent*n,w=this.loadGeometry(),T=ah.types[this.type];function A(z){for(var B=0;B<z.length;B++){var j=z[B];z[B]=[360*(j.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+v)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(u=0;u<w.length;u++)M[u]=w[u][0];A(w=M);break;case 2:for(u=0;u<w.length;u++)A(w[u]);break;case 3:for(w=function(z){var B=z.length;if(B<=1)return[z];for(var j,W,X=[],oe=0;oe<B;oe++){var ce=Oz(z[oe]);ce!==0&&(W===void 0&&(W=ce<0),W===ce<0?(j&&X.push(j),j=[z[oe]]):j.push(z[oe]))}return j&&X.push(j),X}(w),u=0;u<w.length;u++)for(d=0;d<w[u].length;d++)A(w[u][d])}w.length===1?w=w[0]:T="Multi"+T;var D={type:"Feature",geometry:{type:T,coordinates:w},properties:this.properties};return"id"in this&&(D.id=this.id),D};var ST=AT;function AT(o,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(zz,this,n),this.length=this._features.length}function zz(o,n,a){o===15?n.version=a.readVarint():o===1?n.name=a.readString():o===5?n.extent=a.readVarint():o===2?n._features.push(a.pos):o===3?n._keys.push(a.readString()):o===4&&n._values.push(function(u){for(var d=null,m=u.readVarint()+u.pos;u.pos<m;){var g=u.readVarint()>>3;d=g===1?u.readString():g===2?u.readFloat():g===3?u.readDouble():g===4?u.readVarint64():g===5?u.readVarint():g===6?u.readSVarint():g===7?u.readBoolean():null}return d}(a))}function Nz(o,n,a){if(o===3){var u=new ST(a,a.readVarint()+a.pos);u.length&&(n[u.name]=u)}}AT.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var n=this._pbf.readVarint()+this._pbf.pos;return new IT(this._pbf,n,this.extent,this._keys,this._values)};var mc={VectorTile:function(o,n){this.layers=o.readFields(Nz,{},n)},VectorTileFeature:IT,VectorTileLayer:ST};function K_(o,n,a,u){const d=[],m=u===0?(g,v,w,T,A,M)=>{g.push(new R(M,w+(M-v)/(T-v)*(A-w)))}:(g,v,w,T,A,M)=>{g.push(new R(v+(M-w)/(A-w)*(T-v),M))};for(const g of o){const v=[];for(const w of g){if(w.length<=2)continue;const T=[];for(let D=0;D<w.length-1;D++){const z=w[D].x,B=w[D].y,j=w[D+1].x,W=w[D+1].y,X=u===0?z:B,oe=u===0?j:W;X<n?oe>n&&m(T,z,B,j,W,n):X>a?oe<a&&m(T,z,B,j,W,a):T.push(w[D]),oe<n&&X>=n&&m(T,z,B,j,W,n),oe>a&&X<=a&&m(T,z,B,j,W,a)}let A=w[w.length-1];const M=u===0?A.x:A.y;M>=n&&M<=a&&T.push(A),T.length&&(A=T[T.length-1],T[0].x===A.x&&T[0].y===A.y||T.push(T[0]),v.push(T))}v.length&&d.push(v)}return d}const Fz=mc.VectorTileFeature.types,Bz=Math.pow(2,13);function Rf(o,n,a,u,d,m,g,v){o.emplaceBack((n<<1)+g,(a<<1)+m,(Math.floor(u*Bz)<<1)+d,Math.round(v))}function Lf(o,n,a){o.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384)}class CT{constructor(){this.acc=new R(0,0),this.polyCount=[]}startRing(n){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new R(n.x,n.y),this.max=new R(n.x,n.y))}append(n,a){this.currentPolyCount.edges++,this.acc._add(n);const u=this.min,d=this.max;n.x<u.x?u.x=n.x:n.x>d.x&&(d.x=n.x),n.y<u.y?u.y=n.y:n.y>d.y&&(d.y=n.y),((n.x===0||n.x===$t)&&n.x===a.x)!=((n.y===0||n.y===$t)&&n.y===a.y)&&this.processBorderOverlap(n,a),a.x<0!=n.x<0&&this.addBorderIntersection(0,At(a.y,n.y,(0-a.x)/(n.x-a.x))),a.x>$t!=n.x>$t&&this.addBorderIntersection(1,At(a.y,n.y,($t-a.x)/(n.x-a.x))),a.y<0!=n.y<0&&this.addBorderIntersection(2,At(a.x,n.x,(0-a.y)/(n.y-a.y))),a.y>$t!=n.y>$t&&this.addBorderIntersection(3,At(a.x,n.x,($t-a.y)/(n.y-a.y)))}addBorderIntersection(n,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[n];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(n,a){if(n.x===a.x){if(n.y===a.y)return;const u=n.x===0?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,n.y)}else{const u=n.y===0?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,n.x)}}centroid(){const n=this.polyCount.reduce((a,u)=>a+u.edges,0);return n!==0?this.acc.div(n)._round():new R(0,0)}span(){return new R(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((n,a)=>n+ +(a[0]!==Number.MAX_VALUE),0)}}class Of{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new re,this.centroidVertexArray=new uc,this.indexArray=new ht,this.programConfigurations=new hc(n.layers,n.zoom),this.segments=new hn,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=n.enableTerrain}populate(n,a,u,d){this.features=[],this.hasPattern=zx("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const g=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*g/(g*g+1)/$t/(1<<m.z)}(u);for(const{feature:m,id:g,index:v,sourceLayerIndex:w}of n){const T=this.layers[0]._featureFilter.needGeometry,A=dc(m,T);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),A,u))continue;const M={id:g,sourceLayerIndex:w,index:v,geometry:T?A.geometry:da(m,u,d),properties:m.properties,type:m.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(Nx("fill-extrusion",this.layers,M,this.zoom,a)):this.addFeature(M,M.geometry,v,u,{},a.availableImages,d),a.featureIndex.insert(m,M.geometry,v,w,this.index,D)}this.sortBorders()}addFeatures(n,a,u,d,m){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,a,u,d,m)}this.sortBorders()}update(n,a,u,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Rz),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,Pz.members,!0))),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,Dz.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,u,d,m,g,v){const w=[new R(0,0),new R($t,$t)],T=v.projection,A=T.name==="globe",M=this.enableTerrain&&!A?new CT:null;A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Rr);const D=Ox(a,500);for(let j=D.length-1;j>=0;j--){const W=D[j];(W.length===0||(z=W[0]).every(X=>X.x<=0)||z.every(X=>X.x>=$t)||z.every(X=>X.y<=0)||z.every(X=>X.y>=$t))&&D.splice(j,1)}var z;let B;if(A){const W=1<<d.z,X=ks(d.x/W),oe=ks((d.x+1)/W),ce=Wn(d.y/W),he=Wn((d.y+1)/W);B=function(de,fe,Se,Ce,Le=0,Ne){const Ee=[];if(!de.length||!Se||!Ce)return Ee;const Pe=(Bt,qt)=>{for(const vt of Bt)Ee.push({polygon:vt,bounds:qt})},Ve=Math.ceil(Math.log2(Se)),Ze=Math.ceil(Math.log2(Ce)),Ge=Ve-Ze,Ke=[];for(let Bt=0;Bt<Math.abs(Ge);Bt++)Ke.push(Ge>0?0:1);for(let Bt=0;Bt<Math.min(Ve,Ze);Bt++)Ke.push(0),Ke.push(1);let Nt=de;if(Nt=K_(Nt,fe[0].y-Le,fe[1].y+Le,1),Nt=K_(Nt,fe[0].x-Le,fe[1].x+Le,0),!Nt.length)return Ee;const ti=[];for(Ke.length?ti.push({polygons:Nt,bounds:fe,depth:0}):Pe(Nt,fe);ti.length;){const Bt=ti.pop(),qt=Bt.depth,vt=Ke[qt],ot=Bt.bounds[0],oi=Bt.bounds[1],Si=vt===0?ot.x:ot.y,In=vt===0?oi.x:oi.y,qi=Ne?Ne(vt,Si,In):.5*(Si+In),Sn=K_(Bt.polygons,Si-Le,qi+Le,vt),Ai=K_(Bt.polygons,qi-Le,In+Le,vt);if(Sn.length){const ci=[ot,new R(vt===0?qi:oi.x,vt===1?qi:oi.y)];Ke.length>qt+1?ti.push({polygons:Sn,bounds:ci,depth:qt+1}):Pe(Sn,ci)}if(Ai.length){const ci=[new R(vt===0?qi:ot.x,vt===1?qi:ot.y),oi];Ke.length>qt+1?ti.push({polygons:Ai,bounds:ci,depth:qt+1}):Pe(Ai,ci)}}return Ee}(D,w,Math.ceil((oe-X)/11.25),Math.ceil((ce-he)/11.25),1,(de,fe,Se)=>{if(de===0)return .5*(fe+Se);{const Ce=Wn((d.y+fe/$t)/W);return(eh(.5*(Wn((d.y+Se/$t)/W)+Ce))*W-d.y)*$t}})}else{B=[];for(const j of D)B.push({polygon:j,bounds:w})}for(const j of B){const W=j.polygon;let X=0,oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Se=0;Se<W.length;Se++){const Ce=W[Se];if(Ce.length===0)continue;X+=Ce.length;let Le=0;M&&M.startRing(Ce[0]);for(let Ne=0;Ne<Ce.length;Ne++){const Ee=Ce[Ne];if(Ne>=1){const Pe=Ce[Ne-1];if(!Uz(Ee,Pe,j.bounds)){M&&M.append(Ee,Pe),oe.vertexLength+4>hn.MAX_VERTEX_ARRAY_LENGTH&&(oe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ve=Ee.sub(Pe)._perp(),Ze=Ve.x/(Math.abs(Ve.x)+Math.abs(Ve.y)),Ge=Ve.y>0?1:0,Ke=Pe.dist(Ee);Le+Ke>32768&&(Le=0),Rf(this.layoutVertexArray,Ee.x,Ee.y,Ze,Ge,0,0,Le),Rf(this.layoutVertexArray,Ee.x,Ee.y,Ze,Ge,0,1,Le),Le+=Ke,Rf(this.layoutVertexArray,Pe.x,Pe.y,Ze,Ge,0,0,Le),Rf(this.layoutVertexArray,Pe.x,Pe.y,Ze,Ge,0,1,Le);const Nt=oe.vertexLength;if(this.indexArray.emplaceBack(Nt,Nt+2,Nt+1),this.indexArray.emplaceBack(Nt+1,Nt+2,Nt+3),oe.vertexLength+=4,oe.primitiveLength+=2,A){const ti=this.layoutVertexExtArray,Bt=T.projectTilePoint(Ee.x,Ee.y,d),qt=T.projectTilePoint(Pe.x,Pe.y,d),vt=T.upVector(d,Ee.x,Ee.y),ot=T.upVector(d,Pe.x,Pe.y);Lf(ti,Bt,vt),Lf(ti,Bt,vt),Lf(ti,qt,ot),Lf(ti,qt,ot)}}}}}if(oe.vertexLength+X>hn.MAX_VERTEX_ARRAY_LENGTH&&(oe=this.segments.prepareSegment(X,this.layoutVertexArray,this.indexArray)),Fz[n.type]!=="Polygon")continue;const ce=[],he=[],de=oe.vertexLength;for(let Se=0;Se<W.length;Se++){const Ce=W[Se];if(Ce.length!==0){Ce!==W[0]&&he.push(ce.length/2);for(let Le=0;Le<Ce.length;Le++){const Ne=Ce[Le];Rf(this.layoutVertexArray,Ne.x,Ne.y,0,0,1,1,0),ce.push(Ne.x),ce.push(Ne.y),M&&M.currentPolyCount.top++,A&&Lf(this.layoutVertexExtArray,T.projectTilePoint(Ne.x,Ne.y,d),T.upVector(d,Ne.x,Ne.y))}}}const fe=$_(ce,he);for(let Se=0;Se<fe.length;Se+=3)this.indexArray.emplaceBack(de+fe[Se],de+fe[Se+2],de+fe[Se+1]);oe.primitiveLength+=fe.length/3,oe.vertexLength+=X}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const j=M.borders,W=this.featuresOnBorder.push(M)-1;for(let X=0;X<4;X++)j[X][0]!==Number.MAX_VALUE&&this.borders[X].push(W)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,m,g,d)}sortBorders(){for(let n=0;n<4;n++)this.borders[n].sort((a,u)=>this.featuresOnBorder[a].borders[n][0]-this.featuresOnBorder[u].borders[n][0])}encodeCentroid(n,a,u=!0){let d,m;if(n)if(n.y!==0){const v=a.span()._mult(this.tileToMeter);d=(Math.max(n.x,1)<<3)+Math.min(7,Math.round(v.x/10)),m=(Math.max(n.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else d=Math.ceil(7*(n.x+450)),m=0;else d=0,m=+u;let g=u?this.centroidVertexArray.length:a.vertexArrayOffset;for(const v of a.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let w=0;w<2*v.edges;w++)this.centroidVertexArray.emplace(g++,0,m),this.centroidVertexArray.emplace(g++,d,m);for(let w=0;w<v.top;w++)this.centroidVertexArray.emplace(g++,d,m)}}}function Uz(o,n,a){return o.x===n.x&&(o.x<a[0].x||o.x>a[1].x)||o.y===n.y&&(o.y<a[0].y||o.y>a[1].y)}at(Of,"FillExtrusionBucket",{omit:["layers","features"]}),at(CT,"PartMetadata");var Vz={paint:new F({"fill-extrusion-opacity":new E(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new S(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new E(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new E(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new k(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new S(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new S(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new E(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function zf(o,n){return o.x*n.x+o.y*n.y}function MT(o,n){if(o.length===1){let a=0;const u=n[a++];let d;for(;!d||u.equals(d);)if(d=n[a++],!d)return 1/0;for(;a<n.length;a++){const m=n[a],g=o[0],v=d.sub(u),w=m.sub(u),T=g.sub(u),A=zf(v,v),M=zf(v,w),D=zf(w,w),z=zf(T,v),B=zf(T,w),j=A*D-M*M,W=(D*z-M*B)/j,X=(A*B-M*z)/j,oe=u.z*(1-W-X)+d.z*W+m.z*X;if(isFinite(oe))return oe}return 1/0}{let a=1/0;for(const u of n)a=Math.min(a,u.z);return a}}function kT(o){const n=new R(o[0],o[1]);return n.z=o[2],n}function $z(o,n,a,u,d,m,g,v){const w=g*d.getElevationAt(o,n,!0,!0),T=m[0]!==0,A=T?m[1]===0?g*(m[0]/7-450):g*function(M,D,z){const B=Math.floor(D[0]/8),j=Math.floor(D[1]/8),W=10*(D[0]-8*B),X=10*(D[1]-8*j),oe=M.getElevationAt(B,j,!0,!0),ce=M.getMeterToDEM(z),he=Math.floor(.5*(W*ce-1)),de=Math.floor(.5*(X*ce-1)),fe=M.tileCoordToPixel(B,j),Se=2*he+1,Ce=2*de+1,Le=function(Ge,Ke,Nt,ti,Bt){return[Ge.getElevationAtPixel(Ke,Nt,!0),Ge.getElevationAtPixel(Ke+Bt,Nt,!0),Ge.getElevationAtPixel(Ke,Nt+Bt,!0),Ge.getElevationAtPixel(Ke+ti,Nt+Bt,!0)]}(M,fe.x-he,fe.y-de,Se,Ce),Ne=Math.abs(Le[0]-Le[1]),Ee=Math.abs(Le[2]-Le[3]),Pe=Math.abs(Le[0]-Le[2])+Math.abs(Le[1]-Le[3]),Ve=Math.min(.25,.5*ce*(Ne+Ee)/Se),Ze=Math.min(.25,.5*ce*Pe/Ce);return oe+Math.max(Ve*W,Ze*X)}(d,m,v):w;return{base:w+(a===0)?-1:a,top:T?Math.max(A+u,w+a+2):w+u}}const jz=ie([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Gz}=jz,qz=ie([{name:"a_packed",components:3,type:"Float32"}]),{members:Wz}=qz,Hz=mc.VectorTileFeature.types,Kz=Math.cos(Math.PI/180*37.5);class Z_{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Q,this.layoutVertexArray2=new We,this.indexArray=new ht,this.programConfigurations=new hc(n.layers,n.zoom),this.segments=new hn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,u,d){this.hasPattern=zx("line",this.layers,a);const m=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:A,id:M,index:D,sourceLayerIndex:z}of n){const B=this.layers[0]._featureFilter.needGeometry,j=dc(A,B);if(!this.layers[0]._featureFilter.filter(new Gi(this.zoom),j,u))continue;const W=m?m.evaluate(j,{},u):void 0,X={id:M,properties:A.properties,type:A.type,sourceLayerIndex:z,index:D,geometry:B?j.geometry:da(A,u,d),patterns:{},sortKey:W};g.push(X)}m&&g.sort((A,M)=>A.sortKey-M.sortKey);const{lineAtlas:v,featureIndex:w}=a,T=this.addConstantDashes(v);for(const A of g){const{geometry:M,index:D,sourceLayerIndex:z}=A;if(T&&this.addFeatureDashes(A,v),this.hasPattern){const B=Nx("line",this.layers,A,this.zoom,a);this.patternFeatures.push(B)}else this.addFeature(A,M,D,u,v.positions,a.availableImages);w.insert(n[D].feature,M,D,z,this.index)}}addConstantDashes(n){let a=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(d.kind!=="constant"||m.kind!=="constant")a=!0;else{const g=m.value,v=d.value;if(!v)continue;n.addDash(v.from,g),n.addDash(v.to,g),v.other&&n.addDash(v.other,g)}}return a}addFeatureDashes(n,a){const u=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,g=d.layout.get("line-cap").value;if(m.kind==="constant"&&g.kind==="constant")continue;let v,w,T,A,M,D;if(m.kind==="constant"){const W=m.value;if(!W)continue;v=W.other||W.to,w=W.to,T=W.from}else v=m.evaluate({zoom:u-1},n),w=m.evaluate({zoom:u},n),T=m.evaluate({zoom:u+1},n);g.kind==="constant"?A=M=D=g.value:(A=g.evaluate({zoom:u-1},n),M=g.evaluate({zoom:u},n),D=g.evaluate({zoom:u+1},n)),a.addDash(v,A),a.addDash(w,M),a.addDash(T,D);const z=a.getKey(v,A),B=a.getKey(w,M),j=a.getKey(T,D);n.patterns[d.id]={min:z,mid:B,max:j}}}update(n,a,u,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,u,d)}addFeatures(n,a,u,d,m){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,a,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,Wz)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Gz),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,a,u,d,m,g){const v=this.layers[0].layout,w=v.get("line-join").evaluate(n,{}),T=v.get("line-cap").evaluate(n,{}),A=v.get("line-miter-limit"),M=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const D of a)this.addLine(D,n,w,T,A,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,m,g,d)}addLine(n,a,u,d,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<n.length-1;X++)this.totalDistance+=n[X].dist(n[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=Hz[a.type]==="Polygon";let w=n.length;for(;w>=2&&n[w-1].equals(n[w-2]);)w--;let T=0;for(;T<w-1&&n[T].equals(n[T+1]);)T++;if(w<(v?3:2))return;u==="bevel"&&(m=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let D,z,B,j,W;this.e1=this.e2=-1,v&&(D=n[w-2],W=n[T].sub(D)._unit()._perp());for(let X=T;X<w;X++){if(B=X===w-1?v?n[T+1]:void 0:n[X+1],B&&n[X].equals(B))continue;W&&(j=W),D&&(z=D),D=n[X],W=B?B.sub(D)._unit()._perp():j,j=j||W;let oe=j.add(W);oe.x===0&&oe.y===0||oe._unit();const ce=j.x*W.x+j.y*W.y,he=oe.x*W.x+oe.y*W.y,de=he!==0?1/he:1/0,fe=2*Math.sqrt(2-2*he),Se=he<Kz&&z&&B,Ce=j.x*W.y-j.y*W.x>0;if(Se&&X>T){const Ee=D.dist(z);if(Ee>2*A){const Pe=D.sub(D.sub(z)._mult(A/Ee)._round());this.updateDistance(z,Pe),this.addCurrentVertex(Pe,j,0,0,M),z=Pe}}const Le=z&&B;let Ne=Le?u:v?"butt":d;if(Le&&Ne==="round"&&(de<g?Ne="miter":de<=2&&(Ne="fakeround")),Ne==="miter"&&de>m&&(Ne="bevel"),Ne==="bevel"&&(de>2&&(Ne="flipbevel"),de<m&&(Ne="miter")),z&&this.updateDistance(z,D),Ne==="miter")oe._mult(de),this.addCurrentVertex(D,oe,0,0,M);else if(Ne==="flipbevel"){if(de>100)oe=W.mult(-1);else{const Ee=de*j.add(W).mag()/j.sub(W).mag();oe._perp()._mult(Ee*(Ce?-1:1))}this.addCurrentVertex(D,oe,0,0,M),this.addCurrentVertex(D,oe.mult(-1),0,0,M)}else if(Ne==="bevel"||Ne==="fakeround"){const Ee=-Math.sqrt(de*de-1),Pe=Ce?Ee:0,Ve=Ce?0:Ee;if(z&&this.addCurrentVertex(D,j,Pe,Ve,M),Ne==="fakeround"){const Ze=Math.round(180*fe/Math.PI/20);for(let Ge=1;Ge<Ze;Ge++){let Ke=Ge/Ze;if(Ke!==.5){const ti=Ke-.5;Ke+=Ke*ti*(Ke-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*ti*ti+(.848013+ce*(.215638*ce-1.06021)))}const Nt=W.sub(j)._mult(Ke)._add(j)._unit()._mult(Ce?-1:1);this.addHalfVertex(D,Nt.x,Nt.y,!1,Ce,0,M)}}B&&this.addCurrentVertex(D,W,-Pe,-Ve,M)}else if(Ne==="butt")this.addCurrentVertex(D,oe,0,0,M);else if(Ne==="square"){const Ee=z?1:-1;z||this.addCurrentVertex(D,oe,Ee,Ee,M),this.addCurrentVertex(D,oe,0,0,M),z&&this.addCurrentVertex(D,oe,Ee,Ee,M)}else Ne==="round"&&(z&&(this.addCurrentVertex(D,j,0,0,M),this.addCurrentVertex(D,j,1,1,M,!0)),B&&(this.addCurrentVertex(D,W,-1,-1,M,!0),this.addCurrentVertex(D,W,0,0,M)));if(Se&&X<w-1){const Ee=D.dist(B);if(Ee>2*A){const Pe=D.add(B.sub(D)._mult(A/Ee)._round());this.updateDistance(D,Pe),this.addCurrentVertex(Pe,W,0,0,M),D=Pe}}}}addCurrentVertex(n,a,u,d,m,g=!1){const v=a.y*d-a.x,w=-a.y-a.x*d;this.addHalfVertex(n,a.x+a.y*u,a.y-a.x*u,g,!1,u,m),this.addHalfVertex(n,v,w,g,!0,-d,m)}addHalfVertex({x:n,y:a},u,d,m,g,v,w){this.layoutVertexArray.emplaceBack((n<<1)+(m?1:0),(a<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const T=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),w.primitiveLength++),g?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,a){this.distance+=n.dist(a),this.updateScaledDistance()}}at(Z_,"LineBucket",{omit:["layers","patternFeatures"]});const Zz=new F({"line-cap":new S(be.layout_line["line-cap"]),"line-join":new S(be.layout_line["line-join"]),"line-miter-limit":new E(be.layout_line["line-miter-limit"]),"line-round-limit":new E(be.layout_line["line-round-limit"]),"line-sort-key":new S(be.layout_line["line-sort-key"])});var DT={paint:new F({"line-opacity":new S(be.paint_line["line-opacity"]),"line-color":new S(be.paint_line["line-color"]),"line-translate":new E(be.paint_line["line-translate"]),"line-translate-anchor":new E(be.paint_line["line-translate-anchor"]),"line-width":new S(be.paint_line["line-width"]),"line-gap-width":new S(be.paint_line["line-gap-width"]),"line-offset":new S(be.paint_line["line-offset"]),"line-blur":new S(be.paint_line["line-blur"]),"line-dasharray":new k(be.paint_line["line-dasharray"]),"line-pattern":new k(be.paint_line["line-pattern"]),"line-gradient":new O(be.paint_line["line-gradient"])}),layout:Zz};const PT=new class extends S{possiblyEvaluate(o,n){return n=new Gi(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(o,n)}evaluate(o,n,a,u){return n=Ht({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(o,n,a,u)}}(DT.paint.properties["line-width"].specification);function RT(o,n){return n>0?n+2*o:o}PT.useIntegerZoom=!0;const Xz=ie([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),Yz=ie([{name:"a_projected_pos",components:3,type:"Float32"}],4);ie([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jz=ie([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Qz=ie([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const LT=ie([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eN=ie([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ie([{name:"triangle",components:3,type:"Uint16"}]),ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ie([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ie([{type:"Float32",name:"offsetX"}]),ie([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Hn=24;const Ao=128;function Fx(o,n){const{expression:a}=n;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Gi(o+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:d}=a;let m=0;for(;m<u.length&&u[m]<=o;)m++;m=Math.max(0,m-1);let g=m;for(;g<u.length&&u[g]<o+1;)g++;g=Math.min(u.length-1,g);const v=u[m],w=u[g];return a.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:d}:{kind:"camera",minZoom:v,maxZoom:w,minSize:a.evaluate(new Gi(v)),maxSize:a.evaluate(new Gi(w)),interpolationType:d}}}function X_(o,{uSize:n,uSizeT:a},{lowerSize:u,upperSize:d}){return o.kind==="source"?u/Ao:o.kind==="composite"?At(u/Ao,d/Ao,a):n}function lh(o,n){let a=0,u=0;if(o.kind==="constant")u=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:d,minZoom:m,maxZoom:g}=o,v=d?rt(kr.interpolationFactor(d,n,m,g),0,1):0;o.kind==="camera"?u=At(o.minSize,o.maxSize,v):a=v}return{uSizeT:a,uSize:u}}var tN=Object.freeze({__proto__:null,getSizeData:Fx,evaluateSizeForFeature:X_,evaluateSizeForZoom:lh,SIZE_PACK_FACTOR:Ao});function iN(o,n,a){return o.sections.forEach(u=>{u.text=function(d,m,g){const v=m.layout.get("text-transform").evaluate(g,{});return v==="uppercase"?d=d.toLocaleUpperCase():v==="lowercase"&&(d=d.toLocaleLowerCase()),Hr.applyArabicShaping&&(d=Hr.applyArabicShaping(d)),d}(u.text,n,a)}),o}const Nf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function nN(o){return o==="\uFE36"||o==="\uFE48"||o==="\uFE38"||o==="\uFE44"||o==="\uFE42"||o==="\uFE3E"||o==="\uFE3C"||o==="\uFE3A"||o==="\uFE18"||o==="\uFE40"||o==="\uFE10"||o==="\uFE13"||o==="\uFE14"||o==="\uFF40"||o==="\uFFE3"||o==="\uFE11"||o==="\uFE12"}function rN(o){return o==="\uFE35"||o==="\uFE47"||o==="\uFE37"||o==="\uFE43"||o==="\uFE41"||o==="\uFE3D"||o==="\uFE3B"||o==="\uFE39"||o==="\uFE17"||o==="\uFE3F"}var OT=function(o,n,a,u,d){var m,g,v=8*d-u-1,w=(1<<v)-1,T=w>>1,A=-7,M=a?d-1:0,D=a?-1:1,z=o[n+M];for(M+=D,m=z&(1<<-A)-1,z>>=-A,A+=v;A>0;m=256*m+o[n+M],M+=D,A-=8);for(g=m&(1<<-A)-1,m>>=-A,A+=u;A>0;g=256*g+o[n+M],M+=D,A-=8);if(m===0)m=1-T;else{if(m===w)return g?NaN:1/0*(z?-1:1);g+=Math.pow(2,u),m-=T}return(z?-1:1)*g*Math.pow(2,m-u)},zT=function(o,n,a,u,d,m){var g,v,w,T=8*m-d-1,A=(1<<T)-1,M=A>>1,D=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=u?0:m-1,B=u?1:-1,j=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(v=isNaN(n)?1:0,g=A):(g=Math.floor(Math.log(n)/Math.LN2),n*(w=Math.pow(2,-g))<1&&(g--,w*=2),(n+=g+M>=1?D/w:D*Math.pow(2,1-M))*w>=2&&(g++,w/=2),g+M>=A?(v=0,g=A):g+M>=1?(v=(n*w-1)*Math.pow(2,d),g+=M):(v=n*Math.pow(2,M-1)*Math.pow(2,d),g=0));d>=8;o[a+z]=255&v,z+=B,v/=256,d-=8);for(g=g<<d|v,T+=d;T>0;o[a+z]=255&g,z+=B,g/=256,T-=8);o[a+z-B]|=128*j},Ff=ji;function ji(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}ji.Varint=0,ji.Fixed64=1,ji.Bytes=2,ji.Fixed32=5;var Bx=4294967296,NT=1/Bx,FT=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function pa(o){return o.type===ji.Bytes?o.readVarint()+o.pos:o.pos+1}function ch(o,n,a){return a?4294967296*n+(o>>>0):4294967296*(n>>>0)+(o>>>0)}function BT(o,n,a){var u=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));a.realloc(u);for(var d=a.pos-1;d>=o;d--)a.buf[d+u]=a.buf[d]}function sN(o,n){for(var a=0;a<o.length;a++)n.writeVarint(o[a])}function oN(o,n){for(var a=0;a<o.length;a++)n.writeSVarint(o[a])}function aN(o,n){for(var a=0;a<o.length;a++)n.writeFloat(o[a])}function lN(o,n){for(var a=0;a<o.length;a++)n.writeDouble(o[a])}function cN(o,n){for(var a=0;a<o.length;a++)n.writeBoolean(o[a])}function uN(o,n){for(var a=0;a<o.length;a++)n.writeFixed32(o[a])}function hN(o,n){for(var a=0;a<o.length;a++)n.writeSFixed32(o[a])}function dN(o,n){for(var a=0;a<o.length;a++)n.writeFixed64(o[a])}function fN(o,n){for(var a=0;a<o.length;a++)n.writeSFixed64(o[a])}function Y_(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+16777216*o[n+3]}function uh(o,n,a){o[a]=n,o[a+1]=n>>>8,o[a+2]=n>>>16,o[a+3]=n>>>24}function UT(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+(o[n+3]<<24)}function pN(o,n,a){n.glyphs=[],o===1&&a.readMessage(mN,n)}function mN(o,n,a){if(o===3){const{id:u,bitmap:d,width:m,height:g,left:v,top:w,advance:T}=a.readMessage(_N,{});n.glyphs.push({id:u,bitmap:new fa({width:m+6,height:g+6},d),metrics:{width:m,height:g,left:v,top:w,advance:T}})}else o===4?n.ascender=a.readSVarint():o===5&&(n.descender=a.readSVarint())}function _N(o,n,a){o===1?n.id=a.readVarint():o===2?n.bitmap=a.readBytes():o===3?n.width=a.readVarint():o===4?n.height=a.readVarint():o===5?n.left=a.readSVarint():o===6?n.top=a.readSVarint():o===7&&(n.advance=a.readVarint())}function Ux(o){let n=0,a=0;for(const g of o)n+=g.w*g.h,a=Math.max(a,g.w);o.sort((g,v)=>v.h-g.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}];let d=0,m=0;for(const g of o)for(let v=u.length-1;v>=0;v--){const w=u[v];if(!(g.w>w.w||g.h>w.h)){if(g.x=w.x,g.y=w.y,m=Math.max(m,g.y+g.h),d=Math.max(d,g.x+g.w),g.w===w.w&&g.h===w.h){const T=u.pop();v<u.length&&(u[v]=T)}else g.h===w.h?(w.x+=g.w,w.w-=g.w):g.w===w.w?(w.y+=g.h,w.h-=g.h):(u.push({x:w.x+g.w,y:w.y,w:w.w-g.w,h:g.h}),w.y+=g.h,w.h-=g.h);break}}return{w:d,h:m,fill:n/(d*m)||0}}ji.prototype={destroy:function(){this.buf=null},readFields:function(o,n,a){for(a=a||this.length;this.pos<a;){var u=this.readVarint(),d=u>>3,m=this.pos;this.type=7&u,o(d,n,this),this.pos===m&&this.skip(u)}return n},readMessage:function(o,n){return this.readFields(o,n,this.readVarint()+this.pos)},readFixed32:function(){var o=Y_(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=UT(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Y_(this.buf,this.pos)+Y_(this.buf,this.pos+4)*Bx;return this.pos+=8,o},readSFixed64:function(){var o=Y_(this.buf,this.pos)+UT(this.buf,this.pos+4)*Bx;return this.pos+=8,o},readFloat:function(){var o=OT(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=OT(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var n,a,u=this.buf;return n=127&(a=u[this.pos++]),a<128?n:(n|=(127&(a=u[this.pos++]))<<7,a<128?n:(n|=(127&(a=u[this.pos++]))<<14,a<128?n:(n|=(127&(a=u[this.pos++]))<<21,a<128?n:function(d,m,g){var v,w,T=g.buf;if(v=(112&(w=T[g.pos++]))>>4,w<128||(v|=(127&(w=T[g.pos++]))<<3,w<128)||(v|=(127&(w=T[g.pos++]))<<10,w<128)||(v|=(127&(w=T[g.pos++]))<<17,w<128)||(v|=(127&(w=T[g.pos++]))<<24,w<128)||(v|=(1&(w=T[g.pos++]))<<31,w<128))return ch(d,v,m);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(a=u[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,n=this.pos;return this.pos=o,o-n>=12&&FT?function(a,u,d){return FT.decode(a.subarray(u,d))}(this.buf,n,o):function(a,u,d){for(var m="",g=u;g<d;){var v,w,T,A=a[g],M=null,D=A>239?4:A>223?3:A>191?2:1;if(g+D>d)break;D===1?A<128&&(M=A):D===2?(192&(v=a[g+1]))==128&&(M=(31&A)<<6|63&v)<=127&&(M=null):D===3?(w=a[g+2],(192&(v=a[g+1]))==128&&(192&w)==128&&((M=(15&A)<<12|(63&v)<<6|63&w)<=2047||M>=55296&&M<=57343)&&(M=null)):D===4&&(w=a[g+2],T=a[g+3],(192&(v=a[g+1]))==128&&(192&w)==128&&(192&T)==128&&((M=(15&A)<<18|(63&v)<<12|(63&w)<<6|63&T)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,D=1):M>65535&&(M-=65536,m+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),m+=String.fromCharCode(M),g+=D}return m}(this.buf,n,o)},readBytes:function(){var o=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,o);return this.pos=o,n},readPackedVarint:function(o,n){if(this.type!==ji.Bytes)return o.push(this.readVarint(n));var a=pa(this);for(o=o||[];this.pos<a;)o.push(this.readVarint(n));return o},readPackedSVarint:function(o){if(this.type!==ji.Bytes)return o.push(this.readSVarint());var n=pa(this);for(o=o||[];this.pos<n;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==ji.Bytes)return o.push(this.readBoolean());var n=pa(this);for(o=o||[];this.pos<n;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==ji.Bytes)return o.push(this.readFloat());var n=pa(this);for(o=o||[];this.pos<n;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==ji.Bytes)return o.push(this.readDouble());var n=pa(this);for(o=o||[];this.pos<n;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==ji.Bytes)return o.push(this.readFixed32());var n=pa(this);for(o=o||[];this.pos<n;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==ji.Bytes)return o.push(this.readSFixed32());var n=pa(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==ji.Bytes)return o.push(this.readFixed64());var n=pa(this);for(o=o||[];this.pos<n;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==ji.Bytes)return o.push(this.readSFixed64());var n=pa(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed64());return o},skip:function(o){var n=7&o;if(n===ji.Varint)for(;this.buf[this.pos++]>127;);else if(n===ji.Bytes)this.pos=this.readVarint()+this.pos;else if(n===ji.Fixed32)this.pos+=4;else{if(n!==ji.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(o,n){this.writeVarint(o<<3|n)},realloc:function(o){for(var n=this.length||16;n<this.pos+o;)n*=2;if(n!==this.length){var a=new Uint8Array(n);a.set(this.buf),this.buf=a,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),uh(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),uh(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),uh(this.buf,-1&o,this.pos),uh(this.buf,Math.floor(o*NT),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),uh(this.buf,-1&o,this.pos),uh(this.buf,Math.floor(o*NT),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(n,a){var u,d;if(n>=0?(u=n%4294967296|0,d=n/4294967296|0):(d=~(-n/4294967296),4294967295^(u=~(-n%4294967296))?u=u+1|0:(u=0,d=d+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(m,g,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)}(u,0,a),function(m,g){var v=(7&m)<<4;g.buf[g.pos++]|=v|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(d,a)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var n=this.pos;this.pos=function(u,d,m){for(var g,v,w=0;w<d.length;w++){if((g=d.charCodeAt(w))>55295&&g<57344){if(!v){g>56319||w+1===d.length?(u[m++]=239,u[m++]=191,u[m++]=189):v=g;continue}if(g<56320){u[m++]=239,u[m++]=191,u[m++]=189,v=g;continue}g=v-55296<<10|g-56320|65536,v=null}else v&&(u[m++]=239,u[m++]=191,u[m++]=189,v=null);g<128?u[m++]=g:(g<2048?u[m++]=g>>6|192:(g<65536?u[m++]=g>>12|224:(u[m++]=g>>18|240,u[m++]=g>>12&63|128),u[m++]=g>>6&63|128),u[m++]=63&g|128)}return m}(this.buf,o,this.pos);var a=this.pos-n;a>=128&&BT(n,a,this),this.pos=n-1,this.writeVarint(a),this.pos+=a},writeFloat:function(o){this.realloc(4),zT(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),zT(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var n=o.length;this.writeVarint(n),this.realloc(n);for(var a=0;a<n;a++)this.buf[this.pos++]=o[a]},writeRawMessage:function(o,n){this.pos++;var a=this.pos;o(n,this);var u=this.pos-a;u>=128&&BT(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeMessage:function(o,n,a){this.writeTag(o,ji.Bytes),this.writeRawMessage(n,a)},writePackedVarint:function(o,n){n.length&&this.writeMessage(o,sN,n)},writePackedSVarint:function(o,n){n.length&&this.writeMessage(o,oN,n)},writePackedBoolean:function(o,n){n.length&&this.writeMessage(o,cN,n)},writePackedFloat:function(o,n){n.length&&this.writeMessage(o,aN,n)},writePackedDouble:function(o,n){n.length&&this.writeMessage(o,lN,n)},writePackedFixed32:function(o,n){n.length&&this.writeMessage(o,uN,n)},writePackedSFixed32:function(o,n){n.length&&this.writeMessage(o,hN,n)},writePackedFixed64:function(o,n){n.length&&this.writeMessage(o,dN,n)},writePackedSFixed64:function(o,n){n.length&&this.writeMessage(o,fN,n)},writeBytesField:function(o,n){this.writeTag(o,ji.Bytes),this.writeBytes(n)},writeFixed32Field:function(o,n){this.writeTag(o,ji.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(o,n){this.writeTag(o,ji.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(o,n){this.writeTag(o,ji.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(o,n){this.writeTag(o,ji.Fixed64),this.writeSFixed64(n)},writeVarintField:function(o,n){this.writeTag(o,ji.Varint),this.writeVarint(n)},writeSVarintField:function(o,n){this.writeTag(o,ji.Varint),this.writeSVarint(n)},writeStringField:function(o,n){this.writeTag(o,ji.Bytes),this.writeString(n)},writeFloatField:function(o,n){this.writeTag(o,ji.Fixed32),this.writeFloat(n)},writeDoubleField:function(o,n){this.writeTag(o,ji.Fixed64),this.writeDouble(n)},writeBooleanField:function(o,n){this.writeVarintField(o,Boolean(n))}};class Vx{constructor(n,{pixelRatio:a,version:u,stretchX:d,stretchY:m,content:g}){this.paddedRect=n,this.pixelRatio=a,this.stretchX=d,this.stretchY=m,this.content=g,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class VT{constructor(n,a){const u={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(n,u,m),this.addImages(a,d,m);const{w:g,h:v}=Ux(m),w=new Xr({width:g||1,height:v||1});for(const T in n){const A=n[T],M=u[T].paddedRect;Xr.copy(A.data,w,{x:0,y:0},{x:M.x+1,y:M.y+1},A.data)}for(const T in a){const A=a[T],M=d[T].paddedRect,D=M.x+1,z=M.y+1,B=A.data.width,j=A.data.height;Xr.copy(A.data,w,{x:0,y:0},{x:D,y:z},A.data),Xr.copy(A.data,w,{x:0,y:j-1},{x:D,y:z-1},{width:B,height:1}),Xr.copy(A.data,w,{x:0,y:0},{x:D,y:z+j},{width:B,height:1}),Xr.copy(A.data,w,{x:B-1,y:0},{x:D-1,y:z},{width:1,height:j}),Xr.copy(A.data,w,{x:0,y:0},{x:D+B,y:z},{width:1,height:j})}this.image=w,this.iconPositions=u,this.patternPositions=d}addImages(n,a,u){for(const d in n){const m=n[d],g={x:0,y:0,w:m.data.width+2,h:m.data.height+2};u.push(g),a[d]=new Vx(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>n.hasImage(u)),n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in n.updatedImages)this.patchUpdatedImage(this.iconPositions[u],n.getImage(u),a),this.patchUpdatedImage(this.patternPositions[u],n.getImage(u),a)}patchUpdatedImage(n,a,u){if(!n||!a||n.version===a.version)return;n.version=a.version;const[d,m]=n.tl;u.update(a.data,void 0,{x:d,y:m})}}at(Vx,"ImagePosition"),at(VT,"ImageAtlas");const _s={horizontal:1,vertical:2,horizontalOnly:3};class Bf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,a){const u=new Bf;return u.scale=n||1,u.fontStack=a,u}static forImage(n){const a=new Bf;return a.imageName=n,a}}class hh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,a){const u=new hh;for(let d=0;d<n.sections.length;d++){const m=n.sections[d];m.image?u.addImageSection(m):u.addTextSection(m,a)}return u}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(n){this.text=function(a,u){let d="";for(let m=0;m<a.length;m++){const g=a.charCodeAt(m+1)||null,v=a.charCodeAt(m-1)||null;d+=!u&&(g&&Xu(g)&&!Nf[a[m+1]]||v&&Xu(v)&&!Nf[a[m-1]])||!Nf[a[m]]?a[m]:Nf[a[m]]}return d}(this.text,n)}trim(){let n=0;for(let u=0;u<this.text.length&&J_[this.text.charCodeAt(u)];u++)n++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&J_[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(n,a),this.sectionIndex=this.sectionIndex.slice(n,a)}substring(n,a){const u=new hh;return u.text=this.text.substring(n,a),u.sectionIndex=this.sectionIndex.slice(n,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,a)=>Math.max(n,this.sections[a].scale),0)}addTextSection(n,a){this.text+=n.text,this.sections.push(Bf.forText(n.scale,n.fontStack||a));const u=this.sections.length-1;for(let d=0;d<n.text.length;++d)this.sectionIndex.push(u)}addImageSection(n){const a=n.image?n.image.name:"";if(a.length===0)return void Kt("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Bf.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Kt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $x(o,n,a,u,d,m,g,v,w,T,A,M,D,z,B,j){const W=hh.fromFeature(o,d);let X;M===_s.vertical&&W.verticalizePunctuation(D);const{processBidirectionalText:oe,processStyledBidirectionalText:ce}=Hr;if(oe&&W.sections.length===1){X=[];const fe=oe(W.toString(),jx(W,T,m,n,u,z,B));for(const Se of fe){const Ce=new hh;Ce.text=Se,Ce.sections=W.sections;for(let Le=0;Le<Se.length;Le++)Ce.sectionIndex.push(0);X.push(Ce)}}else if(ce){X=[];const fe=ce(W.text,W.sectionIndex,jx(W,T,m,n,u,z,B));for(const Se of fe){const Ce=new hh;Ce.text=Se[0],Ce.sectionIndex=Se[1],Ce.sections=W.sections,X.push(Ce)}}else X=function(fe,Se){const Ce=[],Le=fe.text;let Ne=0;for(const Ee of Se)Ce.push(fe.substring(Ne,Ee)),Ne=Ee;return Ne<Le.length&&Ce.push(fe.substring(Ne,Le.length)),Ce}(W,jx(W,T,m,n,u,z,B));const he=[],de={positionedLines:he,text:W.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(fe,Se,Ce,Le,Ne,Ee,Pe,Ve,Ze,Ge,Ke,Nt){let ti=0,Bt=0,qt=0;const vt=Ve==="right"?1:Ve==="left"?0:.5;let ot=!1;for(const Ai of Ne){const ci=Ai.getSections();for(const Bi of ci){if(Bi.imageName)continue;const ln=Se[Bi.fontStack];if(ln&&(ot=ln.ascender!==void 0&&ln.descender!==void 0,!ot))break}if(!ot)break}let oi=0;for(const Ai of Ne){Ai.trim();const ci=Ai.getMaxScale(),Bi=(ci-1)*Hn,ln={positionedGlyphs:[],lineOffset:0};fe.positionedLines[oi]=ln;const dn=ln.positionedGlyphs;let An=0;if(!Ai.length()){Bt+=Ee,++oi;continue}let Dn=0,Qr=0;for(let Vi=0;Vi<Ai.length();Vi++){const yr=Ai.getSection(Vi),es=Ai.getSectionIndex(Vi),jn=Ai.getCharCode(Vi);let Pn=yr.scale,Qi=null,Wi=null,Nr=null,vr=Hn,En=0;const xr=!(Ze===_s.horizontal||!Ke&&!Zu(jn)||Ke&&(J_[jn]||(Si=jn,y_(Si)||Gu(Si)||rc(Si)||pf(Si)||Hu(Si))));if(yr.imageName){const nr=Le[yr.imageName];if(!nr)continue;Nr=yr.imageName,fe.iconsInText=fe.iconsInText||!0,Wi=nr.paddedRect;const Rn=nr.displaySize;Pn=Pn*Hn/Nt,Qi={width:Rn[0],height:Rn[1],left:1,top:-3,advance:xr?Rn[1]:Rn[0],localGlyph:!1},En=ot?-Qi.height*Pn:ci*Hn-17-Rn[1]*Pn,vr=Qi.advance;const Ps=(xr?Rn[0]:Rn[1])*Pn-Hn*ci;Ps>0&&Ps>An&&(An=Ps)}else{const nr=Ce[yr.fontStack];if(!nr)continue;nr[jn]&&(Wi=nr[jn]);const Rn=Se[yr.fontStack];if(!Rn)continue;const Ps=Rn.glyphs[jn];if(!Ps)continue;if(Qi=Ps.metrics,vr=jn!==8203?Hn:0,ot){const ll=Rn.ascender!==void 0?Math.abs(Rn.ascender):0,Zf=Rn.descender!==void 0?Math.abs(Rn.descender):0,Xf=(ll+Zf)*Pn;Dn<Xf&&(Dn=Xf,Qr=(ll-Zf)/2*Pn),En=-ll*Pn}else En=(ci-Pn)*Hn-17}xr?(fe.verticalizable=!0,dn.push({glyph:jn,imageName:Nr,x:ti,y:Bt+En,vertical:xr,scale:Pn,localGlyph:Qi.localGlyph,fontStack:yr.fontStack,sectionIndex:es,metrics:Qi,rect:Wi}),ti+=vr*Pn+Ge):(dn.push({glyph:jn,imageName:Nr,x:ti,y:Bt+En,vertical:xr,scale:Pn,localGlyph:Qi.localGlyph,fontStack:yr.fontStack,sectionIndex:es,metrics:Qi,rect:Wi}),ti+=Qi.advance*Pn+Ge)}dn.length!==0&&(qt=Math.max(ti-Ge,qt),ot?WT(dn,vt,An,Qr,Ee*ci/2):WT(dn,vt,An,0,Ee/2)),ti=0;const zr=Ee*ci+An;ln.lineOffset=Math.max(An,Bi),Bt+=zr,++oi}var Si;const In=Bt,{horizontalAlign:qi,verticalAlign:Sn}=Gx(Pe);(function(Ai,ci,Bi,ln,dn,An){const Dn=(ci-Bi)*dn,Qr=-An*ln;for(const zr of Ai)for(const Vi of zr.positionedGlyphs)Vi.x+=Dn,Vi.y+=Qr})(fe.positionedLines,vt,qi,Sn,qt,In),fe.top+=-Sn*In,fe.bottom=fe.top+In,fe.left+=-qi*qt,fe.right=fe.left+qt,fe.hasBaseline=ot}(de,n,a,u,X,g,v,w,M,T,D,j),!function(fe){for(const Se of fe)if(Se.positionedGlyphs.length!==0)return!1;return!0}(he)&&de}const J_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $T(o,n,a,u,d,m){if(n.imageName){const g=u[n.imageName];return g?g.displaySize[0]*n.scale*Hn/m+d:0}{const g=a[n.fontStack],v=g&&g.glyphs[o];return v?v.metrics.advance*n.scale+d:0}}function jT(o,n,a,u){const d=Math.pow(o-n,2);return u?o<n?d/2:2*d:d+Math.abs(a)*a}function yN(o,n,a){let u=0;return o===10&&(u-=1e4),a&&(u+=150),o!==40&&o!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function GT(o,n,a,u,d,m){let g=null,v=jT(n,a,d,m);for(const w of u){const T=jT(n-w.x,a,d,m)+w.badness;T<=v&&(g=w,v=T)}return{index:o,x:n,priorBreak:g,badness:v}}function qT(o){return o?qT(o.priorBreak).concat(o.index):[]}function jx(o,n,a,u,d,m,g){if(m!=="point")return[];if(!o)return[];const v=[],w=function(D,z,B,j,W,X){let oe=0;for(let ce=0;ce<D.length();ce++){const he=D.getSection(ce);oe+=$T(D.getCharCode(ce),he,j,W,z,X)}return oe/Math.max(1,Math.ceil(oe/B))}(o,n,a,u,d,g),T=o.text.indexOf("\u200B")>=0;let A=0;for(let D=0;D<o.length();D++){const z=o.getSection(D),B=o.getCharCode(D);if(J_[B]||(A+=$T(B,z,u,d,n,g)),D<o.length()-1){const j=!((M=B)<11904||!(b_(M)||x_(M)||Ha(M)||oc(M)||T_(M)||uf(M)||w_(M)||qu(M)||I_(M)||ff(M)||E_(M)||mf(M)||sc(M)||hf(M)||v_(M)||df(M)||Wu(M)||M_(M)||A_(M)||S_(M)));(gN[B]||j||z.imageName)&&v.push(GT(D+1,A,w,v,yN(B,o.getCharCode(D+1),j&&T),!1))}}var M;return qT(GT(o.length(),A,w,v,0,!0))}function Gx(o){let n=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function WT(o,n,a,u,d){if(!(n||a||u||d))return;const m=o.length-1,g=o[m],v=(g.x+g.metrics.advance*g.scale)*n;for(let w=0;w<=m;w++)o[w].x-=v,o[w].y+=a+u+d}function vN(o,n,a){const{horizontalAlign:u,verticalAlign:d}=Gx(a),m=n[0]-o.displaySize[0]*u,g=n[1]-o.displaySize[1]*d;return{image:o,top:g,bottom:g+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function HT(o,n,a,u,d,m){const g=o.image;let v;if(g.content){const W=g.content,X=g.pixelRatio||1;v=[W[0]/X,W[1]/X,g.displaySize[0]-W[2]/X,g.displaySize[1]-W[3]/X]}const w=n.left*m,T=n.right*m;let A,M,D,z;a==="width"||a==="both"?(z=d[0]+w-u[3],M=d[0]+T+u[1]):(z=d[0]+(w+T-g.displaySize[0])/2,M=z+g.displaySize[0]);const B=n.top*m,j=n.bottom*m;return a==="height"||a==="both"?(A=d[1]+B-u[0],D=d[1]+j+u[2]):(A=d[1]+(B+j-g.displaySize[1])/2,D=A+g.displaySize[1]),{image:g,top:A,right:M,bottom:D,left:z,collisionPadding:v}}class ma extends R{constructor(n,a,u,d,m){super(n,a),this.angle=d,this.z=u,m!==void 0&&(this.segment=m)}clone(){return new ma(this.x,this.y,this.z,this.angle,this.segment)}}function KT(o,n,a,u,d){if(n.segment===void 0)return!0;let m=n,g=n.segment+1,v=0;for(;v>-a/2;){if(g--,g<0)return!1;v-=o[g].dist(m),m=o[g]}v+=o[g].dist(o[g+1]),g++;const w=[];let T=0;for(;v<a/2;){const A=o[g],M=o[g+1];if(!M)return!1;let D=o[g-1].angleTo(A)-A.angleTo(M);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:D}),T+=D;v-w[0].distance>u;)T-=w.shift().angleDelta;if(T>d)return!1;g++,v+=A.dist(M)}return!0}function ZT(o){let n=0;for(let a=0;a<o.length-1;a++)n+=o[a].dist(o[a+1]);return n}function XT(o,n,a){return o?.6*n*a:0}function YT(o,n){return Math.max(o?o.right-o.left:0,n?n.right-n.left:0)}function xN(o,n,a,u,d,m){const g=XT(a,d,m),v=YT(a,u)*m;let w=0;const T=ZT(o)/2;for(let A=0;A<o.length-1;A++){const M=o[A],D=o[A+1],z=M.dist(D);if(w+z>T){const B=(T-w)/z,j=At(M.x,D.x,B),W=At(M.y,D.y,B),X=new ma(j,W,0,D.angleTo(M),A);return!g||KT(o,X,v,g,n)?X:void 0}w+=z}}function bN(o,n,a,u,d,m,g,v,w){const T=XT(u,m,g),A=YT(u,d),M=A*g,D=o[0].x===0||o[0].x===w||o[0].y===0||o[0].y===w;return n-M<n/4&&(n=M+n/4),JT(o,D?n/2*v%n:(A/2+2*m)*g*v%n,n,T,a,M,D,!1,w)}function JT(o,n,a,u,d,m,g,v,w){const T=m/2,A=ZT(o);let M=0,D=n-a,z=[];for(let B=0;B<o.length-1;B++){const j=o[B],W=o[B+1],X=j.dist(W),oe=W.angleTo(j);for(;D+a<M+X;){D+=a;const ce=(D-M)/X,he=At(j.x,W.x,ce),de=At(j.y,W.y,ce);if(he>=0&&he<w&&de>=0&&de<w&&D-T>=0&&D+T<=A){const fe=new ma(he,de,0,oe,B);fe._round(),u&&!KT(o,fe,m,u,d)||z.push(fe)}}M+=X}return v||z.length||g||(z=JT(o,M/2,a,u,d,m,g,!0,w)),z}function QT(o,n,a,u,d){const m=[];for(let g=0;g<o.length;g++){const v=o[g];let w;for(let T=0;T<v.length-1;T++){let A=v[T],M=v[T+1];A.x<n&&M.x<n||(A.x<n?A=new R(n,A.y+(n-A.x)/(M.x-A.x)*(M.y-A.y))._round():M.x<n&&(M=new R(n,A.y+(n-A.x)/(M.x-A.x)*(M.y-A.y))._round()),A.y<a&&M.y<a||(A.y<a?A=new R(A.x+(a-A.y)/(M.y-A.y)*(M.x-A.x),a)._round():M.y<a&&(M=new R(A.x+(a-A.y)/(M.y-A.y)*(M.x-A.x),a)._round()),A.x>=u&&M.x>=u||(A.x>=u?A=new R(u,A.y+(u-A.x)/(M.x-A.x)*(M.y-A.y))._round():M.x>=u&&(M=new R(u,A.y+(u-A.x)/(M.x-A.x)*(M.y-A.y))._round()),A.y>=d&&M.y>=d||(A.y>=d?A=new R(A.x+(d-A.y)/(M.y-A.y)*(M.x-A.x),d)._round():M.y>=d&&(M=new R(A.x+(d-A.y)/(M.y-A.y)*(M.x-A.x),d)._round()),w&&A.equals(w[w.length-1])||(w=[A],m.push(w)),w.push(M)))))}}return m}at(ma,"Anchor");const Uf=1e20;function eI(o,n,a,u,d,m,g,v,w){for(let T=n;T<n+u;T++)tI(o,a*m+T,m,d,g,v,w);for(let T=a;T<a+d;T++)tI(o,T*m+n,1,u,g,v,w)}function tI(o,n,a,u,d,m,g){m[0]=0,g[0]=-Uf,g[1]=Uf,d[0]=o[n];for(let v=1,w=0,T=0;v<u;v++){d[v]=o[n+v*a];const A=v*v;do{const M=m[w];T=(d[v]-d[M]+A-M*M)/(v-M)/2}while(T<=g[w]&&--w>-1);w++,m[w]=v,g[w]=T,g[w+1]=Uf}for(let v=0,w=0;v<u;v++){for(;g[w+1]<v;)w++;const T=m[w],A=v-T;o[n+v*a]=d[T]+A*A}}const qx={none:0,ideographs:1,all:2};class dh{constructor(n,a,u){this.requestManager=n,this.localGlyphMode=a,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,a){const u=[];for(const d in n)for(const m of n[d])u.push({stack:d,id:m});_i(u,({stack:d,id:m},g)=>{let v=this.entries[d];v||(v=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=v.glyphs[m];if(w!==void 0)return void g(null,{stack:d,id:m,glyph:w});if(w=this._tinySDF(v,d,m),w)return v.glyphs[m]=w,void g(null,{stack:d,id:m,glyph:w});const T=Math.floor(m/256);if(256*T>65535)return void g(new Error("glyphs > 65535 not supported"));if(v.ranges[T])return void g(null,{stack:d,id:m,glyph:w});let A=v.requests[T];A||(A=v.requests[T]=[],dh.loadGlyphRange(d,T,this.url,this.requestManager,(M,D)=>{if(D){v.ascender=D.ascender,v.descender=D.descender;for(const z in D.glyphs)this._doesCharSupportLocalGlyph(+z)||(v.glyphs[+z]=D.glyphs[+z]);v.ranges[T]=!0}for(const z of A)z(M,D);delete v.requests[T]})),A.push((M,D)=>{M?g(M):D&&g(null,{stack:d,id:m,glyph:D.glyphs[m]||null})})},(d,m)=>{if(d)a(d);else if(m){const g={};for(const{stack:v,id:w,glyph:T}of m)g[v]===void 0&&(g[v]={}),g[v].glyphs===void 0&&(g[v].glyphs={}),g[v].glyphs[w]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},g[v].ascender=this.entries[v].ascender,g[v].descender=this.entries[v].descender;a(null,g)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==qx.none&&(this.localGlyphMode===qx.all?!!this.localFontFamily:!!this.localFontFamily&&(ff(n)||C_(n)||sc(n)||Wu(n)||qu(n)))}_tinySDF(n,a,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let m=n.tinySDF;if(!m){let j="400";/bold/i.test(a)?j="900":/medium/i.test(a)?j="500":/light/i.test(a)&&(j="200"),m=n.tinySDF=new dh.TinySDF({fontFamily:d,fontWeight:j,fontSize:48,buffer:6,radius:16}),m.fontWeight=j}if(this.localGlyphs[m.fontWeight][u])return this.localGlyphs[m.fontWeight][u];const g=String.fromCharCode(u),{data:v,width:w,height:T,glyphWidth:A,glyphHeight:M,glyphLeft:D,glyphTop:z,glyphAdvance:B}=m.draw(g);return this.localGlyphs[m.fontWeight][u]={id:u,bitmap:new fa({width:w,height:T},v),metrics:{width:A/2,height:M/2,left:D/2,top:z/2-27,advance:B/2,localGlyph:!0}}}}function iI(o,n,a,u){const d=[],m=o.image,g=m.pixelRatio,v=m.paddedRect.w-2,w=m.paddedRect.h-2,T=o.right-o.left,A=o.bottom-o.top,M=m.stretchX||[[0,v]],D=m.stretchY||[[0,w]],z=(Ee,Pe)=>Ee+Pe[1]-Pe[0],B=M.reduce(z,0),j=D.reduce(z,0),W=v-B,X=w-j;let oe=0,ce=B,he=0,de=j,fe=0,Se=W,Ce=0,Le=X;if(m.content&&u){const Ee=m.content;oe=Q_(M,0,Ee[0]),he=Q_(D,0,Ee[1]),ce=Q_(M,Ee[0],Ee[2]),de=Q_(D,Ee[1],Ee[3]),fe=Ee[0]-oe,Ce=Ee[1]-he,Se=Ee[2]-Ee[0]-ce,Le=Ee[3]-Ee[1]-de}const Ne=(Ee,Pe,Ve,Ze)=>{const Ge=eg(Ee.stretch-oe,ce,T,o.left),Ke=tg(Ee.fixed-fe,Se,Ee.stretch,B),Nt=eg(Pe.stretch-he,de,A,o.top),ti=tg(Pe.fixed-Ce,Le,Pe.stretch,j),Bt=eg(Ve.stretch-oe,ce,T,o.left),qt=tg(Ve.fixed-fe,Se,Ve.stretch,B),vt=eg(Ze.stretch-he,de,A,o.top),ot=tg(Ze.fixed-Ce,Le,Ze.stretch,j),oi=new R(Ge,Nt),Si=new R(Bt,Nt),In=new R(Bt,vt),qi=new R(Ge,vt),Sn=new R(Ke/g,ti/g),Ai=new R(qt/g,ot/g),ci=n*Math.PI/180;if(ci){const dn=Math.sin(ci),An=Math.cos(ci),Dn=[An,-dn,dn,An];oi._matMult(Dn),Si._matMult(Dn),qi._matMult(Dn),In._matMult(Dn)}const Bi=Ee.stretch+Ee.fixed,ln=Pe.stretch+Pe.fixed;return{tl:oi,tr:Si,bl:qi,br:In,tex:{x:m.paddedRect.x+1+Bi,y:m.paddedRect.y+1+ln,w:Ve.stretch+Ve.fixed-Bi,h:Ze.stretch+Ze.fixed-ln},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sn,pixelOffsetBR:Ai,minFontScaleX:Se/g/T,minFontScaleY:Le/g/A,isSDF:a}};if(u&&(m.stretchX||m.stretchY)){const Ee=nI(M,W,B),Pe=nI(D,X,j);for(let Ve=0;Ve<Ee.length-1;Ve++){const Ze=Ee[Ve],Ge=Ee[Ve+1];for(let Ke=0;Ke<Pe.length-1;Ke++)d.push(Ne(Ze,Pe[Ke],Ge,Pe[Ke+1]))}}else d.push(Ne({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return d}function Q_(o,n,a){let u=0;for(const d of o)u+=Math.max(n,Math.min(a,d[1]))-Math.max(n,Math.min(a,d[0]));return u}function nI(o,n,a){const u=[{fixed:-1,stretch:0}];for(const[d,m]of o){const g=u[u.length-1];u.push({fixed:d-g.stretch,stretch:g.stretch}),u.push({fixed:d-g.stretch,stretch:g.stretch+(m-d)})}return u.push({fixed:n+1,stretch:a}),u}function eg(o,n,a,u){return o/n*a+u}function tg(o,n,a,u){return o-n*a/u}function wN(o,n,a,u){const d=n+o.positionedLines[u].lineOffset;return u===0?a+d/2:a+(d+(n+o.positionedLines[u-1].lineOffset))/2}dh.loadGlyphRange=function(o,n,a,u,d){const m=256*n,g=m+255,v=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${m}-${g}`),Y.Glyphs);ne(v,(w,T)=>{if(w)d(w);else if(T){const A={},M=function(D){return new Ff(D).readFields(pN,{})}(T);for(const D of M.glyphs)A[D.id]=D;d(null,{glyphs:A,ascender:M.ascender,descender:M.descender})}})},dh.TinySDF=class{constructor({fontSize:o=24,buffer:n=3,radius:a=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:g="normal"}){this.buffer=n,this.cutoff=u,this.radius=a;const v=this.size=o+4*n,w=this._createCanvas(v),T=this.ctx=w.getContext("2d",{willReadFrequently:!0});T.font=`${g} ${m} ${o}px ${d}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(o){const n=document.createElement("canvas");return n.width=n.height=o,n}draw(o){const{width:n,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(o),g=Math.floor(a),v=Math.min(this.size-this.buffer,Math.ceil(m-d)),w=Math.min(this.size-this.buffer,Math.ceil(a)+Math.ceil(u)),T=v+2*this.buffer,A=w+2*this.buffer,M=T*A,D=new Uint8ClampedArray(M),z={data:D,width:T,height:A,glyphWidth:v,glyphHeight:w,glyphTop:g,glyphLeft:0,glyphAdvance:n};if(v===0||w===0)return z;const{ctx:B,buffer:j,gridInner:W,gridOuter:X}=this;B.clearRect(j,j,v,w),B.fillText(o,j,j+g+1);const oe=B.getImageData(j,j,v,w);X.fill(Uf,0,M),W.fill(0,0,M);for(let ce=0;ce<w;ce++)for(let he=0;he<v;he++){const de=oe.data[4*(ce*v+he)+3]/255;if(de===0)continue;const fe=(ce+j)*T+he+j;if(de===1)X[fe]=0,W[fe]=Uf;else{const Se=.5-de;X[fe]=Se>0?Se*Se:0,W[fe]=Se<0?Se*Se:0}}eI(X,0,0,T,A,T,this.f,this.v,this.z),eI(W,j,j,v,w,T,this.f,this.v,this.z);for(let ce=0;ce<M;ce++){const he=Math.sqrt(X[ce])-Math.sqrt(W[ce]);D[ce]=Math.round(255-255*(he/this.radius+this.cutoff))}return z}};class EN{constructor(n=[],a=TN){if(this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:a,compare:u}=this,d=a[n];for(;n>0;){const m=n-1>>1,g=a[m];if(u(d,g)>=0)break;a[n]=g,n=m}a[n]=d}_down(n){const{data:a,compare:u}=this,d=this.length>>1,m=a[n];for(;n<d;){let g=1+(n<<1),v=a[g];const w=g+1;if(w<this.length&&u(a[w],v)<0&&(g=w,v=a[w]),u(v,m)>=0)break;a[n]=v,n=g}a[n]=m}}function TN(o,n){return o<n?-1:o>n?1:0}function IN(o,n=1,a=!1){let u=1/0,d=1/0,m=-1/0,g=-1/0;const v=o[0];for(let z=0;z<v.length;z++){const B=v[z];(!z||B.x<u)&&(u=B.x),(!z||B.y<d)&&(d=B.y),(!z||B.x>m)&&(m=B.x),(!z||B.y>g)&&(g=B.y)}const w=Math.min(m-u,g-d);let T=w/2;const A=new EN([],SN);if(w===0)return new R(u,d);for(let z=u;z<m;z+=w)for(let B=d;B<g;B+=w)A.push(new fh(z+T,B+T,T,o));let M=function(z){let B=0,j=0,W=0;const X=z[0];for(let oe=0,ce=X.length,he=ce-1;oe<ce;he=oe++){const de=X[oe],fe=X[he],Se=de.x*fe.y-fe.x*de.y;j+=(de.x+fe.x)*Se,W+=(de.y+fe.y)*Se,B+=3*Se}return new fh(j/B,W/B,0,z)}(o),D=A.length;for(;A.length;){const z=A.pop();(z.d>M.d||!M.d)&&(M=z,a&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,D)),z.max-M.d<=n||(T=z.h/2,A.push(new fh(z.p.x-T,z.p.y-T,T,o)),A.push(new fh(z.p.x+T,z.p.y-T,T,o)),A.push(new fh(z.p.x-T,z.p.y+T,T,o)),A.push(new fh(z.p.x+T,z.p.y+T,T,o)),D+=4)}return a&&(console.log(`num probes: ${D}`),console.log(`best distance: ${M.d}`)),M.p}function SN(o,n){return n.max-o.max}function fh(o,n,a,u){this.p=new R(o,n),this.h=a,this.d=function(d,m){let g=!1,v=1/0;for(let w=0;w<m.length;w++){const T=m[w];for(let A=0,M=T.length,D=M-1;A<M;D=A++){const z=T[A],B=T[D];z.y>d.y!=B.y>d.y&&d.x<(B.x-z.x)*(d.y-z.y)/(B.y-z.y)+z.x&&(g=!g),v=Math.min(v,QE(d,z,B))}}return(g?1:-1)*Math.sqrt(v)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const Wx=Number.POSITIVE_INFINITY,AN=Math.sqrt(2);function rI(o,n){return n[1]!==Wx?function(a,u,d){let m=0,g=0;switch(u=Math.abs(u),d=Math.abs(d),a){case"top-right":case"top-left":case"top":g=d-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-d}switch(a){case"top-right":case"bottom-right":case"right":m=-u;break;case"top-left":case"bottom-left":case"left":m=u}return[m,g]}(o,n[0],n[1]):function(a,u){let d=0,m=0;u<0&&(u=0);const g=u/AN;switch(a){case"top-right":case"top-left":m=g-7;break;case"bottom-right":case"bottom-left":m=7-g;break;case"bottom":m=7-u;break;case"top":m=u-7}switch(a){case"top-right":case"bottom-right":d=-g;break;case"top-left":case"bottom-left":d=g;break;case"left":d=u;break;case"right":d=-u}return[d,m]}(o,n[0])}function CN(o,n,a,u,d,m,g,v,w,T){o.createArrays(),o.tilePixelRatio=$t/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const A=o.layers[0].layout,M=o.layers[0]._unevaluatedLayout._values,D={};if(o.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:W}=o.textSizeData;D.compositeTextSizes=[M["text-size"].possiblyEvaluate(new Gi(j),v),M["text-size"].possiblyEvaluate(new Gi(W),v)]}if(o.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:W}=o.iconSizeData;D.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new Gi(j),v),M["icon-size"].possiblyEvaluate(new Gi(W),v)]}D.layoutTextSize=M["text-size"].possiblyEvaluate(new Gi(w+1),v),D.layoutIconSize=M["icon-size"].possiblyEvaluate(new Gi(w+1),v),D.textMaxSize=M["text-size"].possiblyEvaluate(new Gi(18),v);const z=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",B=A.get("text-size");for(const j of o.features){const W=A.get("text-font").evaluate(j,{},v).join(","),X=B.evaluate(j,{},v),oe=D.layoutTextSize.evaluate(j,{},v),ce=(D.layoutIconSize.evaluate(j,{},v),{horizontal:{},vertical:void 0}),he=j.text;let de,fe=[0,0];if(he){const Le=he.toString(),Ne=A.get("text-letter-spacing").evaluate(j,{},v)*Hn,Ee=A.get("text-line-height").evaluate(j,{},v)*Hn,Pe=D_(Le)?Ne:0,Ve=A.get("text-anchor").evaluate(j,{},v),Ze=A.get("text-variable-anchor");if(!Ze){const qt=A.get("text-radial-offset").evaluate(j,{},v);fe=qt?rI(Ve,[qt*Hn,Wx]):A.get("text-offset").evaluate(j,{},v).map(vt=>vt*Hn)}let Ge=z?"center":A.get("text-justify").evaluate(j,{},v);const Ke=A.get("symbol-placement"),Nt=Ke==="point",ti=Ke==="point"?A.get("text-max-width").evaluate(j,{},v)*Hn:0,Bt=qt=>{o.allowVerticalPlacement&&Ku(Le)&&(ce.vertical=$x(he,n,a,d,W,ti,Ee,Ve,qt,Pe,fe,_s.vertical,!0,Ke,oe,X))};if(!z&&Ze){const qt=Ge==="auto"?Ze.map(ot=>Hx(ot)):[Ge];let vt=!1;for(let ot=0;ot<qt.length;ot++){const oi=qt[ot];if(!ce.horizontal[oi])if(vt)ce.horizontal[oi]=ce.horizontal[0];else{const Si=$x(he,n,a,d,W,ti,Ee,"center",oi,Pe,fe,_s.horizontal,!1,Ke,oe,X);Si&&(ce.horizontal[oi]=Si,vt=Si.positionedLines.length===1)}}Bt("left")}else{if(Ge==="auto"&&(Ge=Hx(Ve)),Nt||A.get("text-writing-mode").indexOf("horizontal")>=0||!Ku(Le)){const qt=$x(he,n,a,d,W,ti,Ee,Ve,Ge,Pe,fe,_s.horizontal,!1,Ke,oe,X);qt&&(ce.horizontal[Ge]=qt)}Bt(Ke==="point"?"left":Ge)}}let Se=!1;if(j.icon&&j.icon.name){const Le=u[j.icon.name];Le&&(de=vN(d[j.icon.name],A.get("icon-offset").evaluate(j,{},v),A.get("icon-anchor").evaluate(j,{},v)),Se=Le.sdf,o.sdfIcons===void 0?o.sdfIcons=Le.sdf:o.sdfIcons!==Le.sdf&&Kt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Le.pixelRatio!==o.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}const Ce=oI(ce.horizontal)||ce.vertical;o.iconsInText||(o.iconsInText=!!Ce&&Ce.iconsInText),(Ce||de)&&MN(o,j,ce,de,u,D,oe,0,fe,Se,g,v,T)}m&&o.generateCollisionDebugBuffers(w,o.collisionBoxArray)}function Hx(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function MN(o,n,a,u,d,m,g,v,w,T,A,M,D){let z=m.textMaxSize.evaluate(n,{},M);z===void 0&&(z=g);const B=o.layers[0].layout,j=B.get("icon-offset").evaluate(n,{},M),W=oI(a.horizontal)||a.vertical,X=g/24,oe=o.tilePixelRatio*z/24,ce=(Ee=o.overscaling,o.zoom>18&&Ee>2&&(Ee>>=1),Math.max($t/(512*Ee),1)*B.get("symbol-spacing")),he=B.get("text-padding")*o.tilePixelRatio,de=B.get("icon-padding")*o.tilePixelRatio,fe=we(B.get("text-max-angle")),Se=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Ce=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Le=B.get("symbol-placement"),Ne=ce/2;var Ee;const Pe=B.get("icon-text-fit");let Ve;u&&Pe!=="none"&&(o.allowVerticalPlacement&&a.vertical&&(Ve=HT(u,a.vertical,Pe,B.get("icon-text-fit-padding"),j,X)),W&&(u=HT(u,W,Pe,B.get("icon-text-fit-padding"),j,X)));const Ze=(Ge,Ke,Nt)=>{if(Ke.x<0||Ke.x>=$t||Ke.y<0||Ke.y>=$t)return;const{x:ti,y:Bt,z:qt}=D.projectTilePoint(Ke.x,Ke.y,Nt),vt=new ma(ti,Bt,qt,0,void 0);(function(ot,oi,Si,In,qi,Sn,Ai,ci,Bi,ln,dn,An,Dn,Qr,zr,Vi,yr,es,jn,Pn,Qi,Wi,Nr,vr,En){const xr=ot.addToLineVertexArray(oi,In);let nr,Rn,Ps,ll,Zf,Xf,$I,jI=0,GI=0,qI=0,WI=0,u0=-1,h0=-1;const Do={};let HI=To(""),d0=0,f0=0;if(Bi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[d0,f0]=Bi.layout.get("text-offset").evaluate(Qi,{},En).map(ts=>ts*Hn):(d0=Bi.layout.get("text-radial-offset").evaluate(Qi,{},En)*Hn,f0=Wx),ot.allowVerticalPlacement&&qi.vertical){const ts=qi.vertical;if(zr)Xf=Kx(ts),ci&&($I=Kx(ci));else{const is=Bi.layout.get("text-rotate").evaluate(Qi,{},En)+90;Ps=ig(ln,Si,oi,dn,An,Dn,ts,Qr,is,Vi),ci&&(ll=ig(ln,Si,oi,dn,An,Dn,ci,es,is))}}if(Sn){const ts=Bi.layout.get("icon-rotate").evaluate(Qi,{},En),is=Bi.layout.get("icon-text-fit")!=="none",Yf=iI(Sn,ts,Nr,is),m0=ci?iI(ci,ts,Nr,is):void 0;Rn=ig(ln,Si,oi,dn,An,Dn,Sn,es,ts),jI=4*Yf.length;const KI=ot.iconSizeData;let yc=null;KI.kind==="source"?(yc=[Ao*Bi.layout.get("icon-size").evaluate(Qi,{},En)],yc[0]>il&&Kt(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):KI.kind==="composite"&&(yc=[Ao*Wi.compositeIconSizes[0].evaluate(Qi,{},En),Ao*Wi.compositeIconSizes[1].evaluate(Qi,{},En)],(yc[0]>il||yc[1]>il)&&Kt(`${ot.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ot.addSymbols(ot.icon,Yf,yc,Pn,jn,Qi,!1,Si,oi,xr.lineStartIndex,xr.lineLength,-1,vr,En),u0=ot.icon.placedSymbolArray.length-1,m0&&(GI=4*m0.length,ot.addSymbols(ot.icon,m0,yc,Pn,jn,Qi,_s.vertical,Si,oi,xr.lineStartIndex,xr.lineLength,-1,vr,En),h0=ot.icon.placedSymbolArray.length-1)}for(const ts in qi.horizontal){const is=qi.horizontal[ts];nr||(HI=To(is.text),zr?Zf=Kx(is):nr=ig(ln,Si,oi,dn,An,Dn,is,Qr,Bi.layout.get("text-rotate").evaluate(Qi,{},En),Vi));const Yf=is.positionedLines.length===1;if(qI+=sI(ot,Si,oi,is,Ai,Bi,zr,Qi,Vi,xr,qi.vertical?_s.horizontal:_s.horizontalOnly,Yf?Object.keys(qi.horizontal):[ts],Do,u0,Wi,vr,En),Yf)break}qi.vertical&&(WI+=sI(ot,Si,oi,qi.vertical,Ai,Bi,zr,Qi,Vi,xr,_s.vertical,["vertical"],Do,h0,Wi,vr,En));let cl=-1;const p0=(ts,is)=>ts?Math.max(ts,is):is;cl=p0(Zf,cl),cl=p0(Xf,cl),cl=p0($I,cl);const cF=cl>-1?1:0;ot.glyphOffsetArray.length>=nl.MAX_GLYPHS&&Kt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qi.sortKey!==void 0&&ot.addToSortKeyRanges(ot.symbolInstances.length,Qi.sortKey),ot.symbolInstances.emplaceBack(Si.x,Si.y,Si.z,oi.x,oi.y,Do.right>=0?Do.right:-1,Do.center>=0?Do.center:-1,Do.left>=0?Do.left:-1,Do.vertical>=0?Do.vertical:-1,u0,h0,HI,nr!==void 0?nr:ot.collisionBoxArray.length,nr!==void 0?nr+1:ot.collisionBoxArray.length,Ps!==void 0?Ps:ot.collisionBoxArray.length,Ps!==void 0?Ps+1:ot.collisionBoxArray.length,Rn!==void 0?Rn:ot.collisionBoxArray.length,Rn!==void 0?Rn+1:ot.collisionBoxArray.length,ll||ot.collisionBoxArray.length,ll?ll+1:ot.collisionBoxArray.length,dn,qI,WI,jI,GI,cF,0,d0,f0,cl)})(o,Ke,vt,Ge,a,u,d,Ve,o.layers[0],o.collisionBoxArray,n.index,n.sourceLayerIndex,o.index,he,Se,w,0,de,Ce,j,n,m,T,A,M)};if(Le==="line")for(const Ge of QT(n.geometry,0,0,$t,$t)){const Ke=bN(Ge,ce,fe,a.vertical||W,u,24,oe,o.overscaling,$t);for(const Nt of Ke){const ti=W;ti&&kN(o,ti.text,Ne,Nt)||Ze(Ge,Nt,M)}}else if(Le==="line-center"){for(const Ge of n.geometry)if(Ge.length>1){const Ke=xN(Ge,fe,a.vertical||W,u,24,oe);Ke&&Ze(Ge,Ke,M)}}else if(n.type==="Polygon")for(const Ge of Ox(n.geometry,0)){const Ke=IN(Ge,16);Ze(Ge[0],new ma(Ke.x,Ke.y,0,0,void 0),M)}else if(n.type==="LineString")for(const Ge of n.geometry)Ze(Ge,new ma(Ge[0].x,Ge[0].y,0,0,void 0),M);else if(n.type==="Point")for(const Ge of n.geometry)for(const Ke of Ge)Ze([Ke],new ma(Ke.x,Ke.y,0,0,void 0),M)}const il=32640;function sI(o,n,a,u,d,m,g,v,w,T,A,M,D,z,B,j,W){const X=function(he,de,fe,Se,Ce,Le,Ne,Ee){const Pe=[];if(de.positionedLines.length===0)return Pe;const Ve=Se.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,Ze=function(Bt){const qt=Bt[0],vt=Bt[1],ot=qt*vt;return ot>0?[qt,-vt]:ot<0?[-qt,vt]:qt===0?[vt,qt]:[vt,-qt]}(fe);let Ge=Math.abs(de.top-de.bottom);for(const Bt of de.positionedLines)Ge-=Bt.lineOffset;const Ke=de.positionedLines.length,Nt=Ge/Ke;let ti=de.top-fe[1];for(let Bt=0;Bt<Ke;++Bt){const qt=de.positionedLines[Bt];ti=wN(de,Nt,ti,Bt);for(const vt of qt.positionedGlyphs){if(!vt.rect)continue;const ot=vt.rect||{};let oi=4,Si=!0,In=1,qi=0;if(vt.imageName){const Wi=Ne[vt.imageName];if(!Wi)continue;if(Wi.sdf){Kt("SDF images are not supported in formatted text and will be ignored.");continue}Si=!1,In=Wi.pixelRatio,oi=1/In}const Sn=(Ce||Ee)&&vt.vertical,Ai=vt.metrics.advance*vt.scale/2,ci=vt.metrics,Bi=vt.rect;if(Bi===null)continue;Ee&&de.verticalizable&&(qi=vt.imageName?Ai-vt.metrics.width*vt.scale/2:0);const ln=Ce?[vt.x+Ai,vt.y]:[0,0];let dn=[0,0],An=[0,0],Dn=!1;Ce||(Sn?(An=[vt.x+Ai+Ze[0],vt.y+Ze[1]-qi],Dn=!0):dn=[vt.x+Ai+fe[0],vt.y+fe[1]-qi]);const Qr=Bi.w*vt.scale/(In*(vt.localGlyph?2:1)),zr=Bi.h*vt.scale/(In*(vt.localGlyph?2:1));let Vi,yr,es,jn;if(Sn){const Wi=vt.y-ti,Nr=new R(-Ai,Ai-Wi),vr=-Math.PI/2,En=new R(...An);Vi=new R(-Ai+dn[0],dn[1]),Vi._rotateAround(vr,Nr)._add(En),Vi.x+=-Wi+Ai,Vi.y-=(ci.left-oi)*vt.scale;const xr=vt.imageName?ci.advance*vt.scale:Hn*vt.scale,nr=String.fromCharCode(vt.glyph);nN(nr)?Vi.x+=(1-oi)*vt.scale:rN(nr)?Vi.x+=xr-ci.height*vt.scale+(-oi-1)*vt.scale:Vi.x+=vt.imageName||ci.width+2*oi===Bi.w&&ci.height+2*oi===Bi.h?(xr-zr)/2:(xr-(ci.height+2*oi)*vt.scale)/2,yr=new R(Vi.x,Vi.y-Qr),es=new R(Vi.x+zr,Vi.y),jn=new R(Vi.x+zr,Vi.y-Qr)}else{const Wi=(ci.left-oi)*vt.scale-Ai+dn[0],Nr=(-ci.top-oi)*vt.scale+dn[1],vr=Wi+Qr,En=Nr+zr;Vi=new R(Wi,Nr),yr=new R(vr,Nr),es=new R(Wi,En),jn=new R(vr,En)}if(Ve){let Wi;Wi=Ce?new R(0,0):Dn?new R(Ze[0],Ze[1]):new R(fe[0],fe[1]),Vi._rotateAround(Ve,Wi),yr._rotateAround(Ve,Wi),es._rotateAround(Ve,Wi),jn._rotateAround(Ve,Wi)}const Pn=new R(0,0),Qi=new R(0,0);Pe.push({tl:Vi,tr:yr,bl:es,br:jn,tex:ot,writingMode:de.writingMode,glyphOffset:ln,sectionIndex:vt.sectionIndex,isSDF:Si,pixelOffsetTL:Pn,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}}return Pe}(0,u,w,m,g,v,d,o.allowVerticalPlacement),oe=o.textSizeData;let ce=null;oe.kind==="source"?(ce=[Ao*m.layout.get("text-size").evaluate(v,{},W)],ce[0]>il&&Kt(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):oe.kind==="composite"&&(ce=[Ao*B.compositeTextSizes[0].evaluate(v,{},W),Ao*B.compositeTextSizes[1].evaluate(v,{},W)],(ce[0]>il||ce[1]>il)&&Kt(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,X,ce,w,g,v,A,n,a,T.lineStartIndex,T.lineLength,z,j,W);for(const he of M)D[he]=o.text.placedSymbolArray.length-1;return 4*X.length}function oI(o){for(const n in o)return o[n];return null}function ig(o,n,a,u,d,m,g,v,w,T){let A=g.top,M=g.bottom,D=g.left,z=g.right;const B=g.collisionPadding;if(B&&(D-=B[0],A-=B[1],z+=B[2],M+=B[3]),w){const j=new R(D,A),W=new R(z,A),X=new R(D,M),oe=new R(z,M),ce=we(w);let he=new R(0,0);T&&(he=new R(T[0],T[1])),j._rotateAround(ce,he),W._rotateAround(ce,he),X._rotateAround(ce,he),oe._rotateAround(ce,he),D=Math.min(j.x,W.x,X.x,oe.x),z=Math.max(j.x,W.x,X.x,oe.x),A=Math.min(j.y,W.y,X.y,oe.y),M=Math.max(j.y,W.y,X.y,oe.y)}return o.emplaceBack(n.x,n.y,n.z,a.x,a.y,D,A,z,M,v,u,d,m),o.length-1}function Kx(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const n=o.bottom-o.top;return n>0?Math.max(10,n):null}function kN(o,n,a,u){const d=o.compareText;if(n in d){const m=d[n];for(let g=m.length-1;g>=0;g--)if(u.dist(m[g])<a)return!0}else d[n]=[];return d[n].push(u),!1}const DN=mc.VectorTileFeature.types,PN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ng(o,n,a,u,d,m,g,v,w,T,A,M,D,z,B,j){const W=A?Math.min(il,Math.round(A[0])):0,X=A?Math.min(il,Math.round(A[1])):0;o.emplaceBack(n,a,Math.round(32*g),Math.round(32*v),w,T,(W<<1)+(M?1:0),X,16*D,16*z,256*B,256*j,u,d,m,0)}function Zx(o,n,a){o.emplaceBack(n.x,n.y,a),o.emplaceBack(n.x,n.y,a),o.emplaceBack(n.x,n.y,a),o.emplaceBack(n.x,n.y,a)}function RN(o){for(const n of o.sections)if(ux(n.text))return!0;return!1}class Xx{constructor(n){this.layoutVertexArray=new Ae,this.indexArray=new ht,this.programConfigurations=n,this.segments=new hn,this.dynamicLayoutVertexArray=new We,this.opacityVertexArray=new ve,this.placedSymbolArray=new Ys}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,a,u,d){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Xz.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,Yz.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,PN,!0),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}at(Xx,"SymbolBuffers");class Yx{constructor(n,a,u){this.layoutVertexArray=new n,this.layoutAttributes=a,this.indexArray=new u,this.segments=new hn,this.collisionVertexArray=new ke,this.collisionVertexArrayExt=new We}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Jz.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,Qz.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}at(Yx,"CollisionBuffers");class nl{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(g=>g.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=So([]),this.placementViewportMatrix=So([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fx(this.zoom,a["text-size"]),this.iconSizeData=Fx(this.zoom,a["icon-size"]);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(g=>_s[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=n.sourceID,this.projection=n.projection}createArrays(){this.text=new Xx(new hc(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Xx(new hc(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new Ii,this.lineVertexArray=new bn,this.symbolInstances=new un}calculateGlyphDependencies(n,a,u,d,m){for(let g=0;g<n.length;g++)if(a[n.charCodeAt(g)]=!0,d&&m){const v=Nf[n.charAt(g)];v&&(a[v.charCodeAt(0)]=!0)}}populate(n,a,u,d){const m=this.layers[0],g=m.layout,v=g.get("text-font"),w=g.get("text-field"),T=g.get("icon-image"),A=(w.value.kind!=="constant"||w.value.value instanceof Tn&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),M=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,D=g.get("symbol-sort-key");if(this.features=[],!A&&!M)return;const z=a.iconDependencies,B=a.glyphDependencies,j=a.availableImages,W=new Gi(this.zoom);for(const{feature:X,id:oe,index:ce,sourceLayerIndex:he}of n){const de=m._featureFilter.needGeometry,fe=dc(X,de);if(!m._featureFilter.filter(W,fe,u))continue;let Se,Ce;if(de||(fe.geometry=da(X,u,d)),A){const Ne=m.getValueAndResolveTokens("text-field",fe,u,j),Ee=Tn.factory(Ne);RN(Ee)&&(this.hasRTLText=!0),(!this.hasRTLText||Ju()==="unavailable"||this.hasRTLText&&Hr.isParsed())&&(Se=iN(Ee,m,fe))}if(M){const Ne=m.getValueAndResolveTokens("icon-image",fe,u,j);Ce=Ne instanceof Cr?Ne:Cr.fromString(Ne)}if(!Se&&!Ce)continue;const Le=this.sortFeaturesByKey?D.evaluate(fe,{},u):void 0;if(this.features.push({id:oe,text:Se,icon:Ce,index:ce,sourceLayerIndex:he,geometry:fe.geometry,properties:X.properties,type:DN[X.type],sortKey:Le}),Ce&&(z[Ce.name]=!0),Se){const Ne=v.evaluate(fe,{},u).join(","),Ee=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_s.vertical)>=0;for(const Pe of Se.sections)if(Pe.image)z[Pe.image.name]=!0;else{const Ve=Ku(Se.toString()),Ze=Pe.fontStack||Ne,Ge=B[Ze]=B[Ze]||{};this.calculateGlyphDependencies(Pe.text,Ge,Ee,this.allowVerticalPlacement,Ve)}}}g.get("symbol-placement")==="line"&&(this.features=function(X){const oe={},ce={},he=[];let de=0;function fe(Ne){he.push(X[Ne]),de++}function Se(Ne,Ee,Pe){const Ve=ce[Ne];return delete ce[Ne],ce[Ee]=Ve,he[Ve].geometry[0].pop(),he[Ve].geometry[0]=he[Ve].geometry[0].concat(Pe[0]),Ve}function Ce(Ne,Ee,Pe){const Ve=oe[Ee];return delete oe[Ee],oe[Ne]=Ve,he[Ve].geometry[0].shift(),he[Ve].geometry[0]=Pe[0].concat(he[Ve].geometry[0]),Ve}function Le(Ne,Ee,Pe){const Ve=Pe?Ee[0][Ee[0].length-1]:Ee[0][0];return`${Ne}:${Ve.x}:${Ve.y}`}for(let Ne=0;Ne<X.length;Ne++){const Ee=X[Ne],Pe=Ee.geometry,Ve=Ee.text?Ee.text.toString():null;if(!Ve){fe(Ne);continue}const Ze=Le(Ve,Pe),Ge=Le(Ve,Pe,!0);if(Ze in ce&&Ge in oe&&ce[Ze]!==oe[Ge]){const Ke=Ce(Ze,Ge,Pe),Nt=Se(Ze,Ge,he[Ke].geometry);delete oe[Ze],delete ce[Ge],ce[Le(Ve,he[Nt].geometry,!0)]=Nt,he[Ke].geometry=null}else Ze in ce?Se(Ze,Ge,Pe):Ge in oe?Ce(Ze,Ge,Pe):(fe(Ne),oe[Ze]=de-1,ce[Ge]=de-1)}return he.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,oe)=>X.sortKey-oe.sortKey)}update(n,a,u,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,a,this.layers,u,d),this.icon.programConfigurations.updatePaintArrays(n,a,this.layers,u,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,a){const u=this.lineVertexArray.length,d=n.segment;if(d!==void 0){let m=n.dist(a[d+1]),g=n.dist(a[d]);const v={};for(let w=d+1;w<a.length;w++)v[w]={x:a[w].x,y:a[w].y,tileUnitDistanceFromAnchor:m},w<a.length-1&&(m+=a[w+1].dist(a[w]));for(let w=d||0;w>=0;w--)v[w]={x:a[w].x,y:a[w].y,tileUnitDistanceFromAnchor:g},w>0&&(g+=a[w-1].dist(a[w]));for(let w=0;w<a.length;w++){const T=v[w];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,a,u,d,m,g,v,w,T,A,M,D,z,B){const j=n.indexArray,W=n.layoutVertexArray,X=n.segments.prepareSegment(4*a.length,W,j,this.canOverlap?g.sortKey:void 0),oe=this.glyphOffsetArray.length,ce=X.vertexLength,he=this.allowVerticalPlacement&&v===_s.vertical?Math.PI/2:0,de=g.text&&g.text.sections;for(let fe=0;fe<a.length;fe++){const{tl:Se,tr:Ce,bl:Le,br:Ne,tex:Ee,pixelOffsetTL:Pe,pixelOffsetBR:Ve,minFontScaleX:Ze,minFontScaleY:Ge,glyphOffset:Ke,isSDF:Nt,sectionIndex:ti}=a[fe],Bt=X.vertexLength,qt=Ke[1];ng(W,w.x,w.y,w.z,T.x,T.y,Se.x,qt+Se.y,Ee.x,Ee.y,u,Nt,Pe.x,Pe.y,Ze,Ge),ng(W,w.x,w.y,w.z,T.x,T.y,Ce.x,qt+Ce.y,Ee.x+Ee.w,Ee.y,u,Nt,Ve.x,Pe.y,Ze,Ge),ng(W,w.x,w.y,w.z,T.x,T.y,Le.x,qt+Le.y,Ee.x,Ee.y+Ee.h,u,Nt,Pe.x,Ve.y,Ze,Ge),ng(W,w.x,w.y,w.z,T.x,T.y,Ne.x,qt+Ne.y,Ee.x+Ee.w,Ee.y+Ee.h,u,Nt,Ve.x,Ve.y,Ze,Ge),Zx(n.dynamicLayoutVertexArray,w,he),j.emplaceBack(Bt,Bt+1,Bt+2),j.emplaceBack(Bt+1,Bt+2,Bt+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ke[0]),fe!==a.length-1&&ti===a[fe+1].sectionIndex||n.programConfigurations.populatePaintArrays(W.length,g,g.index,{},z,B,de&&de[ti])}n.placedSymbolArray.emplaceBack(w.x,w.y,w.z,T.x,T.y,oe,this.glyphOffsetArray.length-oe,ce,A,M,T.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],v,0,!1,0,D,0)}_commitLayoutVertex(n,a,u,d,m,g,v){n.emplaceBack(a,u,d,m,g,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(n,a,u,d,m,g,v){const w=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),T=w.vertexLength,A=v.tileAnchorX,M=v.tileAnchorY;for(let z=0;z<4;z++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(a,-n.padding,-n.padding),u.collisionVertexArrayExt.emplaceBack(a,n.padding,-n.padding),u.collisionVertexArrayExt.emplaceBack(a,n.padding,n.padding),u.collisionVertexArrayExt.emplaceBack(a,-n.padding,n.padding),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,A,M,new R(n.x1,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,A,M,new R(n.x2,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,A,M,new R(n.x2,n.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,m,g,A,M,new R(n.x1,n.y2)),w.vertexLength+=4;const D=u.indexArray;D.emplaceBack(T,T+1),D.emplaceBack(T+1,T+2),D.emplaceBack(T+2,T+3),D.emplaceBack(T+3,T),w.primitiveLength+=4}_addTextDebugCollisionBoxes(n,a,u,d,m,g){for(let v=d;v<m;v++){const w=u.get(v),T=this.getSymbolInstanceTextSize(n,g,a,v);this._addCollisionDebugVertices(w,T,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(n,a,u,d,m,g){for(let v=d;v<m;v++){const w=u.get(v),T=this.getSymbolInstanceIconSize(n,a,v);this._addCollisionDebugVertices(w,T,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,g)}}generateCollisionDebugBuffers(n,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yx($e,LT.members,Ot),this.iconCollisionBox=new Yx($e,LT.members,Ot);const u=lh(this.iconSizeData,n),d=lh(this.textSizeData,n);for(let m=0;m<this.symbolInstances.length;m++){const g=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(d,n,a,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(d,n,a,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(u,n,a,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(u,n,a,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(n,a,u,d){const m=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:d),g=X_(this.textSizeData,n,m)/Hn;return this.tilePixelRatio*g}getSymbolInstanceIconSize(n,a,u){const d=this.icon.placedSymbolArray.get(u),m=X_(this.iconSizeData,n,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(n,a,u){n.emplaceBack(a,-u,-u),n.emplaceBack(a,u,-u),n.emplaceBack(a,u,u),n.emplaceBack(a,-u,u)}_updateTextDebugCollisionBoxes(n,a,u,d,m,g){for(let v=d;v<m;v++){const w=u.get(v),T=this.getSymbolInstanceTextSize(n,g,a,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,w.padding)}}_updateIconDebugCollisionBoxes(n,a,u,d,m){for(let g=d;g<m;g++){const v=u.get(g),w=this.getSymbolInstanceIconSize(n,a,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,v.padding)}}updateCollisionDebugBuffers(n,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=lh(this.iconSizeData,n),d=lh(this.textSizeData,n);for(let m=0;m<this.symbolInstances.length;m++){const g=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(d,n,a,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(d,n,a,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(u,n,a,g.iconBoxStartIndex,g.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(u,n,a,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,a,u,d,m,g,v,w,T){const A={};for(let M=a;M<u;M++){const D=n.get(M);A.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},A.textFeatureIndex=D.featureIndex;break}for(let M=d;M<m;M++){const D=n.get(M);A.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},A.verticalTextFeatureIndex=D.featureIndex;break}for(let M=g;M<v;M++){const D=n.get(M);A.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},A.iconFeatureIndex=D.featureIndex;break}for(let M=w;M<T;M++){const D=n.get(M);A.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,padding:D.padding,projectedAnchorX:D.projectedAnchorX,projectedAnchorY:D.projectedAnchorY,projectedAnchorZ:D.projectedAnchorZ,tileAnchorX:D.tileAnchorX,tileAnchorY:D.tileAnchorY},A.verticalIconFeatureIndex=D.featureIndex;break}return A}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,a){const u=n.placedSymbolArray.get(a),d=u.vertexStartIndex+4*u.numGlyphs;for(let m=u.vertexStartIndex;m<d;m+=4)n.indexArray.emplaceBack(m,m+1,m+2),n.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(n),u=Math.cos(n),d=[],m=[],g=[];for(let v=0;v<this.symbolInstances.length;++v){g.push(v);const w=this.symbolInstances.get(v);d.push(0|Math.round(a*w.tileAnchorX+u*w.tileAnchorY)),m.push(w.featureIndex)}return g.sort((v,w)=>d[v]-d[w]||m[w]-m[v]),g}addToSortKeyRanges(n,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex),[u.rightJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.leftJustifiedTextSymbolIndex].forEach((d,m,g)=>{d>=0&&g.indexOf(d)===m&&this.addIndicesForPlacedSymbol(this.text,d)}),u.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,u.verticalPlacedTextSymbolIndex),u.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.placedIconSymbolIndex),u.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,u.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}at(nl,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),nl.MAX_GLYPHS=65535,nl.addDynamicAttributes=Zx;const LN=new F({"symbol-placement":new E(be.layout_symbol["symbol-placement"]),"symbol-spacing":new E(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new E(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new S(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new E(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new E(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new E(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new E(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new E(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new S(be.layout_symbol["icon-size"]),"icon-text-fit":new E(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new E(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new S(be.layout_symbol["icon-image"]),"icon-rotate":new S(be.layout_symbol["icon-rotate"]),"icon-padding":new E(be.layout_symbol["icon-padding"]),"icon-keep-upright":new E(be.layout_symbol["icon-keep-upright"]),"icon-offset":new S(be.layout_symbol["icon-offset"]),"icon-anchor":new S(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new E(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new E(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new E(be.layout_symbol["text-rotation-alignment"]),"text-field":new S(be.layout_symbol["text-field"]),"text-font":new S(be.layout_symbol["text-font"]),"text-size":new S(be.layout_symbol["text-size"]),"text-max-width":new S(be.layout_symbol["text-max-width"]),"text-line-height":new S(be.layout_symbol["text-line-height"]),"text-letter-spacing":new S(be.layout_symbol["text-letter-spacing"]),"text-justify":new S(be.layout_symbol["text-justify"]),"text-radial-offset":new S(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new E(be.layout_symbol["text-variable-anchor"]),"text-anchor":new S(be.layout_symbol["text-anchor"]),"text-max-angle":new E(be.layout_symbol["text-max-angle"]),"text-writing-mode":new E(be.layout_symbol["text-writing-mode"]),"text-rotate":new S(be.layout_symbol["text-rotate"]),"text-padding":new E(be.layout_symbol["text-padding"]),"text-keep-upright":new E(be.layout_symbol["text-keep-upright"]),"text-transform":new S(be.layout_symbol["text-transform"]),"text-offset":new S(be.layout_symbol["text-offset"]),"text-allow-overlap":new E(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new E(be.layout_symbol["text-ignore-placement"]),"text-optional":new E(be.layout_symbol["text-optional"])});var Jx={paint:new F({"icon-opacity":new S(be.paint_symbol["icon-opacity"]),"icon-color":new S(be.paint_symbol["icon-color"]),"icon-halo-color":new S(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new S(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new S(be.paint_symbol["icon-halo-blur"]),"icon-translate":new E(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new E(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new S(be.paint_symbol["text-opacity"]),"text-color":new S(be.paint_symbol["text-color"],{runtimeType:Cs,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new S(be.paint_symbol["text-halo-color"]),"text-halo-width":new S(be.paint_symbol["text-halo-width"]),"text-halo-blur":new S(be.paint_symbol["text-halo-blur"]),"text-translate":new E(be.paint_symbol["text-translate"]),"text-translate-anchor":new E(be.paint_symbol["text-translate-anchor"])}),layout:LN};class aI{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Gs,this.defaultValue=n}evaluate(n){if(n.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(n.formattedSection))return a.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}at(aI,"FormatSectionOverride",{omit:["defaultValue"]});class rg extends Qs{constructor(n){super(n,Jx)}recalculate(n,a){super.recalculate(n,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const m of u)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,a,u,d){const m=this.layout.get(n).evaluate(a,{},u,d),g=this._unevaluatedLayout._values[n];return g.isDataDriven()||ja(g.value)||!m?m:function(v,w){return w.replace(/{([^{}]+)}/g,(T,A)=>A in v?String(v[A]):"")}(a.properties,m)}createBucket(n){return new nl(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Jx.paint.overridableProperties){if(!rg.hasPaintOverride(this.layout,n))continue;const a=this.paint.get(n),u=new aI(a),d=new Fu(u,a.property.specification);let m=null;m=a.value.kind==="constant"||a.value.kind==="source"?new Qd("source",d):new ef("composite",d,a.value.zoomStops,a.value._interpolationType),this.paint._values[n]=new x(a.property,m,a.parameters)}}_handleOverridablePaintPropertyUpdate(n,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&rg.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,a){const u=n.get("text-field"),d=Jx.paint.properties[a];let m=!1;const g=v=>{for(const w of v)if(d.overrides&&d.overrides.hasOverride(w))return void(m=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Tn)g(u.value.value.sections);else if(u.value.kind==="source"){const v=T=>{m||(T instanceof Ws&&xn(T.value)===Oa?g(T.value.sections):T instanceof Fa?g(T.sections):T.eachChild(v))},w=u.value;w._styleExpression&&v(w._styleExpression.expression)}return m}getProgramConfiguration(n){return new Ja(this,n)}}var ON={paint:new F({"background-color":new E(be.paint_background["background-color"]),"background-pattern":new P(be.paint_background["background-pattern"]),"background-opacity":new E(be.paint_background["background-opacity"])})},zN={paint:new F({"raster-opacity":new E(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new E(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new E(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new E(be.paint_raster["raster-brightness-max"]),"raster-saturation":new E(be.paint_raster["raster-saturation"]),"raster-contrast":new E(be.paint_raster["raster-contrast"]),"raster-resampling":new E(be.paint_raster["raster-resampling"]),"raster-fade-duration":new E(be.paint_raster["raster-fade-duration"])})};class NN extends Qs{constructor(n){super(n,{}),this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}var FN={paint:new F({"sky-type":new E(be.paint_sky["sky-type"]),"sky-atmosphere-sun":new E(be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new E(be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new E(be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new E(be.paint_sky["sky-gradient-radius"]),"sky-gradient":new O(be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new E(be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new E(be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new E(be.paint_sky["sky-opacity"])})};function Qx(o,n,a){const u=[0,0,1],d=fT([]);return function(m,g,v){v*=.5;var w=g[0],T=g[1],A=g[2],M=g[3],D=Math.sin(v),z=Math.cos(v);m[0]=w*z-A*D,m[1]=T*z+M*D,m[2]=A*z+w*D,m[3]=M*z-T*D}(d,d,a?-we(o)+Math.PI:we(o)),pT(d,d,-we(n)),hT(u,u,d),Sf(u,u)}const BN={circle:class extends Qs{constructor(o){super(o,rz)}createBucket(o){return new yx(o)}queryRadius(o){const n=o;return nh("circle-radius",this,n)+nh("circle-stroke-width",this,n)+V_(this.paint.get("circle-translate"))}queryIntersectsFeature(o,n,a,u,d,m,g,v){const w=nT(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a);return mT(o,u,m,g,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,T)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Ja(this,o)}},heatmap:class extends Qs{createBucket(o){return new gT(o)}constructor(o){super(o,hz),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return nh("heatmap-radius",this,o)}queryIntersectsFeature(o,n,a,u,d,m,g,v){const w=this.paint.get("heatmap-radius").evaluate(n,a);return mT(o,u,m,g,v,!0,!0,new R(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Ja(this,o)}},hillshade:class extends Qs{constructor(o){super(o,dz)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Qs{constructor(o){super(o,Mz)}getProgramIds(){const o=this.paint.get("fill-pattern"),n=o&&o.constantOr(1),a=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(o){return new Ja(this,o)}recalculate(o,n){super.recalculate(o,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new H_(o)}queryRadius(){return V_(this.paint.get("fill-translate"))}queryIntersectsFeature(o,n,a,u,d,m){return!o.queryGeometry.isAboveHorizon&&JE(iT(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Qs{constructor(o){super(o,Vz)}createBucket(o){return new Of(o)}queryRadius(){return V_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Ja(this,o)}queryIntersectsFeature(o,n,a,u,d,m,g,v,w){const T=nT(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(n,a),M=this.paint.get("fill-extrusion-base").evaluate(n,a),D=[0,0],z=v&&m.elevation,B=m.elevation?m.elevation.exaggeration():1,j=o.tile.getBucket(this);if(z&&j instanceof Of){const oe=j.centroidVertexArray,ce=w+1;if(ce<oe.length){const he=oe.get(ce);D[0]=he.a_centroid_pos0,D[1]=he.a_centroid_pos1}}if(D[0]===0&&D[1]===1)return!1;const W=function(oe,ce,he,de,fe,Se,Ce,Le,Ne){return Se?function(Ee,Pe,Ve,Ze,Ge,Ke,Nt,ti,Bt){const qt=[],vt=[],ot=[0,0,0,1];for(const oi of Ee){const Si=[],In=[];for(const qi of oi){const Sn=qi.x+Ze.x,Ai=qi.y+Ze.y,ci=$z(Sn,Ai,Pe,Ve,Ke,Nt,ti,Bt);ot[0]=Sn,ot[1]=Ai,ot[2]=ci.base,ot[3]=1,sh(ot,ot,Ge),ot[3]=Math.max(ot[3],1e-5);const Bi=kT([ot[0]/ot[3],ot[1]/ot[3],ot[2]/ot[3]]);ot[0]=Sn,ot[1]=Ai,ot[2]=ci.top,ot[3]=1,sh(ot,ot,Ge),ot[3]=Math.max(ot[3],1e-5);const ln=kT([ot[0]/ot[3],ot[1]/ot[3],ot[2]/ot[3]]);Si.push(Bi),In.push(ln)}qt.push(Si),vt.push(In)}return[qt,vt]}(oe,ce,he,de,fe,Se,Ce,Le,Ne):function(Ee,Pe,Ve,Ze,Ge){const Ke=[],Nt=[],ti=Ge[8]*Pe,Bt=Ge[9]*Pe,qt=Ge[10]*Pe,vt=Ge[11]*Pe,ot=Ge[8]*Ve,oi=Ge[9]*Ve,Si=Ge[10]*Ve,In=Ge[11]*Ve;for(const qi of Ee){const Sn=[],Ai=[];for(const ci of qi){const Bi=ci.x+Ze.x,ln=ci.y+Ze.y,dn=Ge[0]*Bi+Ge[4]*ln+Ge[12],An=Ge[1]*Bi+Ge[5]*ln+Ge[13],Dn=Ge[2]*Bi+Ge[6]*ln+Ge[14],Qr=Ge[3]*Bi+Ge[7]*ln+Ge[15],zr=dn+ti,Vi=An+Bt,yr=Dn+qt,es=Math.max(Qr+vt,1e-5),jn=dn+ot,Pn=An+oi,Qi=Dn+Si,Wi=Math.max(Qr+In,1e-5),Nr=new R(zr/es,Vi/es);Nr.z=yr/es,Sn.push(Nr);const vr=new R(jn/Wi,Pn/Wi);vr.z=Qi/Wi,Ai.push(vr)}Ke.push(Sn),Nt.push(Ai)}return[Ke,Nt]}(oe,ce,he,de,fe)}(u,M,A,T,g,z?v:null,D,B,m.center.lat),X=o.queryGeometry;return function(oe,ce,he){let de=1/0;JE(he,ce)&&(de=MT(he,ce[0]));for(let fe=0;fe<ce.length;fe++){const Se=ce[fe],Ce=oe[fe];for(let Le=0;Le<Se.length-1;Le++){const Ne=Se[Le],Ee=[Ne,Se[Le+1],Ce[Le+1],Ce[Le],Ne];YE(he,Ee)&&(de=Math.min(de,MT(he,Ee)))}}return de!==1/0&&de}(W[0],W[1],X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends Qs{constructor(o){super(o,DT),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof jl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,n){super.recalculate(o,n),this.paint._values["line-floorwidth"]=PT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Z_(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Ja(this,o)}queryRadius(o){const n=o,a=RT(nh("line-width",this,n),nh("line-gap-width",this,n)),u=nh("line-offset",this,n);return a/2+Math.abs(u)+V_(this.paint.get("line-translate"))}queryIntersectsFeature(o,n,a,u,d,m){if(o.queryGeometry.isAboveHorizon)return!1;const g=iT(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),v=o.pixelToTileUnitsFactor/2*RT(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),w=this.paint.get("line-offset").evaluate(n,a);return w&&(u=function(T,A){const M=[],D=new R(0,0);for(let z=0;z<T.length;z++){const B=T[z],j=[];for(let W=0;W<B.length;W++){const X=B[W-1],oe=B[W],ce=B[W+1],he=W===0?D:oe.sub(X)._unit()._perp(),de=W===B.length-1?D:ce.sub(oe)._unit()._perp(),fe=he._add(de)._unit();fe._mult(1/(fe.x*de.x+fe.y*de.y)),j.push(fe._mult(A)._add(oe))}M.push(j)}return M}(u,w*o.pixelToTileUnitsFactor)),function(T,A,M){for(let D=0;D<A.length;D++){const z=A[D];if(T.length>=3){for(let B=0;B<z.length;B++)if(ih(T,z[B]))return!0}if(ez(T,z,M))return!0}return!1}(g,u,v)}isTileClipped(){return!0}},symbol:rg,background:class extends Qs{constructor(o){super(o,ON)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Qs{constructor(o){super(o,zN)}getProgramIds(){return["raster"]}},sky:class extends Qs{constructor(o){super(o,FN),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Dx({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(o,n){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),d=!u,m=o.style.light,g=m.properties.get("position");return d&&m.properties.get("anchor")==="viewport"&&Kt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?Qx(g.azimuthal,90-g.polar,n):Qx(u[0],90-u[1],n)}const a=this.paint.get("sky-gradient-center");return Qx(a[0],90-a[1],n)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}}};class Vf{constructor(n,a,u,d){this.context=n,this.format=u,this.texture=n.gl.createTexture(),this.update(a,d)}update(n,a,u){const{width:d,height:m}=n,{context:g}=this,{gl:v}=g,{HTMLImageElement:w,HTMLCanvasElement:T,HTMLVideoElement:A,ImageData:M,ImageBitmap:D}=J;if(v.bindTexture(v.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!a||a.premultiply!==!1)),u||this.size&&this.size[0]===d&&this.size[1]===m){const{x:z,y:B}=u||{x:0,y:0};n instanceof w||n instanceof T||n instanceof A||n instanceof M||D&&n instanceof D?v.texSubImage2D(v.TEXTURE_2D,0,z,B,v.RGBA,v.UNSIGNED_BYTE,n):v.texSubImage2D(v.TEXTURE_2D,0,z,B,d,m,v.RGBA,v.UNSIGNED_BYTE,n.data)}else this.size=[d,m],n instanceof w||n instanceof T||n instanceof A||n instanceof M||D&&n instanceof D?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,n):v.texImage2D(v.TEXTURE_2D,0,this.format,d,m,0,this.format,v.UNSIGNED_BYTE,n.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,a){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),n!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?n===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:n),this.filter=n),a!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class e0{constructor(n,a){this.width=n,this.height=a,this.nextRow=0,this.image=new fa({width:n,height:a}),this.positions={},this.uploaded=!1}getDash(n,a){const u=this.getKey(n,a);return this.positions[u]}trim(){const n=this.width,a=this.height=Fn(this.nextRow);this.image.resize({width:n,height:a})}getKey(n,a){return n.join(",")+a}getDashRanges(n,a,u){const d=[];let m=n.length%2==1?-n[n.length-1]*u:0,g=n[0]*u,v=!0;d.push({left:m,right:g,isDash:v,zeroLength:n[0]===0});let w=n[0];for(let T=1;T<n.length;T++){v=!v;const A=n[T];m=w*u,w+=A,g=w*u,d.push({left:m,right:g,isDash:v,zeroLength:A===0})}return d}addRoundDash(n,a,u){const d=a/2;for(let m=-u;m<=u;m++){const g=this.width*(this.nextRow+u+m);let v=0,w=n[v];for(let T=0;T<this.width;T++){T/w.right>1&&(w=n[++v]);const A=Math.abs(T-w.left),M=Math.abs(T-w.right),D=Math.min(A,M);let z;const B=m/u*(d+1);if(w.isDash){const j=d-Math.abs(B);z=Math.sqrt(D*D+j*j)}else z=d-Math.sqrt(D*D+B*B);this.image.data[g+T]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(n,a){for(let w=n.length-1;w>=0;--w){const T=n[w],A=n[w+1];T.zeroLength?n.splice(w,1):A&&A.isDash===T.isDash&&(A.left=T.left,n.splice(w,1))}const u=n[0],d=n[n.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const m=this.width*this.nextRow;let g=0,v=n[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=n[++g]);const T=Math.abs(w-v.left),A=Math.abs(w-v.right),M=Math.min(T,A);this.image.data[m+w]=Math.max(0,Math.min(255,(v.isDash?M:-M)+a+128))}}addDash(n,a){const u=this.getKey(n,a);if(this.positions[u])return this.positions[u];const d=a==="round",m=d?7:0,g=2*m+1;if(this.nextRow+g>this.height)return Kt("LineAtlas out of space"),null;n.length===0&&n.push(1);let v=0;for(let A=0;A<n.length;A++)n[A]<0&&(Kt("Negative value is found in line dasharray, replacing values with 0"),n[A]=0),v+=n[A];if(v!==0){const A=this.width/v,M=this.getDashRanges(n,this.width,A);d?this.addRoundDash(M,A,m):this.addRegularDash(M,a==="square"?.5*A:0)}const w=this.nextRow+m;this.nextRow+=g;const T={tl:[w,m],br:[v,0]};return this.positions[u]=T,T}}at(e0,"LineAtlas");class UN{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const VN=J.performance;function lI(o){const n=o?o.url.toString():void 0;return VN.getEntriesByName(n)}class $N{constructor(){this.tasks={},this.taskQueue=[],Zt(["process"],this),this.invoker=new UN(this.process),this.nextId=0}add(n,a){const u=this.nextId++,d=function({type:m,isSymbolTile:g,zoom:v}){return v=v||0,m==="message"?0:m!=="maybePrepare"||g?m!=="parseTile"||g?m==="parseTile"&&g?300-v:m==="maybePrepare"&&g?400-v:500:200-v:100-v}(a);if(d===0){_t();try{n()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:n,metadata:a,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){_t();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const a=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let n=null,a=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<a&&(a=m.priority,n=d)}if(n===null)return null;const u=this.taskQueue[n];return this.taskQueue.splice(n,1),u}remove(){this.invoker.remove()}}const jN=ie([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),GN=ie([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:cI}=jN,uI=ie([{name:"a_pos_3",components:3,type:"Int16"}]);var $f=ie([{name:"a_pos",type:"Int16",components:2}]);const ph=$t/Math.PI/2,Yr=-ph,Jr=ph,qN=[new ms([Yr,Yr,Yr],[Jr,Jr,Jr]),new ms([Yr,Yr,Yr],[0,0,Jr]),new ms([0,Yr,Yr],[Jr,0,Jr]),new ms([Yr,0,Yr],[0,Jr,Jr]),new ms([0,0,Yr],[Jr,Jr,Jr])];class WN{constructor(n,a,u){this.a=rh([],n,u),this.b=rh([],a,u),this.center=u;const d=Sf([],this.a),m=Sf([],this.b);this.angle=Math.acos(Af(d,m))}}function t0(o,n){if(o.angle===0)return null;let a;return a=o.a[n]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[n]/o.a[n]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:function(u,d,m,g){const v=Math.sin(m);return u*(Math.sin((1-g)*m)/v)+d*(Math.sin(g*m)/v)}(o.a[n],o.b[n],o.angle,rt(a,0,1))+o.center[n]}function jf(o){if(o.z<=1)return qN[o.z+2*o.y+o.x];const[n,a]=i0(o),u=[_a(n[0],n[1]),_a(n[0],a[1]),_a(a[0],n[1]),_a(a[0],a[1])],d=[Jr,Jr,Jr],m=[Yr,Yr,Yr];for(const g of u)d[0]=Math.min(d[0],g[0]),d[1]=Math.min(d[1],g[1]),d[2]=Math.min(d[2],g[2]),m[0]=Math.max(m[0],g[0]),m[1]=Math.max(m[1],g[1]),m[2]=Math.max(m[2],g[2]);return new ms(d,m)}function HN(o,n,a){const u=n/o.worldSize,d=(Pe,Ve)=>{If(Pe,Pe,u),If(Ve,Ve,u)},m=Number.MAX_VALUE,g=[-m,-m,-m],v=[m,m,m],w=mI(o);if(a.z<=1){const Pe=jf(a).getCorners();for(let Ve=0;Ve<Pe.length;Ve++)pc(Pe[Ve],Pe[Ve],w),Sx(v,v,Pe[Ve]),Ax(g,g,Pe[Ve]);return d(v,g),new ms(v,g)}const[T,A]=i0(a),M=new Qa;M.setSouthWest([T[1],A[0]]),M.setNorthEast([A[1],T[0]]);const D=[_a(M.getSouth(),M.getWest()),_a(M.getSouth(),M.getEast()),_a(M.getNorth(),M.getEast()),_a(M.getNorth(),M.getWest())];for(let Pe=0;Pe<D.length;Pe++)pc(D[Pe],D[Pe],w),Sx(v,v,D[Pe]),Ax(g,g,D[Pe]);if(M.contains(o.center))return g[2]=0,d(v,g),new ms(v,g);const z=[w[12],w[13],w[14]],B=o.center.lng,j=rt(o.center.lat,-85.051129,Io),W=[Ef(B),eh(j)],X=M.getCenter().lng,oe=rt(M.getCenter().lat,-85.051129,Io),ce=[Ef(X),eh(oe)];let he=new Array(3),de=0;const fe=W[0]-ce[0],Se=W[1]-ce[1];if(Math.abs(fe)>Math.abs(Se))de=fe>=0?1:3,he=z;else{de=Se>=0?0:2;const Pe=[w[4],w[5],w[6]];let Ve;Ve=Se>=0?-Math.sin(we(M.getSouth()))*ph:-Math.sin(we(M.getNorth()))*ph,he=Cx(he,z,Pe,Ve)}const Ce=D[de],Le=D[(de+1)%4],Ne=new WN(Ce,Le,he),Ee=[t0(Ne,0)||Ce[0],t0(Ne,1)||Ce[1],t0(Ne,2)||Ce[2]];return v[2]=Math.min(Ce[2],Le[2]),Sx(v,v,Ee),Ax(g,g,Ee),d(v,g),new ms(v,g)}function i0(o){const n=1<<o.z,a=o.x/n,u=(o.x+1)/n,d=(o.y+1)/n;return[[Wn(o.y/n),ks(a)],[Wn(d),ks(u)]]}function hI(o,n,a,u=ph){return a=we(a),[o*Math.sin(a)*u,-n*u,o*Math.cos(a)*u]}function _a(o,n,a){return hI(Math.cos(we(o)),Math.sin(we(o)),n,a)}function dI(o,n,a){const u=Math.pow(2,a.z),d=(o/$t+a.x)/u;return _a(Wn((n/$t+a.y)/u),ks(d))}function n0(o){return 16383/Math.max(...rh([],o.max,o.min))}function fI(o){const n=So(new Float64Array(16)),a=n0(o);var u,d;return el(n,n,[a,a,a]),fc(n,n,((u=[])[0]=-(d=o.min)[0],u[1]=-d[1],u[2]=-d[2],u)),n}function pI(o,n,a,u,d){const m=function(w){const T=$t/(2*Math.PI);return w/(2*Math.PI)/T}(a),g=[o,n,-a/(2*Math.PI)],v=So(new Float64Array(16));return fc(v,v,g),el(v,v,[m,m,m]),Ex(v,v,we(-d)),Tx(v,v,we(-u)),v}function mI(o){const{x:n,y:a}=o.point,{lng:u,lat:d}=o._center;return pI(n,a,o.worldSize,u,d)}const _I=we(85),KN=Math.cos(_I),ZN=Math.sin(_I);function gI(o,n,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[o*u-2*Math.PI*6378137/2,n*u-2*Math.PI*6378137/2]}class sg{constructor(n,a,u){this.z=n,this.x=a,this.y=u,this.key=Gf(0,n,n,a,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,a){const u=function(m,g,v){var w=gI(256*m,256*(g=Math.pow(2,v)-g-1),v),T=gI(256*(m+1),256*(g+1),v);return w[0]+","+w[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),d=function(m,g,v){let w,T="";for(let A=m;A>0;A--)w=1<<A-1,T+=(g&w?1:0)+(v&w?2:0);return T}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yI{constructor(n,a){this.wrap=n,this.canonical=a,this.key=Gf(n,a.z,a.z,a.x,a.y)}}class gr{constructor(n,a,u,d,m){this.overscaledZ=n,this.wrap=a,this.canonical=new sg(u,+d,+m),this.key=a===0&&n===u?this.canonical.key:Gf(a,n,u,d,m)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const a=this.canonical.z-n;return n>this.canonical.z?new gr(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gr(n,this.wrap,n,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(n,a=!0){if(this.overscaledZ===n&&a)return this.key;if(n>this.canonical.z)return Gf(this.wrap*+a,n,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-n;return Gf(this.wrap*+a,n,n,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const a=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>a&&n.canonical.y===this.canonical.y>>a}children(n){if(this.overscaledZ>=n)return[new gr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new gr(a,this.wrap,a,u,d),new gr(a,this.wrap,a,u+1,d),new gr(a,this.wrap,a,u,d+1),new gr(a,this.wrap,a,u+1,d+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new gr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new gr(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yI(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gf(o,n,a,u,d){const m=1<<Math.min(a,22);let g=m*(d%m)+u%m;return o&&a<22&&(g+=m*m*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*g+a)+(n-a)}function _c(o,n){if(!n.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:n};const a=Math.pow(2,-o.z),u=o.x*a,d=(o.x+1)*a,m=o.y*a,g=(o.y+1)*a,v=ks(u),w=ks(d),T=Wn(m),A=Wn(g),M=n.project(v,T),D=n.project(w,T),z=n.project(w,A),B=n.project(v,A);let j=Math.min(M.x,D.x,z.x,B.x),W=Math.min(M.y,D.y,z.y,B.y),X=Math.max(M.x,D.x,z.x,B.x),oe=Math.max(M.y,D.y,z.y,B.y);const ce=a/16;function he(fe,Se,Ce,Le,Ne,Ee){const Pe=(Ce+Ne)/2,Ve=(Le+Ee)/2,Ze=n.project(ks(Pe),Wn(Ve)),Ge=Math.max(0,j-Ze.x,W-Ze.y,Ze.x-X,Ze.y-oe);j=Math.min(j,Ze.x),X=Math.max(X,Ze.x),W=Math.min(W,Ze.y),oe=Math.max(oe,Ze.y),Ge>ce&&(he(fe,Ze,Ce,Le,Pe,Ve),he(Ze,Se,Pe,Ve,Ne,Ee))}he(M,D,u,m,d,m),he(D,z,d,m,d,g),he(z,B,d,g,u,g),he(B,M,u,g,u,m),j-=ce,W-=ce,X+=ce,oe+=ce;const de=1/Math.max(X-j,oe-W);return{scale:de,x:j*de,y:W*de,x2:X*de,y2:oe*de,projection:n}}at(sg,"CanonicalTileID"),at(gr,"OverscaledTileID",{omit:["projMatrix"]});class vI{constructor(n){this._stringToNumber={},this._numberToString=[];for(let a=0;a<n.length;a++){const u=n[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const XN=["tile","layer","source","sourceLayer","state"];class xI{constructor(n,a,u,d,m){this.type="Feature",this._vectorTileFeature=n,this._z=a,this._x=u,this._y=d,this.properties=n.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(n.id=this.id);for(const a of XN)this[a]!==void 0&&(n[a]=this[a]);return n}}const Ds=32,Co=33,rl=new Uint16Array(8184);for(let o=0;o<2046;o++){let n=o+2,a=0,u=0,d=0,m=0,g=0,v=0;for(1&n?d=m=g=Ds:a=u=v=Ds;(n>>=1)>1;){const T=a+d>>1,A=u+m>>1;1&n?(d=a,m=u,a=g,u=v):(a=d,u=m,d=g,m=v),g=T,v=A}const w=4*o;rl[w+0]=a,rl[w+1]=u,rl[w+2]=d,rl[w+3]=m}const Mo=new Uint16Array(2178),sl=new Uint8Array(1089),og=new Uint16Array(1089);function bI(o){return o===0?-.03125:o===32?.03125:0}var wI=ie([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const EI={type:2,extent:$t,loadGeometry:()=>[[new R(0,0),new R(8193,0),new R(8193,8193),new R(0,8193),new R(0,0)]]};class r0{constructor(n,a,u,d,m){this.tileID=n,this.uid=Xi(),this.uses=0,this.tileSize=a,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(n){const a=n+this.timeAdded;a<Ie.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=_c(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,u){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(d,m){const g={};if(!m)return g;for(const v of d){const w=v.layerIds.map(T=>m.getLayer(T)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(T=>w.filter(A=>A.id===T)[0]));for(const T of w)g[T.id]=v}}return g}(n.buckets,a.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof nl){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof nl&&m.hasRTLText){this.hasRTLText=!0,Hr.isLoading()||Hr.isLoaded()||Ju()!=="deferred"||Ka();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(d).queryRadius(m))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas)}else this.collisionBoxArray=new Xs}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.id]}upload(n){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(n)}const a=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vf(n,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vf(n,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Vf(n,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,a,u,d,m,g,v,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:v,transform:g,params:m,tileTransform:this.tileTransform},n,a,u):{}}querySourceFeatures(n,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),m=a?a.sourceLayer:"",g=d._geojsonTileLayer||d[m];if(!g)return;const v=vo(a&&a.filter),{z:w,x:T,y:A}=this.tileID.canonical,M={z:w,x:T,y:A};for(let D=0;D<g.length;D++){const z=g.feature(D);if(v.needGeometry){const W=dc(z,!0);if(!v.filter(new Gi(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!v.filter(new Gi(this.tileID.overscaledZ),z))continue;const B=u.getId(z,m),j=new xI(z,w,T,A,B);j.tile=M,n.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const a=this.expirationTime;if(n.cacheControl){const u=tt(n.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(a)if(this.expirationTime<a)d=!0;else{const m=this.expirationTime-a;m?this.expirationTime=u+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0||!a)return;const u=this.latestFeatureIndex.loadVTLayers(),d=a.style.listImages();for(const m in this.buckets){if(!a.style.hasLayer(m))continue;const g=this.buckets[m],v=g.layers[0].sourceLayer||"_geojsonTileLayer",w=u[v],T=n[v];if(!w||!T||Object.keys(T).length===0)continue;if(g.update(T,w,d,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof Z_||g instanceof H_){const M=a.style._getSourceCache(g.layers[0].source);a._terrain&&a._terrain.enabled&&M&&g.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(M.id,this.tileID)}const A=a&&a.style&&a.style.getLayer(m);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ie.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=Ie.now()+n}setTexture(n,a){const u=a.context,d=u.gl;this.texture=a.getTileTexture(n.width),this.texture?this.texture.update(n,{useMipmap:!0}):(this.texture=new Vf(u,n,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(n,a){const u={};for(const d of a)u[d]=!0;this.dependencies[n]=u}hasDependency(n,a){for(const u of n){const d=this.dependencies[u];if(d){for(const m of a)if(d[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const u=da(EI,this.tileID.canonical,this.tileTransform)[0],d=new ee,m=new pi;for(let g=0;g<u.length;g++){const{x:v,y:w}=u[g];d.emplaceBack(v,w),m.emplaceBack(g)}m.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(m),this._tileDebugBuffer=n.createVertexBuffer(d,$f.members),this._tileDebugSegments=hn.simpleSegment(0,0,d.length,m.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const u=da(EI,this.tileID.canonical,this.tileTransform)[0];let d,m;if(this.isRaster){const g=function(v,w){const T=_c(v,w),A=Math.pow(2,v.z);for(let W=0;W<Co;W++)for(let X=0;X<Co;X++){const oe=ks((v.x+(X+bI(X))/Ds)/A),ce=Wn((v.y+(W+bI(W))/Ds)/A),he=w.project(oe,ce),de=W*Co+X;Mo[2*de+0]=Math.round((he.x*T.scale-T.x)*$t),Mo[2*de+1]=Math.round((he.y*T.scale-T.y)*$t)}sl.fill(0),og.fill(0);for(let W=2045;W>=0;W--){const X=4*W,oe=rl[X+0],ce=rl[X+1],he=rl[X+2],de=rl[X+3],fe=oe+he>>1,Se=ce+de>>1,Ce=fe+Se-ce,Le=Se+oe-fe,Ne=ce*Co+oe,Ee=de*Co+he,Pe=Se*Co+fe,Ve=Math.hypot((Mo[2*Ne+0]+Mo[2*Ee+0])/2-Mo[2*Pe+0],(Mo[2*Ne+1]+Mo[2*Ee+1])/2-Mo[2*Pe+1])>=16;if(sl[Pe]=sl[Pe]||(Ve?1:0),W<1022){const Ze=(ce+Le>>1)*Co+(oe+Ce>>1),Ge=(de+Le>>1)*Co+(he+Ce>>1);sl[Pe]=sl[Pe]||sl[Ze]||sl[Ge]}}const M=new re,D=new ht;let z=0;function B(W,X){const oe=X*Co+W;return og[oe]===0&&(M.emplaceBack(Mo[2*oe+0],Mo[2*oe+1],W*$t/Ds,X*$t/Ds),og[oe]=++z),og[oe]-1}function j(W,X,oe,ce,he,de){const fe=W+oe>>1,Se=X+ce>>1;if(Math.abs(W-he)+Math.abs(X-de)>1&&sl[Se*Co+fe])j(he,de,W,X,fe,Se),j(oe,ce,he,de,fe,Se);else{const Ce=B(W,X),Le=B(oe,ce),Ne=B(he,de);D.emplaceBack(Ce,Le,Ne)}}return j(0,0,Ds,Ds,Ds,0),j(Ds,Ds,0,0,0,Ds),{vertices:M,indices:D}}(this.tileID.canonical,a);d=g.vertices,m=g.indices}else{d=new re,m=new ht;for(const{x:v,y:w}of u)d.emplaceBack(v,w,0,0);const g=$_(d.int16,void 0,4);for(let v=0;v<g.length;v+=3)m.emplaceBack(g[v],g[v+1],g[v+2])}this._tileBoundsBuffer=n.createVertexBuffer(d,wI.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(m),this._tileBoundsSegments=hn.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugBuffers(n,a){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!a||a.name!=="globe")return;const u=this.tileID.canonical,d=fI(jf(u));this._makeGlobeTileDebugBorderBuffer(n,u,d),this._makeGlobeTileDebugTextBuffer(n,u,d)}_makeGlobeTileDebugBorderBuffer(n,a,u){const d=new ee,m=new pi,g=new te,v=(T,A,M,D,z)=>{const B=(M-T)/(z-1),j=(D-A)/(z-1),W=d.length;for(let X=0;X<z;X++){const oe=T+X*B,ce=A+X*j;d.emplaceBack(oe,ce);const he=dI(oe,ce,a),de=pc(he,he,u);g.emplaceBack(de[0],de[1],de[2]),m.emplaceBack(W+X)}},w=$t;v(0,0,w,0,16),v(w,0,w,w,16),v(w,w,0,w,16),v(0,w,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(m),this._tileDebugBuffer=n.createVertexBuffer(d,$f.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(g,uI.members),this._tileDebugSegments=hn.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugTextBuffer(n,a,u){const d=new ee,m=new ht,g=new te,v=25;m.reserve(32),d.reserve(v),g.reserve(v);const w=(T,A)=>v*T+A;for(let T=0;T<v;T++){const A=2048*T;for(let M=0;M<v;M++){const D=2048*M;d.emplaceBack(D,A);const z=dI(D,A,a),B=pc(z,z,u);g.emplaceBack(B[0],B[1],B[2])}}for(let T=0;T<4;T++)for(let A=0;A<4;A++){const M=w(T,A),D=w(T,A+1),z=w(T+1,A),B=w(T+1,A+1);m.emplaceBack(M,D,z),m.emplaceBack(z,D,B)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(m),this._tileDebugTextBuffer=n.createVertexBuffer(d,$f.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(g,uI.members),this._tileDebugTextSegments=hn.simpleSegment(0,0,v,32)}}class YN{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,u){const d=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][d]=this.stateChanges[n][d]||{},Ht(this.stateChanges[n][d],u),this.deletedStates[n]===null){this.deletedStates[n]={};for(const m in this.state[n])m!==d&&(this.deletedStates[n][m]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][d]===null){this.deletedStates[n][d]={};for(const m in this.state[n][d])u[m]||(this.deletedStates[n][d][m]=null)}else for(const m in u)this.deletedStates[n]&&this.deletedStates[n][d]&&this.deletedStates[n][d][m]===null&&delete this.deletedStates[n][d][m]}removeFeatureState(n,a,u){if(this.deletedStates[n]===null)return;const d=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},u&&a!==void 0)this.deletedStates[n][d]!==null&&(this.deletedStates[n][d]=this.deletedStates[n][d]||{},this.deletedStates[n][d][u]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][d])for(u in this.deletedStates[n][d]={},this.stateChanges[n][d])this.deletedStates[n][d][u]=null;else this.deletedStates[n][d]=null;else this.deletedStates[n]=null}getState(n,a){const u=String(a),d=Ht({},(this.state[n]||{})[u],(this.stateChanges[n]||{})[u]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const m=this.deletedStates[n][a];if(m===null)return{};for(const g in m)delete d[g]}return d}initializeTileState(n,a){n.setFeatureState(this.state,a)}coalesceChanges(n,a){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const g in this.stateChanges[d])this.state[d][g]||(this.state[d][g]={}),Ht(this.state[d][g],this.stateChanges[d][g]),m[g]=this.state[d][g];u[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(this.deletedStates[d]===null)for(const g in this.state[d])m[g]={},this.state[d][g]={};else for(const g in this.deletedStates[d]){if(this.deletedStates[d][g]===null)this.state[d][g]={};else for(const v of Object.keys(this.deletedStates[d][g]))delete this.state[d][g][v];m[g]=this.state[d][g]}u[d]=u[d]||{},Ht(u[d],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in n)n[d].setFeatureState(u,a)}}class TI{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,a){const u=this.toIdx(n,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(n,a){return this.leaves[this.toIdx(n,a)]}toIdx(n,a){return a*this.size+n}}function II(o,n,a,u){let d=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(a[g]<o[g]||a[g]>n[g])return null}else{const v=1/u[g];let w=(o[g]-a[g])*v,T=(n[g]-a[g])*v;if(w>T){const A=w;w=T,T=A}if(w>d&&(d=w),T<m&&(m=T),d>m)return null}return d}function SI(o,n,a,u,d,m,g,v,w,T,A){const M=u-o,D=d-n,z=m-a,B=g-o,j=v-n,W=w-a,X=A[1]*W-A[2]*j,oe=A[2]*B-A[0]*W,ce=A[0]*j-A[1]*B,he=M*X+D*oe+z*ce;if(Math.abs(he)<1e-15)return null;const de=1/he,fe=T[0]-o,Se=T[1]-n,Ce=T[2]-a,Le=(fe*X+Se*oe+Ce*ce)*de;if(Le<0||Le>1)return null;const Ne=Se*z-Ce*D,Ee=Ce*M-fe*z,Pe=fe*D-Se*M,Ve=(A[0]*Ne+A[1]*Ee+A[2]*Pe)*de;return Ve<0||Le+Ve>1?null:(B*Ne+j*Ee+W*Pe)*de}function AI(o,n,a){return(o-n)/(a-n)}function CI(o,n,a,u,d,m,g,v,w){const T=1<<a,A=m-u,M=g-d,D=(o+1)/T*A+u,z=(n+0)/T*M+d,B=(n+1)/T*M+d;v[0]=(o+0)/T*A+u,v[1]=z,w[0]=D,w[1]=B}class MI{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(m){const g=Math.ceil(Math.log2(m.dim/8)),v=[];let w=Math.ceil(Math.pow(2,g));const T=1/w,A=(z,B,j,W,X)=>{const oe=W?1:0,ce=(z+1)*j-oe,he=B*j,de=(B+1)*j-oe;X[0]=z*j,X[1]=he,X[2]=ce,X[3]=de};let M=new TI(w);const D=[];for(let z=0;z<w*w;z++){A(z%w,Math.floor(z/w),T,!1,D);const B=ol(D[0],D[1],m),j=ol(D[2],D[1],m),W=ol(D[2],D[3],m),X=ol(D[0],D[3],m);M.minimums.push(Math.min(B,j,W,X)),M.maximums.push(Math.max(B,j,W,X)),M.leaves.push(1)}for(v.push(M),w/=2;w>=1;w/=2){const z=v[v.length-1];M=new TI(w);for(let B=0;B<w*w;B++){A(B%w,Math.floor(B/w),2,!0,D);const j=z.getElevation(D[0],D[1]),W=z.getElevation(D[2],D[1]),X=z.getElevation(D[2],D[3]),oe=z.getElevation(D[0],D[3]),ce=z.isLeaf(D[0],D[1]),he=z.isLeaf(D[2],D[1]),de=z.isLeaf(D[2],D[3]),fe=z.isLeaf(D[0],D[3]),Se=Math.min(j.min,W.min,X.min,oe.min),Ce=Math.max(j.max,W.max,X.max,oe.max),Le=ce&&he&&de&&fe;M.maximums.push(Ce),M.minimums.push(Se),M.leaves.push(Ce-Se<=5&&Le?1:0)}v.push(M)}return v}(this.dem),u=a.length-1,d=a[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(n,a,u,d,m,g,v=1){return II([n,a,-100],[u,d,this.maximums[0]*v],m,g)}raycast(n,a,u,d,m,g,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(n,a,u,d,m,g,v);if(w==null)return null;const T=[],A=[],M=[],D=[],z=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:B,t:j,nodex:W,nodey:X,depth:oe}=z.pop();if(this.leaves[B]){CI(W,X,oe,n,a,u,d,M,D);const he=1<<oe,de=(W+0)/he,fe=(W+1)/he,Se=(X+0)/he,Ce=(X+1)/he,Le=ol(de,Se,this.dem)*v,Ne=ol(fe,Se,this.dem)*v,Ee=ol(fe,Ce,this.dem)*v,Pe=ol(de,Ce,this.dem)*v,Ve=SI(M[0],M[1],Le,D[0],M[1],Ne,D[0],D[1],Ee,m,g),Ze=SI(D[0],D[1],Ee,M[0],D[1],Pe,M[0],M[1],Le,m,g),Ge=Math.min(Ve!==null?Ve:Number.MAX_VALUE,Ze!==null?Ze:Number.MAX_VALUE);if(Ge!==Number.MAX_VALUE)return Ge;{const Ke=Cx([],m,g,j);if(kI(Le,Ne,Pe,Ee,AI(Ke[0],M[0],D[0]),AI(Ke[1],M[1],D[1]))>=Ke[2])return j}continue}let ce=0;for(let he=0;he<this._siblingOffset.length;he++){CI((W<<1)+this._siblingOffset[he][0],(X<<1)+this._siblingOffset[he][1],oe+1,n,a,u,d,M,D),M[2]=-100,D[2]=this.maximums[this.childOffsets[B]+he]*v;const de=II(M,D,m,g);if(de!=null){const fe=de;T[he]=fe;let Se=!1;for(let Ce=0;Ce<ce&&!Se;Ce++)fe>=T[A[Ce]]&&(A.splice(Ce,0,he),Se=!0);Se||(A[ce]=he),ce++}}for(let he=0;he<ce;he++){const de=A[he];z.push({idx:this.childOffsets[B]+de,t:T[de],nodex:(W<<1)+this._siblingOffset[de][0],nodey:(X<<1)+this._siblingOffset[de][1],depth:oe+1})}}return null}_addNode(n,a,u){return this.minimums.push(n),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(n,a,u,d,m){if(n[d].isLeaf(a,u)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const g=d-1,v=n[g];let w=0,T=0;for(let A=0;A<this._siblingOffset.length;A++){const M=2*a+this._siblingOffset[A][0],D=2*u+this._siblingOffset[A][1],z=v.getElevation(M,D),B=v.isLeaf(M,D),j=this._addNode(z.min,z.max,B);B&&(w|=1<<A),T||(T=j)}for(let A=0;A<this._siblingOffset.length;A++)w&1<<A||this._construct(n,2*a+this._siblingOffset[A][0],2*u+this._siblingOffset[A][1],g,T+A)}}function kI(o,n,a,u,d,m){return At(At(o,a,m),At(n,u,m),d)}function ol(o,n,a){const u=a.dim,d=rt(o*u-.5,0,u-1),m=rt(n*u-.5,0,u-1),g=Math.floor(d),v=Math.floor(m),w=Math.min(g+1,u-1),T=Math.min(v+1,u-1);return kI(a.get(g,v),a.get(w,v),a.get(g,T),a.get(w,T),d-g,m-v)}const DI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ag{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,a,u,d=!1,m=!1){if(this.uid=n,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Kt(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const g=this.dim=a.height-2,v=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=u||"mapbox",this.borderReady=d,!d){for(let w=0;w<g;w++)v[this._idx(-1,w)]=v[this._idx(0,w)],v[this._idx(g,w)]=v[this._idx(g-1,w)],v[this._idx(w,-1)]=v[this._idx(w,0)],v[this._idx(w,g)]=v[this._idx(w,g-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(g,-1)]=v[this._idx(g-1,0)],v[this._idx(-1,g)]=v[this._idx(0,g-1)],v[this._idx(g,g)]=v[this._idx(g-1,g-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new MI(this)}get(n,a,u=!1){u&&(n=rt(n,-1,this.dim),a=rt(a,-1,this.dim));const d=4*this._idx(n,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[d],this.pixels[d+1],this.pixels[d+2])}static getUnpackVector(n){return DI[n]}get unpackVector(){return DI[this.encoding]}_idx(n,a){if(n<-1||n>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(n+1)}_unpackMapbox(n,a,u){return(256*n*256+256*a+u)/10-1e4}_unpackTerrarium(n,a,u){return 256*n+a+u/256-32768}static pack(n,a){const u=[0,0,0,0],d=ag.getUnpackVector(a);let m=Math.floor((n+d[3])/d[2]);return u[2]=m%256,m=Math.floor(m/256),u[1]=m%256,m=Math.floor(m/256),u[0]=m,u}getPixels(){return new Xr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,a,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,m=a*this.dim+this.dim,g=u*this.dim,v=u*this.dim+this.dim;switch(a){case-1:d=m-1;break;case 1:m=d+1}switch(u){case-1:g=v-1;break;case 1:v=g+1}const w=-a*this.dim,T=-u*this.dim;for(let A=g;A<v;A++)for(let M=d;M<m;M++){const D=4*this._idx(M,A),z=4*this._idx(M+w,A+T);this.pixels[D+0]=n.pixels[z+0],this.pixels[D+1]=n.pixels[z+1],this.pixels[D+2]=n.pixels[z+2],this.pixels[D+3]=n.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}at(ag,"DEMData"),at(MI,"DemMinMaxQuadTree",{omit:["dem"]});class JN{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(const n in this.data)for(const a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,u){const d=n.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const m={value:a,timeout:void 0};if(u!==void 0&&(m.timeout=setTimeout(()=>{this.remove(n,m)},u)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){const a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;const u=n.wrapped().key,d=a===void 0?0:this.data[u].indexOf(a),m=this.data[u][d];return this.data[u].splice(d,1),m.timeout&&clearTimeout(m.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){const a=[];for(const u in this.data)for(const d of this.data[u])n(d.value)||a.push(d);for(const u of a)this.remove(u.value.tileID,u)}}class mh{constructor(n,a,u){this.func=n,this.mask=a,this.range=u}}mh.ReadOnly=!1,mh.ReadWrite=!0,mh.disabled=new mh(519,mh.ReadOnly,[0,1]);const s0=7680;class o0{constructor(n,a,u,d,m,g){this.test=n,this.ref=a,this.mask=u,this.fail=d,this.depthFail=m,this.pass=g}}o0.disabled=new o0({func:519,mask:0},0,0,s0,s0,s0);class ko{constructor(n,a,u){this.blendFunction=n,this.blendColor=a,this.mask=u}}ko.Replace=[1,0],ko.disabled=new ko(ko.Replace,wi.transparent,[!1,!1,!1,!1]),ko.unblended=new ko(ko.Replace,wi.transparent,[!0,!0,!0,!0]),ko.alphaBlended=new ko([1,771],wi.transparent,[!0,!0,!0,!0]);const a0=1029,l0=2305;class eo{constructor(n,a,u){this.enable=n,this.mode=a,this.frontFace=u}}eo.disabled=new eo(!1,a0,l0),eo.backCCW=new eo(!0,a0,l0),eo.backCW=new eo(!0,a0,2304),eo.frontCW=new eo(!0,1028,2304),eo.frontCCW=new eo(!0,1028,l0);class gc extends Lt{constructor(n,a,u){super(),this.id=n,this._onlySymbols=u,a.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new JN(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new YN,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const a=this._tiles[n];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const a in this._tiles){const u=this._tiles[a];this._source.prepareTile(u)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,u.tileID),u.upload(n),u.prepare(this.map.style.imageManager)}else for(const a in this._tiles){const u=this._tiles[a];u.upload(n),u.prepare(this.map.style.imageManager)}}getIds(){return Ci(this._tiles).map(n=>n.tileID).sort(PI).map(n=>n.key)}getRenderableIds(n){const a=[];for(const u in this._tiles)this._isIdRenderable(+u,n)&&a.push(this._tiles[u]);return n?a.sort((u,d)=>{const m=u.tileID,g=d.tileID,v=new R(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),w=new R(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-g.overscaledZ||w.y-v.y||w.x-v.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(PI).map(u=>u.key)}hasRenderableParent(n){const a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){const u=this._tiles[n];u&&(u.state!=="loading"&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,n,a)))}_tileLoaded(n,a,u,d){if(d)if(n.state="errored",d.status!==404)this._source.fire(new It(d,{tile:n}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else n.timeAdded=Ie.now(),u==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Tt("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const a=this.getRenderableIds();for(let d=0;d<a.length;d++){const m=a[d];if(n.neighboringTiles&&n.neighboringTiles[m]){const g=this.getTileByID(m);u(n,g),u(g,n)}}function u(d,m){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let g=m.tileID.canonical.x-d.tileID.canonical.x;const v=m.tileID.canonical.y-d.tileID.canonical.y,w=Math.pow(2,d.tileID.canonical.z),T=m.tileID.key;g===0&&v===0||Math.abs(v)>1||(Math.abs(g)>1&&(Math.abs(g+w)===1?g+=w:Math.abs(g-w)===1&&(g-=w)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,g,v),d.neighboringTiles&&d.neighboringTiles[T]&&(d.neighboringTiles[T].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,u,d){for(const m in this._tiles){let g=this._tiles[m];if(d[m]||!g.hasData()||g.tileID.overscaledZ<=a||g.tileID.overscaledZ>u)continue;let v=g.tileID;for(;g&&g.tileID.overscaledZ>a+1;){const T=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[T.key],g&&g.hasData()&&(v=T)}let w=v;for(;w.overscaledZ>a;)if(w=w.scaledTo(w.overscaledZ-1),n[w.key]){d[v.key]=v;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){const u=this._loadedParentTiles[n.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=n.overscaledZ-1;u>=a;u--){const d=n.scaledTo(u),m=this._getLoadedTile(d);if(m)return m}}_getLoadedTile(n){const a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;const u=Math.ceil(n.width/a)+1,d=Math.ceil(n.height/a)+1,m=Math.floor(u*d*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(n){const a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){const u={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),u[m.tileID.key]=m}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(n,a,u){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let d;this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new gr(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(d=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(v=>this._source.hasTile(v)))):d=[];const m=this._updateRetainedTiles(d);if(RI(this._source.type)&&d.length!==0){const v={},w={},T=Object.keys(m);for(const M of T){const D=m[M],z=this._tiles[M];if(!z||z.fadeEndTime&&z.fadeEndTime<=Ie.now())continue;const B=this.findLoadedParent(D,Math.max(D.overscaledZ-gc.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),v[B.tileID.key]=B.tileID),w[M]=D}const A=d[d.length-1].overscaledZ;for(const M in this._tiles){const D=this._tiles[M];if(m[M]||!D.hasData())continue;let z=D.tileID;for(;z.overscaledZ>A;){z=z.scaledTo(z.overscaledZ-1);const B=this._tiles[z.key];if(B&&B.hasData()&&w[z.key]){m[M]=D.tileID;break}}}for(const M in v)m[M]||(this._coveredTiles[M]=!0,m[M]=v[M])}for(const v in m)this._tiles[v].clearFadeHold();const g=function(v,w){const T=[];for(const A in v)A in w||T.push(A);return T}(this._tiles,m);for(const v of g){const w=this._tiles[v];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const a={};if(n.length===0)return a;const u={},d=n.reduce((T,A)=>Math.min(T,A.overscaledZ),1/0),m=n[0].overscaledZ,g=Math.max(m-gc.maxOverzooming,this._source.minzoom),v=Math.max(m+gc.maxUnderzooming,this._source.minzoom),w={};for(const T of n){const A=this._addTile(T);a[T.key]=T,A.hasData()||d<this._source.maxzoom&&(w[T.key]=T)}this._retainLoadedChildren(w,d,v,a);for(const T of n){let A=this._tiles[T.key];if(A.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const D=T.children(this._source.maxzoom)[0],z=this.getTile(D);if(z&&z.hasData()){a[D.key]=D;continue}}else{const D=T.children(this._source.maxzoom);if(a[D[0].key]&&a[D[1].key]&&a[D[2].key]&&a[D[3].key])continue}let M=A.wasRequested();for(let D=T.overscaledZ-1;D>=g;--D){const z=T.scaledTo(D);if(u[z.key]||(u[z.key]=!0,A=this.getTile(z),!A&&M&&(A=this._addTile(z)),A&&(a[z.key]=z,M=A.wasRequested(),A.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const a=[];let u,d=this._tiles[n].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}a.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;d=m}for(const m of a)this._loadedParentTiles[m]=u}}_addTile(n){let a=this._tiles[n.key];if(a)return this._source.prepareTile&&this._source.prepareTile(a),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));const u=Boolean(a);if(!u){const d=this.map?this.map.painter:null;a=new r0(n,this._source.tileSize*n.overscaleFactor(),this.transform.tileZoom,d,this._isRaster),this._source.prepareTile&&this._source.prepareTile(a)||this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a?(a.uses++,this._tiles[n.key]=a,u||this._source.fire(new Tt("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const u=a.getExpiryTimeout();u&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},u))}_removeTile(n){const a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,u){const d=[],m=this.transform;if(!m)return d;for(const g in this._tiles){const v=this._tiles[g];if(u&&v.clearQueryDebugViz(),v.holdingForFade())continue;const w=n.containsTile(v,m,a);w&&d.push(w)}return d}getVisibleCoordinates(n){const a=this.getRenderableIds(n).map(u=>this._tiles[u].tileID);for(const u of a)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(RI(this._source.type))for(const n in this._tiles){const a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=Ie.now())return!0}return!1}setFeatureState(n,a,u){this._state.updateState(n=n||"_geojsonTileLayer",a,u)}removeFeatureState(n,a,u){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,u)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,u){const d=this._tiles[n];d&&d.setDependencies(a,u)}reloadTilesForDependencies(n,a){for(const u in this._tiles)this._tiles[u].hasDependency(n,a)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(n,a))}_preloadTiles(n,a){const u=new Map,d=Array.isArray(n)?n:[n],m=this.map.painter.terrain,g=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const v of d){const w=v.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of w)u.set(T.key,T);this.usedForTerrain&&v.updateElevation(!1)}_i(Array.from(u.values()),(v,w)=>{const T=new r0(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,A=>{this._source.type==="raster-dem"&&T.dem&&this._backfillDEM(T),w(A,T)})},a)}}function PI(o,n){const a=Math.abs(2*o.wrap)-+(o.wrap<0),u=Math.abs(2*n.wrap)-+(n.wrap<0);return o.overscaledZ-n.overscaledZ||u-a||n.canonical.y-o.canonical.y||n.canonical.x-o.canonical.x}function RI(o){return o==="raster"||o==="image"||o==="video"}gc.maxOverzooming=10,gc.maxUnderzooming=3;class lg{constructor(n,a,u){this._demTile=n,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(n,a,u){const d=u||n.findDEMTileFor(a);if(!d||!d.dem)return;const m=d.dem,g=d.tileID,v=1<<a.canonical.z-g.canonical.z;return new lg(d,d.tileSize/$t/v,[(a.canonical.x/v-g.canonical.x)*m.dim,(a.canonical.y/v-g.canonical.y)*m.dim])}tileCoordToPixel(n,a){const u=a*this._scale+this._offset[1],d=Math.floor(n*this._scale+this._offset[0]),m=Math.floor(u);return new R(d,m)}getElevationAt(n,a,u,d){const m=n*this._scale+this._offset[0],g=a*this._scale+this._offset[1],v=Math.floor(m),w=Math.floor(g),T=this._dem;return d=!!d,u?At(At(T.get(v,w,d),T.get(v,w+1,d),g-w),At(T.get(v+1,w,d),T.get(v+1,w+1,d),g-w),m-v):T.get(v,w,d)}getElevationAtPixel(n,a,u){return this._dem.get(n,a,!!u)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*th(1,n)*this._dem.stride}}class LI{constructor(n,a){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new wo($t,16,0),this.featureIndexArray=new rn,this.promoteId=a}insert(n,a,u,d,m,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,m,g);const w=this.grid;for(let T=0;T<a.length;T++){const A=a[T],M=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const z=A[D];M[0]=Math.min(M[0],z.x),M[1]=Math.min(M[1],z.y),M[2]=Math.max(M[2],z.x),M[3]=Math.max(M[3],z.y)}M[0]<$t&&M[1]<$t&&M[2]>=0&&M[3]>=0&&w.insert(v,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new mc.VectorTile(new Ff(this.rawTileData)).layers,this.sourceLayerCoder=new vI(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,a,u,d){this.loadVTLayers();const m=n.params||{},g=vo(m.filter),v=n.tileResult,w=n.transform,T=v.bufferedTilespaceBounds,A=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(B,j,W,X)=>tT(v.bufferedTilespaceGeometry,B,j,W,X));A.sort(QN);let M=null;w.elevation&&A.length>0&&(M=lg.create(w.elevation,this.tileID));const D={};let z;for(let B=0;B<A.length;B++){const j=A[B];if(j===z)continue;z=j;const W=this.featureIndexArray.get(j);let X=null;this.loadMatchingFeature(D,W,g,m.layers,m.availableImages,a,u,d,(oe,ce,he,de=0)=>(X||(X=da(oe,this.tileID.canonical,n.tileTransform)),ce.queryIntersectsFeature(v,oe,he,X,this.z,n.transform,n.pixelPosMatrix,M,de)))}return D}loadMatchingFeature(n,a,u,d,m,g,v,w,T){const{featureIndex:A,bucketIndex:M,sourceLayerIndex:D,layoutVertexArrayOffset:z}=a,B=this.bucketLayerIDs[M];if(d&&!function(oe,ce){for(let he=0;he<oe.length;he++)if(ce.indexOf(oe[he])>=0)return!0;return!1}(d,B))return;const j=this.sourceLayerCoder.decode(D),W=this.vtLayers[j].feature(A);if(u.needGeometry){const oe=dc(W,!0);if(!u.filter(new Gi(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!u.filter(new Gi(this.tileID.overscaledZ),W))return;const X=this.getId(W,j);for(let oe=0;oe<B.length;oe++){const ce=B[oe];if(d&&d.indexOf(ce)<0)continue;const he=g[ce];if(!he)continue;let de={};X!==void 0&&w&&(de=w.getState(he.sourceLayer||"_geojsonTileLayer",X));const fe=Ht({},v[ce]);fe.paint=OI(fe.paint,he.paint,W,de,m),fe.layout=OI(fe.layout,he.layout,W,de,m);const Se=!T||T(W,he,de,z);if(!Se)continue;const Ce=new xI(W,this.z,this.x,this.y,X);Ce.layer=fe;let Le=n[ce];Le===void 0&&(Le=n[ce]=[]),Le.push({featureIndex:A,feature:Ce,intersectionZ:Se})}}lookupSymbolFeatures(n,a,u,d,m,g,v,w){const T={};this.loadVTLayers();const A=vo(m);for(const M of n)this.loadMatchingFeature(T,{bucketIndex:u,sourceLayerIndex:d,featureIndex:M,layoutVertexArrayOffset:0},A,g,v,w,a);return T}loadFeature(n){const{featureIndex:a,sourceLayerIndex:u}=n;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),m=this.vtFeatures[d];if(m[a])return m[a];const g=this.vtLayers[d].feature(a);return m[a]=g,g}hasLayer(n){for(const a of this.bucketLayerIDs)for(const u of a)if(n===u)return!0;return!1}getId(n,a){let u=n.id;return this.promoteId&&(u=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof u=="boolean"&&(u=Number(u))),u}}function OI(o,n,a,u,d){return Ui(o,(m,g)=>{const v=n instanceof b?n.get(g):null;return v&&v.evaluate?v.evaluate(a,u,d):v})}function QN(o,n){return n-o}at(LI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class zI{constructor(n){const a={},u=[];for(const v in n){const w=n[v],T=a[v]={};for(const A in w.glyphs){const M=w.glyphs[+A];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const D=M.metrics.localGlyph?2:1,z={x:0,y:0,w:M.bitmap.width+2*D,h:M.bitmap.height+2*D};u.push(z),T[A]=z}}const{w:d,h:m}=Ux(u),g=new fa({width:d||1,height:m||1});for(const v in n){const w=n[v];for(const T in w.glyphs){const A=w.glyphs[+T];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const M=a[v][T],D=A.metrics.localGlyph?2:1;fa.copy(A.bitmap,g,{x:0,y:0},{x:M.x+D,y:M.y+D},A.bitmap)}}this.image=g,this.positions=a}}at(zI,"GlyphAtlas");class eF{constructor(n){this.tileID=new gr(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),this.tileZoom=n.tileZoom,this.uid=n.uid,this.zoom=n.zoom,this.canonical=n.tileID.canonical,this.pixelRatio=n.pixelRatio,this.tileSize=n.tileSize,this.source=n.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=n.showCollisionBoxes,this.collectResourceTiming=!!n.collectResourceTiming,this.returnDependencies=!!n.returnDependencies,this.promoteId=n.promoteId,this.enableTerrain=!!n.enableTerrain,this.isSymbolTile=n.isSymbolTile,this.tileTransform=_c(n.tileID.canonical,n.projection),this.projection=n.projection}parse(n,a,u,d,m){this.status="parsing",this.data=n,this.collisionBoxArray=new Xs;const g=new vI(Object.keys(n.layers).sort()),v=new LI(this.tileID,this.promoteId);v.bucketLayerIDs=[];const w={},T=new e0(256,256),A={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:u},M=a.familiesBySource[this.source];for(const de in M){const fe=n.layers[de];if(!fe)continue;let Se=!1,Ce=!1;for(const Ee of M[de])Ee[0].type==="symbol"?Se=!0:Ce=!0;if(this.isSymbolTile===!0&&!Se||this.isSymbolTile===!1&&!Ce)continue;fe.version===1&&Kt(`Vector tile source "${this.source}" layer "${de}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Le=g.encode(de),Ne=[];for(let Ee=0;Ee<fe.length;Ee++){const Pe=fe.feature(Ee),Ve=v.getId(Pe,de);Ne.push({feature:Pe,id:Ve,index:Ee,sourceLayerIndex:Le})}for(const Ee of M[de]){const Pe=Ee[0];this.isSymbolTile!==void 0&&Pe.type==="symbol"!==this.isSymbolTile||Pe.minzoom&&this.zoom<Math.floor(Pe.minzoom)||Pe.maxzoom&&this.zoom>=Pe.maxzoom||Pe.visibility!=="none"&&(c0(Ee,this.zoom,u),(w[Pe.id]=Pe.createBucket({index:v.bucketLayerIDs.length,layers:Ee,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Le,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:u})).populate(Ne,A,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(Ee.map(Ve=>Ve.id)))}}let D,z,B,j;T.trim();const W={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},X=Ui(A.glyphDependencies,de=>Object.keys(de).map(Number));Object.keys(X).length?d.send("getGlyphs",{uid:this.uid,stacks:X},(de,fe)=>{D||(D=de,z=fe,he.call(this))},void 0,!1,W):z={};const oe=Object.keys(A.iconDependencies);oe.length?d.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"icons"},(de,fe)=>{D||(D=de,B=fe,he.call(this))},void 0,!1,W):B={};const ce=Object.keys(A.patternDependencies);function he(){if(D)return m(D);if(z&&B&&j){const de=new zI(z),fe=new VT(B,j);for(const Se in w){const Ce=w[Se];Ce instanceof nl?(c0(Ce.layers,this.zoom,u),CN(Ce,z,de.positions,B,fe.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Ce.hasPattern&&(Ce instanceof Z_||Ce instanceof H_||Ce instanceof Of)&&(c0(Ce.layers,this.zoom,u),Ce.addFeatures(A,this.tileID.canonical,fe.patternPositions,u,this.tileTransform))}this.status="done",m(null,{buckets:Ci(w).filter(Se=>!Se.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:de.image,lineAtlas:T,imageAtlas:fe,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?de.positions:null})}}ce.length?d.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(de,fe)=>{D||(D=de,j=fe,he.call(this))},void 0,!1,W):j={},he.call(this)}}function c0(o,n,a){const u=new Gi(n);for(const d of o)d.recalculate(u,a)}class NI{constructor(n){this.entries={},this.scheduler=n}request(n,a,u,d){const m=this.entries[n]=this.entries[n]||{callbacks:[]};if(m.result){const[g,v]=m.result;return this.scheduler?this.scheduler.add(()=>{d(g,v)},a):d(g,v),()=>{}}return m.callbacks.push(d),m.cancel||(m.cancel=u((g,v)=>{m.result=[g,v];for(const w of m.callbacks)this.scheduler?this.scheduler.add(()=>{w(g,v)},a):w(g,v);setTimeout(()=>delete this.entries[n],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(g=>g!==d),m.callbacks.length||(m.cancel(),delete this.entries[n]))}}}function FI(o,n,a){const u=JSON.stringify(o.request);return o.data&&(this.deduped.entries[u]={result:[null,o.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},d=>{const m=ne(o.request,(g,v,w,T)=>{g?d(g):v&&d(null,{vectorTile:a?void 0:new mc.VectorTile(new Ff(v)),rawData:v,cacheControl:w,expires:T})});return()=>{m.cancel(),d()}},n)}const tF=So(new Float32Array(16));class al{constructor(n){this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,a){return{x:0,y:0,z:0}}unproject(n,a){return new Fi(0,0)}projectTilePoint(n,a,u){return{x:n,y:a,z:0}}locationPoint(n,a){return n._coordinatePoint(n.locationCoordinate(a),!1)}pixelsPerMeter(n,a){return th(1,n)*a}farthestPixelDistance(n){return function(a,u){const d=a.fovAboveCenter,m=a.elevation?a.elevation.getMinElevationBelowMSL()*u:0,g=(a._camera.position[2]*a.worldSize-m)/Math.cos(a._pitch),v=Math.sin(d)*g/Math.sin(Math.max(Math.PI/2-a._pitch-d,.01)),w=Math.sin(a._pitch)*v+g;return Math.min(1.01*w,g*(1/a._horizonShift))}(n,n.pixelsPerMeter)}pointCoordinate(n,a,u,d){const m=n.horizonLineFromTop(!1),g=new R(a,Math.max(m,u));return n.rayIntersectionCoordinate(n.pointRayIntersection(g,d))}createInversionMatrix(n,a){return tF}createTileMatrix(n,a,u){let d,m,g;const v=u.canonical,w=So(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=_c(v,this);d=1,m=T.x+u.wrap*T.scale,g=T.y,el(w,w,[d/T.scale,d/T.scale,n.pixelsPerMeter/a])}else d=a/n.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*u.wrap)*d,g=v.y*d;return fc(w,w,[m,g,0]),el(w,w,[d/$t,d/$t,1]),w}upVector(n,a,u){return[0,0,1]}upVectorScale(n,a,u){return{metersToTile:1,metersToLabelSpace:1}}}class iF extends al{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,a){return{x:Ef(n),y:eh(a),z:0}}unproject(n,a){const u=ks(n),d=Wn(a);return new Fi(u,d)}}class nF extends al{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[a,u]=this.parallels=n.parallels||[29.5,45.5],d=Math.sin(we(a));this.n=(d+Math.sin(we(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(n,a){const{n:u,c:d,r0:m}=this,g=we(n-this.center[0]),v=we(a),w=Math.sqrt(d-2*u*Math.sin(v))/u;return{x:w*Math.sin(g*u),y:w*Math.cos(g*u)-m,z:0}}unproject(n,a){const{n:u,c:d,r0:m}=this,g=m+a;let v=Math.atan2(n,Math.abs(g))*Math.sign(g);g*u<0&&(v-=Math.PI*Math.sign(n)*Math.sign(g));const w=we(this.center[0])*u;v=hi(v,-Math.PI-w,Math.PI-w);const T=Be(v/u)+this.center[0],A=Math.asin(rt((d-(n*n+g*g)*u*u)/(2*u),-1,1)),M=rt(Be(A),-85.051129,Io);return new Fi(T,M)}}const qf=1.340264,Wf=-.081106,Hf=893e-6,Kf=.003796,cg=Math.sqrt(3)/2;class rF extends al{project(n,a){a=a/180*Math.PI,n=n/180*Math.PI;const u=Math.asin(cg*Math.sin(a)),d=u*u,m=d*d*d;return{x:.5*(n*Math.cos(u)/(cg*(qf+3*Wf*d+m*(7*Hf+9*Kf*d)))/Math.PI+.5),y:1-.5*(u*(qf+Wf*d+m*(Hf+Kf*d))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=u*u,m=d*d*d;for(let A,M,D,z=0;z<12&&(M=u*(qf+Wf*d+m*(Hf+Kf*d))-a,D=qf+3*Wf*d+m*(7*Hf+9*Kf*d),A=M/D,u=rt(u-A,-Math.PI/3,Math.PI/3),d=u*u,m=d*d*d,!(Math.abs(A)<1e-12));++z);const g=cg*n*(qf+3*Wf*d+m*(7*Hf+9*Kf*d))/Math.cos(u),v=Math.asin(Math.sin(u)/cg),w=rt(180*g/Math.PI,-180,180),T=rt(180*v/Math.PI,-85.051129,Io);return new Fi(w,T)}}class sF extends al{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){return{x:.5+n/360,y:.5-a/360,z:0}}unproject(n,a){const u=360*(n-.5),d=rt(360*(.5-a),-85.051129,Io);return new Fi(u,d)}}const _h=Math.PI/2;function ug(o){return Math.tan((_h+o)/2)}class oF extends al{constructor(n){super(n),this.center=n.center||[0,30];const[a,u]=this.parallels=n.parallels||[30,30],d=we(a),m=we(u),g=Math.cos(d);this.n=d===m?Math.sin(d):Math.log(g/Math.cos(m))/Math.log(ug(m)/ug(d)),this.f=g*Math.pow(ug(d),this.n)/this.n}project(n,a){a=we(a),n=we(n-this.center[0]);const u=1e-6,{n:d,f:m}=this;m>0?a<-_h+u&&(a=-_h+u):a>_h-u&&(a=_h-u);const g=m/Math.pow(ug(a),d),v=g*Math.sin(d*n),w=m-g*Math.cos(d*n);return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+.5),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI,a=(2*(1-a)-.5)*Math.PI;const{n:u,f:d}=this,m=d-a,g=Math.sign(m),v=Math.sign(u)*Math.sqrt(n*n+m*m);let w=Math.atan2(n,Math.abs(m))*g;m*u<0&&(w-=Math.PI*Math.sign(n)*g);const T=rt(Be(w/u)+this.center[0],-180,180),A=rt(Be(2*Math.atan(Math.pow(d/v,1/u))-_h),-85.051129,Io);return new Fi(T,A)}}const BI=we(Io);class aF extends al{project(n,a){const u=(a=we(a))*a,d=u*u;return{x:.5*((n=we(n))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=25,m=0,g=u*u;do{g=u*u;const T=g*g;m=(u*(1.007226+g*(.015085+T*(.028874*g-.044475-.005916*T)))-a)/(1.007226+g*(.045255+T*(.259866*g-.311325-.005916*11*T))),u=rt(u-m,-BI,BI)}while(Math.abs(m)>1e-6&&--d>0);g=u*u;const v=rt(Be(n/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),w=Be(u);return new Fi(v,w)}}const UI=we(Io);class lF extends al{project(n,a){a=we(a),n=we(n);const u=Math.cos(a),d=2/Math.PI,m=Math.acos(u*Math.cos(n/2)),g=Math.sin(m)/m,v=.5*(n*d+2*u*Math.sin(n/2)/g)||0,w=.5*(a+Math.sin(a)/g)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(n,a){let u=n=(2*n-.5)*Math.PI,d=a=(2*(1-a)-1)*Math.PI,m=25;const g=1e-6;let v=0,w=0;do{const T=Math.cos(d),A=Math.sin(d),M=2*A*T,D=A*A,z=T*T,B=Math.cos(u/2),j=Math.sin(u/2),W=2*B*j,X=j*j,oe=1-z*B*B,ce=oe?1/oe:0,he=oe?Math.acos(T*B)*Math.sqrt(1/oe):0,de=.5*(2*he*T*j+2*u/Math.PI)-n,fe=.5*(he*A+d)-a,Se=.5*ce*(z*X+he*T*B*D)+1/Math.PI,Ce=ce*(W*M/4-he*A*j),Le=.125*ce*(M*j-he*A*z*W),Ne=.5*ce*(D*B+he*X*T)+.5,Ee=Ce*Le-Ne*Se;v=(fe*Ce-de*Ne)/Ee,w=(de*Le-fe*Se)/Ee,u=rt(u-v,-Math.PI,Math.PI),d=rt(d-w,-UI,UI)}while((Math.abs(v)>g||Math.abs(w)>g)&&--m>0);return new Fi(Be(u),Be(d))}}class VI extends al{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(we(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){const{scale:u,cosPhi:d}=this;return{x:we(n)*d*u+.5,y:-Math.sin(we(a))/d*u+.5,z:0}}unproject(n,a){const{scale:u,cosPhi:d}=this,m=-(a-.5)/u,g=rt(Be((n-.5)/u)/d,-180,180),v=Math.asin(rt(m*d,-1,1)),w=rt(Be(v),-85.051129,Io);return new Fi(g,w)}}l.ARRAY_TYPE=Zr,l.AUTH_ERR_MSG=Ct,l.Aabb=ms,l.Actor=class{constructor(o,n,a){this.target=o,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Zt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=_t()?o:J,this.scheduler=new $N}send(o,n,a,u,d=!1,m){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[g]=a);const v=se(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:o,hasCallback:!!a,targetMapId:u,mustQueue:d,sourceMapId:this.mapId,data:nc(n,v)},v),{cancel:()=>{a&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(o){const n=o.data,a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(n.mustQueue||_t()){const u=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,n),u&&u.metadata||{type:"message"})}else this.processTask(a,n)}processTask(o,n){if(n.type==="<response>"){const a=this.callbacks[o];delete this.callbacks[o],a&&(n.error?a(Wa(n.error)):a(null,Wa(n.data)))}else{const a=se(this.globalScope)?void 0:[],u=n.hasCallback?(m,g)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:m?nc(m):null,data:nc(g,a)},a)}:m=>{},d=Wa(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,d,u);else if(this.parent.getWorkerSource){const m=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,m[0],d.source)[m[1]](d,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.CanonicalTileID=sg,l.Color=wi,l.ColorMode=ko,l.CullFaceMode=eo,l.DEMData=ag,l.DataConstantProperty=E,l.DedupedRequest=NI,l.DepthMode=mh,l.EXTENT=$t,l.Elevation=class{isDataAvailableAtPoint(o){const n=this._source();if(!n||o.y<0||o.y>1)return!1;const a=n.getSource().maxzoom,u=1<<a,d=Math.floor(o.x),m=Math.floor((o.x-d)*u),g=Math.floor(o.y*u),v=this.findDEMTileFor(new gr(a,d,a,m,g));return!(!v||!v.dem)}getAtPointOrZero(o,n=0){return this.getAtPoint(o,n)||0}getAtPoint(o,n,a=!0){n==null&&(n=null);const u=this._source();if(!u||o.y<0||o.y>1)return n;const d=u.getSource().maxzoom,m=1<<d,g=Math.floor(o.x),v=o.x-g,w=new gr(d,g,d,Math.floor(v*m),Math.floor(o.y*m)),T=this.findDEMTileFor(w);if(!T||!T.dem)return n;const A=T.dem,M=1<<T.tileID.canonical.z,D=(v*M-T.tileID.canonical.x)*A.dim,z=(o.y*M-T.tileID.canonical.y)*A.dim,B=Math.floor(D),j=Math.floor(z);return(a?this.exaggeration():1)*At(At(A.get(B,j),A.get(B,j+1),z-j),At(A.get(B+1,j),A.get(B+1,j+1),z-j),D-B)}getAtTileOffset(o,n,a){const u=1<<o.canonical.z;return this.getAtPointOrZero(new F_(o.wrap+(o.canonical.x+n/$t)/u,(o.canonical.y+a/$t)/u))}getAtTileOffsetFunc(o,n,a,u){return d=>{const m=this.getAtTileOffset(o,d.x,d.y),g=u.upVector(o.canonical,d.x,d.y);return If(g,g,m*u.upVectorScale(o.canonical,n,a).metersToTile),g}}getForTilePoints(o,n,a,u){const d=lg.create(this,o,u);return!!d&&(n.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],a)}),!0)}getMinMaxForTile(o){const n=this.findDEMTileFor(o);if(!n||!n.dem)return null;const a=n.dem.tree,u=n.tileID,d=1<<o.canonical.z-u.canonical.z;let m=o.canonical.x/d-u.canonical.x,g=o.canonical.y/d-u.canonical.y,v=0;for(let w=0;w<o.canonical.z-u.canonical.z&&!a.leaves[v];w++){m*=2,g*=2;const T=2*Math.floor(g)+Math.floor(m);v=a.childOffsets[v]+T,m%=1,g%=1}return{min:this.exaggeration()*a.minimums[v],max:this.exaggeration()*a.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,n,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},l.ErrorEvent=It,l.EvaluationParameters=Gi,l.Event=Tt,l.Evented=Lt,l.FillExtrusionBucket=Of,l.Frustum=Mx,l.GLOBE_RADIUS=ph,l.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o),this._createAtmosphere(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(o){const n=new ee,a=new ht,u=65;for(let d=0;d<u;d++)for(let m=0;m<u;m++)n.emplaceBack(m,d);for(let d=0;d<64;d++)for(let m=0;m<64;m++){const g=d*u+m;a.emplaceBack(g+1,g,g+u),a.emplaceBack(g+u,g+u+1,g+1)}this._gridBuffer=o.createVertexBuffer(n,$f.members),this._gridIndexBuffer=o.createIndexBuffer(a,!0),this._gridSegments=hn.simpleSegment(0,0,4225,8192)}_createPoles(o){const n=new ht;for(let d=0;d<=64;d++)n.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=o.createIndexBuffer(n,!0);const a=new Dt,u=new Dt;this._poleSegments=[];for(let d=0,m=0;d<5;d++){const g=1<<d,v=512*g/Math.PI/2,w=360/g;a.emplaceBack(0,-v,0,0,0,.5,0),u.emplaceBack(0,-v,0,0,0,.5,1);for(let T=0;T<=64;T++){const A=T/64,M=At(0,w,A),[D,z,B]=hI(KN,ZN,M,v);a.emplaceBack(D,z,B,0,0,A,0),u.emplaceBack(D,z,B,0,0,A,1)}this._poleSegments.push(hn.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,cI,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(u,cI,!1)}_createAtmosphere(o){const n=new Gt;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const a=new ht;a.emplaceBack(0,1,2),a.emplaceBack(2,3,0),this.atmosphereVertexBuffer=o.createVertexBuffer(n,GN.members),this.atmosphereIndexBuffer=o.createIndexBuffer(a),this.atmosphereSegments=hn.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o){if(!this._wireframeSegments){const n=new Ot,a=64,u=a+1;for(let d=0;d<a;d++)for(let m=0;m<a;m++){const g=d*u+m;n.emplaceBack(g,g+1),n.emplaceBack(g,g+u),n.emplaceBack(g,g+u+1)}this._wireframeIndexBuffer=o.createIndexBuffer(n),this._wireframeSegments=hn.simpleSegment(0,0,a*a,n.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},l.GlyphManager=dh,l.ImagePosition=Vx,l.LineAtlas=e0,l.LngLat=Fi,l.LngLatBounds=Qa,l.LocalGlyphMode=qx,l.MAX_MERCATOR_LATITUDE=Io,l.MercatorCoordinate=F_,l.ONE_EM=Hn,l.OverscaledTileID=gr,l.Properties=F,l.RGBAImage=Xr,l.Ray=class{constructor(o,n){this.pos=o,this.dir=n}intersectsPlane(o,n,a){const u=Af(n,this.dir);if(Math.abs(u)<1e-6)return!1;const d=((o[0]-this.pos[0])*n[0]+(o[1]-this.pos[1])*n[1]+(o[2]-this.pos[2])*n[2])/u;return a[0]=this.pos[0]+this.dir[0]*d,a[1]=this.pos[1]+this.dir[1]*d,a[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(o,n,a){if(function(D,z){var B=D[0],j=D[1],W=D[2],X=z[0],oe=z[1],ce=z[2];return Math.abs(B-X)<=bx*Math.max(1,Math.abs(B),Math.abs(X))&&Math.abs(j-oe)<=bx*Math.max(1,Math.abs(j),Math.abs(oe))&&Math.abs(W-ce)<=bx*Math.max(1,Math.abs(W),Math.abs(ce))}(this.pos,o)||n===0)return a[0]=a[1]=a[2]=0,!1;const[u,d,m]=this.dir,g=this.pos[0]-o[0],v=this.pos[1]-o[1],w=this.pos[2]-o[2],T=u*u+d*d+m*m,A=2*(g*u+v*d+w*m),M=A*A-4*T*(g*g+v*v+w*w-n*n);if(M<0){const D=Math.max(-A/2,0),z=g+u*D,B=v+d*D,j=w+m*D,W=Math.hypot(z,B,j);return a[0]=z*n/W,a[1]=B*n/W,a[2]=j*n/W,!1}{const D=(-A-Math.sqrt(M))/(2*T);if(D<0){const z=Math.hypot(g,v,w);return a[0]=g*n/z,a[1]=v*n/z,a[2]=w*n/z,!1}return a[0]=g+u*D,a[1]=v+d*D,a[2]=w+m*D,!0}}},l.RequestManager=class{constructor(o,n,a){this._transformRequestFn=o,this._customAccessToken=n,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const o=function(){let n="";for(let a=0;a<10;a++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",wt,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,n){return this._transformRequestFn&&this._transformRequestFn(o,n)||{url:o}}normalizeStyleURL(o,n){if(!Rt(o))return o;const a=fi(o);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||n)}normalizeGlyphsURL(o,n){if(!Rt(o))return o;const a=fi(o);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||n)}normalizeSourceURL(o,n){if(!Rt(o))return o;const a=fi(o);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||n)}normalizeSpriteURL(o,n,a,u){const d=fi(o);return Rt(o)?(d.path=`/styles/v1${d.path}/sprite${n}${a}`,this._makeAPIURL(d,this._customAccessToken||u)):(d.path+=`${n}${a}`,Mi(d))}normalizeTileURL(o,n,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Rt(o))return o;const u=fi(o);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||a&&u.authority!=="raster"&&a===512?"@2x":""}${Ye.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${De.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${De.TILE_URL_VERSION}${u.path}`);const d=this._customAccessToken||function(m){for(const g of m){const v=g.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(u.params)||De.ACCESS_TOKEN;return De.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,d)}canonicalizeTileURL(o,n){const a=fi(o);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return o;let u="mapbox://";a.path.match(/^\/raster\/v1\//)?u+=`raster/${a.path.replace(`/${De.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${a.path.replace(`/${De.TILE_URL_VERSION}/`,"")}`;let d=a.params;return n&&(d=d.filter(m=>!m.match(/^access_token=/))),d.length&&(u+=`?${d.join("&")}`),u}canonicalizeTileset(o,n){const a=!!n&&Rt(n),u=[];for(const d of o.tiles||[])Yt(d)?u.push(this.canonicalizeTileURL(d,a)):u.push(d);return u}_makeAPIURL(o,n){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",u=fi(De.API_URL);if(o.protocol=u.protocol,o.authority=u.authority,o.protocol==="http"){const d=o.params.indexOf("secure");d>=0&&o.params.splice(d,1)}if(u.path!=="/"&&(o.path=`${u.path}${o.path}`),!De.REQUIRE_ACCESS_TOKEN)return Mi(o);if(n=n||De.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return o.params=o.params.filter(d=>d.indexOf("access_token")===-1),o.params.push(`access_token=${n||""}`),Mi(o)}},l.ResourceType=Y,l.SegmentVector=hn,l.SourceCache=gc,l.StencilMode=o0,l.StructArrayLayout1ui2=pi,l.StructArrayLayout2f1f2i16=mt,l.StructArrayLayout2i4=ee,l.StructArrayLayout2ui4=Ot,l.StructArrayLayout3f12=We,l.StructArrayLayout3ui6=ht,l.StructArrayLayout4i8=re,l.Texture=Vf,l.Tile=r0,l.Transitionable=p,l.Uniform1f=z_,l.Uniform1i=class extends ua{constructor(o,n){super(o,n),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},l.Uniform2f=class extends ua{constructor(o,n){super(o,n),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},l.Uniform3f=class extends ua{constructor(o,n){super(o,n),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},l.Uniform4f=qE,l.UniformColor=WE,l.UniformMatrix2f=class extends ua{constructor(o,n){super(o,n),this.current=GO}set(o){for(let n=0;n<4;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},l.UniformMatrix3f=class extends ua{constructor(o,n){super(o,n),this.current=jO}set(o){for(let n=0;n<9;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},l.UniformMatrix4f=class extends ua{constructor(o,n){super(o,n),this.current=$O}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let n=1;n<16;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},l.UnwrappedTileID=yI,l.ValidationError=st,l.VectorTileWorkerSource=class extends Lt{constructor(o,n,a,u,d){super(),this.actor=o,this.layerIndex=n,this.availableImages=a,this.loadVectorData=d||FI,this.loading={},this.loaded={},this.deduped=new NI(o.scheduler),this.isSpriteLoaded=u,this.scheduler=o.scheduler}loadTile(o,n){const a=o.uid,u=o&&o.request,d=u&&u.collectResourceTiming,m=this.loading[a]=new eF(o);m.abort=this.loadVectorData(o,(g,v)=>{const w=!this.loading[a];if(delete this.loading[a],w||g||!v)return m.status="done",w||(this.loaded[a]=m),n(g);const T=v.rawData,A={};v.expires&&(A.expires=v.expires),v.cacheControl&&(A.cacheControl=v.cacheControl),m.vectorTile=v.vectorTile||new mc.VectorTile(new Ff(T));const M=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(D,z)=>{if(D||!z)return n(D);const B={};if(d){const j=lI(u);j.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify(j)))}n(null,Ht({rawTileData:T.slice(0)},z,A,B))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[a]=m})}reloadTile(o,n){const a=this.loaded,u=o.uid,d=this;if(a&&a[u]){const m=a[u];m.showCollisionBoxes=o.showCollisionBoxes,m.enableTerrain=!!o.enableTerrain,m.projection=o.projection,m.tileTransform=_c(o.tileID.canonical,o.projection);const g=(v,w)=>{const T=m.reloadCallback;T&&(delete m.reloadCallback,m.parse(m.vectorTile,d.layerIndex,this.availableImages,d.actor,T)),n(v,w)};m.status==="parsing"?m.reloadCallback=g:m.status==="done"&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(o,n){const a=o.uid,u=this.loading[a];u&&(u.abort&&u.abort(),delete this.loading[a]),n()}removeTile(o,n){const a=this.loaded,u=o.uid;a&&a[u]&&delete a[u],n()}},l.WritingMode=_s,l.ZoomHistory=cf,l.add=aT,l.addDynamicAttributes=Zx,l.adjoint=function(o,n){var a=n[0],u=n[1],d=n[2],m=n[3],g=n[4],v=n[5],w=n[6],T=n[7],A=n[8];return o[0]=g*A-v*T,o[1]=d*T-u*A,o[2]=u*v-d*g,o[3]=v*w-m*A,o[4]=a*A-d*w,o[5]=d*m-a*v,o[6]=m*T-g*w,o[7]=u*w-a*T,o[8]=a*g-u*m,o},l.asyncAll=_i,l.bezier=lt,l.bindAll=Zt,l.boundsAttributes=wI,l.bufferConvexPolygon=function(o,n){const a=[];for(let u=0;u<o.length;u++){const d=hi(u-1,-1,o.length-1),m=hi(u+1,-1,o.length-1),g=o[u],v=o[m],w=o[d].sub(g).unit(),T=v.sub(g).unit(),A=T.angleWithSep(w.x,w.y),M=w.add(T).unit().mult(-1*n/Math.sin(A/2));a.push(g.add(M))}return a},l.cacheEntryPossiblyAdded=function(o){La++,La>Qo&&(o.getActor().send("enforceCacheSizeLimit",Jo),La=0)},l.calculateGlobeLabelMatrix=function(o,n){const{lng:a,lat:u}=o._center,d=pI(0,0,o.worldSize/o._projectionScaler,a,u);return wx(d,d,function(m){const g=So(new Float64Array(16)),v=1/n0(m);return fc(g,g,m.min),el(g,g,[v,v,v]),g}(jf(n)))},l.calculateGlobeMatrix=mI,l.calculateGlobeMercatorMatrix=function(o){const n=o.worldSize,a=o.point,u=th(1,o.center.lat)*n,d=o.pixelsPerMeter,m=n/(u/o.pixelsPerMeter),g=So(new Float64Array(16));return fc(g,g,[a.x,a.y,0]),el(g,g,[m,m,d]),Float32Array.from(g)},l.circumferenceAtLatitude=mx,l.clamp=rt,l.clearTileCache=function(o){const n=J.caches.delete(vu);o&&n.catch(o).then(()=>o())},l.clipLine=QT,l.clone=function(o){var n=new Zr(16);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=o[6],n[7]=o[7],n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},l.clone$1=Ji,l.collisionCircleLayout=eN,l.config=De,l.conjugate=function(o,n){return o[0]=-n[0],o[1]=-n[1],o[2]=-n[2],o[3]=n[3],o},l.create=function(){var o=new Zr(16);return Zr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},l.create$1=rT,l.createExpression=Zl,l.createLayout=ie,l.createStyleLayer=function(o){return o.type==="custom"?new NN(o):new BN[o.type](o)},l.cross=uT,l.degToRad=we,l.div=function(o,n,a){return o[0]=n[0]/a[0],o[1]=n[1]/a[1],o[2]=n[2]/a[2],o},l.dot=Af,l.earthRadius=px,l.ease=zt,l.easeCubicInOut=yt,l.emitValidationErrors=__,l.endsWith=Qt,l.enforceCacheSizeLimit=function(o){Ra(),us&&us.then(n=>{n.keys().then(a=>{for(let u=0;u<a.length-o;u++)n.delete(a[u])})})},l.evaluateSizeForFeature=X_,l.evaluateSizeForZoom=lh,l.evaluateVariableOffset=rI,l.evented=vf,l.exactEquals=function(o,n){return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]&&o[3]===n[3]},l.exactEquals$1=function(o,n){return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]},l.exported=Ie,l.exported$1=Ye,l.extend=Ht,l.extend$1=Ei,l.filterObject=Bn,l.fromMat4=function(o,n){return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[4],o[4]=n[5],o[5]=n[6],o[6]=n[8],o[7]=n[9],o[8]=n[10],o},l.fromQuat=function(o,n){var a=n[0],u=n[1],d=n[2],m=n[3],g=a+a,v=u+u,w=d+d,T=a*g,A=u*g,M=u*v,D=d*g,z=d*v,B=d*w,j=m*g,W=m*v,X=m*w;return o[0]=1-M-B,o[1]=A+X,o[2]=D-W,o[3]=0,o[4]=A-X,o[5]=1-T-B,o[6]=z+j,o[7]=0,o[8]=D+W,o[9]=z-j,o[10]=1-T-M,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},l.fromRotation=function(o,n){var a=Math.sin(n),u=Math.cos(n);return o[0]=u,o[1]=a,o[2]=0,o[3]=-a,o[4]=u,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},l.fromScaling=function(o,n){return o[0]=n[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},l.furthestTileCorner=function(o){const n=Math.round((o+45+360)%360/90)%4;return nt[n]},l.getAABBPointSquareDist=function(o,n,a){let u=0;for(let d=0;d<2;++d){const m=a?a[d]:0;o[d]>m&&(u+=(o[d]-m)*(o[d]-m)),n[d]<m&&(u+=(m-n[d])*(m-n[d]))}return u},l.getAnchorAlignment=Gx,l.getAnchorJustification=Hx,l.getBounds=function(o){let n=1/0,a=1/0,u=-1/0,d=-1/0;for(const m of o)n=Math.min(n,m.x),a=Math.min(a,m.y),u=Math.max(u,m.x),d=Math.max(d,m.y);return{min:new R(n,a),max:new R(u,d)}},l.getColumn=function(o,n){return[o[4*n],o[4*n+1],o[4*n+2],o[4*n+3]]},l.getGridMatrix=function(o,n){const[a,u]=n,d=.015625;return[0,(u[1]-a[1])*d,1<<o.z,(u[0]-a[0])*d,0,o.y,a[0],a[1],d]},l.getImage=it,l.getJSON=function(o,n){return K(Ht(o,{type:"json"}),n)},l.getMapSessionAPI=Xo,l.getPerformanceMeasurement=lI,l.getProjection=function(o){const n=o.parallels,a=!!n&&Math.abs(n[0]+n[1])<.01;switch(o.name){case"mercator":return new iF(o);case"equirectangular":return new sF(o);case"naturalEarth":return new aF(o);case"equalEarth":return new rF(o);case"winkelTripel":return new lF(o);case"albers":return a?new VI(o):new nF(o);case"lambertConformalConic":return a?new VI(o):new oF(o)}throw new Error(`Invalid projection name: ${o.name}`)},l.getRTLTextPluginStatus=Ju,l.getReferrer=U,l.getTilePoint=function(o,{x:n,y:a},u=0){return new R(((n-u)*o.scale-o.x)*$t,(a*o.scale-o.y)*$t)},l.getTileVec3=function(o,n,a=0){return Tf(((n.x-a)*o.scale-o.x)*$t,(n.y*o.scale-o.y)*$t,ZE(n.z,n.y))},l.getVideo=function(o,n){const a=J.document.createElement("video");a.muted=!0,a.onloadstart=function(){n(null,a)};for(let u=0;u<o.length;u++){const d=J.document.createElement("source");_e(o[u])||(a.crossOrigin="Anonymous"),d.src=o[u],a.appendChild(d)}return{cancel:()=>{}}},l.globeECEFOrigin=function(o,n){const a=[0,0,0];return pc(a,a,fI(jf(n.canonical))),pc(a,a,o),a},l.globePixelsToTileUnits=function(o,n){return $t/(512*Math.pow(2,o))*n0(jf(n))},l.globePoleMatrixForTile=function(o,n,a){const u=So(new Float64Array(16)),d=1<<o,m=360*(n/d-.5),g=a.point,v=a.worldSize/(a.tileSize*d);return fc(u,u,[g.x,g.y,-a.worldSize/Math.PI/2]),el(u,u,[v,v,v]),Ex(u,u,we(-a._center.lat)),Tx(u,u,we(-a._center.lng+m)),Float32Array.from(u)},l.globeTileLatLngCorners=i0,l.globeToMercatorTransition=function(o){return Wt(5,6,o)},l.identity=So,l.identity$1=fT,l.invert=function(o,n){var a=n[0],u=n[1],d=n[2],m=n[3],g=n[4],v=n[5],w=n[6],T=n[7],A=n[8],M=n[9],D=n[10],z=n[11],B=n[12],j=n[13],W=n[14],X=n[15],oe=a*v-u*g,ce=a*w-d*g,he=a*T-m*g,de=u*w-d*v,fe=u*T-m*v,Se=d*T-m*w,Ce=A*j-M*B,Le=A*W-D*B,Ne=A*X-z*B,Ee=M*W-D*j,Pe=M*X-z*j,Ve=D*X-z*W,Ze=oe*Ve-ce*Pe+he*Ee+de*Ne-fe*Le+Se*Ce;return Ze?(o[0]=(v*Ve-w*Pe+T*Ee)*(Ze=1/Ze),o[1]=(d*Pe-u*Ve-m*Ee)*Ze,o[2]=(j*Se-W*fe+X*de)*Ze,o[3]=(D*fe-M*Se-z*de)*Ze,o[4]=(w*Ne-g*Ve-T*Le)*Ze,o[5]=(a*Ve-d*Ne+m*Le)*Ze,o[6]=(W*he-B*Se-X*ce)*Ze,o[7]=(A*Se-D*he+z*ce)*Ze,o[8]=(g*Pe-v*Ne+T*Ce)*Ze,o[9]=(u*Ne-a*Pe-m*Ce)*Ze,o[10]=(B*fe-j*he+X*oe)*Ze,o[11]=(M*he-A*fe-z*oe)*Ze,o[12]=(v*Le-g*Ee-w*Ce)*Ze,o[13]=(a*Ee-u*Le+d*Ce)*Ze,o[14]=(j*ce-B*de-W*oe)*Ze,o[15]=(A*de-M*ce+D*oe)*Ze,o):null},l.isMapAuthenticated=function(o){return Yo.has(o)},l.isMapboxURL=Rt,l.isSafariWithAntialiasingBug=function(o){const n=o.navigator?o.navigator.userAgent:null;return!!se(o)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},l.latFromMercatorY=Wn,l.len=az,l.length=oT,l.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},l.loadVectorTile=FI,l.makeRequest=K,l.mercatorXfromLng=Ef,l.mercatorYfromLat=eh,l.mercatorZfromAltitude=th,l.mul=sz,l.mul$1=oz,l.multiply=function(o,n,a){var u=n[0],d=n[1],m=n[2],g=n[3],v=n[4],w=n[5],T=n[6],A=n[7],M=n[8],D=a[0],z=a[1],B=a[2],j=a[3],W=a[4],X=a[5],oe=a[6],ce=a[7],he=a[8];return o[0]=D*u+z*g+B*T,o[1]=D*d+z*v+B*A,o[2]=D*m+z*w+B*M,o[3]=j*u+W*g+X*T,o[4]=j*d+W*v+X*A,o[5]=j*m+W*w+X*M,o[6]=oe*u+ce*g+he*T,o[7]=oe*d+ce*v+he*A,o[8]=oe*m+ce*w+he*M,o},l.multiply$1=wx,l.multiply$2=cT,l.nextPowerOfTwo=Fn,l.normalize=Sf,l.normalize$1=function(o,n){var a=n[0],u=n[1],d=n[2],m=n[3],g=a*a+u*u+d*d+m*m;return g>0&&(g=1/Math.sqrt(g)),o[0]=a*g,o[1]=u*g,o[2]=d*g,o[3]=m*g,o},l.number=At,l.ortho=function(o,n,a,u,d,m,g){var v=1/(n-a),w=1/(u-d),T=1/(m-g);return o[0]=-2*v,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*w,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*T,o[11]=0,o[12]=(n+a)*v,o[13]=(d+u)*w,o[14]=(g+m)*T,o[15]=1,o},l.pbf=Ff,l.perspective=function(o,n,a,u,d){var m,g=1/Math.tan(n/2);return o[0]=g/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=g,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,d!=null&&d!==1/0?(o[10]=(d+u)*(m=1/(u-d)),o[14]=2*d*u*m):(o[10]=-1,o[14]=-2*u),o},l.pick=function(o,n){const a={};for(let u=0;u<n.length;u++){const d=n[u];d in o&&(a[d]=o[d])}return a},l.plugin=Hr,l.pointGeometry=R,l.polygonIntersectsBox=tT,l.polygonIntersectsPolygon=YE,l.polygonizeBounds=function(o,n,a=0,u=!0){const d=new R(a,a),m=o.sub(d),g=n.add(d),v=[m,new R(g.x,m.y),g,new R(m.x,g.y)];return u&&v.push(m),v},l.posAttributes=$f,l.postMapLoadEvent=kn,l.postTurnstileEvent=js,l.potpack=Ux,l.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},l.radToDeg=Be,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.registerForPluginStateChange=function(o){return o({pluginStatus:_r,pluginURL:Pr}),vf.on("pluginStateChange",o),o},l.removeAuthState=function(o){Yo.delete(o)},l.renderColorRamp=Dx,l.rotateX=Ex,l.rotateX$1=pT,l.rotateY=Tx,l.rotateZ=function(o,n,a){var u=Math.sin(a),d=Math.cos(a),m=n[0],g=n[1],v=n[2],w=n[3],T=n[4],A=n[5],M=n[6],D=n[7];return n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=m*d+T*u,o[1]=g*d+A*u,o[2]=v*d+M*u,o[3]=w*d+D*u,o[4]=T*d-m*u,o[5]=A*d-g*u,o[6]=M*d-v*u,o[7]=D*d-w*u,o},l.rotateZ$1=function(o,n,a){a*=.5;var u=n[0],d=n[1],m=n[2],g=n[3],v=Math.sin(a),w=Math.cos(a);return o[0]=u*w+d*v,o[1]=d*w-u*v,o[2]=m*w+g*v,o[3]=g*w-m*v,o},l.scale=el,l.scale$1=function(o,n,a){return o[0]=n[0]*a,o[1]=n[1]*a,o[2]=n[2]*a,o[3]=n[3]*a,o},l.scale$2=If,l.scaleAndAdd=Cx,l.setCacheLimits=function(o,n){Jo=o,Qo=n},l.setColumn=function(o,n,a){o[4*n+0]=a[0],o[4*n+1]=a[1],o[4*n+2]=a[2],o[4*n+3]=a[3]},l.setRTLTextPlugin=function(o,n,a=!1){if(_r===_f||_r===ac||_r===gf)throw new Error("setRTLTextPlugin cannot be called multiple times.");Pr=Ie.resolveURL(o),_r=_f,yf=n,la(),a||Ka()},l.smoothstep=Wt,l.spec=be,l.storeAuthState=function(o,n){n?Yo.add(o):Yo.delete(o)},l.sub=rh,l.subtract=lT,l.symbolSize=tN,l.tileAABB=function(o,n,a,u,d,m,g,v,w){if(w.name==="globe")return HN(o,n,new sg(a,u,d));const T=_c({z:a,x:u,y:d},w);return new ms([(m+T.x/T.scale)*n,n*(T.y/T.scale),g],[(m+T.x2/T.scale)*n,n*(T.y2/T.scale),v])},l.tileTransform=_c,l.transformMat3=function(o,n,a){var u=n[0],d=n[1],m=n[2];return o[0]=u*a[0]+d*a[3]+m*a[6],o[1]=u*a[1]+d*a[4]+m*a[7],o[2]=u*a[2]+d*a[5]+m*a[8],o},l.transformMat4=pc,l.transformMat4$1=sh,l.transformQuat=hT,l.translate=fc,l.transpose=function(o,n){if(o===n){var a=n[1],u=n[2],d=n[5];o[1]=n[3],o[2]=n[6],o[3]=a,o[5]=n[7],o[6]=u,o[7]=d}else o[0]=n[0],o[1]=n[3],o[2]=n[6],o[3]=n[1],o[4]=n[4],o[5]=n[7],o[6]=n[2],o[7]=n[5],o[8]=n[8];return o},l.triggerPluginCompletionEvent=lc,l.uniqueId=Xi,l.validateCustomStyleLayer=function(o){const n=[],a=o.id;return a===void 0&&n.push({message:`layers.${a}: missing required property "id"`}),o.render===void 0&&n.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&n.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),n},l.validateFilter=o=>Zs(bo(o)),l.validateFog=o=>Zs(m_(o)),l.validateLayer=o=>Zs(u_(o)),l.validateLight=o=>Zs(f_(o)),l.validateSource=o=>Zs(d_(o)),l.validateStyle=ic,l.validateTerrain=o=>Zs(p_(o)),l.values=Ci,l.vectorTile=mc,l.version=I,l.warnOnce=Kt,l.window=J,l.wrap=hi}),f(["./shared"],function(l){function I(Y){if(typeof Y=="number"||typeof Y=="boolean"||typeof Y=="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){let U="[";for(const K of Y)U+=`${I(K)},`;return`${U}]`}let N="{";for(const U of Object.keys(Y).sort())N+=`${U}:${I(Y[U])},`;return`${N}}`}function C(Y){let N="";for(const U of l.refProperties)N+=`/${I(Y[U])}`;return N}class L{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,U){for(const ne of N)this._layerConfigs[ne.id]=ne,(this._layers[ne.id]=l.createStyleLayer(ne)).compileFilter(),this.keyCache[ne.id]&&delete this.keyCache[ne.id];for(const ne of U)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const K=function(ne,le){const ge={};for(let ue=0;ue<ne.length;ue++){const xe=le&&le[ne[ue].id]||C(ne[ue]);le&&(le[ne[ue].id]=xe);let Oe=ge[xe];Oe||(Oe=ge[xe]=[]),Oe.push(ne[ue])}const _e=[];for(const ue in ge)_e.push(ge[ue]);return _e}(l.values(this._layerConfigs),this.keyCache);for(const ne of K){const le=ne.map(it=>this._layers[it.id]),ge=le[0];if(ge.visibility==="none")continue;const _e=ge.source||"";let ue=this.familiesBySource[_e];ue||(ue=this.familiesBySource[_e]={});const xe=ge.sourceLayer||"_geojsonTileLayer";let Oe=ue[xe];Oe||(Oe=ue[xe]=[]),Oe.push(le)}}}class R{loadTile(N,U){const{uid:K,encoding:ne,rawImageData:le,padding:ge,buildQuadTree:_e}=N,ue=l.window.ImageBitmap&&le instanceof l.window.ImageBitmap?this.getImageData(le,ge):le;U(null,new l.DEMData(K,ue,ne,ge<1,_e))}getImageData(N,U){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const K=this.offscreenCanvasContext.getImageData(-U,-U,N.width+2*U,N.height+2*U);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),K}}var $=function Y(N,U){var K,ne=N&&N.type;if(ne==="FeatureCollection")for(K=0;K<N.features.length;K++)Y(N.features[K],U);else if(ne==="GeometryCollection")for(K=0;K<N.geometries.length;K++)Y(N.geometries[K],U);else if(ne==="Feature")Y(N.geometry,U);else if(ne==="Polygon")J(N.coordinates,U);else if(ne==="MultiPolygon")for(K=0;K<N.coordinates.length;K++)J(N.coordinates[K],U);return N};function J(Y,N){if(Y.length!==0){pe(Y[0],N);for(var U=1;U<Y.length;U++)pe(Y[U],!N)}}function pe(Y,N){for(var U=0,K=0,ne=0,le=Y.length,ge=le-1;ne<le;ge=ne++){var _e=(Y[ne][0]-Y[ge][0])*(Y[ge][1]+Y[ne][1]),ue=U+_e;K+=Math.abs(U)>=Math.abs(_e)?U-ue+_e:_e-ue+U,U=ue}U+K>=0!=!!N&&Y.reverse()}const Re=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class we{constructor(N){this._feature=N,this.extent=l.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(this._feature.type===1){const N=[];for(const U of this._feature.geometry)N.push([new l.pointGeometry(U[0],U[1])]);return N}{const N=[];for(const U of this._feature.geometry){const K=[];for(const ne of U)K.push(new l.pointGeometry(ne[0],ne[1]));N.push(K)}return N}}toGeoJSON(N,U,K){return Re.call(this,N,U,K)}}class Be{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=N.length,this._features=N}feature(N){return new we(this._features[N])}}var nt=l.vectorTile.VectorTileFeature,yt=lt;function lt(Y,N){this.options=N||{},this.features=Y,this.length=Y.length}function zt(Y,N){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=N||4096}lt.prototype.feature=function(Y){return new zt(this.features[Y],this.options.extent)},zt.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var N=0;N<Y.length;N++){for(var U=Y[N],K=[],ne=0;ne<U.length;ne++)K.push(new l.pointGeometry(U[ne][0],U[ne][1]));this.geometry.push(K)}return this.geometry},zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,N=1/0,U=-1/0,K=1/0,ne=-1/0,le=0;le<Y.length;le++)for(var ge=Y[le],_e=0;_e<ge.length;_e++){var ue=ge[_e];N=Math.min(N,ue.x),U=Math.max(U,ue.x),K=Math.min(K,ue.y),ne=Math.max(ne,ue.y)}return[N,K,U,ne]},zt.prototype.toGeoJSON=nt.prototype.toGeoJSON;var rt=hi,Wt=yt;function hi(Y){var N=new l.pbf;return function(U,K){for(var ne in U.layers)K.writeMessage(3,_i,U.layers[ne])}(Y,N),N.finish()}function _i(Y,N){var U;N.writeVarintField(15,Y.version||1),N.writeStringField(1,Y.name||""),N.writeVarintField(5,Y.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<Y.length;U++)K.feature=Y.feature(U),N.writeMessage(2,Ci,K);var ne=K.keys;for(U=0;U<ne.length;U++)N.writeStringField(3,ne[U]);var le=K.values;for(U=0;U<le.length;U++)N.writeMessage(4,Fn,le[U])}function Ci(Y,N){var U=Y.feature;U.id!==void 0&&N.writeVarintField(1,U.id),N.writeMessage(2,Ht,Y),N.writeVarintField(3,U.type),N.writeMessage(4,Nn,U)}function Ht(Y,N){var U=Y.feature,K=Y.keys,ne=Y.values,le=Y.keycache,ge=Y.valuecache;for(var _e in U.properties){var ue=U.properties[_e],xe=le[_e];if(ue!==null){xe===void 0&&(K.push(_e),le[_e]=xe=K.length-1),N.writeVarint(xe);var Oe=typeof ue;Oe!=="string"&&Oe!=="boolean"&&Oe!=="number"&&(ue=JSON.stringify(ue));var it=Oe+":"+ue,Fe=ge[it];Fe===void 0&&(ne.push(ue),ge[it]=Fe=ne.length-1),N.writeVarint(Fe)}}}function $i(Y,N){return(N<<3)+(7&Y)}function Xi(Y){return Y<<1^Y>>31}function Nn(Y,N){for(var U=Y.loadGeometry(),K=Y.type,ne=0,le=0,ge=U.length,_e=0;_e<ge;_e++){var ue=U[_e],xe=1;K===1&&(xe=ue.length),N.writeVarint($i(1,xe));for(var Oe=K===3?ue.length-1:ue.length,it=0;it<Oe;it++){it===1&&K!==1&&N.writeVarint($i(2,Oe-1));var Fe=ue[it].x-ne,kt=ue[it].y-le;N.writeVarint(Xi(Fe)),N.writeVarint(Xi(kt)),ne+=Fe,le+=kt}K===3&&N.writeVarint($i(7,1))}}function Fn(Y,N){var U=typeof Y;U==="string"?N.writeStringField(1,Y):U==="boolean"?N.writeBooleanField(7,Y):U==="number"&&(Y%1!=0?N.writeDoubleField(3,Y):Y<0?N.writeSVarintField(6,Y):N.writeVarintField(5,Y))}function si(Y,N,U,K,ne,le){if(ne-K<=U)return;const ge=K+ne>>1;Zt(Y,N,ge,K,ne,le%2),si(Y,N,U,K,ge-1,le+1),si(Y,N,U,ge+1,ne,le+1)}function Zt(Y,N,U,K,ne,le){for(;ne>K;){if(ne-K>600){const xe=ne-K+1,Oe=U-K+1,it=Math.log(xe),Fe=.5*Math.exp(2*it/3),kt=.5*Math.sqrt(it*Fe*(xe-Fe)/xe)*(Oe-xe/2<0?-1:1);Zt(Y,N,U,Math.max(K,Math.floor(U-Oe*Fe/xe+kt)),Math.min(ne,Math.floor(U+(xe-Oe)*Fe/xe+kt)),le)}const ge=N[2*U+le];let _e=K,ue=ne;for(Qt(Y,N,K,U),N[2*ne+le]>ge&&Qt(Y,N,K,ne);_e<ue;){for(Qt(Y,N,_e,ue),_e++,ue--;N[2*_e+le]<ge;)_e++;for(;N[2*ue+le]>ge;)ue--}N[2*K+le]===ge?Qt(Y,N,K,ue):(ue++,Qt(Y,N,ue,ne)),ue<=U&&(K=ue+1),U<=ue&&(ne=ue-1)}}function Qt(Y,N,U,K){Ui(Y,U,K),Ui(N,2*U,2*K),Ui(N,2*U+1,2*K+1)}function Ui(Y,N,U){const K=Y[N];Y[N]=Y[U],Y[U]=K}function Bn(Y,N,U,K){const ne=Y-U,le=N-K;return ne*ne+le*le}rt.fromVectorTileJs=hi,rt.fromGeojsonVt=function(Y,N){N=N||{};var U={};for(var K in Y)U[K]=new yt(Y[K].features,N),U[K].name=K,U[K].version=N.version,U[K].extent=N.extent;return hi({layers:U})},rt.GeoJSONWrapper=Wt;const Ji=Y=>Y[0],vn=Y=>Y[1];class Kt{constructor(N,U=Ji,K=vn,ne=64,le=Float64Array){this.nodeSize=ne,this.points=N;const ge=N.length<65536?Uint16Array:Uint32Array,_e=this.ids=new ge(N.length),ue=this.coords=new le(2*N.length);for(let xe=0;xe<N.length;xe++)_e[xe]=xe,ue[2*xe]=U(N[xe]),ue[2*xe+1]=K(N[xe]);si(_e,ue,ne,0,_e.length-1,0)}range(N,U,K,ne){return function(le,ge,_e,ue,xe,Oe,it){const Fe=[0,le.length-1,0],kt=[];let Tt,It;for(;Fe.length;){const Lt=Fe.pop(),be=Fe.pop(),Ei=Fe.pop();if(be-Ei<=it){for(let Ti=Ei;Ti<=be;Ti++)Tt=ge[2*Ti],It=ge[2*Ti+1],Tt>=_e&&Tt<=xe&&It>=ue&&It<=Oe&&kt.push(le[Ti]);continue}const gt=Math.floor((Ei+be)/2);Tt=ge[2*gt],It=ge[2*gt+1],Tt>=_e&&Tt<=xe&&It>=ue&&It<=Oe&&kt.push(le[gt]);const bi=(Lt+1)%2;(Lt===0?_e<=Tt:ue<=It)&&(Fe.push(Ei),Fe.push(gt-1),Fe.push(bi)),(Lt===0?xe>=Tt:Oe>=It)&&(Fe.push(gt+1),Fe.push(be),Fe.push(bi))}return kt}(this.ids,this.coords,N,U,K,ne,this.nodeSize)}within(N,U,K){return function(ne,le,ge,_e,ue,xe){const Oe=[0,ne.length-1,0],it=[],Fe=ue*ue;for(;Oe.length;){const kt=Oe.pop(),Tt=Oe.pop(),It=Oe.pop();if(Tt-It<=xe){for(let bi=It;bi<=Tt;bi++)Bn(le[2*bi],le[2*bi+1],ge,_e)<=Fe&&it.push(ne[bi]);continue}const Lt=Math.floor((It+Tt)/2),be=le[2*Lt],Ei=le[2*Lt+1];Bn(be,Ei,ge,_e)<=Fe&&it.push(ne[Lt]);const gt=(kt+1)%2;(kt===0?ge-ue<=be:_e-ue<=Ei)&&(Oe.push(It),Oe.push(Lt-1),Oe.push(gt)),(kt===0?ge+ue>=be:_e+ue>=Ei)&&(Oe.push(Lt+1),Oe.push(Tt),Oe.push(gt))}return it}(this.ids,this.coords,N,U,K,this.nodeSize)}}const Yi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},ze=Math.fround||(_t=new Float32Array(1),Y=>(_t[0]=+Y,_t[0]));var _t;class tt{constructor(N){this.options=Ie(Object.create(Yi),N),this.trees=new Array(this.options.maxZoom+1)}load(N){const{log:U,minZoom:K,maxZoom:ne,nodeSize:le}=this.options;U&&console.time("total time");const ge=`prepare ${N.length} points`;U&&console.time(ge),this.points=N;let _e=[];for(let ue=0;ue<N.length;ue++)N[ue].geometry&&_e.push(yi(N[ue],ue));this.trees[ne+1]=new Kt(_e,Ue,De,le,Float32Array),U&&console.timeEnd(ge);for(let ue=ne;ue>=K;ue--){const xe=+Date.now();_e=this._cluster(_e,ue),this.trees[ue]=new Kt(_e,Ue,De,le,Float32Array),U&&console.log("z%d: %d clusters in %dms",ue,_e.length,+Date.now()-xe)}return U&&console.timeEnd("total time"),this}getClusters(N,U){let K=((N[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,N[1]));let le=N[2]===180?180:((N[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)K=-180,le=180;else if(K>le){const Oe=this.getClusters([K,ne,180,ge],U),it=this.getClusters([-180,ne,le,ge],U);return Oe.concat(it)}const _e=this.trees[this._limitZoom(U)],ue=_e.range(ct(K),se(ge),ct(le),se(ne)),xe=[];for(const Oe of ue){const it=_e.points[Oe];xe.push(it.numPoints?xi(it):this.points[it.index])}return xe}getChildren(N){const U=this._getOriginId(N),K=this._getOriginZoom(N),ne="No cluster with the specified id.",le=this.trees[K];if(!le)throw new Error(ne);const ge=le.points[U];if(!ge)throw new Error(ne);const _e=this.options.radius/(this.options.extent*Math.pow(2,K-1)),ue=le.within(ge.x,ge.y,_e),xe=[];for(const Oe of ue){const it=le.points[Oe];it.parentId===N&&xe.push(it.numPoints?xi(it):this.points[it.index])}if(xe.length===0)throw new Error(ne);return xe}getLeaves(N,U,K){const ne=[];return this._appendLeaves(ne,N,U=U||10,K=K||0,0),ne}getTile(N,U,K){const ne=this.trees[this._limitZoom(N)],le=Math.pow(2,N),{extent:ge,radius:_e}=this.options,ue=_e/ge,xe=(K-ue)/le,Oe=(K+1+ue)/le,it={features:[]};return this._addTileFeatures(ne.range((U-ue)/le,xe,(U+1+ue)/le,Oe),ne.points,U,K,le,it),U===0&&this._addTileFeatures(ne.range(1-ue/le,xe,1,Oe),ne.points,le,K,le,it),U===le-1&&this._addTileFeatures(ne.range(0,xe,ue/le,Oe),ne.points,-1,K,le,it),it.features.length?it:null}getClusterExpansionZoom(N){let U=this._getOriginZoom(N)-1;for(;U<=this.options.maxZoom;){const K=this.getChildren(N);if(U++,K.length!==1)break;N=K[0].properties.cluster_id}return U}_appendLeaves(N,U,K,ne,le){const ge=this.getChildren(U);for(const _e of ge){const ue=_e.properties;if(ue&&ue.cluster?le+ue.point_count<=ne?le+=ue.point_count:le=this._appendLeaves(N,ue.cluster_id,K,ne,le):le<ne?le++:N.push(_e),N.length===K)break}return le}_addTileFeatures(N,U,K,ne,le,ge){for(const _e of N){const ue=U[_e],xe=ue.numPoints;let Oe,it,Fe;if(xe)Oe=Ut(ue),it=ue.x,Fe=ue.y;else{const It=this.points[ue.index];Oe=It.properties,it=ct(It.geometry.coordinates[0]),Fe=se(It.geometry.coordinates[1])}const kt={type:1,geometry:[[Math.round(this.options.extent*(it*le-K)),Math.round(this.options.extent*(Fe*le-ne))]],tags:Oe};let Tt;xe?Tt=ue.id:this.options.generateId?Tt=ue.index:this.points[ue.index].id&&(Tt=this.points[ue.index].id),Tt!==void 0&&(kt.id=Tt),ge.features.push(kt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(+N,this.options.maxZoom+1))}_cluster(N,U){const K=[],{radius:ne,extent:le,reduce:ge,minPoints:_e}=this.options,ue=ne/(le*Math.pow(2,U));for(let xe=0;xe<N.length;xe++){const Oe=N[xe];if(Oe.zoom<=U)continue;Oe.zoom=U;const it=this.trees[U+1],Fe=it.within(Oe.x,Oe.y,ue),kt=Oe.numPoints||1;let Tt=kt;for(const It of Fe){const Lt=it.points[It];Lt.zoom>U&&(Tt+=Lt.numPoints||1)}if(Tt>kt&&Tt>=_e){let It=Oe.x*kt,Lt=Oe.y*kt,be=ge&&kt>1?this._map(Oe,!0):null;const Ei=(xe<<5)+(U+1)+this.points.length;for(const gt of Fe){const bi=it.points[gt];if(bi.zoom<=U)continue;bi.zoom=U;const Ti=bi.numPoints||1;It+=bi.x*Ti,Lt+=bi.y*Ti,bi.parentId=Ei,ge&&(be||(be=this._map(Oe,!0)),ge(be,this._map(bi)))}Oe.parentId=Ei,K.push(bt(It/Tt,Lt/Tt,Ei,Tt,be))}else if(K.push(Oe),Tt>1)for(const It of Fe){const Lt=it.points[It];Lt.zoom<=U||(Lt.zoom=U,K.push(Lt))}}return K}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,U){if(N.numPoints)return U?Ie({},N.properties):N.properties;const K=this.points[N.index].properties,ne=this.options.map(K);return U&&ne===K?Ie({},ne):ne}}function bt(Y,N,U,K,ne){return{x:ze(Y),y:ze(N),zoom:1/0,id:U,parentId:-1,numPoints:K,properties:ne}}function yi(Y,N){const[U,K]=Y.geometry.coordinates;return{x:ze(ct(U)),y:ze(se(K)),zoom:1/0,index:N,parentId:-1}}function xi(Y){return{type:"Feature",id:Y.id,properties:Ut(Y),geometry:{type:"Point",coordinates:[(N=Y.x,360*(N-.5)),me(Y.y)]}};var N}function Ut(Y){const N=Y.numPoints,U=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N;return Ie(Ie({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:N,point_count_abbreviated:U})}function ct(Y){return Y/360+.5}function se(Y){const N=Math.sin(Y*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function me(Y){const N=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function Ie(Y,N){for(const U in N)Y[U]=N[U];return Y}function Ue(Y){return Y.x}function De(Y){return Y.y}function Ye(Y,N,U,K){for(var ne,le=K,ge=U-N>>1,_e=U-N,ue=Y[N],xe=Y[N+1],Oe=Y[U],it=Y[U+1],Fe=N+3;Fe<U;Fe+=3){var kt=ut(Y[Fe],Y[Fe+1],ue,xe,Oe,it);if(kt>le)ne=Fe,le=kt;else if(kt===le){var Tt=Math.abs(Fe-ge);Tt<_e&&(ne=Fe,_e=Tt)}}le>K&&(ne-N>3&&Ye(Y,N,ne,K),Y[ne+2]=le,U-ne>3&&Ye(Y,ne,U,K))}function ut(Y,N,U,K,ne,le){var ge=ne-U,_e=le-K;if(ge!==0||_e!==0){var ue=((Y-U)*ge+(N-K)*_e)/(ge*ge+_e*_e);ue>1?(U=ne,K=le):ue>0&&(U+=ge*ue,K+=_e*ue)}return(ge=Y-U)*ge+(_e=N-K)*_e}function je(Y,N,U,K){var ne={id:Y===void 0?null:Y,type:N,geometry:U,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var ge=le.geometry,_e=le.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Je(le,ge);else if(_e==="Polygon"||_e==="MultiLineString")for(var ue=0;ue<ge.length;ue++)Je(le,ge[ue]);else if(_e==="MultiPolygon")for(ue=0;ue<ge.length;ue++)for(var xe=0;xe<ge[ue].length;xe++)Je(le,ge[ue][xe])}(ne),ne}function Je(Y,N){for(var U=0;U<N.length;U+=3)Y.minX=Math.min(Y.minX,N[U]),Y.minY=Math.min(Y.minY,N[U+1]),Y.maxX=Math.max(Y.maxX,N[U]),Y.maxY=Math.max(Y.maxY,N[U+1])}function qe(Y,N,U,K){if(N.geometry){var ne=N.geometry.coordinates,le=N.geometry.type,ge=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),_e=[],ue=N.id;if(U.promoteId?ue=N.properties[U.promoteId]:U.generateId&&(ue=K||0),le==="Point")Pt(ne,_e);else if(le==="MultiPoint")for(var xe=0;xe<ne.length;xe++)Pt(ne[xe],_e);else if(le==="LineString")wt(ne,_e,ge,!1);else if(le==="MultiLineString"){if(U.lineMetrics){for(xe=0;xe<ne.length;xe++)wt(ne[xe],_e=[],ge,!1),Y.push(je(ue,"LineString",_e,N.properties));return}Ct(ne,_e,ge,!1)}else if(le==="Polygon")Ct(ne,_e,ge,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(xe=0;xe<N.geometry.geometries.length;xe++)qe(Y,{id:ue,geometry:N.geometry.geometries[xe],properties:N.properties},U,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(xe=0;xe<ne.length;xe++){var Oe=[];Ct(ne[xe],Oe,ge,!0),_e.push(Oe)}}Y.push(je(ue,le,_e,N.properties))}}function Pt(Y,N){N.push(Rt(Y[0])),N.push(Yt(Y[1])),N.push(0)}function wt(Y,N,U,K){for(var ne,le,ge=0,_e=0;_e<Y.length;_e++){var ue=Rt(Y[_e][0]),xe=Yt(Y[_e][1]);N.push(ue),N.push(xe),N.push(0),_e>0&&(ge+=K?(ne*xe-ue*le)/2:Math.sqrt(Math.pow(ue-ne,2)+Math.pow(xe-le,2))),ne=ue,le=xe}var Oe=N.length-3;N[2]=1,Ye(N,0,Oe,U),N[Oe+2]=1,N.size=Math.abs(ge),N.start=0,N.end=N.size}function Ct(Y,N,U,K){for(var ne=0;ne<Y.length;ne++){var le=[];wt(Y[ne],le,U,K),N.push(le)}}function Rt(Y){return Y/360+.5}function Yt(Y){var N=Math.sin(Y*Math.PI/180),U=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return U<0?0:U>1?1:U}function di(Y,N,U,K,ne,le,ge,_e){if(K/=N,le>=(U/=N)&&ge<K)return Y;if(ge<U||le>=K)return null;for(var ue=[],xe=0;xe<Y.length;xe++){var Oe=Y[xe],it=Oe.geometry,Fe=Oe.type,kt=ne===0?Oe.minX:Oe.minY,Tt=ne===0?Oe.maxX:Oe.maxY;if(kt>=U&&Tt<K)ue.push(Oe);else if(!(Tt<U||kt>=K)){var It=[];if(Fe==="Point"||Fe==="MultiPoint")fi(it,It,U,K,ne);else if(Fe==="LineString")Mi(it,It,U,K,ne,!1,_e.lineMetrics);else if(Fe==="MultiLineString")pr(it,It,U,K,ne,!1);else if(Fe==="Polygon")pr(it,It,U,K,ne,!0);else if(Fe==="MultiPolygon")for(var Lt=0;Lt<it.length;Lt++){var be=[];pr(it[Lt],be,U,K,ne,!0),be.length&&It.push(be)}if(It.length){if(_e.lineMetrics&&Fe==="LineString"){for(Lt=0;Lt<It.length;Lt++)ue.push(je(Oe.id,Fe,It[Lt],Oe.tags));continue}Fe!=="LineString"&&Fe!=="MultiLineString"||(It.length===1?(Fe="LineString",It=It[0]):Fe="MultiLineString"),Fe!=="Point"&&Fe!=="MultiPoint"||(Fe=It.length===3?"Point":"MultiPoint"),ue.push(je(Oe.id,Fe,It,Oe.tags))}}}return ue.length?ue:null}function fi(Y,N,U,K,ne){for(var le=0;le<Y.length;le+=3){var ge=Y[le+ne];ge>=U&&ge<=K&&(N.push(Y[le]),N.push(Y[le+1]),N.push(Y[le+2]))}}function Mi(Y,N,U,K,ne,le,ge){for(var _e,ue,xe=Un(Y),Oe=ne===0?js:Zo,it=Y.start,Fe=0;Fe<Y.length-3;Fe+=3){var kt=Y[Fe],Tt=Y[Fe+1],It=Y[Fe+2],Lt=Y[Fe+3],be=Y[Fe+4],Ei=ne===0?kt:Tt,gt=ne===0?Lt:be,bi=!1;ge&&(_e=Math.sqrt(Math.pow(kt-Lt,2)+Math.pow(Tt-be,2))),Ei<U?gt>U&&(ue=Oe(xe,kt,Tt,Lt,be,U),ge&&(xe.start=it+_e*ue)):Ei>K?gt<K&&(ue=Oe(xe,kt,Tt,Lt,be,K),ge&&(xe.start=it+_e*ue)):$s(xe,kt,Tt,It),gt<U&&Ei>=U&&(ue=Oe(xe,kt,Tt,Lt,be,U),bi=!0),gt>K&&Ei<=K&&(ue=Oe(xe,kt,Tt,Lt,be,K),bi=!0),!le&&bi&&(ge&&(xe.end=it+_e*ue),N.push(xe),xe=Un(Y)),ge&&(it+=_e)}var Ti=Y.length-3;kt=Y[Ti],Tt=Y[Ti+1],It=Y[Ti+2],(Ei=ne===0?kt:Tt)>=U&&Ei<=K&&$s(xe,kt,Tt,It),Ti=xe.length-3,le&&Ti>=3&&(xe[Ti]!==xe[0]||xe[Ti+1]!==xe[1])&&$s(xe,xe[0],xe[1],xe[2]),xe.length&&N.push(xe)}function Un(Y){var N=[];return N.size=Y.size,N.start=Y.start,N.end=Y.end,N}function pr(Y,N,U,K,ne,le){for(var ge=0;ge<Y.length;ge++)Mi(Y[ge],N,U,K,ne,le,!1)}function $s(Y,N,U,K){Y.push(N),Y.push(U),Y.push(K)}function js(Y,N,U,K,ne,le){var ge=(le-N)/(K-N);return Y.push(le),Y.push(U+(ne-U)*ge),Y.push(1),ge}function Zo(Y,N,U,K,ne,le){var ge=(le-U)/(ne-U);return Y.push(N+(K-N)*ge),Y.push(le),Y.push(1),ge}function kn(Y,N){for(var U=[],K=0;K<Y.length;K++){var ne,le=Y[K],ge=le.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")ne=Vn(le.geometry,N);else if(ge==="MultiLineString"||ge==="Polygon"){ne=[];for(var _e=0;_e<le.geometry.length;_e++)ne.push(Vn(le.geometry[_e],N))}else if(ge==="MultiPolygon")for(ne=[],_e=0;_e<le.geometry.length;_e++){for(var ue=[],xe=0;xe<le.geometry[_e].length;xe++)ue.push(Vn(le.geometry[_e][xe],N));ne.push(ue)}U.push(je(le.id,ge,ne,le.tags))}return U}function Vn(Y,N){var U=[];U.size=Y.size,Y.start!==void 0&&(U.start=Y.start,U.end=Y.end);for(var K=0;K<Y.length;K+=3)U.push(Y[K]+N,Y[K+1],Y[K+2]);return U}function Xo(Y,N){if(Y.transformed)return Y;var U,K,ne,le=1<<Y.z,ge=Y.x,_e=Y.y;for(U=0;U<Y.features.length;U++){var ue=Y.features[U],xe=ue.geometry,Oe=ue.type;if(ue.geometry=[],Oe===1)for(K=0;K<xe.length;K+=2)ue.geometry.push(Yo(xe[K],xe[K+1],N,le,ge,_e));else for(K=0;K<xe.length;K++){var it=[];for(ne=0;ne<xe[K].length;ne+=2)it.push(Yo(xe[K][ne],xe[K][ne+1],N,le,ge,_e));ue.geometry.push(it)}}return Y.transformed=!0,Y}function Yo(Y,N,U,K,ne,le){return[Math.round(U*(Y*K-ne)),Math.round(U*(N*K-le))]}function vu(Y,N,U,K,ne){for(var le=N===ne.maxZoom?0:ne.tolerance/((1<<N)*ne.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:K,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<Y.length;_e++){ge.numFeatures++,us(ge,Y[_e],le,ne);var ue=Y[_e].minX,xe=Y[_e].minY,Oe=Y[_e].maxX,it=Y[_e].maxY;ue<ge.minX&&(ge.minX=ue),xe<ge.minY&&(ge.minY=xe),Oe>ge.maxX&&(ge.maxX=Oe),it>ge.maxY&&(ge.maxY=it)}return ge}function us(Y,N,U,K){var ne=N.geometry,le=N.type,ge=[];if(le==="Point"||le==="MultiPoint")for(var _e=0;_e<ne.length;_e+=3)ge.push(ne[_e]),ge.push(ne[_e+1]),Y.numPoints++,Y.numSimplified++;else if(le==="LineString")fo(ge,ne,Y,U,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(_e=0;_e<ne.length;_e++)fo(ge,ne[_e],Y,U,le==="Polygon",_e===0);else if(le==="MultiPolygon")for(var ue=0;ue<ne.length;ue++){var xe=ne[ue];for(_e=0;_e<xe.length;_e++)fo(ge,xe[_e],Y,U,!0,_e===0)}if(ge.length){var Oe=N.tags||null;if(le==="LineString"&&K.lineMetrics){for(var it in Oe={},N.tags)Oe[it]=N.tags[it];Oe.mapbox_clip_start=ne.start/ne.size,Oe.mapbox_clip_end=ne.end/ne.size}var Fe={geometry:ge,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Oe};N.id!==null&&(Fe.id=N.id),Y.features.push(Fe)}}function fo(Y,N,U,K,ne,le){var ge=K*K;if(K>0&&N.size<(ne?ge:K))U.numPoints+=N.length/3;else{for(var _e=[],ue=0;ue<N.length;ue+=3)(K===0||N[ue+2]>ge)&&(U.numSimplified++,_e.push(N[ue]),_e.push(N[ue+1])),U.numPoints++;ne&&function(xe,Oe){for(var it=0,Fe=0,kt=xe.length,Tt=kt-2;Fe<kt;Tt=Fe,Fe+=2)it+=(xe[Fe]-xe[Tt])*(xe[Fe+1]+xe[Tt+1]);if(it>0===Oe)for(Fe=0,kt=xe.length;Fe<kt/2;Fe+=2){var It=xe[Fe],Lt=xe[Fe+1];xe[Fe]=xe[kt-2-Fe],xe[Fe+1]=xe[kt-1-Fe],xe[kt-2-Fe]=It,xe[kt-1-Fe]=Lt}}(_e,le),Y.push(_e)}}function Jo(Y,N){var U=(N=this.options=function(ne,le){for(var ge in le)ne[ge]=le[ge];return ne}(Object.create(this.options),N)).debug;if(U&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var K=function(ne,le){var ge=[];if(ne.type==="FeatureCollection")for(var _e=0;_e<ne.features.length;_e++)qe(ge,ne.features[_e],le,_e);else qe(ge,ne.type==="Feature"?ne:{geometry:ne},le);return ge}(Y,N);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(K=function(ne,le){var ge=le.buffer/le.extent,_e=ne,ue=di(ne,1,-1-ge,ge,0,-1,2,le),xe=di(ne,1,1-ge,2+ge,0,-1,2,le);return(ue||xe)&&(_e=di(ne,1,-ge,1+ge,0,-1,2,le)||[],ue&&(_e=kn(ue,1).concat(_e)),xe&&(_e=_e.concat(kn(xe,-1)))),_e}(K,N)).length&&this.splitTile(K,0,0,0),U&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qo(Y,N,U){return 32*((1<<Y)*U+N)+Y}function Ra(Y,N){const U=Y.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const K=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!K)return N(null,null);const ne=new Be(K.features);let le=rt(ne);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),N(null,{vectorTile:ne,rawData:le.buffer})}Jo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Jo.prototype.splitTile=function(Y,N,U,K,ne,le,ge){for(var _e=[Y,N,U,K],ue=this.options,xe=ue.debug;_e.length;){K=_e.pop(),U=_e.pop(),N=_e.pop(),Y=_e.pop();var Oe=1<<N,it=Qo(N,U,K),Fe=this.tiles[it];if(!Fe&&(xe>1&&console.time("creation"),Fe=this.tiles[it]=vu(Y,N,U,K,ue),this.tileCoords.push({z:N,x:U,y:K}),xe)){xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,U,K,Fe.numFeatures,Fe.numPoints,Fe.numSimplified),console.timeEnd("creation"));var kt="z"+N;this.stats[kt]=(this.stats[kt]||0)+1,this.total++}if(Fe.source=Y,ne){if(N===ue.maxZoom||N===ne)continue;var Tt=1<<ne-N;if(U!==Math.floor(le/Tt)||K!==Math.floor(ge/Tt))continue}else if(N===ue.indexMaxZoom||Fe.numPoints<=ue.indexMaxPoints)continue;if(Fe.source=null,Y.length!==0){xe>1&&console.time("clipping");var It,Lt,be,Ei,gt,bi,Ti=.5*ue.buffer/ue.extent,ea=.5-Ti,Gs=.5+Ti,Qe=1+Ti;It=Lt=be=Ei=null,gt=di(Y,Oe,U-Ti,U+Gs,0,Fe.minX,Fe.maxX,ue),bi=di(Y,Oe,U+ea,U+Qe,0,Fe.minX,Fe.maxX,ue),Y=null,gt&&(It=di(gt,Oe,K-Ti,K+Gs,1,Fe.minY,Fe.maxY,ue),Lt=di(gt,Oe,K+ea,K+Qe,1,Fe.minY,Fe.maxY,ue),gt=null),bi&&(be=di(bi,Oe,K-Ti,K+Gs,1,Fe.minY,Fe.maxY,ue),Ei=di(bi,Oe,K+ea,K+Qe,1,Fe.minY,Fe.maxY,ue),bi=null),xe>1&&console.timeEnd("clipping"),_e.push(It||[],N+1,2*U,2*K),_e.push(Lt||[],N+1,2*U,2*K+1),_e.push(be||[],N+1,2*U+1,2*K),_e.push(Ei||[],N+1,2*U+1,2*K+1)}}},Jo.prototype.getTile=function(Y,N,U){var K=this.options,ne=K.extent,le=K.debug;if(Y<0||Y>24)return null;var ge=1<<Y,_e=Qo(Y,N=(N%ge+ge)%ge,U);if(this.tiles[_e])return Xo(this.tiles[_e],ne);le>1&&console.log("drilling down to z%d-%d-%d",Y,N,U);for(var ue,xe=Y,Oe=N,it=U;!ue&&xe>0;)xe--,Oe=Math.floor(Oe/2),it=Math.floor(it/2),ue=this.tiles[Qo(xe,Oe,it)];return ue&&ue.source?(le>1&&console.log("found parent tile z%d-%d-%d",xe,Oe,it),le>1&&console.time("drilling down"),this.splitTile(ue.source,xe,Oe,it,Y,N,U),le>1&&console.timeEnd("drilling down"),this.tiles[_e]?Xo(this.tiles[_e],ne):null):null};class Nl extends l.VectorTileWorkerSource{constructor(N,U,K,ne,le){super(N,U,K,ne,Ra),le&&(this.loadGeoJSON=le)}loadData(N,U){const K=N&&N.request,ne=K&&K.collectResourceTiming;this.loadGeoJSON(N,(le,ge)=>{if(le||!ge)return U(le);if(typeof ge!="object")return U(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{$(ge,!0);try{if(N.filter){const ue=l.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ue.result==="error")throw new Error(ue.value.map(Oe=>`${Oe.key}: ${Oe.message}`).join(", "));const xe=ge.features.filter(Oe=>ue.value.evaluate({zoom:0},Oe));ge={type:"FeatureCollection",features:xe}}this._geoJSONIndex=N.cluster?new tt(function({superclusterOptions:ue,clusterProperties:xe}){if(!xe||!ue)return ue;const Oe={},it={},Fe={accumulated:null,zoom:0},kt={properties:null},Tt=Object.keys(xe);for(const It of Tt){const[Lt,be]=xe[It],Ei=l.createExpression(be),gt=l.createExpression(typeof Lt=="string"?[Lt,["accumulated"],["get",It]]:Lt);Oe[It]=Ei.value,it[It]=gt.value}return ue.map=It=>{kt.properties=It;const Lt={};for(const be of Tt)Lt[be]=Oe[be].evaluate(Fe,kt);return Lt},ue.reduce=(It,Lt)=>{kt.properties=Lt;for(const be of Tt)Fe.accumulated=It[be],It[be]=it[be].evaluate(Fe,kt)},ue}(N)).load(ge.features):function(ue,xe){return new Jo(ue,xe)}(ge,N.geojsonVtOptions)}catch(ue){return U(ue)}this.loaded={};const _e={};if(ne){const ue=l.getPerformanceMeasurement(K);ue&&(_e.resourceTiming={},_e.resourceTiming[N.source]=JSON.parse(JSON.stringify(ue)))}U(null,_e)}})}reloadTile(N,U){const K=this.loaded;return K&&K[N.uid]?super.reloadTile(N,U):this.loadTile(N,U)}loadGeoJSON(N,U){if(N.request)l.getJSON(N.request,U);else{if(typeof N.data!="string")return U(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse(N.data))}catch{return U(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(N,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(K){U(K)}}getClusterChildren(N,U){try{U(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(K){U(K)}}getClusterLeaves(N,U){try{U(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(K){U(K)}}}class La{constructor(N){this.self=N,this.actor=new l.Actor(N,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=l.getProjection({name:"mercator"}),this.workerSourceTypes={vector:l.VectorTileWorkerSource,geojson:Nl},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,K)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=K},this.self.registerRTLTextPlugin=U=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=U.applyArabicShaping,l.plugin.processBidirectionalText=U.processBidirectionalText,l.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}clearCaches(N,U,K){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],K()}checkIfReady(N,U,K){K()}setReferrer(N,U){this.referrer=U}spriteLoaded(N,U){this.isSpriteLoaded[N]=U;for(const K in this.workerSources[N]){const ne=this.workerSources[N][K];for(const le in ne)ne[le]instanceof l.VectorTileWorkerSource&&(ne[le].isSpriteLoaded=U,ne[le].fire(new l.Event("isSpriteLoaded")))}}setImages(N,U,K){this.availableImages[N]=U;for(const ne in this.workerSources[N]){const le=this.workerSources[N][ne];for(const ge in le)le[ge].availableImages=U}K()}enableTerrain(N,U,K){this.terrain=U,K()}setProjection(N,U){this.projections[N]=l.getProjection(U)}setLayers(N,U,K){this.getLayerIndex(N).replace(U),K()}updateLayers(N,U,K){this.getLayerIndex(N).update(U.layers,U.removedIds),K()}loadTile(N,U,K){const ne=this.enableTerrain?l.extend({enableTerrain:this.terrain},U):U;ne.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,U.type,U.source).loadTile(ne,K)}loadDEMTile(N,U,K){const ne=this.enableTerrain?l.extend({buildQuadTree:this.terrain},U):U;this.getDEMWorkerSource(N,U.source).loadTile(ne,K)}reloadTile(N,U,K){const ne=this.enableTerrain?l.extend({enableTerrain:this.terrain},U):U;ne.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,U.type,U.source).reloadTile(ne,K)}abortTile(N,U,K){this.getWorkerSource(N,U.type,U.source).abortTile(U,K)}removeTile(N,U,K){this.getWorkerSource(N,U.type,U.source).removeTile(U,K)}removeSource(N,U,K){if(!this.workerSources[N]||!this.workerSources[N][U.type]||!this.workerSources[N][U.type][U.source])return;const ne=this.workerSources[N][U.type][U.source];delete this.workerSources[N][U.type][U.source],ne.removeSource!==void 0?ne.removeSource(U,K):K()}loadWorkerSource(N,U,K){try{this.self.importScripts(U.url),K()}catch(ne){K(ne.toString())}}syncRTLPluginState(N,U,K){try{l.plugin.setState(U);const ne=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);const le=l.plugin.isParsed();K(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),le)}}catch(ne){K(ne.toString())}}getAvailableImages(N){let U=this.availableImages[N];return U||(U=[]),U}getLayerIndex(N){let U=this.layerIndexes[N];return U||(U=this.layerIndexes[N]=new L),U}getWorkerSource(N,U,K){return this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][U]||(this.workerSources[N][U]={}),this.workerSources[N][U][K]||(this.workerSources[N][U][K]=new this.workerSourceTypes[U]({send:(ne,le,ge,_e,ue,xe)=>{this.actor.send(ne,le,ge,N,ue,xe)},scheduler:this.actor.scheduler},this.getLayerIndex(N),this.getAvailableImages(N),this.isSpriteLoaded[N])),this.workerSources[N][U][K]}getDEMWorkerSource(N,U){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][U]||(this.demWorkerSources[N][U]=new R),this.demWorkerSources[N][U]}enforceCacheSizeLimit(N,U){l.enforceCacheSizeLimit(U)}getWorkerPerformanceMetrics(N,U,K){K(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new La(self)),La}),f(["./shared"],function(l){var I=C;function C(p){return!function(s){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{x=new Worker(E),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(E),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var b=x.getImageData(0,0,1,1);return b&&b.width===_.width}()?(L[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(L[h]=function(_){var x,b=function(E){var S=document.createElement("canvas"),k=Object.create(C.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=E,S.getContext("webgl",k)||S.getContext("experimental-webgl",k)}(_);if(!b)return!1;try{x=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!x||b.isContextLost())&&(b.shaderSource(x,"void main() {}"),b.compileShader(x),b.getShaderParameter(x,b.COMPILE_STATUS)===!0)}(h)),L[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(p)}var L={};function R(p,s){if(Array.isArray(p)){if(!Array.isArray(s)||p.length!==s.length)return!1;for(let h=0;h<p.length;h++)if(!R(p[h],s[h]))return!1;return!0}if(typeof p=="object"&&p!==null&&s!==null){if(typeof s!="object"||Object.keys(p).length!==Object.keys(s).length)return!1;for(const h in p)if(!R(p[h],s[h]))return!1;return!0}return p===s}function $(p,s,h){const _=l.window.document.createElement(p);return s!==void 0&&(_.className=s),h&&h.appendChild(_),_}function J(p,s,h){const _=l.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const x of Object.keys(s))_.setAttributeNS(null,x,s[x]);return h&&h.appendChild(_),_}C.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const pe=l.window.document&&l.window.document.documentElement.style,Re=pe&&pe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let we;function Be(){pe&&Re&&(we=pe[Re],pe[Re]="none")}function nt(){pe&&Re&&(pe[Re]=we)}function yt(p){p.preventDefault(),p.stopPropagation(),l.window.removeEventListener("click",yt,!0)}function lt(){l.window.addEventListener("click",yt,!0),l.window.setTimeout(()=>{l.window.removeEventListener("click",yt,!0)},0)}function zt(p,s){const h=p.getBoundingClientRect();return hi(p,h,s)}function rt(p,s){const h=p.getBoundingClientRect(),_=[];for(let x=0;x<s.length;x++)_.push(hi(p,h,s[x]));return _}function Wt(p){return l.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&l.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function hi(p,s,h){const _=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new l.pointGeometry((h.clientX-s.left)*_,(h.clientY-s.top)*_)}function _i(p,s){var h=s[0],_=s[1],x=s[2],b=s[3],E=h*b-x*_;return E?(p[0]=b*(E=1/E),p[1]=-_*E,p[2]=-x*E,p[3]=h*E,p):null}function Ci(p){const{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class Ht extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(s){return!!this.getImage(s)}getImage(s){return this.images[s]}addImage(s,h){this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),_=!1),_}_validateStretch(s,h){if(!s)return!0;let _=0;for(const x of s){if(x[0]<_||x[1]<x[0]||h<x[1])return!1;_=x[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){h.version=this.images[s].version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let _=!0;if(!this.isLoaded())for(const x of s)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const _={};for(const x of s){this.images[x]||this.fire(new l.Event("styleimagemissing",{id:x}));const b=this.images[x];b?_[x]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:l.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],_=this.getImage(s);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},b=new l.ImagePosition(x,_);this.patterns[s]={bin:x,position:b}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.Texture(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const b in this.patterns)s.push(this.patterns[b].bin);const{w:h,h:_}=l.potpack(s),x=this.atlasImage;x.resize({width:h||1,height:_||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],S=E.x+1,k=E.y+1,P=this.images[b].data,O=P.width,F=P.height;l.RGBAImage.copy(P,x,{x:0,y:0},{x:S,y:k},{width:O,height:F}),l.RGBAImage.copy(P,x,{x:0,y:F-1},{x:S,y:k-1},{width:O,height:1}),l.RGBAImage.copy(P,x,{x:0,y:0},{x:S,y:k+F},{width:O,height:1}),l.RGBAImage.copy(P,x,{x:O-1,y:0},{x:S-1,y:k},{width:1,height:F}),l.RGBAImage.copy(P,x,{x:0,y:0},{x:S+O,y:k},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];Ci(_)&&this.updateImage(h,_)}}}const $i=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(p,s){return function([h,_,x]){const b=l.degToRad(_+90),E=l.degToRad(x);return{x:h*Math.cos(b)*Math.sin(E),y:h*Math.sin(b)*Math.sin(E),z:h*Math.cos(E),azimuthal:_,polar:x}}(p.expression.evaluate(s))}interpolate(p,s,h){return{x:l.number(p.x,s.x,h),y:l.number(p.y,s.y,h),z:l.number(p.z,s.z,h),azimuthal:l.number(p.azimuthal,s.azimuthal,h),polar:l.number(p.polar,s.polar,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Xi="-transition";class Nn extends l.Evented{constructor(s){super(),this._transitionable=new l.Transitionable($i),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(l.validateLight,s,h))for(const _ in s){const x=s[_];l.endsWith(_,Xi)?this._transitionable.setTransition(_.slice(0,-Xi.length),x):this._transitionable.setValue(_,x)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,_){return(!_||_.validate!==!1)&&l.emitValidationErrors(this,s.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}const Fn=new l.Properties({source:new l.DataConstantProperty(l.spec.terrain.source),exaggeration:new l.DataConstantProperty(l.spec.terrain.exaggeration)}),si="-transition";class Zt extends l.Evented{constructor(s,h){super(),this._transitionable=new l.Transitionable(Fn),this.set(s),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(s){for(const h in s){const _=s[h];l.endsWith(h,si)?this._transitionable.setTransition(h.slice(0,-si.length),_):this._transitionable.setValue(h,_)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}}function Qt(p,s,h,_){const x=l.smoothstep(45,65,h),[b,E]=Ui(p,_),S=l.length(s);let k=1-Math.min(1,Math.exp((S-b)/(E-b)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*x*p.alpha}function Ui(p,s){const h=.5/Math.tan(.5*s);return[p.range[0]+h,p.range[1]+h]}const Bn=new l.Properties({range:new l.DataConstantProperty(l.spec.fog.range),color:new l.DataConstantProperty(l.spec.fog.color),"horizon-blend":new l.DataConstantProperty(l.spec.fog["horizon-blend"])}),Ji="-transition";class vn extends l.Evented{constructor(s,h){super(),this._transitionable=new l.Transitionable(Bn),this.set(s),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h={}){if(!this._validate(l.validateFog,s,h))for(const _ in s){const x=s[_];l.endsWith(_,Ji)?this._transitionable.setTransition(_.slice(0,-Ji.length),x):this._transitionable.setValue(_,x)}}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return l.smoothstep(45,65,s)*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(_,x,b){const E=l.MercatorCoordinate.fromLngLat(x),S=b.elevation?b.elevation.getAtPointOrZero(E):0,k=[E.x,E.y,S];return l.transformMat4(k,k,b.mercatorFogMatrix),Qt(_,k,b.pitch,b._fov)}(this.state,s,h):0}getFovAdjustedRange(s){return this._transform.projection.supportsFog?Ui(this.state,s):[0,1]}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,_){return(!_||_.validate!==!1)&&l.emitValidationErrors(this,s.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class Kt{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const b=new Kt.Actor(_[x],h,this.id);b.name=`Worker ${x}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,h,_){l.asyncAll(this.actors,(x,b)=>{x.send(s,h,b)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Yi(p,s,h){return s*(l.EXTENT/(p.tileSize*Math.pow(2,h-p.tileID.overscaledZ)))}Kt.Actor=l.Actor;class ze{constructor(s,h,_,x){this.screenBounds=s,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>x.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(s,h){let _,x;if(s instanceof l.pointGeometry||typeof s[0]=="number"){const b=l.pointGeometry.convert(s);_=[l.pointGeometry.convert(s)],x=h.isPointAboveHorizon(b)}else{const b=l.pointGeometry.convert(s[0]),E=l.pointGeometry.convert(s[1]);_=[b,E],x=l.polygonizeBounds(b,E).every(S=>h.isPointAboveHorizon(S))}return new ze(_,h.getCameraPoint(),x,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return l.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const h=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new l.pointGeometry(1,1)):this.screenBounds[1],x=l.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),l.bufferConvexPolygon(x,s)}containsTile(s,h,_){const x=s.queryPadding+1,b=s.tileID.wrap,E=_?this._bufferedCameraMercator(x,h).map(q=>l.getTilePoint(s.tileTransform,q,b)):this._bufferedScreenMercator(x,h).map(q=>l.getTilePoint(s.tileTransform,q,b)),S=this.screenGeometryMercator.map(q=>l.getTileVec3(s.tileTransform,q,b)),k=S.map(q=>new l.pointGeometry(q[0],q[1])),P=h.getFreeCameraOptions().position||new l.MercatorCoordinate(0,0,0),O=l.getTileVec3(s.tileTransform,P,b),F=S.map(q=>{const V=l.sub(q,q,O);return l.normalize(V,V),new l.Ray(O,V)}),G=Yi(s,1,h.zoom);if(l.polygonIntersectsBox(E,0,0,l.EXTENT,l.EXTENT))return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:F,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(H=l.getBounds(E),H.min.x=l.clamp(H.min.x,0,l.EXTENT),H.min.y=l.clamp(H.min.y,0,l.EXTENT),H.max.x=l.clamp(H.max.x,0,l.EXTENT),H.max.y=l.clamp(H.max.y,0,l.EXTENT),H),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:G};var H}_bufferedScreenMercator(s,h){const _=_t(s);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{const x=this.bufferedScreenGeometry(s).map(b=>h.pointCoordinate3D(b));return this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(s,h){const _=_t(s);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{const x=this.bufferedCameraGeometry(s).map(b=>h.pointCoordinate3D(b));return this._cameraRaycastCache[_]=x,x}}}function _t(p){return 100*p|0}function tt(p,s,h){const _=function(x,b){if(x)return h(x);if(b){const E=l.pick(l.extend(b,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(E.vectorLayers=b.vector_layers,E.vectorLayerIds=E.vectorLayers.map(S=>S.id)),E.tiles=s.canonicalizeTileset(E,p.url),h(null,E)}};return p.url?l.getJSON(s.transformRequest(s.normalizeSourceURL(p.url),l.ResourceType.Source),_):l.exported.frame(()=>_(null,p))}class bt{constructor(s,h,_){this.bounds=l.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),_=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),x=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),b=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),E=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=_&&s.x<b&&s.y>=x&&s.y<E}}class yi{constructor(s,h,_){this.context=s;const x=s.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ut{constructor(s,h,_,x){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.context=s;const b=s.gl;this.buffer=b.createBuffer(),s.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let _=0;_<this.attributes.length;_++){const x=h.attributes[this.attributes[_].name];x!==void 0&&s.enableVertexAttribArray(x)}}setVertexAttribPointers(s,h,_){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],E=h.attributes[b.name];E!==void 0&&s.vertexAttribPointer(E,b.components,s[xi[b.type]],!1,this.itemSize,b.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ct{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class se extends ct{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class me extends ct{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Ie extends ct{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Ue extends ct{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class De extends ct{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Ye extends ct{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class ut extends ct{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class je extends ct{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Je extends ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class qe extends ct{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Pt extends ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class wt extends ct{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ct extends ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Rt extends ct{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Yt extends ct{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class di extends ct{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class fi extends ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Mi extends ct{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Un extends ct{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class pr extends ct{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class $s extends ct{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class js extends ct{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Zo extends ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class kn extends ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Vn extends ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Xo extends ct{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Yo extends ct{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class vu extends ct{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class us extends ct{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class fo extends ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Jo extends ct{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Qo extends ct{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class Ra extends Qo{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Nl extends Qo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class La extends Nl{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Y{constructor(s,h,_,x){this.context=s,this.width=h,this.height=_;const b=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new Ra(s,b),x&&(this.depthAttachment=new Nl(s,b))}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&s.deleteRenderbuffer(_)}s.deleteFramebuffer(this.framebuffer)}}class N{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new se(this),this.clearDepth=new me(this),this.clearStencil=new Ie(this),this.colorMask=new Ue(this),this.depthMask=new De(this),this.stencilMask=new Ye(this),this.stencilFunc=new ut(this),this.stencilOp=new je(this),this.stencilTest=new Je(this),this.depthRange=new qe(this),this.depthTest=new Pt(this),this.depthFunc=new wt(this),this.blend=new Ct(this),this.blendFunc=new Rt(this),this.blendColor=new Yt(this),this.blendEquation=new di(this),this.cullFace=new fi(this),this.cullFaceSide=new Mi(this),this.frontFace=new Un(this),this.program=new pr(this),this.activeTexture=new $s(this),this.viewport=new js(this),this.bindFramebuffer=new Zo(this),this.bindRenderbuffer=new kn(this),this.bindTexture=new Vn(this),this.bindVertexBuffer=new Xo(this),this.bindElementBuffer=new Yo(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new vu(this),this.pixelStoreUnpack=new us(this),this.pixelStoreUnpackPremultiplyAlpha=new fo(this),this.pixelStoreUnpackFlipY=new Jo(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new yi(this,s,h)}createVertexBuffer(s,h,_){return new Ut(this,s,h,_)}createRenderbuffer(s,h,_){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,s,h,_),this.bindRenderbuffer.set(null),b}createFramebuffer(s,h,_){return new Y(this,s,h,_)}clear({color:s,depth:h,stencil:_}){const x=this.gl;let b=0;s&&(b|=x.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(b|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(b)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){R(s.blendFunction,l.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class U extends l.Evented{constructor(s,h,_,x){super(),this.id=s,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=tt(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new bt(h.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(h.tiles),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const _=l.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);s.request=l.getImage(this.map._requestManager.transformRequest(x,l.ResourceType.Tile),(b,E,S,k)=>(delete s.request,s.aborted?(s.state="unloaded",h(null)):b?(s.state="errored",h(b)):E?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:S,expires:k}),s.setTexture(E,this.map.painter),s.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(s,h,_){s.setTexture(h,_)}static unloadTileData(s,h){s.texture&&h.saveTileTexture(s.texture)}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}let K;function ne(p,s,h,_,x,b,E,S){const k=[p,h,x,s,_,b,1,1,1],P=[E,S,1],O=l.adjoint([],k),[F,G,H]=l.transformMat3(P,P,l.transpose(O,O));return l.multiply(k,[F,0,0,0,G,0,0,0,H],k)}class le extends l.Evented{constructor(s,h,_,x){super(),this.id=s,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=h}load(s){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(h,_)=>{if(this._loaded=!0,h)this.fire(new l.ErrorEvent(h));else if(_){const{HTMLImageElement:x}=l.window;this.image=_ instanceof x?l.exported.getImageData(_):_,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading()}})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(s){this.coordinates=s,this._boundsArray=void 0;const h=s.map(l.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,b=1/0,E=-1/0,S=-1/0;for(const F of _)x=Math.min(x,F.x),b=Math.min(b,F.y),E=Math.max(E,F.x),S=Math.max(S,F.y);const k=Math.max(E-x,S-b),P=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),O=Math.pow(2,P);return new l.CanonicalTileID(P,Math.floor((x+E)/2*O),Math.floor((b+S)/2*O))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(s){for(const k in this.tiles){const P=this.tiles[k];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const h=l.tileTransform(this.tileID,this.map.transform.projection),[_,x,b,E]=this.coordinates.map(k=>{const P=h.projection.project(k[0],k[1]);return l.getTilePoint(h,P)._round()});this.perspectiveTransform=function(k,P,O,F,G,H,q,V,ie,Z){const ee=ne(0,0,k,0,0,P,k,P),te=ne(O,F,G,H,q,V,ie,Z);return l.multiply(te,l.adjoint(ee,ee),te),[te[6]/te[8]*k/l.EXTENT,te[7]/te[8]*P/l.EXTENT]}(this.width,this.height,_.x,_.y,x.x,x.y,E.x,E.y,b.x,b.y);const S=this._boundsArray=new l.StructArrayLayout4i8;S.emplaceBack(_.x,_.y,0,0),S.emplaceBack(x.x,x.y,l.EXTENT,0),S.emplaceBack(E.x,E.y,0,l.EXTENT),S.emplaceBack(b.x,b.y,l.EXTENT,l.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=s.createVertexBuffer(S,l.boundsAttributes.members),this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this.texture?this.texture.update(this.image):(this.texture=new l.Texture(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._prepareData(s)}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ge={vector:class extends l.Evented{constructor(p,s,h,_){if(super(),this.id=p,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(s,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new l.DedupedRequest}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=tt(this._options,this.map._requestManager,(p,s)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):s&&(l.extend(this,s),s.bounds&&(this.tileBounds=new bt(s.bounds,this.minzoom,this.maxzoom)),l.postTurnstileEvent(s.tiles,this.map._requestManager._customAccessToken),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const s=this.map.style._getSourceCaches(this.id);for(const h of s)h.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(p,s){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,l.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired")p.state==="loading"?p.reloadCallback=s:p.request=p.actor.send("reloadTile",_,x.bind(this));else if(p.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",_,x.bind(this),void 0,!0);else{const b=l.loadVectorTile.call({deduped:this._deduped},_,(E,S)=>{E||!S?x.call(this,E):(_.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},p.actor&&p.actor.send("loadTile",_,x.bind(this),void 0,!0))},!0);p.request={cancel:b}}function x(b,E){return delete p.request,p.aborted?s(null):b&&b.status!==404?s(b):(E&&E.resourceTiming&&(p.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&p.setExpiryData(E),p.loadVectorData(E,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:U,"raster-dem":class extends U{constructor(p,s,h,_){super(p,s,h,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){const h=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,b){x&&(p.state="errored",s(x)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=l.getImage(this.map._requestManager.transformRequest(h,l.ResourceType.Tile),function(x,b,E,S){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(x)p.state="errored",s(x);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:E,expires:S});const k=l.window.ImageBitmap&&b instanceof l.window.ImageBitmap&&(K==null&&(K=l.window.OffscreenCanvas&&new l.window.OffscreenCanvas(1,1).getContext("2d")&&typeof l.window.createImageBitmap=="function"),K),P=1-(b.width-l.prevPowerOfTwo(b.width))/2;P<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const O=k?b:l.exported.getImageData(b,P),F={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:P};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",F,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const s=p.canonical,h=Math.pow(2,s.z),_=(s.x-1+h)%h,x=s.x===0?p.wrap-1:p.wrap,b=(s.x+1+h)%h,E=s.x+1===h?p.wrap+1:p.wrap,S={};return S[new l.OverscaledTileID(p.overscaledZ,x,s.z,_,s.y).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,E,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(S[new l.OverscaledTileID(p.overscaledZ,x,s.z,_,s.y-1).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,E,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<h&&(S[new l.OverscaledTileID(p.overscaledZ,x,s.z,_,s.y+1).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new l.OverscaledTileID(p.overscaledZ,E,s.z,b,s.y+1).key]={backfilled:!1}),S}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends l.Evented{constructor(p,s,h,_){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=s.data,this._options=l.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const x=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*x,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*x,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.EXTENT,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*x,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},s),this}getClusterLeaves(p,s,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:s,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new l.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=l.extend({},this.workerOptions),s=this._data;typeof s=="string"?(p.request=this.map._requestManager.transformRequest(l.exported.resolveURL(s),l.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new l.ErrorEvent(h));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new l.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,s){const h=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(h,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:l.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete p.request,p.unloadVectorData(),p.aborted?s(null):_?s(_):(p.loadVectorData(x,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends le{constructor(p,s,h,_){super(p,s,h,_),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,l.ResourceType.Source).url);l.getVideo(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new l.Texture(p,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:le,canvas:class extends le{constructor(p,s,h,_){super(p,s,h,_),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(b=>typeof b!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof l.window.HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof l.window.HTMLCanvasElement?this.options.canvas:l.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.Texture(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends l.Evented{constructor(p,s,h,_){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new l.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new l.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new bt(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.coveringTiles=this._coveringTiles.bind(this),l.extend(this,l.pick(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return l.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:s,y:h,z:_}=p.canonical;return this._implementation.hasTile({x:s,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){const{x:h,y:_,z:x}=p.tileID.canonical,b=new l.window.AbortController,E=this._implementation.loadTile({x:h,y:_,z:x},{signal:b.signal});if(!E)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null);E.cancel=()=>b.abort(),p.request=E.then(function(S){return delete p.request,p.aborted?(p.state="unloaded",s(null)):S?function(k){return k instanceof l.window.ImageData||k instanceof l.window.ImageBitmap||k instanceof l.window.HTMLCanvasElement}(S)?(this.loadTileData(p,S),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null))}.bind(this)).catch(S=>{S.code!==20&&(p.state="errored",s(S))})}loadTileData(p,s){U.loadTileData(p,s,this._map.painter)}unloadTileData(p){U.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:s,y:h,z:_}=p.tileID.canonical,x=this._implementation.prepareTile({x:s,y:h,z:_});return x?(this.loadTileData(p,x),p.state="loaded",x):null}unloadTile(p,s){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:h,y:_,z:x}=p.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:x})}s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"}))}}},_e=function(p,s,h,_){const x=new ge[s.type](p,s,h,_);if(x.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${x.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],x),x};function ue(p,s){const h=l.identity([]);return l.scale(h,h,[.5*p.width,.5*-p.height,1]),l.translate(h,h,[1,-1,0]),l.multiply$1(h,h,p.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(h)}function xe(p,s,h,_,x,b,E,S=!1){const k=p.tilesIn(_,E,S);k.sort(it);const P=[];for(const F of k)P.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(s,h,p._state,F,x,b,ue(p.transform,F.tile.tileID),S)});const O=function(F){const G={},H={};for(const q of F){const V=q.queryResults,ie=q.wrappedTileID,Z=H[ie]=H[ie]||{};for(const ee in V){const te=V[ee],re=Z[ee]=Z[ee]||{},Q=G[ee]=G[ee]||[];for(const ae of te)re[ae.featureIndex]||(re[ae.featureIndex]=!0,Q.push(ae))}}return G}(P);for(const F in O)O[F].forEach(G=>{const H=G.feature,q=H.layer;q&&q.type!=="background"&&q.type!=="sky"&&(H.source=q.source,q["source-layer"]&&(H.sourceLayer=q["source-layer"]),H.state=H.id!==void 0?p.getFeatureState(q["source-layer"],H.id):{})});return O}function Oe(p,s){const h=p.getRenderableIds().map(b=>p.getTileByID(b)),_=[],x={};for(let b=0;b<h.length;b++){const E=h[b],S=E.tileID.canonical.key;x[S]||(x[S]=!0,E.querySourceFeatures(_,s))}return _}function it(p,s){const h=p.tileID,_=s.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function Fe(){return Za.workerClass!=null?new Za.workerClass:new l.window.Worker(Za.workerUrl)}const kt="mapboxgl_preloaded_worker_pool";class Tt{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Tt.workerCount;)this.workers.push(new Fe);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kt]}numActive(){return Object.keys(this.active).length}}let It;function Lt(){return It||(It=new Tt),It}function be(p,s){const h={};for(const _ in p)_!=="ref"&&(h[_]=p[_]);return l.refProperties.forEach(_=>{_ in s&&(h[_]=s[_])}),h}function Ei(p){p=p.slice();const s=Object.create(null);for(let h=0;h<p.length;h++)s[p[h].id]=p[h];for(let h=0;h<p.length;h++)"ref"in p[h]&&(p[h]=be(p[h],s[p[h].ref]));return p}Tt.workerCount=2;const gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function bi(p,s,h){h.push({command:gt.addSource,args:[p,s[p]]})}function Ti(p,s,h){s.push({command:gt.removeSource,args:[p]}),h[p]=!0}function ea(p,s,h,_){Ti(p,h,_),bi(p,s,h)}function Gs(p,s,h){let _;for(_ in p[h])if(p[h].hasOwnProperty(_)&&_!=="data"&&!R(p[h][_],s[h][_]))return!1;for(_ in s[h])if(s[h].hasOwnProperty(_)&&_!=="data"&&!R(p[h][_],s[h][_]))return!1;return!0}function Qe(p,s,h,_,x,b){let E;for(E in s=s||{},p=p||{})p.hasOwnProperty(E)&&(R(p[E],s[E])||h.push({command:b,args:[_,E,s[E],x]}));for(E in s)s.hasOwnProperty(E)&&!p.hasOwnProperty(E)&&(R(p[E],s[E])||h.push({command:b,args:[_,E,s[E],x]}))}function li(p){return p.id}function ei(p,s){return p[s.id]=s,p}class Cs{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.clamp(s,0,1);let h=1,_=this._distances[h];const x=s*this.paddedLength+this.padding;for(;_<x&&h<this._distances.length;)_=this._distances[++h];const b=h-1,E=this._distances[b],S=_-E,k=S>0?(x-E)/S:0;return this.points[b].mult(1-k).add(this.points[h].mult(k))}}class ta{constructor(s,h,_){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(s/_),this.yCellCount=Math.ceil(h/_);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,_,x,b){this._forEachCell(h,_,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(s,h,_,x){this._forEachCell(h-x,_-x,h+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(_),this.circles.push(x)}_insertBoxCell(s,h,_,x,b,E){this.boxCells[b].push(E)}_insertCircleCell(s,h,_,x,b,E){this.circleCells[b].push(E)}_query(s,h,_,x,b,E){if(_<0||s>this.width||x<0||h>this.height)return!b&&[];const S=[];if(s<=0&&h<=0&&this.width<=_&&this.height<=x){if(b)return!0;for(let k=0;k<this.boxKeys.length;k++)S.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const P=this.circles[3*k],O=this.circles[3*k+1],F=this.circles[3*k+2];S.push({key:this.circleKeys[k],x1:P-F,y1:O-F,x2:P+F,y2:O+F})}return E?S.filter(E):S}return this._forEachCell(s,h,_,x,this._queryCell,S,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?S.length>0:S}_queryCircle(s,h,_,x,b){const E=s-_,S=s+_,k=h-_,P=h+_;if(S<0||E>this.width||P<0||k>this.height)return!x&&[];const O=[];return this._forEachCell(E,k,S,P,this._queryCellCircle,O,{hitTest:x,circle:{x:s,y:h,radius:_},seenUids:{box:{},circle:{}}},b),x?O.length>0:O}query(s,h,_,x,b){return this._query(s,h,_,x,!1,b)}hitTest(s,h,_,x,b){return this._query(s,h,_,x,!0,b)}hitTestCircle(s,h,_,x){return this._queryCircle(s,h,_,!0,x)}_queryCell(s,h,_,x,b,E,S,k){const P=S.seenUids,O=this.boxCells[b];if(O!==null){const G=this.bboxes;for(const H of O)if(!P.box[H]){P.box[H]=!0;const q=4*H;if(s<=G[q+2]&&h<=G[q+3]&&_>=G[q+0]&&x>=G[q+1]&&(!k||k(this.boxKeys[H]))){if(S.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[H],x1:G[q],y1:G[q+1],x2:G[q+2],y2:G[q+3]})}}}const F=this.circleCells[b];if(F!==null){const G=this.circles;for(const H of F)if(!P.circle[H]){P.circle[H]=!0;const q=3*H;if(this._circleAndRectCollide(G[q],G[q+1],G[q+2],s,h,_,x)&&(!k||k(this.circleKeys[H]))){if(S.hitTest)return E.push(!0),!0;{const V=G[q],ie=G[q+1],Z=G[q+2];E.push({key:this.circleKeys[H],x1:V-Z,y1:ie-Z,x2:V+Z,y2:ie+Z})}}}}}_queryCellCircle(s,h,_,x,b,E,S,k){const P=S.circle,O=S.seenUids,F=this.boxCells[b];if(F!==null){const H=this.bboxes;for(const q of F)if(!O.box[q]){O.box[q]=!0;const V=4*q;if(this._circleAndRectCollide(P.x,P.y,P.radius,H[V+0],H[V+1],H[V+2],H[V+3])&&(!k||k(this.boxKeys[q])))return E.push(!0),!0}}const G=this.circleCells[b];if(G!==null){const H=this.circles;for(const q of G)if(!O.circle[q]){O.circle[q]=!0;const V=3*q;if(this._circlesCollide(H[V],H[V+1],H[V+2],P.x,P.y,P.radius)&&(!k||k(this.circleKeys[q])))return E.push(!0),!0}}}_forEachCell(s,h,_,x,b,E,S,k){const P=this._convertToXCellCoord(s),O=this._convertToYCellCoord(h),F=this._convertToXCellCoord(_),G=this._convertToYCellCoord(x);for(let H=P;H<=F;H++)for(let q=O;q<=G;q++)if(b.call(this,s,h,_,x,this.xCellCount*q+H,E,S,k))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,_,x,b,E){const S=x-s,k=b-h,P=_+E;return P*P>S*S+k*k}_circleAndRectCollide(s,h,_,x,b,E,S){const k=(E-x)/2,P=Math.abs(s-(x+k));if(P>k+_)return!1;const O=(S-b)/2,F=Math.abs(h-(b+O));if(F>O+_)return!1;if(P<=k||F<=O)return!0;const G=P-k,H=F-O;return G*G+H*H<=_*_}}const ri=Math.tan(85*Math.PI/180);function ia(p,s,h,_,x,b){const E=l.create();if(h){if(x.projection.name==="globe")l.multiply$1(E,E,l.calculateGlobeLabelMatrix(x,s));else{const S=_i([],b);E[0]=S[0],E[1]=S[1],E[4]=S[2],E[5]=S[3]}_||l.rotateZ(E,E,x.angle)}else l.multiply$1(E,x.labelPlaneMatrix,p);return E}function Oa(p,s,h,_,x,b){if(h){if(x.projection.name==="globe"){const E=ia(p,s,h,_,x,b);return l.invert(E,E),l.multiply$1(E,p,E),E}{const E=l.clone(p),S=l.identity([]);return S[0]=b[0],S[1]=b[1],S[4]=b[2],S[5]=b[3],l.multiply$1(E,E,S),_||l.rotateZ(E,E,-x.angle),E}}return x.glCoordMatrix}function ir(p,s,h=0){const _=[p.x,p.y,h,1];h?l.transformMat4$1(_,_,s):Cr(_,_,s);const x=_[3];return{point:new l.pointGeometry(_[0]/x,_[1]/x),signedDistanceFromCamera:x}}function qr(p,s){const h=[p[0],p[1],p[2],1];l.transformMat4$1(h,h,s);const _=h[3];return{point:new l.pointGeometry(h[0]/_,h[1]/_),signedDistanceFromCamera:_}}function tn(p,s){return Math.min(.5+p/s*.5,1.5)}function Hv(p,s){const h=p[0]/p[3],_=p[1]/p[3];return h>=-s[0]&&h<=s[0]&&_>=-s[1]&&_<=s[1]}function Fl(p,s,h,_,x,b,E,S,k,P){const O=h.transform,F=_?p.textSizeData:p.iconSizeData,G=l.evaluateSizeForZoom(F,h.transform.zoom),H=[256/h.width*2+1,256/h.height*2+1],q=_?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;q.clear();const V=p.lineVertexArray,ie=_?p.text.placedSymbolArray:p.icon.placedSymbolArray,Z=h.transform.width/h.transform.height;let ee=!1;for(let te=0;te<ie.length;te++){const re=ie.get(te);if(re.writingMode!==l.WritingMode.vertical||ee||te!==0&&ie.get(te-1).writingMode===l.WritingMode.horizontal||(ee=!0),(re.hidden||re.writingMode===l.WritingMode.vertical)&&!ee){Tn(re.numGlyphs,q);continue}ee=!1;const Q=new l.pointGeometry(re.tileAnchorX,re.tileAnchorY),ae=k?k(Q):[0,0,0],ye=O.projection.projectTilePoint(Q.x,Q.y,P.canonical),Te=[ye.x+ae[0],ye.y+ae[1],ye.z+ae[2]],Me=[...Te,1];if(l.transformMat4$1(Me,Me,s),!Hv(Me,H)){Tn(re.numGlyphs,q);continue}const Ae=tn(h.transform.cameraToCenterDistance,Me[3]),We=l.evaluateSizeForFeature(F,G,re),ve=E?We/Ae:We*Ae,He=ir(new l.pointGeometry(Te[0],Te[1]),x,Te[2]);if(He.signedDistanceFromCamera<=0){Tn(re.numGlyphs,q);continue}let $e={};const mt=E?null:k,ke=bu(re,ve,!1,S,s,x,b,p.glyphOffsetArray,V,q,He.point,Q,$e,Z,mt,O.projection,P);ee=ke.useVertical,mt&&ke.needsFlipping&&($e={}),(ke.notEnoughRoom||ee||ke.needsFlipping&&bu(re,ve,!0,S,s,x,b,p.glyphOffsetArray,V,q,He.point,Q,$e,Z,mt,O.projection,P).notEnoughRoom)&&Tn(re.numGlyphs,q)}_?p.text.dynamicLayoutVertexBuffer.updateData(q):p.icon.dynamicLayoutVertexBuffer.updateData(q)}function xu(p,s,h,_,x,b,E,S,k,P,O,F,G,H,q){const V=S.glyphStartIndex+S.numGlyphs,ie=S.lineStartIndex,Z=S.lineStartIndex+S.lineLength,ee=s.getoffsetX(S.glyphStartIndex),te=s.getoffsetX(V-1),re=Na(p*ee,h,_,x,b,E,S.segment,ie,Z,k,P,O,F,G,!0,H,q);if(!re)return null;const Q=Na(p*te,h,_,x,b,E,S.segment,ie,Z,k,P,O,F,G,!0,H,q);return Q?{first:re,last:Q}:null}function za(p,s,h,_){return p.writingMode===l.WritingMode.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*_?{useVertical:!0}:p.writingMode===l.WritingMode.vertical?s.y<h.y?{needsFlipping:!0}:null:p.flipState!==0&&function(x,b,E){const S=(b.x-x.x)*E;return S===0||Math.abs((b.y-x.y)/S)>ri}(s,h,_)?p.flipState===1?{needsFlipping:!0}:null:s.x>h.x?{needsFlipping:!0}:null}function bu(p,s,h,_,x,b,E,S,k,P,O,F,G,H,q,V,ie){const Z=s/24,ee=p.lineOffsetX*Z,te=p.lineOffsetY*Z;let re;if(p.numGlyphs>1){const Q=p.glyphStartIndex+p.numGlyphs,ae=p.lineStartIndex,ye=p.lineStartIndex+p.lineLength,Te=xu(Z,S,ee,te,h,O,F,p,k,b,G,q,!1,V,ie);if(!Te)return{notEnoughRoom:!0};const Me=ir(Te.first.point,E).point,Ae=ir(Te.last.point,E).point;if(_&&!h){const We=za(p,Me,Ae,H);if(p.flipState=We&&We.needsFlipping?1:2,We)return We}re=[Te.first];for(let We=p.glyphStartIndex+1;We<Q-1;We++)re.push(Na(Z*S.getoffsetX(We),ee,te,h,O,F,p.segment,ae,ye,k,b,G,q,!1,!1,V,ie));re.push(Te.last)}else{if(_&&!h){const ae=ir(F,x).point,ye=p.lineStartIndex+p.segment+1,Te=new l.pointGeometry(k.getx(ye),k.gety(ye)),Me=ir(Te,x),Ae=za(p,ae,Me.signedDistanceFromCamera>0?Me.point:wi(F,Te,ae,1,x,void 0,V,ie.canonical),H);if(p.flipState=Ae&&Ae.needsFlipping?1:2,Ae)return Ae}const Q=Na(Z*S.getoffsetX(p.glyphStartIndex),ee,te,h,O,F,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,k,b,G,q,!1,!1,V,ie);if(!Q)return{notEnoughRoom:!0};re=[Q]}for(const Q of re)l.addDynamicAttributes(P,Q.point,Q.angle);return{}}function Ld(p,s,h,_,x){const b=_.projectTilePoint(p.x,p.y,s);if(!x)return ir(b,h,b.z);const E=x(p);return ir(new l.pointGeometry(b.x+E[0],b.y+E[1]),h,b.z+E[2])}function wi(p,s,h,_,x,b,E,S){const k=Ld(p.add(p.sub(s)._unit()),S,x,E,b).point,P=h.sub(k);return h.add(P._mult(_/P.mag()))}function Na(p,s,h,_,x,b,E,S,k,P,O,F,G,H,q,V,ie){const Z=_?p-s:p+s;let ee=Z>0?1:-1,te=0;_&&(ee*=-1,te=Math.PI),ee<0&&(te+=Math.PI);let re=ee>0?S+E:S+E+1,Q=x,ae=x,ye=0,Te=0;const Me=Math.abs(Z),Ae=[],We=[];let ve=b;const He=()=>{const dt=re-ee;return ye===0?b:new l.pointGeometry(P.getx(dt),P.gety(dt))},$e=()=>wi(He(),ve,ae,Me-ye+1,O,G,V,ie.canonical);for(;ye+Te<=Me;){if(re+=ee,re<S||re>=k)return null;if(ae=Q,Ae.push(Q),H&&We.push(ve||He()),Q=F[re],Q===void 0){ve=new l.pointGeometry(P.getx(re),P.gety(re));const dt=Ld(ve,ie.canonical,O,V,G);Q=dt.signedDistanceFromCamera>0?F[re]=dt.point:$e()}else ve=null;ye+=Te,Te=ae.dist(Q)}q&&G&&(ve=ve||new l.pointGeometry(P.getx(re),P.gety(re)),F[re]=Q=F[re]===void 0?Q:$e(),Te=ae.dist(Q));const mt=(Me-ye)/Te,ke=Q.sub(ae),ht=ke.mult(mt)._add(ae);h&&ht._add(ke._unit()._perp()._mult(h*ee));const St=te+Math.atan2(Q.y-ae.y,Q.x-ae.x);return Ae.push(ht),H&&(ve=ve||new l.pointGeometry(P.getx(re),P.gety(re)),We.push(function(dt,ft,Dt){const Gt=1-Dt;return new l.pointGeometry(dt.x*Gt+ft.x*Dt,dt.y*Gt+ft.y*Dt)}(We.length>0?We[We.length-1]:ve,ve,mt))),{point:ht,angle:St,path:Ae,tilePath:We}}const Od=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Tn(p,s){for(let h=0;h<p;h++){const _=s.length;s.resize(_+4),s.float32.set(Od,3*_)}}function Cr(p,s,h){const _=s[0],x=s[1];return p[0]=h[0]*_+h[4]*x+h[12],p[1]=h[1]*_+h[5]*x+h[13],p[3]=h[3]*_+h[7]*x+h[15],p}const hs=100;class wu{constructor(s,h,_=new ta(s.width+200,s.height+200,25),x=new ta(s.width+200,s.height+200,25)){this.transform=s,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+hs,this.screenBottomBoundary=s.height+hs,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,_,x,b,E,S){let k=h.projectedAnchorX,P=h.projectedAnchorY,O=h.projectedAnchorZ;const F=h.elevation,G=h.tileID;if(F&&G){const re=this.transform.projection.upVector(G.canonical,h.tileAnchorX,h.tileAnchorY),Q=this.transform.projection.upVectorScale(G.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=re[0]*F*Q,P+=re[1]*F*Q,O+=re[2]*F*Q}const H=this.projectAndGetPerspectiveRatio(E,[k,P,O],h.tileID,this.transform.projection.name==="globe"||!!F||this.transform.pitch>0),q=b*H.perspectiveRatio,V=(h.x1*s+_.x-h.padding)*q+H.point.x,ie=(h.y1*s+_.y-h.padding)*q+H.point.y,Z=(h.x2*s+_.x+h.padding)*q+H.point.x,ee=(h.y2*s+_.y+h.padding)*q+H.point.y,te=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(V,ie,Z,ee)||!x&&this.grid.hitTest(V,ie,Z,ee,S)||te?{box:[],offscreen:!1,occluded:H.occluded}:{box:[V,ie,Z,ee],offscreen:this.isOffscreen(V,ie,Z,ee),occluded:!1}}placeCollisionCircles(s,h,_,x,b,E,S,k,P,O,F,G,H,q){const V=[],ie=this.transform.elevation,Z=ie?ie.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,this.transform.projection):$e=>[0,0,0],ee=new l.pointGeometry(h.tileAnchorX,h.tileAnchorY),te=this.transform.projection.projectTilePoint(h.tileAnchorX,h.tileAnchorY,q.canonical),re=Z(ee),Q=[te.x+re[0],te.y+re[1],te.z+re[2]],ae=this.projectAndGetPerspectiveRatio(E,[Q[0],Q[1],Q[2]],q,this.transform.projection.name==="globe"||!!ie||this.transform.pitch>0),{perspectiveRatio:ye}=ae,Te=(O?b/ye:b*ye)/l.ONE_EM,Me=ir(new l.pointGeometry(Q[0],Q[1]),S,Q[2]).point,Ae=ae.signedDistanceFromCamera>0?xu(Te,x,h.lineOffsetX*Te,h.lineOffsetY*Te,!1,Me,ee,h,_,S,{},ie&&!O?Z:null,O&&!!ie,this.transform.projection,q):null;let We=!1,ve=!1,He=!0;if(Ae&&!ae.occluded){const $e=.5*G*ye+H,mt=new l.pointGeometry(-100,-100),ke=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),ht=new Cs,St=Ae.first,dt=Ae.last;let ft=[];for(let Et=St.path.length-1;Et>=1;Et--)ft.push(St.path[Et]);for(let Et=1;Et<dt.path.length;Et++)ft.push(dt.path[Et]);const Dt=2.5*$e;if(k){const Et=ft.map(ie?(Ot,pi)=>{const nn=Z(pi<St.path.length-1?St.tilePath[St.path.length-1-pi]:dt.tilePath[pi-St.path.length+2]);return ir(Ot,k,nn[2])}:Ot=>ir(Ot,k));ft=Et.some(Ot=>Ot.signedDistanceFromCamera<=0)?[]:Et.map(Ot=>Ot.point)}let Gt=[];if(ft.length>0){const Et=ft[0].clone(),Ot=ft[0].clone();for(let pi=1;pi<ft.length;pi++)Et.x=Math.min(Et.x,ft[pi].x),Et.y=Math.min(Et.y,ft[pi].y),Ot.x=Math.max(Ot.x,ft[pi].x),Ot.y=Math.max(Ot.y,ft[pi].y);Gt=Et.x>=mt.x&&Ot.x<=ke.x&&Et.y>=mt.y&&Ot.y<=ke.y?[ft]:Ot.x<mt.x||Et.x>ke.x||Ot.y<mt.y||Et.y>ke.y?[]:l.clipLine([ft],mt.x,mt.y,ke.x,ke.y)}for(const Et of Gt){ht.reset(Et,.25*$e);let Ot=0;Ot=ht.length<=.5*$e?1:Math.ceil(ht.paddedLength/Dt)+1;for(let pi=0;pi<Ot;pi++){const nn=pi/Math.max(Ot-1,1),Gn=ht.lerp(nn),qn=Gn.x+hs,Rr=Gn.y+hs;V.push(qn,Rr,$e,0);const ps=qn-$e,Xs=Rr-$e,Eo=qn+$e,Ys=Rr+$e;if(He=He&&this.isOffscreen(ps,Xs,Eo,Ys),ve=ve||this.isInsideGrid(ps,Xs,Eo,Ys),!s&&this.grid.hitTestCircle(qn,Rr,$e,F)&&(We=!0,!P))return{circles:[],offscreen:!1,collisionDetected:We,occluded:!1}}}}return{circles:!P&&We||!ve?[]:V,offscreen:He,collisionDetected:We,occluded:ae.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let _=1/0,x=1/0,b=-1/0,E=-1/0;for(const O of s){const F=new l.pointGeometry(O.x+hs,O.y+hs);_=Math.min(_,F.x),x=Math.min(x,F.y),b=Math.max(b,F.x),E=Math.max(E,F.y),h.push(F)}const S=this.grid.query(_,x,b,E).concat(this.ignoredGrid.query(_,x,b,E)),k={},P={};for(const O of S){const F=O.key;if(k[F.bucketInstanceId]===void 0&&(k[F.bucketInstanceId]={}),k[F.bucketInstanceId][F.featureIndex])continue;const G=[new l.pointGeometry(O.x1,O.y1),new l.pointGeometry(O.x2,O.y1),new l.pointGeometry(O.x2,O.y2),new l.pointGeometry(O.x1,O.y2)];l.polygonIntersectsPolygon(h,G)&&(k[F.bucketInstanceId][F.featureIndex]=!0,P[F.bucketInstanceId]===void 0&&(P[F.bucketInstanceId]=[]),P[F.bucketInstanceId].push(F.featureIndex))}return P}insertCollisionBox(s,h,_,x,b){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:b},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,_,x,b){const E=h?this.ignoredGrid:this.grid,S={bucketInstanceId:_,featureIndex:x,collisionGroupID:b};for(let k=0;k<s.length;k+=4)E.insertCircle(S,s[k],s[k+1],s[k+2])}projectAndGetPerspectiveRatio(s,h,_,x){const b=[h[0],h[1],h[2],1];let E=!1;return h[2]||this.transform.pitch>0?(l.transformMat4$1(b,b,s),this.fogState&&_&&(E=function(S,k,P,O,F,G){const H=G.calculateFogTileMatrix(F),q=[k,P,O];return l.transformMat4(q,q,H),Qt(S,q,G.pitch,G._fov)}(this.fogState,h[0],h[1],h[2],_.toUnwrapped(),this.transform)>.9)):Cr(b,b,s),{point:new l.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+hs,(-b[1]/b[3]+1)/2*this.transform.height+hs),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/b[3]*.5,1.5),signedDistanceFromCamera:b[3],occluded:x&&b[2]>b[3]||E}}isOffscreen(s,h,_,x){return _<hs||s>=this.screenRightBoundary||x<hs||h>this.screenBottomBoundary}isInsideGrid(s,h,_,x){return _>=0&&s<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=l.identity([]);return l.translate(s,s,[-100,-100,0]),s}}class xn{constructor(s,h,_,x){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class qs{constructor(s,h,_,x,b,E=!1){this.text=new xn(s?s.text:null,h,_,b),this.icon=new xn(s?s.icon:null,h,x,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ws{constructor(s,h,_,x=!1){this.text=s,this.icon=h,this.skipFade=_,this.clipped=x}}class $n{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class zd{constructor(s,h,_,x,b){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=b}}class ds{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[s]}}function Fa(p,s,h,_,x){const{horizontalAlign:b,verticalAlign:E}=l.getAnchorAlignment(p),S=-(b-.5)*s,k=-(E-.5)*h,P=l.evaluateVariableOffset(p,_);return new l.pointGeometry(S+P[0]*x,k+P[1]*x)}function Ba(p,s,h,_,x){const b=new l.pointGeometry(p,s);return h&&b._rotate(_?x:-x),b}class Kv{constructor(s,h,_,x,b){this.transform=s.clone(),this.collisionIndex=new wu(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ds(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,_,x){const b=_.getBucket(h),E=_.latestFeatureIndex;if(!b||!E||h.id!==b.layerIds[0])return;const S=b.layers[0].layout,k=_.collisionBoxArray,P=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),O=_.tileSize/l.EXTENT,F=_.tileID.toUnwrapped(),G=this.transform.calculateProjMatrix(F),H=S.get("text-pitch-alignment")==="map",q=S.get("text-rotation-alignment")==="map";h.compileFilter();const V=h.dynamicFilter(),ie=h.dynamicFilterNeedsFeature(),Z=this.transform.calculatePixelsToTileUnitsMatrix(_),ee=ia(G,_.tileID.canonical,H,q,this.transform,Z);let te=null;if(H){const ae=Oa(G,_.tileID.canonical,H,q,this.transform,Z);te=l.multiply$1([],this.transform.labelPlaneMatrix,ae)}let re=null;V&&_.latestFeatureIndex&&(re={unwrappedTileID:F,dynamicFilter:V,dynamicFilterNeedsFeature:ie,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new zd(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,_.tileID);const Q={bucket:b,layout:S,posMatrix:G,textLabelPlaneMatrix:ee,labelToScreenMatrix:te,clippingData:re,scale:P,textPixelRatio:O,holdingForFade:_.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:l.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(x)for(const ae of b.sortKeyRanges){const{sortKey:ye,symbolInstanceStart:Te,symbolInstanceEnd:Me}=ae;s.push({sortKey:ye,symbolInstanceStart:Te,symbolInstanceEnd:Me,parameters:Q})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(s,h,_,x,b,E,S,k,P,O,F,G,H,q,V,ie,Z,ee){const te=[G.textOffset0,G.textOffset1],re=Fa(s,_,x,te,b),Q=this.collisionIndex.placeCollisionBox(b,h,Ba(re.x,re.y,E,S,this.transform.angle),F,k,P,O.predicate);if((!ie||this.collisionIndex.placeCollisionBox(q.getSymbolInstanceIconSize(ee,this.transform.zoom,H),ie,Ba(re.x,re.y,E,S,this.transform.angle),F,k,P,O.predicate).box.length!==0)&&Q.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[G.crossTileID].anchor),this.variableOffsets[G.crossTileID]={textOffset:te,width:_,height:x,anchor:s,textScale:b,prevAnchor:ae},this.markUsedJustification(q,s,G,V),q.allowVerticalPlacement&&(this.markUsedOrientation(q,V,G),this.placedOrientations[G.crossTileID]=V),{shift:re,placedGlyphBoxes:Q}}}placeLayerBucketPart(s,h,_,x){const{bucket:b,layout:E,posMatrix:S,textLabelPlaneMatrix:k,labelToScreenMatrix:P,clippingData:O,textPixelRatio:F,holdingForFade:G,collisionBoxArray:H,partiallyEvaluatedTextSize:q,partiallyEvaluatedIconSize:V,collisionGroup:ie}=s.parameters,Z=E.get("text-optional"),ee=E.get("icon-optional"),te=E.get("text-allow-overlap"),re=E.get("icon-allow-overlap"),Q=E.get("text-rotation-alignment")==="map",ae=E.get("text-pitch-alignment")==="map",ye=E.get("icon-text-fit")!=="none",Te=E.get("symbol-z-order")==="viewport-y";let Me=te&&(re||!b.hasIconData()||ee),Ae=re&&(te||!b.hasTextData()||Z);!b.collisionArrays&&H&&b.deserializeCollisionBoxes(H),_&&x&&b.updateCollisionDebugBuffers(this.transform.zoom,H);const We=(ve,He,$e)=>{if(O){const an={zoom:this.transform.zoom,pitch:this.transform.pitch};let un=null;if(O.dynamicFilterNeedsFeature){const Ii=this.retainedQueryData[b.bucketInstanceId];un=O.featureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:Ii.bucketIndex,sourceLayerIndex:Ii.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(an,un,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new l.pointGeometry(ve.tileAnchorX,ve.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[ve.crossTileID]=new Ws(!1,!1,!1,!0),void(h[ve.crossTileID]=!0)}if(h[ve.crossTileID])return;if(G)return void(this.placements[ve.crossTileID]=new Ws(!1,!1,!1));let mt=!1,ke=!1,ht=!0,St=!1,dt=!1,ft=null,Dt={box:null,offscreen:null,occluded:null},Gt={box:null,offscreen:null,occluded:null},Et=null,Ot=null,pi=null,nn=0,Gn=0,qn=0;$e.textFeatureIndex?nn=$e.textFeatureIndex:ve.useRuntimeCollisionCircles&&(nn=ve.featureIndex),$e.verticalTextFeatureIndex&&(Gn=$e.verticalTextFeatureIndex);const Rr=an=>{an.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||an.elevation)&&(an.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,an.tileAnchorX,an.tileAnchorY):0)},ps=$e.textBox;if(ps){Rr(ps);const an=Ii=>{let bn=l.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Ii&&this.prevPlacement){const Lr=this.prevPlacement.placedOrientations[ve.crossTileID];Lr&&(this.placedOrientations[ve.crossTileID]=Lr,bn=Lr,this.markUsedOrientation(b,bn,ve))}return bn},un=(Ii,bn)=>{if(b.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&$e.verticalTextBox){for(const Lr of b.writingModes)if(Lr===l.WritingMode.vertical?(Dt=bn(),Gt=Dt):Dt=Ii(),Dt&&Dt.box&&Dt.box.length)break}else Dt=Ii()};if(E.get("text-variable-anchor")){let Ii=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ve.crossTileID]){const rn=this.prevPlacement.variableOffsets[ve.crossTileID];Ii.indexOf(rn.anchor)>0&&(Ii=Ii.filter(Kr=>Kr!==rn.anchor),Ii.unshift(rn.anchor))}const bn=(rn,Kr,uc)=>{const Or=b.getSymbolInstanceTextSize(q,ve,this.transform.zoom,He),ca=(rn.x2-rn.x1)*Or+2*rn.padding,R_=(rn.y2-rn.y1)*Or+2*rn.padding,xf=ye&&!re?Kr:null;xf&&Rr(xf);let Xa={box:[],offscreen:!1,occluded:!1};const hx=te?2*Ii.length:Ii.length;for(let To=0;To<hx;++To){const bf=this.attemptAnchorPlacement(Ii[To%Ii.length],rn,ca,R_,Or,Q,ae,F,S,ie,To>=Ii.length,ve,He,b,uc,xf,q,V);if(bf&&(Xa=bf.placedGlyphBoxes,Xa&&Xa.box&&Xa.box.length)){mt=!0,ft=bf.shift;break}}return Xa};un(()=>bn(ps,$e.iconBox,l.WritingMode.horizontal),()=>{const rn=$e.verticalTextBox;return rn&&Rr(rn),b.allowVerticalPlacement&&!(Dt&&Dt.box&&Dt.box.length)&&ve.numVerticalGlyphVertices>0&&rn?bn(rn,$e.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Dt&&(mt=Dt.box,ht=Dt.offscreen,St=Dt.occluded);const Lr=an(Dt&&Dt.box);if(!mt&&this.prevPlacement){const rn=this.prevPlacement.variableOffsets[ve.crossTileID];rn&&(this.variableOffsets[ve.crossTileID]=rn,this.markUsedJustification(b,rn.anchor,ve,Lr))}}else{const Ii=(bn,Lr)=>{const rn=b.getSymbolInstanceTextSize(q,ve,this.transform.zoom,He),Kr=this.collisionIndex.placeCollisionBox(rn,bn,new l.pointGeometry(0,0),te,F,S,ie.predicate);return Kr&&Kr.box&&Kr.box.length&&(this.markUsedOrientation(b,Lr,ve),this.placedOrientations[ve.crossTileID]=Lr),Kr};un(()=>Ii(ps,l.WritingMode.horizontal),()=>{const bn=$e.verticalTextBox;return b.allowVerticalPlacement&&ve.numVerticalGlyphVertices>0&&bn?(Rr(bn),Ii(bn,l.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),an(Dt&&Dt.box&&Dt.box.length)}}if(Et=Dt,mt=Et&&Et.box&&Et.box.length>0,ht=Et&&Et.offscreen,St=Et&&Et.occluded,ve.useRuntimeCollisionCircles){const an=b.text.placedSymbolArray.get(ve.centerJustifiedTextSymbolIndex>=0?ve.centerJustifiedTextSymbolIndex:ve.verticalPlacedTextSymbolIndex),un=l.evaluateSizeForFeature(b.textSizeData,q,an),Ii=E.get("text-padding");Ot=this.collisionIndex.placeCollisionCircles(te,an,b.lineVertexArray,b.glyphOffsetArray,un,S,k,P,_,ae,ie.predicate,ve.collisionCircleDiameter*un/l.ONE_EM,Ii,this.retainedQueryData[b.bucketInstanceId].tileID),mt=te||Ot.circles.length>0&&!Ot.collisionDetected,ht=ht&&Ot.offscreen,St=Ot.occluded}if($e.iconFeatureIndex&&(qn=$e.iconFeatureIndex),$e.iconBox){const an=un=>{Rr(un);const Ii=ye&&ft?Ba(ft.x,ft.y,Q,ae,this.transform.angle):new l.pointGeometry(0,0),bn=b.getSymbolInstanceIconSize(V,this.transform.zoom,He);return this.collisionIndex.placeCollisionBox(bn,un,Ii,re,F,S,ie.predicate)};Gt&&Gt.box&&Gt.box.length&&$e.verticalIconBox?(pi=an($e.verticalIconBox),ke=pi.box.length>0):(pi=an($e.iconBox),ke=pi.box.length>0),ht=ht&&pi.offscreen,dt=pi.occluded}const Xs=Z||ve.numHorizontalGlyphVertices===0&&ve.numVerticalGlyphVertices===0,Eo=ee||ve.numIconVertices===0;if(Xs||Eo?Eo?Xs||(ke=ke&&mt):mt=ke&&mt:ke=mt=ke&&mt,mt&&Et&&Et.box&&this.collisionIndex.insertCollisionBox(Et.box,E.get("text-ignore-placement"),b.bucketInstanceId,Gt&&Gt.box&&Gn?Gn:nn,ie.ID),ke&&pi&&this.collisionIndex.insertCollisionBox(pi.box,E.get("icon-ignore-placement"),b.bucketInstanceId,qn,ie.ID),Ot&&(mt&&this.collisionIndex.insertCollisionCircles(Ot.circles,E.get("text-ignore-placement"),b.bucketInstanceId,nn,ie.ID),_)){const an=b.bucketInstanceId;let un=this.collisionCircleArrays[an];un===void 0&&(un=this.collisionCircleArrays[an]=new $n);for(let Ii=0;Ii<Ot.circles.length;Ii+=4)un.circles.push(Ot.circles[Ii+0]),un.circles.push(Ot.circles[Ii+1]),un.circles.push(Ot.circles[Ii+2]),un.circles.push(Ot.collisionDetected?1:0)}const Ys=this.transform.projection.name!=="globe";Me=Me&&(Ys||!St),Ae=Ae&&(Ys||!dt),this.placements[ve.crossTileID]=new Ws(mt||Me,ke||Ae,ht||b.justReloaded),h[ve.crossTileID]=!0};if(Te){const ve=b.getSortedSymbolIndexes(this.transform.angle);for(let He=ve.length-1;He>=0;--He){const $e=ve[He];We(b.symbolInstances.get($e),$e,b.collisionArrays[$e])}}else for(let ve=s.symbolInstanceStart;ve<s.symbolInstanceEnd;ve++)We(b.symbolInstances.get(ve),ve,b.collisionArrays[ve]);if(_&&b.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[b.bucketInstanceId];l.invert(ve.invProjMatrix,S),ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(s,h,_,x){let b;b=x===l.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(h)];const E=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const S of E)S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=b>=0&&S!==b?0:_.crossTileID)}markUsedOrientation(s,h,_){const x=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,b=h===l.WritingMode.vertical?h:0,E=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const S of E)s.text.placedSymbolArray.get(S).placedOrientation=x;_.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(s):1,b=h?h.opacities:{},E=h?h.variableOffsets:{},S=h?h.placedOrientations:{};for(const k in this.placements){const P=this.placements[k],O=b[k];O?(this.opacities[k]=new qs(O,x,P.text,P.icon,null,P.clipped),_=_||P.text!==O.text.placed||P.icon!==O.icon.placed):(this.opacities[k]=new qs(null,x,P.text,P.icon,P.skipFade,P.clipped),_=_||P.text||P.icon)}for(const k in b){const P=b[k];if(!this.opacities[k]){const O=new qs(P,x,!1,!1);O.isHidden()||(this.opacities[k]=O,_=_||P.text.placed||P.icon.placed)}}for(const k in E)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=E[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);_?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const _={};for(const x of h){const b=x.getBucket(s);b&&x.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,_,x.collisionBoxArray)}}updateBucketOpacities(s,h,_){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const x=s.layers[0].layout,b=!!s.layers[0].dynamicFilter(),E=new qs(null,0,!1,!1,!0),S=x.get("text-allow-overlap"),k=x.get("icon-allow-overlap"),P=x.get("text-variable-anchor"),O=x.get("text-rotation-alignment")==="map",F=x.get("text-pitch-alignment")==="map",G=x.get("icon-text-fit")!=="none",H=new qs(null,0,S&&(k||!s.hasIconData()||x.get("icon-optional")),k&&(S||!s.hasTextData()||x.get("text-optional")),!0);!s.collisionArrays&&_&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(_);const q=(ie,Z,ee)=>{for(let te=0;te<Z/4;te++)ie.opacityVertexArray.emplaceBack(ee)};let V=0;for(let ie=0;ie<s.symbolInstances.length;ie++){const Z=s.symbolInstances.get(ie),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:te,crossTileID:re}=Z;let Q=this.opacities[re];h[re]?Q=E:Q||(Q=H,this.opacities[re]=Q),h[re]=!0;const ae=ee>0||te>0,ye=Z.numIconVertices>0,Te=this.placedOrientations[Z.crossTileID],Me=Te===l.WritingMode.vertical,Ae=Te===l.WritingMode.horizontal||Te===l.WritingMode.horizontalOnly;if(!ae&&!ye||Q.isHidden()||V++,ae){const We=$m(Q.text);q(s.text,ee,Me?Iu:We),q(s.text,te,Ae?Iu:We);const ve=Q.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(s.text.placedSymbolArray.get(mt).hidden=ve||Me?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=ve||Ae?1:0);const He=this.variableOffsets[Z.crossTileID];He&&this.markUsedJustification(s,He.anchor,Z,Te);const $e=this.placedOrientations[Z.crossTileID];$e&&(this.markUsedJustification(s,"left",Z,$e),this.markUsedOrientation(s,$e,Z))}if(ye){const We=$m(Q.icon);Z.placedIconSymbolIndex>=0&&(q(s.icon,Z.numIconVertices,Me?Iu:We),s.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=Q.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&(q(s.icon,Z.numVerticalIconVertices,Ae?Iu:We),s.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=Q.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const We=s.collisionArrays[ie];if(We){let ve=new l.pointGeometry(0,0),He=!0;if(We.textBox||We.verticalTextBox){if(P){const mt=this.variableOffsets[re];mt?(ve=Fa(mt.anchor,mt.width,mt.height,mt.textOffset,mt.textScale),O&&ve._rotate(F?this.transform.angle:-this.transform.angle)):He=!1}b&&(He=!Q.clipped),We.textBox&&fs(s.textCollisionBox.collisionVertexArray,Q.text.placed,!He||Me,ve.x,ve.y),We.verticalTextBox&&fs(s.textCollisionBox.collisionVertexArray,Q.text.placed,!He||Ae,ve.x,ve.y)}const $e=He&&Boolean(!Ae&&We.verticalIconBox);We.iconBox&&fs(s.iconCollisionBox.collisionVertexArray,Q.icon.placed,$e,G?ve.x:0,G?ve.y:0),We.verticalIconBox&&fs(s.iconCollisionBox.collisionVertexArray,Q.icon.placed,!$e,G?ve.x:0,G?ve.y:0)}}}if(s.fullyClipped=V===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ie.invProjMatrix,s.placementViewportMatrix=ie.viewportMatrix,s.collisionCircleArray=ie.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>s}setStale(){this.stale=!0}}function fs(p,s,h,_,x){p.emplaceBack(s?1:0,h?1:0,_||0,x||0),p.emplaceBack(s?1:0,h?1:0,_||0,x||0),p.emplaceBack(s?1:0,h?1:0,_||0,x||0),p.emplaceBack(s?1:0,h?1:0,_||0,x||0)}const Zv=Math.pow(2,25),Vm=Math.pow(2,24),Mr=Math.pow(2,17),Eu=Math.pow(2,16),po=Math.pow(2,9),Nd=Math.pow(2,8),Tu=Math.pow(2,1);function $m(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const s=p.placed?1:0,h=Math.floor(127*p.opacity);return h*Zv+s*Vm+h*Mr+s*Eu+h*po+s*Nd+h*Tu+s}const Iu=0;class Fd{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,_,x,b){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,x,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((S,k)=>S.sortKey-k.sortKey));this._currentPartIndex<E.length;){const S=E[this._currentPartIndex];if(h.placeLayerBucketPart(S,this._seenCrossTileIDs,_,S.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class Xv{constructor(s,h,_,x,b,E,S,k){this.placement=new Kv(s,b,E,S,k),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(s,h,_){const x=l.exported.now(),b=()=>{const E=l.exported.now()-x;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=h[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=S)&&(!E.maxzoom||E.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Fd(E)),this._inProgressLayer.continuePlacement(_[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const jm=512/l.EXTENT/2;class Yv{constructor(s,h,_){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let x=0;x<h.length;x++){const b=h.get(x),E=b.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,s)})}}getScaledCoordinates(s,h){const _=jm/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*l.EXTENT+s.tileAnchorX)*_),y:Math.floor((h.canonical.y*l.EXTENT+s.tileAnchorY)*_)}}findMatches(s,h,_){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<s.length;b++){const E=s.get(b);if(E.crossTileID)continue;const S=this.indexedSymbolInstances[E.key];if(!S)continue;const k=this.getScaledCoordinates(E,h);for(const P of S)if(Math.abs(P.coord.x-k.x)<=x&&Math.abs(P.coord.y-k.y)<=x&&!_[P.crossTileID]){_[P.crossTileID]=!0,E.crossTileID=P.crossTileID;break}}}}class Gm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jv{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const _ in this.indexes){const x=this.indexes[_],b={};for(const E in x){const S=x[E];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),b[S.tileID.key]=S}this.indexes[_]=b}this.lng=s}addBucket(s,h,_){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const x=this.usedCrossTileIDs[s.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>s.overscaledZ)for(const S in E){const k=E[S];k.tileID.isChildOf(s)&&k.findMatches(h.symbolInstances,s,x)}else{const S=E[s.scaledTo(Number(b)).key];S&&S.findMatches(h.symbolInstances,s,x)}}for(let b=0;b<h.symbolInstances.length;b++){const E=h.symbolInstances.get(b);E.crossTileID||(E.crossTileID=_.generate(),x[E.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Yv(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const _ in h.indexedSymbolInstances)for(const x of h.indexedSymbolInstances[_])delete this.usedCrossTileIDs[s][x.crossTileID]}removeStaleBuckets(s){let h=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const b in x)s[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[b]),delete x[b],h=!0)}return h}}class Su{constructor(){this.layerIndexes={},this.crossTileIDs=new Gm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,_,x){let b=this.layerIndexes[s.id];b===void 0&&(b=this.layerIndexes[s.id]=new Jv);let E=!1;const S={};x.name!=="globe"&&b.handleWrapJump(_);for(const k of h){const P=k.getBucket(s);P&&s.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(k.tileID,P,this.crossTileIDs)&&(E=!0),S[P.bucketInstanceId]=!0)}return b.removeStaleBuckets(S)&&(E=!0),E}pruneUnusedLayers(s){const h={};s.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Bl=(p,s)=>l.emitValidationErrors(p,s&&s.filter(h=>h.identifier!=="source.canvas")),qm=l.pick(gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Wm=l.pick(gt,["setCenter","setZoom","setBearing","setPitch"]),Hm={version:8,layers:[],sources:{}},na={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class mr extends l.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Kt(Lt(),this),this.imageManager=new Ht,this.imageManager.setEventedParent(this),this.glyphManager=new l.GlyphManager(s._requestManager,h.localFontFamily?l.LocalGlyphMode.all:h.localIdeographFontFamily?l.LocalGlyphMode.ideographs:l.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.lineAtlas=new l.LineAtlas(256,512),this.crossTileSymbolIndex=new Su,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const _=this;this._rtlTextPluginCallback=mr.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,E)=>{if(l.triggerPluginCompletionEvent(b),E&&E.every(S=>S))for(const S in _._sourceCaches){const k=_._sourceCaches[S],P=k.getSource().type;P!=="vector"&&P!=="geojson"||k.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const b=this.getSource(x.sourceId);if(b&&b.vectorLayerIds)for(const E in this._layers){const S=this._layers[E];S.source===b.id&&this._validateLayer(S)}})}loadURL(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const _=typeof h.validate=="boolean"?h.validate:!l.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,h.accessToken);const x=this.map._requestManager.transformRequest(s,l.ResourceType.Style);this._request=l.getJSON(x,(b,E)=>{this._request=null,b?this.fire(new l.ErrorEvent(b)):E&&this._load(E,_)})}loadJSON(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Hm,!1)}_updateLayerCount(s,h){const _=h?1:-1;s.is3D()&&(this._num3DLayers+=_),s.type==="circle"&&(this._numCircleLayers+=_),s.type==="symbol"&&(this._numSymbolLayers+=_)}_load(s,h){if(h&&Bl(this,l.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s,this._updateMapProjection();for(const x in s.sources)this.addSource(x,s.sources[x],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const _=Ei(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of _)x=l.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Nn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(s){this._spriteRequest=function(h,_,x){let b,E,S;const k=l.exported.devicePixelRatio>1?"@2x":"";let P=l.getJSON(_.transformRequest(_.normalizeSpriteURL(h,k,".json"),l.ResourceType.SpriteJSON),(G,H)=>{P=null,S||(S=G,b=H,F())}),O=l.getImage(_.transformRequest(_.normalizeSpriteURL(h,k,".png"),l.ResourceType.SpriteImage),(G,H)=>{O=null,S||(S=G,E=H,F())});function F(){if(S)x(S);else if(b&&E){const G=l.exported.getImageData(E),H={};for(const q in b){const{width:V,height:ie,x:Z,y:ee,sdf:te,pixelRatio:re,stretchX:Q,stretchY:ae,content:ye}=b[q],Te=new l.RGBAImage({width:V,height:ie});l.RGBAImage.copy(G,Te,{x:Z,y:ee},{x:0,y:0},{width:V,height:ie}),H[q]={data:Te,pixelRatio:re,sdf:te,stretchX:Q,stretchY:ae,content:ye}}x(null,H)}}return{cancel(){P&&(P.cancel(),P=null),O&&(O.cancel(),O=null)}}}(s,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.getSource(s.source);if(!h)return;const _=s.sourceLayer;_&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(_)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const _ of s){const x=this._layers[_];x.type!=="custom"&&h.push(x.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&na[s.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(x.length||b.length)&&this._updateWorkerLayers(x,b);for(const E in this._updatedSources){const S=this._updatedSources[E];S==="reload"?this._reloadSource(E):S==="clear"&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const b=this._sourceCaches[x];_[x]=b.used,b.used=!1}for(const x of this._order){const b=this._layers[x];if(b.recalculate(s,this._availableImages),!b.isHidden(s.zoom)){const S=this._getLayerSourceCache(b);S&&(S.used=!0)}const E=this.map.painter;if(E){const S=b.getProgramIds();if(!S)continue;const k=b.getProgramConfiguration(s.zoom);for(const P of S)E.useProgram(P,k)}}for(const x in _){const b=this._sourceCaches[x];_[x]!==b.used&&b.getSource().fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),Bl(this,l.validateStyle(s)))return!1;(s=l.clone$1(s)).layers=Ei(s.layers);const h=function(x,b){if(!x)return[{command:gt.setStyle,args:[b]}];let E=[];try{if(!R(x.version,b.version))return[{command:gt.setStyle,args:[b]}];R(x.center,b.center)||E.push({command:gt.setCenter,args:[b.center]}),R(x.zoom,b.zoom)||E.push({command:gt.setZoom,args:[b.zoom]}),R(x.bearing,b.bearing)||E.push({command:gt.setBearing,args:[b.bearing]}),R(x.pitch,b.pitch)||E.push({command:gt.setPitch,args:[b.pitch]}),R(x.sprite,b.sprite)||E.push({command:gt.setSprite,args:[b.sprite]}),R(x.glyphs,b.glyphs)||E.push({command:gt.setGlyphs,args:[b.glyphs]}),R(x.transition,b.transition)||E.push({command:gt.setTransition,args:[b.transition]}),R(x.light,b.light)||E.push({command:gt.setLight,args:[b.light]}),R(x.fog,b.fog)||E.push({command:gt.setFog,args:[b.fog]}),R(x.projection,b.projection)||E.push({command:gt.setProjection,args:[b.projection]});const S={},k=[];(function(F,G,H,q){let V;for(V in G=G||{},F=F||{})F.hasOwnProperty(V)&&(G.hasOwnProperty(V)||Ti(V,H,q));for(V in G)G.hasOwnProperty(V)&&(F.hasOwnProperty(V)?R(F[V],G[V])||(F[V].type==="geojson"&&G[V].type==="geojson"&&Gs(F,G,V)?H.push({command:gt.setGeoJSONSourceData,args:[V,G[V].data]}):ea(V,G,H,q)):bi(V,G,H))})(x.sources,b.sources,k,S);const P=[];x.layers&&x.layers.forEach(F=>{F.source&&S[F.source]?E.push({command:gt.removeLayer,args:[F.id]}):P.push(F)});let O=x.terrain;O&&S[O.source]&&(E.push({command:gt.setTerrain,args:[void 0]}),O=void 0),E=E.concat(k),R(O,b.terrain)||E.push({command:gt.setTerrain,args:[b.terrain]}),function(F,G,H){G=G||[];const q=(F=F||[]).map(li),V=G.map(li),ie=F.reduce(ei,{}),Z=G.reduce(ei,{}),ee=q.slice(),te=Object.create(null);let re,Q,ae,ye,Te,Me,Ae;for(re=0,Q=0;re<q.length;re++)ae=q[re],Z.hasOwnProperty(ae)?Q++:(H.push({command:gt.removeLayer,args:[ae]}),ee.splice(ee.indexOf(ae,Q),1));for(re=0,Q=0;re<V.length;re++)ae=V[V.length-1-re],ee[ee.length-1-re]!==ae&&(ie.hasOwnProperty(ae)?(H.push({command:gt.removeLayer,args:[ae]}),ee.splice(ee.lastIndexOf(ae,ee.length-Q),1)):Q++,Me=ee[ee.length-re],H.push({command:gt.addLayer,args:[Z[ae],Me]}),ee.splice(ee.length-re,0,ae),te[ae]=!0);for(re=0;re<V.length;re++)if(ae=V[re],ye=ie[ae],Te=Z[ae],!te[ae]&&!R(ye,Te))if(R(ye.source,Te.source)&&R(ye["source-layer"],Te["source-layer"])&&R(ye.type,Te.type)){for(Ae in Qe(ye.layout,Te.layout,H,ae,null,gt.setLayoutProperty),Qe(ye.paint,Te.paint,H,ae,null,gt.setPaintProperty),R(ye.filter,Te.filter)||H.push({command:gt.setFilter,args:[ae,Te.filter]}),R(ye.minzoom,Te.minzoom)&&R(ye.maxzoom,Te.maxzoom)||H.push({command:gt.setLayerZoomRange,args:[ae,Te.minzoom,Te.maxzoom]}),ye)ye.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?Qe(ye[Ae],Te[Ae],H,ae,Ae.slice(6),gt.setPaintProperty):R(ye[Ae],Te[Ae])||H.push({command:gt.setLayerProperty,args:[ae,Ae,Te[Ae]]}));for(Ae in Te)Te.hasOwnProperty(Ae)&&!ye.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?Qe(ye[Ae],Te[Ae],H,ae,Ae.slice(6),gt.setPaintProperty):R(ye[Ae],Te[Ae])||H.push({command:gt.setLayerProperty,args:[ae,Ae,Te[Ae]]}))}else H.push({command:gt.removeLayer,args:[ae]}),Me=ee[ee.lastIndexOf(ae)+1],H.push({command:gt.addLayer,args:[Te,Me]})}(P,b.layers,E)}catch(S){console.warn("Unable to compute style diff:",S),E=[{command:gt.setStyle,args:[b]}]}return E}(this.serialize(),s).filter(x=>!(x.command in Wm));if(h.length===0)return!1;const _=h.filter(x=>!(x.command in qm));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return h.forEach(x=>{x.command!=="setTransition"&&this[x.command].apply(this,x.args)}),this.stylesheet=s,this._updateMapProjection(),!0}addImage(s,h){return this.getImage(s)?this.fire(new l.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,h),this._afterImageUpdated(s),this)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s),this._afterImageUpdated(s),this):this.fire(new l.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(s,h,_={}){if(this._checkLoaded(),this.getSource(s)!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateSource,`sources.${s}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=_e(s,h,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s),source:x.serialize(),sourceId:s}));const b=E=>{const S=(E?"symbol:":"other:")+s,k=this._sourceCaches[S]=new l.SourceCache(S,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[s]=k,k.style=this,k.onAdd(this.map)};b(!1),h.type!=="vector"&&h.type!=="geojson"||b(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const h=this.getSource(s);if(!h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===s)return this.fire(new l.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new l.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(s);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getSource(s).setData(h),this._changed=!0}getSource(s){const h=this._getSourceCache(s);return h&&h.getSource()}addLayer(s,h,_={}){this._checkLoaded();const x=s.id;if(this.getLayer(x))return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let b;if(s.type==="custom"){if(Bl(this,l.validateCustomStyleLayer(s)))return;b=l.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(x,s.source),s=l.clone$1(s),s=l.extend(s,{source:x})),this._validate(l.validateLayer,`layers.${x}`,s,{arrayIndex:-1},_))return;b=l.createStyleLayer(s),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)return void this.fire(new l.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(E,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const S=this._getLayerSourceCache(b);if(this._removedLayers[x]&&b.source&&S&&b.type!=="custom"){const k=this._removedLayers[x];delete this._removedLayers[x],k.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",S.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const _=this._order.indexOf(s);this._order.splice(_,1);const x=h?this._order.indexOf(h):this._order.length;h&&x===-1?this.fire(new l.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(x,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(s);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,_){this._checkLoaded();const x=this.getLayer(s);x?x.minzoom===h&&x.maxzoom===_||(h!=null&&(x.minzoom=h),_!=null&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,h,_={}){this._checkLoaded();const x=this.getLayer(s);if(x){if(!R(x.filter,h))return h==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(l.validateFilter,`layers.${x.id}.filter`,h,{layerType:x.type},_)||(x.filter=l.clone$1(h),this._updateLayer(x)))}else this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){const h=this.getLayer(s);return h&&l.clone$1(h.filter)}setLayoutProperty(s,h,_,x={}){this._checkLoaded();const b=this.getLayer(s);b?R(b.getLayoutProperty(h),_)||(b.setLayoutProperty(h,_,x),this._updateLayer(b)):this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,h){const _=this.getLayer(s);if(_)return _.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,h,_,x={}){this._checkLoaded();const b=this.getLayer(s);b?R(b.getPaintProperty(h),_)||(b.setPaintProperty(h,_,x)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,h){const _=this.getLayer(s);return _&&_.getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const _=s.source,x=s.sourceLayer,b=this.getSource(_);if(!b)return void this.fire(new l.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const E=b.type;if(E==="geojson"&&x)return void this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(_);for(const k of S)k.setFeatureState(x,s.id,h)}removeFeatureState(s,h){this._checkLoaded();const _=s.source,x=this.getSource(_);if(!x)return void this.fire(new l.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const b=x.type,E=b==="vector"?s.sourceLayer:void 0;if(b==="vector"&&!E)return void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(_);for(const k of S)k.removeFeatureState(E,s.id,h)}getFeatureState(s){this._checkLoaded();const h=s.source,_=s.sourceLayer,x=this.getSource(h);if(x){if(x.type!=="vector"||_)return s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,s.id);this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();s[_.id]||(s[_.id]=_.serialize())}return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:s,layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0;const h=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&h&&h.getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",h.pause()),this._changed=!0,s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const h=E=>this._layers[E].type==="fill-extrusion",_={},x=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(h(S)){_[S]=E;for(const k of s){const P=k[S];if(P)for(const O of P)x.push(O)}}}x.sort((E,S)=>S.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(h(S))for(let k=x.length-1;k>=0;k--){const P=x[k].feature;if(_[P.layer.id]<E)break;b.push(P),x.pop()}else for(const k of s){const P=k[S];if(P)for(const O of P)b.push(O.feature)}}return b}queryRenderedFeatures(s,h,_){h&&h.filter&&this._validate(l.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const x={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of h.layers){const P=this._layers[k];if(!P)return this.fire(new l.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];x[P.source]=!0}}const b=[];h.availableImages=this._availableImages;const E=h&&h.layers?h.layers.some(k=>{const P=this.getLayer(k);return P&&P.is3D()}):this.has3DLayers(),S=ze.createFromScreenPoints(s,_);for(const k in this._sourceCaches){const P=this._sourceCaches[k].getSource().id;h.layers&&!x[P]||b.push(xe(this._sourceCaches[k],this._layers,this._serializedLayers,S,h,_,E,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(k,P,O,F,G,H,q){const V={},ie=H.queryRenderedSymbols(F),Z=[];for(const ee of Object.keys(ie).map(Number))Z.push(q[ee]);Z.sort(it);for(const ee of Z){const te=ee.featureIndex.lookupSymbolFeatures(ie[ee.bucketInstanceId],P,ee.bucketIndex,ee.sourceLayerIndex,G.filter,G.layers,G.availableImages,k);for(const re in te){const Q=V[re]=V[re]||[],ae=te[re];ae.sort((ye,Te)=>{const Me=ee.featureSortOrder;if(Me){const Ae=Me.indexOf(ye.featureIndex);return Me.indexOf(Te.featureIndex)-Ae}return Te.featureIndex-ye.featureIndex});for(const ye of ae)Q.push(ye)}}for(const ee in V)V[ee].forEach(te=>{const re=te.feature,Q=O(k[ee]).getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=Q});return V}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(s,h){h&&h.filter&&this._validate(l.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(s);let x=[];for(const b of _)x=x.concat(Oe(b,h));return x}addSourceType(s,h,_){return mr.getSourceType(s)?_(new Error(`A source type called "${s}" already exists.`)):(mr.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const E in s)if(!R(s[E],_[E])){x=!0;break}if(!x)return;const b={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,h=1){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(h===1){if(typeof s.source=="object"){const _="terrain-dem-src";this.addSource(_,s.source),s=l.clone$1(s),s=l.extend(s,{source:_})}if(this._validate(l.validateTerrain,"terrain",s))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(s,h);else{const _=this.terrain,x=_.get();for(const b in s)if(!R(s[b],x[b])){_.set(s),this.stylesheet.terrain=s;const E={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const h=this.fog=new vn(s,this.map.transform);this.stylesheet.fog=s;const _={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();for(const x in s)if(!R(s[x],_[x])){h.set(s),this.stylesheet.fog=s;const b={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};h.updateTransitions(b);break}}else this._createFog(s);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){const _=this.terrain=new Zt(s,h);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x={now:l.exported.now(),transition:l.extend({duration:0},this.stylesheet.transition)};_.updateTransitions(x)}_force3DLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,_,x,b={}){return(!b||b.validate!==!1)&&Bl(this,s.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:_,styleSpec:l.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const h=this._getSourceCaches(s);for(const _ of h)_.clearTiles()}_reloadSource(s){const h=this._getSourceCaches(s);for(const _ of h)_.resume(),_.reload()}_updateSources(s){for(const h in this._sourceCaches)this._sourceCaches[h].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,_,x,b=!1){let E=!1,S=!1;const k={};for(const P of this._order){const O=this._layers[P];if(O.type!=="symbol")continue;if(!k[O.source]){const G=this._getLayerSourceCache(O);if(!G)continue;k[O.source]=G.getRenderableIds(!0).map(H=>G.getTileByID(H)).sort((H,q)=>q.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(q.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(O,k[O.source],s.center.lng,s.projection);E=E||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new l.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),s.zoom))&&(this.pauseablePlacement=new Xv(s,this._order,b,h,_,x,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),S=!0),E&&this.pauseablePlacement.placement.setStale()),S||E)for(const P of this._order){const O=this._layers[P];O.type==="symbol"&&this.placement.updateLayerOpacities(O,k[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const x=b=>{b&&b.setDependencies(h.tileID.key,h.type,h.icons)};x(this._otherSourceCaches[h.source]),x(this._symbolSourceCaches[h.source])}getGlyphs(s,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(s,h,_){return l.makeRequest(h,_)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){const h=this._getSourceCaches(s);return h.length===0?(this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${s}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}mr.getSourceType=function(p){return ge[p]},mr.setSourceType=function(p,s){ge[p]=s},mr.registerForPluginStateChange=l.registerForPluginStateChange;var Ul=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Vl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ra={},mo={};ra=At("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),mo=At(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Au=At(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),$l=Ul;var jl={background:At(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:At(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:At(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:At("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:At(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:At(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:At("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:At("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:At("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:At(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:At(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:At(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:At(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:At(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:At(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:At(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:At(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:At(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:At(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:At(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:At(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:At(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:At(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:At(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:At(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:At(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Vl),skyboxGradient:At(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Vl),skyboxCapture:At(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:At(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:At(`uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)
discard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function At(p,s,h){const _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=p.match(x),S=s.match(x),k=Ul.match(x);let P=S?S.concat(E):E;h||(ra.staticUniforms&&(P=ra.staticUniforms.concat(P)),mo.staticUniforms&&(P=mo.staticUniforms.concat(P))),P&&(P=P.concat(k));const O={};return{fragmentSource:p=p.replace(_,(F,G,H,q,V)=>(O[V]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${V}
varying ${H} ${q} ${V};
#else
uniform ${H} ${q} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${H} ${q} ${V} = u_${V};
#endif
`)),vertexSource:s=s.replace(_,(F,G,H,q,V)=>{const ie=q==="float"?"vec2":"vec4",Z=V.match(/color/)?"color":ie;return O[V]?G==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${H} ${ie} a_${V};
varying ${H} ${q} ${V};
#else
uniform ${H} ${q} u_${V};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${H} ${q} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${Z}(a_${V}, u_${V}_t);
#else
    ${H} ${q} ${V} = u_${V};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${H} ${ie} a_${V};
#else
uniform ${H} ${q} u_${V};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${H} ${q} ${V} = a_${V};
#else
    ${H} ${q} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${H} ${q} ${V} = unpack_mix_${Z}(a_${V}, u_${V}_t);
#else
    ${H} ${q} ${V} = u_${V};
#endif
`}),staticAttributes:b,staticUniforms:P}}class Cu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,_,x,b,E,S,k){this.context=s;let P=this.boundPaintVertexBuffers.length!==x.length;for(let O=0;!P&&O<x.length;O++)this.boundPaintVertexBuffers[O]!==x[O]&&(P=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===_&&!P&&this.boundIndexBuffer===b&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===k?(s.bindVertexArrayOES.set(this.vao),S&&S.bind(),b&&b.dynamicDraw&&b.bind(),k&&k.bind()):this.freshBind(h,_,x,b,E,S,k)}freshBind(s,h,_,x,b,E,S){let k;const P=s.numAttributes,O=this.context,F=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=S;else{k=O.currentNumAttributes||0;for(let G=P;G<k;G++)F.disableVertexAttribArray(G)}h.enableAttributes(F,s);for(const G of _)G.enableAttributes(F,s);E&&E.enableAttributes(F,s),S&&S.enableAttributes(F,s),h.bind(),h.setVertexAttribPointers(F,s,b);for(const G of _)G.bind(),G.setVertexAttribPointers(F,s,b);E&&(E.bind(),E.setVertexAttribPointers(F,s,b)),x&&x.bind(),S&&(S.bind(),S.setVertexAttribPointers(F,s,b)),O.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Km(p,s){const h=Math.pow(2,s.canonical.z),_=s.canonical.y;return[new l.MercatorCoordinate(0,_/h).toLngLat().lat,new l.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function Zm(p,s,h,_,x,b,E){const S=p.context,k=S.gl,P=h.fbo;if(!P)return;p.prepareDrawTile();const O=p.useProgram("hillshade");S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,P.colorAttachment.get());const F=((V,ie,Z,ee)=>{const te=Z.paint.get("hillshade-shadow-color"),re=Z.paint.get("hillshade-highlight-color"),Q=Z.paint.get("hillshade-accent-color");let ae=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(ae-=V.transform.angle);const ye=!V.options.moving;return{u_matrix:ee||V.transform.calculateProjMatrix(ie.tileID.toUnwrapped(),ye),u_image:0,u_latrange:Km(0,ie.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),ae],u_shadow:te,u_highlight:re,u_accent:Q}})(p,h,_,p.terrain?s.projMatrix:null);p.prepareDrawProgram(S,O,s.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:H,tileBoundsSegments:q}=p.getTileBoundsBuffers(h);O.draw(S,k.TRIANGLES,x,b,E,l.CullFaceMode.disabled,F,_.id,G,H,q)}function Bd(p,s,h){if(!s.needsDEMTextureUpload)return;const _=p.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(h.stride);const b=h.getPixels();s.demTexture?s.demTexture.update(b,{premultiply:!1}):s.demTexture=new l.Texture(_,b,x.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Ud(p,s,h,_,x,b){const E=p.context,S=E.gl;if(!s.dem)return;const k=s.dem;if(E.activeTexture.set(S.TEXTURE1),Bd(p,s,k),!s.demTexture)return;s.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const P=k.dim;E.activeTexture.set(S.TEXTURE0);let O=s.fbo;if(!O){const q=new l.Texture(E,{width:P,height:P,data:null},S.RGBA);q.bind(S.LINEAR,S.CLAMP_TO_EDGE),O=s.fbo=E.createFramebuffer(P,P,!0),O.colorAttachment.set(q.texture)}E.bindFramebuffer.set(O.framebuffer),E.viewport.set([0,0,P,P]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:G,tileBoundsSegments:H}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(E,S.TRIANGLES,_,x,b,l.CullFaceMode.disabled,((q,V)=>{const ie=V.stride,Z=l.create();return l.ortho(Z,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(Z,Z,[0,-l.EXTENT,0]),{u_matrix:Z,u_image:1,u_dimension:[ie,ie],u_zoom:q.overscaledZ,u_unpack:V.unpackVector}})(s.tileID,k),h.id,F,G,H),s.needsHillshadePrepare=!1}const Vd=(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_image0:new l.Uniform1i(p,s.u_image0),u_skirt_height:new l.Uniform1f(p,s.u_skirt_height)}),Xm=(p,s)=>({u_matrix:p,u_image0:0,u_skirt_height:s}),Ym=(p,s,h,_,x,b)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_merc_matrix:h,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_grid_matrix:b?Float32Array.from(b):new Float32Array(9)});function Mu(p,s){return p!=null&&s!=null&&!(!p.hasData()||!s.hasData())&&p.demTexture!=null&&s.demTexture!=null&&p.tileID.key!==s.tileID.key}const _o=new class{constructor(){this.operations={}}newMorphing(p,s,h,_,x){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==h.tileID.key&&(b.queued=h)}else this.operations[p]={startTime:_,phase:0,duration:x,from:s,to:h,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(const s in this.operations){const h=this.operations[s];for(h.phase=(p-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Ua={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function $d(p,s){const h=1<<p.z;return!s&&(p.x===0||p.x===h-1)||p.y===0||p.y===h-1}const ku=p=>({u_matrix:p});function jd(p,s,h,_,x){if(x>0){const b=l.exported.now(),E=(b-p.timeAdded)/x,S=s?(b-s.timeAdded)/x:-1,k=h.getSource(),P=_.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),O=!s||Math.abs(s.tileID.overscaledZ-P)>Math.abs(p.tileID.overscaledZ-P),F=O&&p.refreshedUponExpiration?1:l.clamp(O?E:1-S,0,1);return p.refreshedUponExpiration&&E>=1&&(p.refreshedUponExpiration=!1),s?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}const Qv=2*l.mercatorZfromAltitude(1,0)*l.GLOBE_RADIUS*Math.PI;class Gl extends l.SourceCache{constructor(s){const h={type:"raster-dem",maxzoom:s.transform.maxZoom},_=new Kt(Lt(),null),x=_e("mock-dem",h,_,s.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class ql extends l.SourceCache{constructor(s){const h=_e("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new Kt(Lt(),null),s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,_){if(s.freezeTileCoverage)return;this.transform=s;const x=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){const S=new l.Tile(E,this._source.tileSize*E.overscaleFactor(),s.tileZoom);S.state="loaded",this._tiles[E.key]=S}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(s){const h=this.proxyCachedFBO[s];if(h!==void 0){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Gd extends l.OverscaledTileID{constructor(s,h,_){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class kr extends l.Elevation{constructor(s,h){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,b]=function(k){const P=new l.StructArrayLayout4i8,O=new l.StructArrayLayout3ui6,F=131;P.reserve(17161),O.reserve(33800);const G=l.EXTENT/128,H=l.EXTENT+G/2,q=H+G;for(let ie=-G;ie<q;ie+=G)for(let Z=-G;Z<q;Z+=G){const ee=Z<0||Z>H||ie<0||ie>H?24575:0,te=l.clamp(Math.round(Z),0,l.EXTENT),re=l.clamp(Math.round(ie),0,l.EXTENT);P.emplaceBack(te+ee,re,te,re)}const V=(ie,Z)=>{const ee=Z*F+ie;O.emplaceBack(ee+1,ee,ee+F),O.emplaceBack(ee+F,ee+F+1,ee+1)};for(let ie=1;ie<129;ie++)for(let Z=1;Z<129;Z++)V(Z,ie);return[0,129].forEach(ie=>{for(let Z=0;Z<130;Z++)V(Z,ie),V(ie,Z)}),[P,O,32768]}(),E=s.context;this.gridBuffer=E.createVertexBuffer(_,l.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=l.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=l.SegmentVector.simpleSegment(0,0,_.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ql(h.map),this.orthoMatrix=l.create(),l.ortho(this.orthoMatrix,0,l.EXTENT,0,l.EXTENT,0,1);const S=E.gl;this._overlapStencilMode=new l.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Gl(h.map)}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency()}update(s,h,_){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const x=s.terrain.properties;this.sourceCache=s.terrain.drapeRenderMode===0?this._mockSourceCache:s._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const b=()=>{this.sourceCache.used&&l.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(h,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),h.updateElevation(!_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||s.efficiency!==100&&l.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(k=>{const P=h.getTileByID(k).tileID;return P.projMatrix=_.calculateProjMatrix(P.toUnwrapped()),P});(function(k,P){const O=P.transform.pointCoordinate(P.transform.getCameraPoint()),F=new l.pointGeometry(O.x,O.y);k.sort((G,H)=>{if(H.overscaledZ-G.overscaledZ)return H.overscaledZ-G.overscaledZ;const q=new l.pointGeometry(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),V=new l.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),ie=F.mult(1<<G.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(q)-ie.distSqr(V)})})(x,this.painter),this._previousZoom=_.zoom;const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const k in E){const P=E[k];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,s[k],b),P.usedForTerrain))continue;const O=s[k];P.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[h.id]=x.map(k=>new Gd(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=l.exported.now();const S={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const P=this.terrainTileForTile[k.key];if(!P)continue;const O=P.tileID.key;O in S||(this._visibleDemTiles.push(P),S[O]=O)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const s=this.painter.context,h=s.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),Bd(this.painter,x,b))}}_prepareDemTileUniforms(s,h,_,x){if(!h||h.demTexture==null)return!1;const b=s.tileID.canonical,E=Math.pow(2,h.tileID.canonical.z-b.z),S=x||"";return _[`u_dem_tl${S}`]=[b.x*E%1,b.y*E%1],_[`u_dem_scale${S}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const s=this.painter.context,h=s.gl;if(!this._emptyDepthBufferTexture){const _=new l.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new l.Texture(s,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0;const h=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const b=x.dem.tree.minimums[0];return b>0&&s++,_+b},0);return s?h/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),x=new l.RGBAImage({width:1,height:1},new Uint8Array(l.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new l.Texture(s,x,h.RGBA,{premultiply:!1}),b}setupElevationDraw(s,h,_){const x=this.painter.context,b=x.gl,E=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:l.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();const k=this.painter.transform,P=k.projection,O=s.tileID.canonical;E.u_tile_tl_up=P.upVector(O,0,0),E.u_tile_tr_up=P.upVector(O,l.EXTENT,0),E.u_tile_br_up=P.upVector(O,l.EXTENT,l.EXTENT),E.u_tile_bl_up=P.upVector(O,0,l.EXTENT),E.u_tile_up_scale=_&&_.useDenormalizedUpVectorScale?Qv:P.upVectorScale(O,k.center.lat,k.worldSize).metersToTile;let F=null,G=null,H=1;if(_&&_.morphing&&this._useVertexMorphing){const q=_.morphing.srcDemTile,V=_.morphing.dstDemTile;H=_.morphing.phase,q&&V&&(this._prepareDemTileUniforms(s,q,E,"_prev")&&(G=q),this._prepareDemTileUniforms(s,V,E)&&(F=V))}if(G&&F?(x.activeTexture.set(b.TEXTURE2),F.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),x.activeTexture.set(b.TEXTURE4),G.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),E.u_dem_lerp=H):(F=this.terrainTileForTile[s.tileID.key],x.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(s,F,E)?F.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),x.activeTexture.set(b.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&F){const q=(1<<F.tileID.canonical.z)*l.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=q}_&&_.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(x,E)}renderToBackBuffer(s){const h=this.painter,_=this.painter.context;s.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),this.renderingToTexture=!1,function(x,b,E,S,k){if(x.transform.projection.name==="globe")(function(P,O,F,G,H){const q=P.context,V=q.gl;let ie,Z;const ee=P.options.showTerrainWireframe?2:0,te=(Ae,We)=>{if(Z===Ae)return;const ve=[Ua[Ae],"PROJECTION_GLOBE_VIEW"];We&&ve.push(Ua[ee]),ie=P.useProgram("globeRaster",null,ve),Z=Ae},re=P.colorModeForRenderPass(),Q=new l.DepthMode(V.LEQUAL,l.DepthMode.ReadWrite,P.depthRangeFor3D);_o.update(H);const ae=P.transform,ye=l.calculateGlobeMercatorMatrix(ae),Te=[l.mercatorXfromLng(ae.center.lng),l.mercatorYfromLat(ae.center.lat)],Me=P.globeSharedBuffers;if((ee?[!1,!0]:[!1]).forEach(Ae=>{Z=-1;const We=Ae?V.LINES:V.TRIANGLES;for(const ve of G){const He=F.getTile(ve),$e=l.StencilMode.disabled,mt=O.prevTerrainTileForTile[ve.key],ke=O.terrainTileForTile[ve.key];Mu(mt,ke)&&_o.newMorphing(ve.key,mt,ke,H,250),q.activeTexture.set(V.TEXTURE0),He.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const ht=_o.getMorphValuesForProxy(ve.key),St=ht?1:0,dt={useDenormalizedUpVectorScale:!0};ht&&l.extend$1(dt,{morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:l.easeCubicInOut(ht.phase)}});const ft=Float32Array.from(ae.globeMatrix),Dt=l.globeTileLatLngCorners(ve.canonical),Gt=l.getGridMatrix(ve.canonical,Dt),Et=Ym(ae.projMatrix,ft,ye,l.globeToMercatorTransition(ae.zoom),Te,Gt);if(te(St,Ae),O.setupElevationDraw(He,ie,dt),P.prepareDrawProgram(q,ie,ve.toUnwrapped()),Me){const[Ot,pi,nn]=Ae?Me.getWirefameBuffers(P.context):Me.getGridBuffers();ie.draw(q,We,Q,$e,re,l.CullFaceMode.backCCW,Et,"globe_raster",Ot,pi,nn)}}}),Me){ie=P.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const Ae of G){const{x:We,y:ve,z:He}=Ae.canonical,$e=ve===0,mt=ve===(1<<He)-1,[ke,ht,St,dt]=Me.getPoleBuffers(He);if(dt&&($e||mt)){const ft=F.getTile(Ae);q.activeTexture.set(V.TEXTURE0),ft.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let Dt=l.globePoleMatrixForTile(He,We,ae);const Gt=(Et,Ot)=>Et.draw(q,V.TRIANGLES,Q,l.StencilMode.disabled,re,l.CullFaceMode.disabled,Ym(ae.projMatrix,Dt,Dt,0,Te),"globe_pole_raster",Ot,St,dt);O.setupElevationDraw(ft,ie,{}),P.prepareDrawProgram(q,ie,Ae.toUnwrapped()),$e&&Gt(ie,ke),mt&&(Dt=l.scale(l.create(),Dt,[1,-1,1]),Gt(ie,ht))}}}})(x,b,E,S,k);else{const P=x.context,O=P.gl;let F,G;const H=x.options.showTerrainWireframe?2:0,q=(te,re)=>{if(G===te)return;const Q=[Ua[te]];re&&Q.push(Ua[H]),F=x.useProgram("terrainRaster",null,Q),G=te},V=x.colorModeForRenderPass(),ie=new l.DepthMode(O.LEQUAL,l.DepthMode.ReadWrite,x.depthRangeFor3D);_o.update(k);const Z=x.transform,ee=6*Math.pow(1.5,22-Z.zoom)*b.exaggeration();(H?[!1,!0]:[!1]).forEach(te=>{G=-1;const re=te?O.LINES:O.TRIANGLES,[Q,ae]=te?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const ye of S){const Te=E.getTile(ye),Me=l.StencilMode.disabled,Ae=b.prevTerrainTileForTile[ye.key],We=b.terrainTileForTile[ye.key];Mu(Ae,We)&&_o.newMorphing(ye.key,Ae,We,k,250),P.activeTexture.set(O.TEXTURE0),Te.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const ve=_o.getMorphValuesForProxy(ye.key),He=ve?1:0;let $e;ve&&($e={morphing:{srcDemTile:ve.from,dstDemTile:ve.to,phase:l.easeCubicInOut(ve.phase)}});const mt=Xm(ye.projMatrix,$d(ye.canonical,Z.renderWorldCopies)?ee/10:ee);q(He,te),b.setupElevationDraw(Te,F,$e),x.prepareDrawProgram(P,F,ye.toUnwrapped()),F.draw(P,re,ie,Me,V,l.CullFaceMode.backCCW,mt,"terrain_raster",b.gridBuffer,Q,ae)}})}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),S=[],k=h.style.order;let P=0;for(const O of b){const F=x.getTileByID(O.proxyTileKey),G=x.proxyCachedFBO[O.key]?x.proxyCachedFBO[O.key][s]:void 0,H=G!==void 0?x.renderCache[G]:this.pool[P++],q=G!==void 0;if(F.texture=H.tex,q&&!H.dirty){S.push(F.tileID);continue}let V;_.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(_.clear({color:l.Color.transparent,stencil:0}),H.dirty=!1);for(let ie=E.start;ie<=E.end;++ie){const Z=h.style._layers[k[ie]];if(Z.isHidden(h.transform.zoom))continue;const ee=h.style._getLayerSourceCache(Z),te=ee?this.proxyToSource[O.key][ee.id]:[O];if(!te)continue;const re=te;_.viewport.set([0,0,H.fb.width,H.fb.height]),V!==(ee?ee.id:null)&&(this._setupStencil(H,te,Z,ee),V=ee?ee.id:null),h.renderLayer(h,ee,Z,re)}this.renderedToTile?(H.dirty=!0,S.push(F.tileID)):q||--P,P===5&&(P=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),E.end+1}postRender(){}renderCacheEfficiency(s){const h=s.order.length;if(h===0)return{efficiency:100};let _,x=0,b=0,E=!1;for(let S=0;S<h;++S){const k=s._layers[s.order[S]];this._style.isLayerDraped(k)?(E&&++x,++b):E||(E=!0,_=k.id)}return b===0?{efficiency:100}:{efficiency:100*(1-x/b),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const E=b.tileID,S=Math.pow(2,E.overscaledZ),{x:k,y:P}=E.canonical,O=k/S,F=(k+1)/S,G=P/S,H=(P+1)/S;return{minx:O,miny:G,maxx:F,maxy:H,t:b.dem.tree.raycastRoot(O,G,F,H,s,h,_),tile:b}});x.sort((b,E)=>(b.t!==null?b.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const b of x){if(b.t==null)return null;const E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,s,h,_);if(E!=null)return E}return null}_createFBO(){const s=this.painter.context,h=s.gl,_=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);const x=new l.Texture(s,{width:_[0],height:_[1],data:null},h.RGBA);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const b=s.createFramebuffer(_[0],_[1],!1);return b.colorAttachment.set(x.texture),b.depthAttachment=new La(s,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const h=this._style._layers[s],_=h.isHidden(this.painter.transform.zoom),x=h.getCrossfadeParameters(),b=!!x&&x.t!==1,E=h.hasTransition();return h.type!=="custom"&&!_&&(b||E)})}_clearRasterFadeFromRenderCache(){let s=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof U){s=!0;break}if(s)for(let h=0;h<this._style.order.length;++h){const _=this._style._layers[this._style.order[h]],x=_.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(_);if(_.type!=="raster"||x||!b)continue;const E=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const k=this.proxyToSource[S.key][b.id];if(k)for(const P of k){const O=jd(b.getTile(P),b.findLoadedParent(P,0),b,this.painter.transform,E);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(b.id,P)}}}}_setupDrapedRenderBatches(){const s=this._style.order,h=s.length;if(h===0)return;const _=[];let x,b=0,E=this._style._layers[s[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<h;)E=this._style._layers[s[b]];for(;b<h;++b){const S=this._style._layers[s[b]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?x===void 0&&(x=b):x!==void 0&&(_.push({start:x,end:b-1}),x=void 0))}x!==void 0&&_.push({start:x,end:b-1}),this._drapedRenderBatches=_}_setupRenderCache(s){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const E=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let S=0;S<E.length;++S){const k=Object.values(E[S]);h.renderCachePool.push(...k)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let E=_.length-1;E>=0;E--){const S=_[E];if(h.getTileByID(S.key),h.proxyCachedFBO[S.key]!==void 0){const k=s[S.key],P=this.proxyToSource[S.key];let O=0;for(const F in P){const G=P[F],H=k[F];if(!H||H.length!==G.length||G.some((q,V)=>q!==H[V]||x[F]&&x[F].hasOwnProperty(q.key))){O=-1;break}++O}for(const F in h.proxyCachedFBO[S.key])h.renderCache[h.proxyCachedFBO[S.key][F]].dirty=O<0||O!==Object.values(k).length}}const b=[...this._drapedRenderBatches];b.sort((E,S)=>S.end-S.start-(E.end-E.start));for(const E of b)for(const S of _){if(h.proxyCachedFBO[S.key])continue;let k=h.renderCachePool.pop();k===void 0&&h.renderCache.length<50&&(k=h.renderCache.length,h.renderCache.push(this._createFBO())),k!==void 0&&(h.proxyCachedFBO[S.key]={},h.proxyCachedFBO[S.key][E.start]=k,h.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,E=b.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let S;if(_.isTileClipped())S=h.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(s.key)||0),this._overlapStencilMode):l.StencilMode.disabled}_renderTileClippingMasks(s,h){const _=this.painter,x=this.painter.context,b=x.gl;_._tileClippingMaskIDs.clear(),x.setColorMode(l.ColorMode.disabled),x.setDepthMode(l.DepthMode.disabled);const E=_.useProgram("clippingMask");for(const S of s){const k=--h;_._tileClippingMaskIDs.set(S.key,k),E.draw(x,b.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:b.ALWAYS,mask:0},k,255,b.KEEP,b.KEEP,b.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,ku(S.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(s){const h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;const _=[s.x,s.y,1,1];l.transformMat4$1(_,_,h.pixelMatrixInverse),l.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const x=h._camera.position,b=l.mercatorZfromAltitude(1,h.center.lat),E=[x[0],x[1],x[2]/b,0],S=l.subtract([],_.slice(0,3),E);l.normalize(S,S);const k=this.raycast(E,S,this._exaggeration);return k!==null&&k?(l.scaleAndAdd(E,E,S,k),E[3]=E[2],E[2]*=b,E):null}drawDepth(){const s=this.painter,h=s.context,_=this.proxySourceCache,x=Math.ceil(s.width),b=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=h.gl,S=h.createFramebuffer(x,b,!0);h.activeTexture.set(E.TEXTURE0);const k=new l.Texture(h,{width:x,height:b,data:null},E.RGBA);k.bind(E.NEAREST,E.CLAMP_TO_EDGE),S.colorAttachment.set(k.texture);const P=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,x,b);S.depthAttachment.set(P),this._depthFBO=S,this._depthTexture=k}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,x,b]),function(E,S,k,P){if(E.transform.projection.name==="globe")return;const O=E.context,F=O.gl;O.clear({depth:1});const G=E.useProgram("terrainDepth"),H=new l.DepthMode(F.LESS,l.DepthMode.ReadWrite,E.depthRangeFor3D);for(const q of P){const V=k.getTile(q),ie=Xm(q.projMatrix,0);S.setupElevationDraw(V,G),G.draw(O,F.TRIANGLES,H,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.backCCW,ie,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(s,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,h,_){if(s.getSource()instanceof le)return this._setupProxiedCoordsForImageSource(s,h,_);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const x=this.proxiedCoords[s.id]=[],b=this.proxyCoords;for(let S=0;S<b.length;S++){const k=b[S],P=this._findTileCoveringTileID(k,s);if(P){const O=this._createProxiedId(k,P,_[k.key]&&_[k.key][s.id]);x.push(O),this.proxyToSource[k.key][s.id]=[O]}}let E=!1;for(let S=0;S<h.length;S++){const k=s.getTile(h[S]);if(!k||!k.hasData())continue;const P=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==k.tileID.canonical.z){const O=this.proxyToSource[P.tileID.key][s.id],F=this._createProxiedId(P.tileID,k,_[P.tileID.key]&&_[P.tileID.key][s.id]);O?O.splice(O.length-1,0,F):this.proxyToSource[P.tileID.key][s.id]=[F],x.push(F),E=!0}}this._sourceTilesOverlap[s.id]=E}_setupProxiedCoordsForImageSource(s,h,_){if(!s.getSource().loaded())return;const x=this.proxiedCoords[s.id]=[],b=this.proxyCoords,E=s.getSource(),S=new l.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),k=E.coordinates.map(l.MercatorCoordinate.fromLngLat).reduce((O,F)=>(O.min.x=Math.min(O.min.x,F.x-S.x),O.min.y=Math.min(O.min.y,F.y-S.y),O.max.x=Math.max(O.max.x,F.x-S.x),O.max.y=Math.max(O.max.y,F.y-S.y),O),{min:new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new l.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(O,F)=>{const G=O.wrap+O.canonical.x/(1<<O.canonical.z),H=O.canonical.y/(1<<O.canonical.z),q=l.EXTENT/(1<<O.canonical.z),V=F.wrap+F.canonical.x/(1<<F.canonical.z),ie=F.canonical.y/(1<<F.canonical.z);return G+q<V+k.min.x||G>V+k.max.x||H+q<ie+k.min.y||H>ie+k.max.y};for(let O=0;O<b.length;O++){const F=b[O];for(let G=0;G<h.length;G++){const H=s.getTile(h[G]);if(!H||!H.hasData()||P(F,H.tileID))continue;const q=this._createProxiedId(F,H,_[F.key]&&_[F.key][s.id]),V=this.proxyToSource[F.key][s.id];V?V.push(q):this.proxyToSource[F.key][s.id]=[q],x.push(q)}}}_createProxiedId(s,h,_){let x=this.orthoMatrix;if(_){const b=_.find(E=>E.key===h.tileID.key);if(b)return b}if(h.tileID.key!==s.key){const b=s.canonical.z-h.tileID.canonical.z;let E,S,k;x=l.create();const P=h.tileID.wrap-s.wrap<<s.overscaledZ;b>0?(E=l.EXTENT>>b,S=E*((h.tileID.canonical.x<<b)-s.canonical.x+P),k=E*((h.tileID.canonical.y<<b)-s.canonical.y)):(E=l.EXTENT<<-b,S=l.EXTENT*(h.tileID.canonical.x-(s.canonical.x+P<<-b)),k=l.EXTENT*(h.tileID.canonical.y-(s.canonical.y<<-b))),l.ortho(x,0,E,0,E,0,1),l.translate(x,x,[S,k,0])}return new Gd(h.tileID,s.key,x)}_findTileCoveringTileID(s,h){let _=h.getTile(s);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[h.id],b=x[s.key];if(_=b?h.getTileByID(b):null,_&&_.hasData()||b===null)return _;let E=_?_.tileID:s,S=E.overscaledZ;const k=h.getSource().minzoom,P=[];if(!b){const F=h.getSource().maxzoom;if(s.canonical.z>=F){const G=s.canonical.z-F;h.getSource().reparseOverscaled?(S=Math.max(s.canonical.z+2,h.transform.tileZoom),E=new l.OverscaledTileID(S,s.wrap,F,s.canonical.x>>G,s.canonical.y>>G)):G!==0&&(S=F,E=new l.OverscaledTileID(S,s.wrap,F,s.canonical.x>>G,s.canonical.y>>G))}E.key!==s.key&&(P.push(E.key),_=h.getTile(E))}const O=F=>{P.forEach(G=>{x[G]=F}),P.length=0};for(S-=1;S>=k&&(!_||!_.hasData());S--){_&&O(_.tileID.key);const F=E.calculateScaledKey(S);if(_=h.getTileByID(F),_&&_.hasData())break;const G=x[F];if(G===null)break;G===void 0?P.push(F):_=h.getTileByID(G)}return O(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let _=this._tilesDirty[s];_||(_=this._tilesDirty[s]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(h){let _=0;const x=new l.StructArrayLayout2ui4,b=131;for(let E=1;E<129;E++){for(let S=1;S<129;S++)_=E*b+S,x.emplaceBack(_,_+1),x.emplaceBack(_,_+b),x.emplaceBack(_+1,_+b),E===128&&x.emplaceBack(_+b,_+b+1);x.emplaceBack(_+1,_+1+b)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=l.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Du(p){const s=[];for(let h=0;h<p.length;h++){if(p[h]===null)continue;const _=p[h].split(" ");s.push(_.pop())}return s}class Wl{static cacheKey(s,h,_){let x=`${s}${_?_.cacheKey:""}`;for(const b of h)x+=`/${b}`;return x}constructor(s,h,_,x,b,E){const S=s.gl;this.program=S.createProgram();const k=Du(_.staticAttributes),P=x?x.getBinderAttributes():[],O=k.concat(P),F=_.staticUniforms?Du(_.staticUniforms):[],G=x?x.getBinderUniforms():[],H=F.concat(G),q=[];for(const Q of H)q.indexOf(Q)<0&&q.push(Q);let V=x?x.defines():[];V=V.concat(E.map(Q=>`#define ${Q}`));const ie=V.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,$l,Au.fragmentSource,mo.fragmentSource,_.fragmentSource).join(`
`),Z=V.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,$l,Au.vertexSource,mo.vertexSource,ra.vertexSource,_.vertexSource).join(`
`),ee=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ee,ie),S.compileShader(ee),S.attachShader(this.program,ee);const te=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(te,Z),S.compileShader(te),S.attachShader(this.program,te),this.attributes={};const re={};this.numAttributes=O.length;for(let Q=0;Q<this.numAttributes;Q++)O[Q]&&(S.bindAttribLocation(this.program,Q,O[Q]),this.attributes[O[Q]]=Q);S.linkProgram(this.program),S.deleteShader(te),S.deleteShader(ee);for(let Q=0;Q<q.length;Q++){const ae=q[Q];if(ae&&!re[ae]){const ye=S.getUniformLocation(this.program,ae);ye&&(re[ae]=ye)}}this.fixedUniforms=b(s,re),this.binderUniforms=x?x.getUniforms(s,re):[],E.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Q,ae)=>({u_dem:new l.Uniform1i(Q,ae.u_dem),u_dem_prev:new l.Uniform1i(Q,ae.u_dem_prev),u_dem_unpack:new l.Uniform4f(Q,ae.u_dem_unpack),u_dem_tl:new l.Uniform2f(Q,ae.u_dem_tl),u_dem_scale:new l.Uniform1f(Q,ae.u_dem_scale),u_dem_tl_prev:new l.Uniform2f(Q,ae.u_dem_tl_prev),u_dem_scale_prev:new l.Uniform1f(Q,ae.u_dem_scale_prev),u_dem_size:new l.Uniform1f(Q,ae.u_dem_size),u_dem_lerp:new l.Uniform1f(Q,ae.u_dem_lerp),u_exaggeration:new l.Uniform1f(Q,ae.u_exaggeration),u_depth:new l.Uniform1i(Q,ae.u_depth),u_depth_size_inv:new l.Uniform2f(Q,ae.u_depth_size_inv),u_meter_to_dem:new l.Uniform1f(Q,ae.u_meter_to_dem),u_label_plane_matrix_inv:new l.UniformMatrix4f(Q,ae.u_label_plane_matrix_inv),u_tile_tl_up:new l.Uniform3f(Q,ae.u_tile_tl_up),u_tile_tr_up:new l.Uniform3f(Q,ae.u_tile_tr_up),u_tile_br_up:new l.Uniform3f(Q,ae.u_tile_br_up),u_tile_bl_up:new l.Uniform3f(Q,ae.u_tile_bl_up),u_tile_up_scale:new l.Uniform1f(Q,ae.u_tile_up_scale)}))(s,re)),E.indexOf("FOG")!==-1&&(this.fogUniforms=((Q,ae)=>({u_fog_matrix:new l.UniformMatrix4f(Q,ae.u_fog_matrix),u_fog_range:new l.Uniform2f(Q,ae.u_fog_range),u_fog_color:new l.Uniform4f(Q,ae.u_fog_color),u_fog_horizon_blend:new l.Uniform1f(Q,ae.u_fog_horizon_blend),u_fog_temporal_offset:new l.Uniform1f(Q,ae.u_fog_temporal_offset)}))(s,re))}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in h)_[x].set(h[x])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in h)_[x].location&&_[x].set(h[x])}}draw(s,h,_,x,b,E,S,k,P,O,F,G,H,q,V,ie){const Z=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(_),s.setStencilMode(x),s.setColorMode(b),s.setCullFace(E);for(const te of Object.keys(this.fixedUniforms))this.fixedUniforms[te].set(S[te]);q&&q.setUniforms(s,this.binderUniforms,G,{zoom:H});const ee={[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[h];for(const te of F.get()){const re=te.vaos||(te.vaos={});(re[k]||(re[k]=new Cu)).bind(s,this,P,q?q.getPaintVertexBuffers():[],O,te.vertexOffset,V,ie),Z.drawElements(h,te.primitiveLength*ee,Z.UNSIGNED_SHORT,te.primitiveOffset*ee*2)}}}function Hl(p,s,h){const _=1/Yi(h,1,s.transform.tileZoom),x=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,s.transform.tileZoom)/x,E=b*(h.tileID.canonical.x+h.tileID.wrap*x),S=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[E>>16,S>>16],u_pixel_coord_lower:[65535&E,65535&S]}}const qd=l.create(),Pu=(p,s,h,_,x,b,E,S,k)=>{const P=s.style.light,O=P.properties.get("position"),F=[O.x,O.y,O.z],G=l.create$1();P.properties.get("anchor")==="viewport"&&(l.fromRotation(G,-s.transform.angle),l.transformMat3(F,F,G));const H=P.properties.get("color"),q=s.transform,V={u_matrix:p,u_lightpos:F,u_lightintensity:P.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return q.projection.name==="globe"&&(V.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],V.u_zoom_transition=E,V.u_inv_rot_matrix=k,V.u_merc_center=S,V.u_up_dir=q.projection.upVector(new l.CanonicalTileID(0,0,0),S[0]*l.EXTENT,S[1]*l.EXTENT),V.u_height_lift=b),V},Ru=(p,s,h,_,x,b,E,S,k,P,O)=>{const F=Pu(p,s,h,_,x,S,k,P,O),G={u_height_factor:-Math.pow(2,x.overscaledZ)/E.tileSize/8};return l.extend(F,Hl(b,s,E),G)},Lu=p=>({u_matrix:p}),Ou=(p,s,h,_)=>l.extend(Lu(p),Hl(h,s,_)),zu=(p,s)=>({u_matrix:p,u_world:s}),Jm=(p,s,h,_,x)=>l.extend(Ou(p,s,h,_),{u_world:x}),Qm=l.create(),Va=(p,s,h,_,x,b)=>{const E=p.transform,S=E.projection.name==="globe";let k;if(b.paint.get("circle-pitch-alignment")==="map")if(S){const O=l.globePixelsToTileUnits(E.zoom,s.canonical);k=Float32Array.from([O,0,0,O])}else k=E.calculatePixelsToTileUnitsMatrix(h);else k=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:p.translatePosMatrix(s.projMatrix,h,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:l.exported.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:Qm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return S&&(P.u_inv_rot_matrix=_,P.u_merc_center=x,P.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],P.u_zoom_transition=l.globeToMercatorTransition(E.zoom),P.u_up_dir=E.projection.upVector(s.canonical,x[0],x[1])),P},ex=p=>{const s=[];return p.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),p.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s},tx=(p,s,h)=>{const _=l.EXTENT/h.tileSize;return{u_matrix:p,u_camera_to_center_distance:s.cameraToCenterDistance,u_extrude_scale:[s.pixelsToGLUnits[0]/_,s.pixelsToGLUnits[1]/_]}},e_=(p,s,h=1)=>({u_matrix:p,u_color:s,u_overlay:0,u_overlay_scale:h}),ix=l.create(),nx=(p,s,h,_,x,b,E)=>{const S=p.transform,k=S.projection.name==="globe",P=k?l.globePixelsToTileUnits(S.zoom,s.canonical):Yi(h,1,b),O={u_matrix:s.projMatrix,u_extrude_scale:P,u_intensity:E,u_inv_rot_matrix:ix,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return k&&(O.u_inv_rot_matrix=_,O.u_merc_center=x,O.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],O.u_zoom_transition=l.globeToMercatorTransition(S.zoom),O.u_up_dir=S.projection.upVector(s.canonical,x[0],x[1])),O},rx=(p,s,h,_,x,b,E)=>{const S=p.transform,k=S.calculatePixelsToTileUnitsMatrix(s),P={u_matrix:sa(p,s,h,x),u_pixels_to_tile_units:k,u_device_pixel_ratio:E,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Hd(h)){const O=Nu(s,p.transform);P.u_texsize=s.lineAtlasTexture.size,P.u_scale=[O,_.fromScale,_.toScale],P.u_mix=_.t}return P},Wd=(p,s,h,_,x,b)=>{const E=p.transform,S=Nu(s,E);return{u_matrix:sa(p,s,h,x),u_texsize:s.imageAtlasTexture.size,u_pixels_to_tile_units:E.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:b,u_image:0,u_scale:[S,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Nu(p,s){return 1/Yi(p,1,s.tileZoom)}function sa(p,s,h,_){return p.translatePosMatrix(_||s.tileID.projMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function Hd(p){const s=p.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}const t_=(p,s,h,_,x,b)=>{return{u_matrix:p,u_tl_parent:s,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(S=x.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(E=x.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Kd(x.paint.get("raster-hue-rotate")),u_perspective_transform:b};var E,S};function Kd(p){p*=Math.PI/180;const s=Math.sin(p),h=Math.cos(p);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const go=l.create(),Zd=(p,s,h,_,x,b,E,S,k,P,O,F,G,H)=>{const q=x.transform,V={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:q.width/q.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:S,u_is_text:+k,u_pitch_with_map:+_,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:go,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:go};return q.projection.name==="globe"&&(V.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],V.u_zoom_transition=F,V.u_inv_rot_matrix=H,V.u_merc_center=G,V.u_camera_forward=q._camera.forward(),V.u_ecef_origin=l.globeECEFOrigin(q.globeMatrix,O.toUnwrapped()),V.u_tile_matrix=Float32Array.from(q.globeMatrix)),V},oa=(p,s,h,_,x,b,E,S,k,P,O,F,G,H,q)=>{const{cameraToCenterDistance:V,_pitch:ie}=x.transform;return l.extend(Zd(p,s,h,_,x,b,E,S,k,P,F,G,H,q),{u_gamma_scale:_?V*Math.cos(x.terrain?0:ie):1,u_device_pixel_ratio:l.exported.devicePixelRatio,u_is_halo:+O})},$a=(p,s,h,_,x,b,E,S,k,P,O,F,G,H)=>l.extend(oa(p,s,h,_,x,b,E,S,!0,k,!0,O,F,G,H),{u_texsize_icon:P,u_texture_icon:1}),i_=(p,s,h)=>({u_matrix:p,u_opacity:s,u_color:h}),Xd=(p,s,h,_,x,b)=>l.extend(function(E,S,k,P){const O=k.imageManager.getPattern(E.from.toString()),F=k.imageManager.getPattern(E.to.toString()),{width:G,height:H}=k.imageManager.getPixelSize(),q=Math.pow(2,P.tileID.overscaledZ),V=P.tileSize*Math.pow(2,k.transform.tileZoom)/q,ie=V*(P.tileID.canonical.x+P.tileID.wrap*q),Z=V*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[G,H],u_mix:S.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/Yi(P,1,k.transform.tileZoom),u_pixel_coord_upper:[ie>>16,Z>>16],u_pixel_coord_lower:[65535&ie,65535&Z]}}(_,b,h,x),{u_matrix:p,u_opacity:s}),ki={fillExtrusion:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_lightpos:new l.Uniform3f(p,s.u_lightpos),u_lightintensity:new l.Uniform1f(p,s.u_lightintensity),u_lightcolor:new l.Uniform3f(p,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(p,s.u_vertical_gradient),u_opacity:new l.Uniform1f(p,s.u_opacity),u_tile_id:new l.Uniform3f(p,s.u_tile_id),u_zoom_transition:new l.Uniform1f(p,s.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(p,s.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,s.u_merc_center),u_up_dir:new l.Uniform3f(p,s.u_up_dir),u_height_lift:new l.Uniform1f(p,s.u_height_lift)}),fillExtrusionPattern:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_lightpos:new l.Uniform3f(p,s.u_lightpos),u_lightintensity:new l.Uniform1f(p,s.u_lightintensity),u_lightcolor:new l.Uniform3f(p,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(p,s.u_vertical_gradient),u_height_factor:new l.Uniform1f(p,s.u_height_factor),u_tile_id:new l.Uniform3f(p,s.u_tile_id),u_zoom_transition:new l.Uniform1f(p,s.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(p,s.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,s.u_merc_center),u_up_dir:new l.Uniform3f(p,s.u_up_dir),u_height_lift:new l.Uniform1f(p,s.u_height_lift),u_image:new l.Uniform1i(p,s.u_image),u_texsize:new l.Uniform2f(p,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(p,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(p,s.u_scale),u_fade:new l.Uniform1f(p,s.u_fade),u_opacity:new l.Uniform1f(p,s.u_opacity)}),fill:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix)}),fillPattern:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_image:new l.Uniform1i(p,s.u_image),u_texsize:new l.Uniform2f(p,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(p,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(p,s.u_scale),u_fade:new l.Uniform1f(p,s.u_fade)}),fillOutline:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_world:new l.Uniform2f(p,s.u_world)}),fillOutlinePattern:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_world:new l.Uniform2f(p,s.u_world),u_image:new l.Uniform1i(p,s.u_image),u_texsize:new l.Uniform2f(p,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(p,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(p,s.u_scale),u_fade:new l.Uniform1f(p,s.u_fade)}),circle:(p,s)=>({u_camera_to_center_distance:new l.Uniform1f(p,s.u_camera_to_center_distance),u_extrude_scale:new l.UniformMatrix2f(p,s.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(p,s.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_inv_rot_matrix:new l.UniformMatrix4f(p,s.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,s.u_merc_center),u_tile_id:new l.Uniform3f(p,s.u_tile_id),u_zoom_transition:new l.Uniform1f(p,s.u_zoom_transition),u_up_dir:new l.Uniform3f(p,s.u_up_dir)}),collisionBox:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_camera_to_center_distance:new l.Uniform1f(p,s.u_camera_to_center_distance),u_extrude_scale:new l.Uniform2f(p,s.u_extrude_scale)}),collisionCircle:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_inv_matrix:new l.UniformMatrix4f(p,s.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(p,s.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(p,s.u_viewport_size)}),debug:(p,s)=>({u_color:new l.UniformColor(p,s.u_color),u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_overlay:new l.Uniform1i(p,s.u_overlay),u_overlay_scale:new l.Uniform1f(p,s.u_overlay_scale)}),clippingMask:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix)}),heatmap:(p,s)=>({u_extrude_scale:new l.Uniform1f(p,s.u_extrude_scale),u_intensity:new l.Uniform1f(p,s.u_intensity),u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_inv_rot_matrix:new l.UniformMatrix4f(p,s.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,s.u_merc_center),u_tile_id:new l.Uniform3f(p,s.u_tile_id),u_zoom_transition:new l.Uniform1f(p,s.u_zoom_transition),u_up_dir:new l.Uniform3f(p,s.u_up_dir)}),heatmapTexture:(p,s)=>({u_image:new l.Uniform1i(p,s.u_image),u_color_ramp:new l.Uniform1i(p,s.u_color_ramp),u_opacity:new l.Uniform1f(p,s.u_opacity)}),hillshade:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_image:new l.Uniform1i(p,s.u_image),u_latrange:new l.Uniform2f(p,s.u_latrange),u_light:new l.Uniform2f(p,s.u_light),u_shadow:new l.UniformColor(p,s.u_shadow),u_highlight:new l.UniformColor(p,s.u_highlight),u_accent:new l.UniformColor(p,s.u_accent)}),hillshadePrepare:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_image:new l.Uniform1i(p,s.u_image),u_dimension:new l.Uniform2f(p,s.u_dimension),u_zoom:new l.Uniform1f(p,s.u_zoom),u_unpack:new l.Uniform4f(p,s.u_unpack)}),line:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_pixels_to_tile_units:new l.UniformMatrix2f(p,s.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(p,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(p,s.u_units_to_pixels),u_dash_image:new l.Uniform1i(p,s.u_dash_image),u_gradient_image:new l.Uniform1i(p,s.u_gradient_image),u_image_height:new l.Uniform1f(p,s.u_image_height),u_texsize:new l.Uniform2f(p,s.u_texsize),u_scale:new l.Uniform3f(p,s.u_scale),u_mix:new l.Uniform1f(p,s.u_mix),u_alpha_discard_threshold:new l.Uniform1f(p,s.u_alpha_discard_threshold)}),linePattern:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_texsize:new l.Uniform2f(p,s.u_texsize),u_pixels_to_tile_units:new l.UniformMatrix2f(p,s.u_pixels_to_tile_units),u_device_pixel_ratio:new l.Uniform1f(p,s.u_device_pixel_ratio),u_image:new l.Uniform1i(p,s.u_image),u_units_to_pixels:new l.Uniform2f(p,s.u_units_to_pixels),u_scale:new l.Uniform3f(p,s.u_scale),u_fade:new l.Uniform1f(p,s.u_fade),u_alpha_discard_threshold:new l.Uniform1f(p,s.u_alpha_discard_threshold)}),raster:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_tl_parent:new l.Uniform2f(p,s.u_tl_parent),u_scale_parent:new l.Uniform1f(p,s.u_scale_parent),u_fade_t:new l.Uniform1f(p,s.u_fade_t),u_opacity:new l.Uniform1f(p,s.u_opacity),u_image0:new l.Uniform1i(p,s.u_image0),u_image1:new l.Uniform1i(p,s.u_image1),u_brightness_low:new l.Uniform1f(p,s.u_brightness_low),u_brightness_high:new l.Uniform1f(p,s.u_brightness_high),u_saturation_factor:new l.Uniform1f(p,s.u_saturation_factor),u_contrast_factor:new l.Uniform1f(p,s.u_contrast_factor),u_spin_weights:new l.Uniform3f(p,s.u_spin_weights),u_perspective_transform:new l.Uniform2f(p,s.u_perspective_transform)}),symbolIcon:(p,s)=>({u_is_size_zoom_constant:new l.Uniform1i(p,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(p,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(p,s.u_size_t),u_size:new l.Uniform1f(p,s.u_size),u_camera_to_center_distance:new l.Uniform1f(p,s.u_camera_to_center_distance),u_rotate_symbol:new l.Uniform1i(p,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(p,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(p,s.u_fade_change),u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(p,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(p,s.u_coord_matrix),u_is_text:new l.Uniform1i(p,s.u_is_text),u_pitch_with_map:new l.Uniform1i(p,s.u_pitch_with_map),u_texsize:new l.Uniform2f(p,s.u_texsize),u_tile_id:new l.Uniform3f(p,s.u_tile_id),u_zoom_transition:new l.Uniform1f(p,s.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(p,s.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,s.u_merc_center),u_camera_forward:new l.Uniform3f(p,s.u_camera_forward),u_tile_matrix:new l.UniformMatrix4f(p,s.u_tile_matrix),u_ecef_origin:new l.Uniform3f(p,s.u_ecef_origin),u_texture:new l.Uniform1i(p,s.u_texture)}),symbolSDF:(p,s)=>({u_is_size_zoom_constant:new l.Uniform1i(p,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(p,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(p,s.u_size_t),u_size:new l.Uniform1f(p,s.u_size),u_camera_to_center_distance:new l.Uniform1f(p,s.u_camera_to_center_distance),u_rotate_symbol:new l.Uniform1i(p,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(p,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(p,s.u_fade_change),u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(p,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(p,s.u_coord_matrix),u_is_text:new l.Uniform1i(p,s.u_is_text),u_pitch_with_map:new l.Uniform1i(p,s.u_pitch_with_map),u_texsize:new l.Uniform2f(p,s.u_texsize),u_texture:new l.Uniform1i(p,s.u_texture),u_gamma_scale:new l.Uniform1f(p,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(p,s.u_device_pixel_ratio),u_tile_id:new l.Uniform3f(p,s.u_tile_id),u_zoom_transition:new l.Uniform1f(p,s.u_zoom_transition),u_inv_rot_matrix:new l.UniformMatrix4f(p,s.u_inv_rot_matrix),u_merc_center:new l.Uniform2f(p,s.u_merc_center),u_camera_forward:new l.Uniform3f(p,s.u_camera_forward),u_tile_matrix:new l.UniformMatrix4f(p,s.u_tile_matrix),u_ecef_origin:new l.Uniform3f(p,s.u_ecef_origin),u_is_halo:new l.Uniform1i(p,s.u_is_halo)}),symbolTextAndIcon:(p,s)=>({u_is_size_zoom_constant:new l.Uniform1i(p,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(p,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(p,s.u_size_t),u_size:new l.Uniform1f(p,s.u_size),u_camera_to_center_distance:new l.Uniform1f(p,s.u_camera_to_center_distance),u_rotate_symbol:new l.Uniform1i(p,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(p,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(p,s.u_fade_change),u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(p,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(p,s.u_coord_matrix),u_is_text:new l.Uniform1i(p,s.u_is_text),u_pitch_with_map:new l.Uniform1i(p,s.u_pitch_with_map),u_texsize:new l.Uniform2f(p,s.u_texsize),u_texsize_icon:new l.Uniform2f(p,s.u_texsize_icon),u_texture:new l.Uniform1i(p,s.u_texture),u_texture_icon:new l.Uniform1i(p,s.u_texture_icon),u_gamma_scale:new l.Uniform1f(p,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(p,s.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(p,s.u_is_halo)}),background:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_opacity:new l.Uniform1f(p,s.u_opacity),u_color:new l.UniformColor(p,s.u_color)}),backgroundPattern:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_opacity:new l.Uniform1f(p,s.u_opacity),u_image:new l.Uniform1i(p,s.u_image),u_pattern_tl_a:new l.Uniform2f(p,s.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(p,s.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(p,s.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(p,s.u_pattern_br_b),u_texsize:new l.Uniform2f(p,s.u_texsize),u_mix:new l.Uniform1f(p,s.u_mix),u_pattern_size_a:new l.Uniform2f(p,s.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(p,s.u_pattern_size_b),u_scale_a:new l.Uniform1f(p,s.u_scale_a),u_scale_b:new l.Uniform1f(p,s.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(p,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(p,s.u_tile_units_to_pixels)}),terrainRaster:Vd,terrainDepth:Vd,skybox:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_sun_direction:new l.Uniform3f(p,s.u_sun_direction),u_cubemap:new l.Uniform1i(p,s.u_cubemap),u_opacity:new l.Uniform1f(p,s.u_opacity),u_temporal_offset:new l.Uniform1f(p,s.u_temporal_offset)}),skyboxGradient:(p,s)=>({u_matrix:new l.UniformMatrix4f(p,s.u_matrix),u_color_ramp:new l.Uniform1i(p,s.u_color_ramp),u_center_direction:new l.Uniform3f(p,s.u_center_direction),u_radius:new l.Uniform1f(p,s.u_radius),u_opacity:new l.Uniform1f(p,s.u_opacity),u_temporal_offset:new l.Uniform1f(p,s.u_temporal_offset)}),skyboxCapture:(p,s)=>({u_matrix_3f:new l.UniformMatrix3f(p,s.u_matrix_3f),u_sun_direction:new l.Uniform3f(p,s.u_sun_direction),u_sun_intensity:new l.Uniform1f(p,s.u_sun_intensity),u_color_tint_r:new l.Uniform4f(p,s.u_color_tint_r),u_color_tint_m:new l.Uniform4f(p,s.u_color_tint_m),u_luminance:new l.Uniform1f(p,s.u_luminance)}),globeRaster:(p,s)=>({u_proj_matrix:new l.UniformMatrix4f(p,s.u_proj_matrix),u_globe_matrix:new l.UniformMatrix4f(p,s.u_globe_matrix),u_merc_matrix:new l.UniformMatrix4f(p,s.u_merc_matrix),u_zoom_transition:new l.Uniform1f(p,s.u_zoom_transition),u_merc_center:new l.Uniform2f(p,s.u_merc_center),u_image0:new l.Uniform1i(p,s.u_image0),u_grid_matrix:new l.UniformMatrix3f(p,s.u_grid_matrix)}),globeAtmosphere:(p,s)=>({u_frustum_tl:new l.Uniform3f(p,s.u_frustum_tl),u_frustum_tr:new l.Uniform3f(p,s.u_frustum_tr),u_frustum_br:new l.Uniform3f(p,s.u_frustum_br),u_frustum_bl:new l.Uniform3f(p,s.u_frustum_bl),u_globe_pos:new l.Uniform3f(p,s.u_globe_pos),u_globe_radius:new l.Uniform1f(p,s.u_globe_radius),u_opacity:new l.Uniform1f(p,s.u_opacity),u_fadeout_range:new l.Uniform1f(p,s.u_fadeout_range),u_start_color:new l.Uniform3f(p,s.u_start_color),u_end_color:new l.Uniform3f(p,s.u_end_color)})};let aa;function n_(p,s,h,_,x,b,E){const S=p.context,k=S.gl,P=p.useProgram("collisionBox"),O=[];let F=0,G=0;for(let te=0;te<_.length;te++){const re=_[te],Q=s.getTile(re),ae=Q.getBucket(h);if(!ae)continue;let ye=re.projMatrix;x[0]===0&&x[1]===0||(ye=p.translatePosMatrix(re.projMatrix,Q,x,b));const Te=E?ae.textCollisionBox:ae.iconCollisionBox,Me=ae.collisionCircleArray;if(Me.length>0){const Ae=l.create(),We=ye;l.mul(Ae,ae.placementInvProjMatrix,p.transform.glCoordMatrix),l.mul(Ae,Ae,ae.placementViewportMatrix),O.push({circleArray:Me,circleOffset:G,transform:We,invTransform:Ae}),F+=Me.length/4,G=F}Te&&(p.terrain&&p.terrain.setupElevationDraw(Q,P),P.draw(S,k.LINES,l.DepthMode.disabled,l.StencilMode.disabled,p.colorModeForRenderPass(),l.CullFaceMode.disabled,tx(ye,p.transform,Q),h.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,p.transform.zoom,null,Te.collisionVertexBuffer,Te.collisionVertexBufferExt))}if(!E||!O.length)return;const H=p.useProgram("collisionCircle"),q=new l.StructArrayLayout2f1f2i16;q.resize(4*F),q._trim();let V=0;for(const te of O)for(let re=0;re<te.circleArray.length/4;re++){const Q=4*re,ae=te.circleArray[Q+0],ye=te.circleArray[Q+1],Te=te.circleArray[Q+2],Me=te.circleArray[Q+3];q.emplace(V++,ae,ye,Te,Me,0),q.emplace(V++,ae,ye,Te,Me,1),q.emplace(V++,ae,ye,Te,Me,2),q.emplace(V++,ae,ye,Te,Me,3)}(!aa||aa.length<2*F)&&(aa=function(te){const re=2*te,Q=new l.StructArrayLayout3ui6;Q.resize(re),Q._trim();for(let ae=0;ae<re;ae++){const ye=6*ae;Q.uint16[ye+0]=4*ae+0,Q.uint16[ye+1]=4*ae+1,Q.uint16[ye+2]=4*ae+2,Q.uint16[ye+3]=4*ae+2,Q.uint16[ye+4]=4*ae+3,Q.uint16[ye+5]=4*ae+0}return Q}(F));const ie=S.createIndexBuffer(aa,!0),Z=S.createVertexBuffer(q,l.collisionCircleLayout.members,!0);for(const te of O){const re={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(ee=p.transform).cameraToCenterDistance,u_viewport_size:[ee.width,ee.height]};H.draw(S,k.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,p.colorModeForRenderPass(),l.CullFaceMode.disabled,re,h.id,Z,ie,l.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,p.transform.zoom,null,null,null)}var ee;Z.destroy(),ie.destroy()}const Yd=l.create();function Kl(p,s,h,_,x,b){const{horizontalAlign:E,verticalAlign:S}=l.getAnchorAlignment(p),k=-(E-.5)*s,P=-(S-.5)*h,O=l.evaluateVariableOffset(p,_);return new l.pointGeometry((k/x+O[0])*b,(P/x+O[1])*b)}function sx(p,s,h,_,x,b,E,S,k,P,O,F){const G=p.text.placedSymbolArray,H=p.text.dynamicLayoutVertexArray,q=p.icon.dynamicLayoutVertexArray,V={},ie=S.projMatrix,Z=b.elevation,ee=F.upVectorScale(S.canonical,b.center.lat,b.worldSize);H.clear();for(let te=0;te<G.length;te++){const re=G.get(te),Q=p.allowVerticalPlacement&&!re.placedOrientation,ae=re.hidden||!re.crossTileID||Q?null:_[re.crossTileID];if(ae){const ye=new l.pointGeometry(re.tileAnchorX,re.tileAnchorY),Te=F.upVector(S.canonical,ye.x,ye.y),Me=Z?Z.getAtTileOffset(S,ye.x,ye.y):0,Ae=qr([re.projectedAnchorX+Me*Te[0]*ee.metersToTile,re.projectedAnchorY+Me*Te[1]*ee.metersToTile,re.projectedAnchorZ+Me*Te[2]*ee.metersToTile],h?ie:E),We=tn(b.cameraToCenterDistance,Ae.signedDistanceFromCamera);let ve=x.evaluateSizeForFeature(p.textSizeData,P,re)*We/l.ONE_EM;h&&(ve*=p.tilePixelRatio/k);const{width:He,height:$e,anchor:mt,textOffset:ke,textScale:ht}=ae,St=Kl(mt,He,$e,ke,ht,ve),dt=h?ir(ye.add(St),E,Me*ee.metersToLabelSpace).point:Ae.point.add(s?St.rotate(-b.angle):St),ft=p.allowVerticalPlacement&&re.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let Dt=0;Dt<re.numGlyphs;Dt++)l.addDynamicAttributes(H,dt,ft);O&&re.associatedIconIndex>=0&&(V[re.associatedIconIndex]={shiftedAnchor:dt,angle:ft})}else Tn(re.numGlyphs,H)}if(O){q.clear();const te=p.icon.placedSymbolArray;for(let re=0;re<te.length;re++){const Q=te.get(re);if(Q.hidden)Tn(Q.numGlyphs,q);else{const ae=V[re];if(ae)for(let ye=0;ye<Q.numGlyphs;ye++)l.addDynamicAttributes(q,ae.shiftedAnchor,ae.angle);else Tn(Q.numGlyphs,q)}}p.icon.dynamicLayoutVertexBuffer.updateData(q)}p.text.dynamicLayoutVertexBuffer.updateData(H)}function ox(p,s,h){return h.iconsInText&&s?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Jd(p,s,h,_,x,b,E,S,k,P,O,F){const G=p.context,H=G.gl,q=p.transform,V=S==="map",ie=k==="map",Z=V&&h.layout.get("symbol-placement")!=="point",ee=V&&!ie&&!Z,te=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let re=!1;const Q=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),ae=[l.mercatorXfromLng(q.center.lng),l.mercatorYfromLat(q.center.lat)],ye=h.layout.get("text-variable-anchor"),Te=q.projection.name==="globe",Me=Te?l.globeToMercatorTransition(q.zoom):0,Ae=[],We=[];p.terrain&&ie&&We.push("PITCH_WITH_MAP_TERRAIN"),Te&&We.push("PROJECTION_GLOBE_VIEW");for(const ve of _){const He=s.getTile(ve),$e=He.getBucket(h);if(!$e||$e.projection!==q.projection.name)continue;const mt=x?$e.text:$e.icon;if(!mt||$e.fullyClipped||!mt.segments.get().length)continue;const ke=mt.programConfigurations.get(h.id),ht=x||$e.sdfIcons,St=x?$e.textSizeData:$e.iconSizeData,dt=ie||q.pitch!==0,ft=l.evaluateSizeForZoom(St,q.zoom);let Dt,Gt,Et,Ot,pi=[0,0],nn=null;if(x){if(Gt=He.glyphAtlasTexture,Et=H.LINEAR,Dt=He.glyphAtlasTexture.size,$e.iconsInText){pi=He.imageAtlasTexture.size,nn=He.imageAtlasTexture;const Or=St.kind==="composite"||St.kind==="camera";Ot=dt||p.options.rotating||p.options.zooming||Or?H.LINEAR:H.NEAREST}}else{const Or=h.layout.get("icon-size").constantOr(0)!==1||$e.iconsNeedLinear;Gt=He.imageAtlasTexture,Et=ht||p.options.rotating||p.options.zooming||Or||dt?H.LINEAR:H.NEAREST,Dt=He.imageAtlasTexture.size}const Gn=p.transform.calculatePixelsToTileUnitsMatrix(He),qn=ia(ve.projMatrix,He.tileID.canonical,ie,V,p.transform,Gn),Rr=p.terrain&&ie&&Z?l.invert(l.create(),qn):Yd,ps=Oa(ve.projMatrix,He.tileID.canonical,ie,V,p.transform,Gn),Xs=ye&&$e.hasTextData(),Eo=h.layout.get("icon-text-fit")!=="none"&&Xs&&$e.hasIconData();if(Z){const Or=q.elevation,ca=Or?Or.getAtTileOffsetFunc(ve,q.center.lat,q.worldSize,q.projection):R_=>[0,0,0];Fl($e,ve.projMatrix,p,x,qn,ps,ie,P,ca,ve)}const Ys=Z||x&&ye||Eo,an=p.translatePosMatrix(ve.projMatrix,He,b,E),un=Ys?Yd:qn,Ii=p.translatePosMatrix(ps,He,b,E,!0),bn=q.projection.createInversionMatrix(q,ve.canonical),Lr=Ys?We.concat(["PROJECTED_POS_ON_VIEWPORT"]):We,rn=ht&&h.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Kr;Kr=ht?$e.iconsInText?$a(St.kind,ft,ee,ie,p,an,un,Ii,Dt,pi,ve,Me,ae,bn):oa(St.kind,ft,ee,ie,p,an,un,Ii,x,Dt,!0,ve,Me,ae,bn):Zd(St.kind,ft,ee,ie,p,an,un,Ii,x,Dt,ve,Me,ae,bn);const uc={program:p.useProgram(ox(ht,x,$e),ke,Lr),buffers:mt,uniformValues:Kr,atlasTexture:Gt,atlasTextureIcon:nn,atlasInterpolation:Et,atlasInterpolationIcon:Ot,isSDF:ht,hasHalo:rn,tile:He,labelPlaneMatrixInv:Rr};if(te&&$e.canOverlap){re=!0;const Or=mt.segments.get();for(const ca of Or)Ae.push({segments:new l.SegmentVector([ca]),sortKey:ca.sortKey,state:uc})}else Ae.push({segments:mt.segments,sortKey:0,state:uc})}re&&Ae.sort((ve,He)=>ve.sortKey-He.sortKey);for(const ve of Ae){const He=ve.state;if(p.terrain&&p.terrain.setupElevationDraw(He.tile,He.program,{useDepthForOcclusion:!Te,labelPlaneMatrixInv:He.labelPlaneMatrixInv}),G.activeTexture.set(H.TEXTURE0),He.atlasTexture.bind(He.atlasInterpolation,H.CLAMP_TO_EDGE),He.atlasTextureIcon&&(G.activeTexture.set(H.TEXTURE1),He.atlasTextureIcon&&He.atlasTextureIcon.bind(He.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),He.isSDF){const $e=He.uniformValues;He.hasHalo&&($e.u_is_halo=1,r_(He.buffers,ve.segments,h,p,He.program,Q,O,F,$e)),$e.u_is_halo=0}r_(He.buffers,ve.segments,h,p,He.program,Q,O,F,He.uniformValues)}}function r_(p,s,h,_,x,b,E,S,k){const P=_.context;x.draw(P,P.gl.TRIANGLES,b,E,S,l.CullFaceMode.disabled,k,h.id,p.layoutVertexBuffer,p.indexBuffer,s,h.paint,_.transform.zoom,p.programConfigurations.get(h.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Fu(p,s,h,_,x,b,E){const S=p.context.gl,k=h.paint.get("fill-pattern"),P=k&&k.constantOr(1),O=h.getCrossfadeParameters();let F,G,H,q,V;E?(G=P&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(G=P?"fillPattern":"fill",F=S.TRIANGLES);for(const ie of _){const Z=s.getTile(ie);if(P&&!Z.patternsLoaded())continue;const ee=Z.getBucket(h);if(!ee)continue;p.prepareDrawTile();const te=ee.programConfigurations.get(h.id),re=p.useProgram(G,te);P&&(p.context.activeTexture.set(S.TEXTURE0),Z.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),te.updatePaintBuffers(O));const Q=k.constantOr(null);if(Q&&Z.imageAtlas){const ye=Z.imageAtlas,Te=ye.patternPositions[Q.to.toString()],Me=ye.patternPositions[Q.from.toString()];Te&&Me&&te.setConstantPatternPositions(Te,Me)}const ae=p.translatePosMatrix(ie.projMatrix,Z,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){q=ee.indexBuffer2,V=ee.segments2;const ye=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];H=G==="fillOutlinePattern"&&P?Jm(ae,p,O,Z,ye):zu(ae,ye)}else q=ee.indexBuffer,V=ee.segments,H=P?Ou(ae,p,O,Z):Lu(ae);p.prepareDrawProgram(p.context,re,ie.toUnwrapped()),re.draw(p.context,F,x,p.stencilModeForClipping(ie),b,l.CullFaceMode.disabled,H,h.id,ee.layoutVertexBuffer,q,V,h.paint,p.transform.zoom,te)}}function ja(p,s,h,_,x,b,E){const S=p.context,k=S.gl,P=p.transform,O=h.paint.get("fill-extrusion-pattern"),F=O.constantOr(1),G=h.getCrossfadeParameters(),H=h.paint.get("fill-extrusion-opacity"),q=function(te){if(te.projection.name!=="globe")return 0;const re=Math.PI/32,Q=Math.tan(re),ae=l.earthRadius;return ae*Math.sqrt(1+2*Q*Q)-ae}(P),V=P.projection.name==="globe",ie=V?l.globeToMercatorTransition(P.zoom):0,Z=[l.mercatorXfromLng(P.center.lng),l.mercatorYfromLat(P.center.lat)],ee=[];V&&ee.push("PROJECTION_GLOBE_VIEW");for(const te of _){const re=s.getTile(te),Q=re.getBucket(h);if(!Q||Q.projection!==P.projection.name)continue;const ae=Q.programConfigurations.get(h.id),ye=p.useProgram(F?"fillExtrusionPattern":"fillExtrusion",ae,ee);if(p.terrain){const He=p.terrain;if(p.style.terrainSetForDrapingOnly())He.setupElevationDraw(re,ye,{useMeterToDem:!0});else{if(!Q.enableTerrain)continue;if(He.setupElevationDraw(re,ye,{useMeterToDem:!0}),Zl(S,s,te,Q,h,He),!Q.centroidVertexBuffer){const $e=ye.attributes.a_centroid_pos;$e!==void 0&&k.vertexAttrib2f($e,0,0)}}}F&&(p.context.activeTexture.set(k.TEXTURE0),re.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ae.updatePaintBuffers(G));const Te=O.constantOr(null);if(Te&&re.imageAtlas){const He=re.imageAtlas,$e=He.patternPositions[Te.to.toString()],mt=He.patternPositions[Te.from.toString()];$e&&mt&&ae.setConstantPatternPositions($e,mt)}const Me=p.translatePosMatrix(te.projMatrix,re,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Ae=P.projection.createInversionMatrix(P,te.canonical),We=h.paint.get("fill-extrusion-vertical-gradient"),ve=F?Ru(Me,p,We,H,te,G,re,q,ie,Z,Ae):Pu(Me,p,We,H,te,q,ie,Z,Ae);p.prepareDrawProgram(S,ye,te.toUnwrapped()),ye.draw(S,S.gl.TRIANGLES,x,b,E,l.CullFaceMode.backCCW,ve,h.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,h.paint,p.transform.zoom,ae,p.terrain?Q.centroidVertexBuffer:null,V?Q.layoutVertexExtBuffer:null)}}function Zl(p,s,h,_,x,b){const E=[Z=>{let ee=Z.canonical.x-1,te=Z.wrap;return ee<0&&(ee=(1<<Z.canonical.z)-1,te--),new l.OverscaledTileID(Z.overscaledZ,te,Z.canonical.z,ee,Z.canonical.y)},Z=>{let ee=Z.canonical.x+1,te=Z.wrap;return ee===1<<Z.canonical.z&&(ee=0,te++),new l.OverscaledTileID(Z.overscaledZ,te,Z.canonical.z,ee,Z.canonical.y)},Z=>new l.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,(Z.canonical.y===0?1<<Z.canonical.z:Z.canonical.y)-1),Z=>new l.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y===(1<<Z.canonical.z)-1?0:Z.canonical.y+1)],S=Z=>{const ee=s.getSource().minzoom,te=Q=>{const ae=s.getTileByID(Q);if(ae&&ae.hasData())return ae.getBucket(x)},re=[0,-1,1];for(const Q of re){if(Z.overscaledZ+Q<ee)continue;const ae=te(Z.calculateScaledKey(Z.overscaledZ+Q));if(ae)return ae}},k=[0,0,0],P=(Z,ee)=>(k[0]=Math.min(Z.min.y,ee.min.y),k[1]=Math.max(Z.max.y,ee.max.y),k[2]=l.EXTENT-ee.min.x>Z.max.x?ee.min.x-l.EXTENT:Z.max.x,k),O=(Z,ee)=>(k[0]=Math.min(Z.min.x,ee.min.x),k[1]=Math.max(Z.max.x,ee.max.x),k[2]=l.EXTENT-ee.min.y>Z.max.y?ee.min.y-l.EXTENT:Z.max.y,k),F=[(Z,ee)=>P(Z,ee),(Z,ee)=>P(ee,Z),(Z,ee)=>O(Z,ee),(Z,ee)=>O(ee,Z)],G=new l.pointGeometry(0,0);let H,q,V;const ie=(Z,ee,te,re,Q)=>{const ae=[[re?te:Z,re?Z:te,0],[re?te:ee,re?ee:te,0]],ye=Q<0?l.EXTENT+Q:Q,Te=[re?ye:(Z+ee)/2,re?(Z+ee)/2:ye,0];return te===0&&Q<0||te!==0&&Q>0?b.getForTilePoints(V,[Te],!0,q):ae.push(Te),b.getForTilePoints(h,ae,!0,H),Math.max(ae[0][2],ae[1][2],Te[2])/b.exaggeration()};for(let Z=0;Z<4;Z++){const ee=(Z<2?1:5)-Z,te=_.borders[Z];if(te.length===0)continue;const re=V=E[Z](h),Q=S(re);if(!(Q&&Q instanceof l.FillExtrusionBucket&&Q.enableTerrain)||_.borderDoneWithNeighborZ[Z]===Q.canonical.z&&Q.borderDoneWithNeighborZ[ee]===_.canonical.z||(q=b.findDEMTileFor(re),!q||!q.dem))continue;if(!H){const Me=b.findDEMTileFor(h);if(!Me||!Me.dem)return;H=Me}const ae=Q.borders[ee];let ye=0;const Te=Q.borderDoneWithNeighborZ[ee]!==_.canonical.z;if(_.canonical.z===Q.canonical.z){for(let Me=0;Me<te.length;Me++){const Ae=_.featuresOnBorder[te[Me]],We=Ae.borders[Z];let ve;for(;ye<ae.length&&(ve=Q.featuresOnBorder[ae[ye]],!(ve.borders[ee][1]>We[0]+3));)Te&&Q.encodeCentroid(void 0,ve,!1),ye++;if(ve&&ye<ae.length){const He=ye;let $e=0;for(;!(ve.borders[ee][0]>We[1]-3)&&($e++,++ye!==ae.length);)ve=Q.featuresOnBorder[ae[ye]];if(ve=Q.featuresOnBorder[ae[He]],Ae.intersectsCount()>1||ve.intersectsCount()>1||$e!==1){$e!==1&&(ye=He),_.encodeCentroid(void 0,Ae,!1),Te&&Q.encodeCentroid(void 0,ve,!1);continue}const mt=F[Z](Ae,ve),ke=Z%2?l.EXTENT-1:0;G.x=ie(mt[0],Math.min(l.EXTENT-1,mt[1]),ke,Z<2,mt[2]),G.y=0,_.encodeCentroid(G,Ae,!1),Te&&Q.encodeCentroid(G,ve,!1)}else _.encodeCentroid(void 0,Ae,!1)}_.borderDoneWithNeighborZ[Z]=Q.canonical.z,_.needsCentroidUpdate=!0,Te&&(Q.borderDoneWithNeighborZ[ee]=_.canonical.z,Q.needsCentroidUpdate=!0)}else{for(const Me of te)_.encodeCentroid(void 0,_.featuresOnBorder[Me],!1);if(Te){for(const Me of ae)Q.encodeCentroid(void 0,Q.featuresOnBorder[Me],!1);Q.borderDoneWithNeighborZ[ee]=_.canonical.z,Q.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[Z]=Q.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(p)}const Qd=new l.Color(1,0,0,1),ef=new l.Color(0,1,0,1),s_=new l.Color(0,0,1,1),Bu=new l.Color(1,0,1,1),Uu=new l.Color(0,1,1,1);function st(p,s,h,_){Xl(p,0,s+h/2,p.transform.width,h,_)}function Wr(p,s,h,_){Xl(p,s-h/2,0,h,p.transform.height,_)}function Xl(p,s,h,_,x,b){const E=p.context,S=E.gl;S.enable(S.SCISSOR_TEST),S.scissor(s*l.exported.devicePixelRatio,h*l.exported.devicePixelRatio,_*l.exported.devicePixelRatio,x*l.exported.devicePixelRatio),E.clear({color:b}),S.disable(S.SCISSOR_TEST)}function o_(p,s,h){const _=p.context,x=_.gl,b=p.transform.projection.name==="globe",E=h.projMatrix,S=p.useProgram("debug",null,b?["PROJECTION_GLOBE_VIEW"]:null),k=s.getTileByID(h.key);p.terrain&&p.terrain.setupElevationDraw(k,S);const P=l.DepthMode.disabled,O=l.StencilMode.disabled,F=p.colorModeForRenderPass(),G="$debug";_.activeTexture.set(x.TEXTURE0),p.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),b?k._makeGlobeTileDebugBuffers(p.context,p.transform.projection):k._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const H=k._tileDebugBuffer||p.debugBuffer,q=k._tileDebugIndexBuffer||p.debugIndexBuffer,V=k._tileDebugSegments||p.debugSegments;S.draw(_,x.LINE_STRIP,P,O,F,l.CullFaceMode.disabled,e_(E,l.Color.red),G,H,q,V,null,null,null,k._globeTileDebugBorderBuffer);const ie=k.latestRawTileData,Z=Math.floor((ie&&ie.byteLength||0)/1024),ee=s.getTile(h).tileSize,te=512/Math.min(ee,512)*(h.overscaledZ/p.transform.zoom)*.5;let re=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(re+=` => ${h.overscaledZ}`),function(Te,Me){Te.initDebugOverlayCanvas();const Ae=Te.debugOverlayCanvas,We=Te.context.gl,ve=Te.debugOverlayCanvas.getContext("2d");ve.clearRect(0,0,Ae.width,Ae.height),ve.shadowColor="white",ve.shadowBlur=2,ve.lineWidth=1.5,ve.strokeStyle="white",ve.textBaseline="top",ve.font="bold 36px Open Sans, sans-serif",ve.fillText(Me,5,5),ve.strokeText(Me,5,5),Te.debugOverlayTexture.update(Ae),Te.debugOverlayTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE)}(p,`${re} ${Z}kb`);const Q=k._tileDebugTextBuffer||p.debugBuffer,ae=k._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,ye=k._tileDebugTextSegments||p.debugSegments;S.draw(_,x.TRIANGLES,P,O,l.ColorMode.alphaBlended,l.CullFaceMode.disabled,e_(E,l.Color.transparent,te),G,Q,ae,ye,null,null,null,k._globeTileDebugTextBuffer)}const a_=l.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ga}=a_;function Hs(p,s,h,_){p.emplaceBack(s,h,_)}class Yl{constructor(s){this.vertexArray=new l.StructArrayLayout3f12,this.indices=new l.StructArrayLayout3ui6,Hs(this.vertexArray,-1,-1,1),Hs(this.vertexArray,1,-1,1),Hs(this.vertexArray,-1,1,1),Hs(this.vertexArray,1,1,1),Hs(this.vertexArray,-1,-1,-1),Hs(this.vertexArray,1,-1,-1),Hs(this.vertexArray,-1,1,-1),Hs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Ga),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=l.SegmentVector.simpleSegment(0,0,36,12)}}function yo(p,s,h,_,x,b){const E=p.gl,S=s.paint.get("sky-atmosphere-color"),k=s.paint.get("sky-atmosphere-halo-color"),P=s.paint.get("sky-atmosphere-sun-intensity"),O=((F,G,H,q,V)=>({u_matrix_3f:F,u_sun_direction:G,u_sun_intensity:H,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(l.fromMat4(l.create$1(),_),x,P,S,k);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,s.skyboxTexture,0),h.draw(p,E.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,l.ColorMode.unblended,l.CullFaceMode.frontCW,O,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}function vo(p,s){return l.transformMat4(p,p,s)}const tf={symbol:function(p,s,h,_,x){if(p.renderPass!=="translucent")return;const b=l.StencilMode.disabled,E=p.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(S,k,P,O,F,G,H){const q=k.transform,V=F==="map",ie=G==="map";for(const Z of S){const ee=O.getTile(Z),te=ee.getBucket(P);if(!te||te.projection!==q.projection.name||!te.text||!te.text.segments.get().length)continue;const re=l.evaluateSizeForZoom(te.textSizeData,q.zoom),Q=k.transform.calculatePixelsToTileUnitsMatrix(ee),ae=ia(Z.projMatrix,ee.tileID.canonical,ie,V,k.transform,Q),ye=P.layout.get("icon-text-fit")!=="none"&&te.hasIconData();if(re){const Te=Math.pow(2,q.zoom-ee.tileID.overscaledZ);sx(te,V,ie,H,l.symbolSize,q,ae,Z,Te,re,ye,q.projection)}}}(_,p,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x),h.paint.get("icon-opacity").constantOr(1)!==0&&Jd(p,s,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),b,E),h.paint.get("text-opacity").constantOr(1)!==0&&Jd(p,s,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),b,E),s.map.showCollisionBoxes&&(n_(p,s,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),n_(p,s,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,h,_){if(p.renderPass!=="translucent")return;const x=h.paint.get("circle-opacity"),b=h.paint.get("circle-stroke-width"),E=h.paint.get("circle-stroke-opacity"),S=h.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;const k=p.context,P=k.gl,O=p.transform,F=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),G=l.StencilMode.disabled,H=p.colorModeForRenderPass(),q=O.projection.name==="globe",V=[l.mercatorXfromLng(O.center.lng),l.mercatorYfromLat(O.center.lat)],ie=[];for(let ee=0;ee<_.length;ee++){const te=_[ee],re=s.getTile(te),Q=re.getBucket(h);if(!Q)continue;const ae=Q.programConfigurations.get(h.id),ye=ex(h);q&&ye.push("PROJECTION_GLOBE_VIEW");const Te=p.useProgram("circle",ae,ye),Me=Q.layoutVertexBuffer,Ae=Q.globeExtVertexBuffer,We=Q.indexBuffer,ve=O.projection.createInversionMatrix(O,te.canonical),He={programConfiguration:ae,program:Te,layoutVertexBuffer:Me,globeExtVertexBuffer:Ae,indexBuffer:We,uniformValues:Va(p,te,re,ve,V,h),tile:re};if(S){const $e=Q.segments.get();for(const mt of $e)ie.push({segments:new l.SegmentVector([mt]),sortKey:mt.sortKey,state:He})}else ie.push({segments:Q.segments,sortKey:0,state:He})}S&&ie.sort((ee,te)=>ee.sortKey-te.sortKey);const Z={useDepthForOcclusion:!q};for(const ee of ie){const{programConfiguration:te,program:re,layoutVertexBuffer:Q,globeExtVertexBuffer:ae,indexBuffer:ye,uniformValues:Te,tile:Me}=ee.state,Ae=ee.segments;p.terrain&&p.terrain.setupElevationDraw(Me,re,Z),p.prepareDrawProgram(k,re,Me.tileID.toUnwrapped()),re.draw(k,P.TRIANGLES,F,G,H,l.CullFaceMode.disabled,Te,h.id,Q,ye,Ae,h.paint,O.zoom,te,q?ae:null)}},heatmap:function(p,s,h,_){if(h.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const x=p.context,b=x.gl,E=l.StencilMode.disabled,S=new l.ColorMode([b.ONE,b.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(G,H,q){const V=G.gl;G.activeTexture.set(V.TEXTURE1),G.viewport.set([0,0,H.width/4,H.height/4]);let ie=q.heatmapFbo;if(ie)V.bindTexture(V.TEXTURE_2D,ie.colorAttachment.get()),G.bindFramebuffer.set(ie.framebuffer);else{const Z=V.createTexture();V.bindTexture(V.TEXTURE_2D,Z),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),ie=q.heatmapFbo=G.createFramebuffer(H.width/4,H.height/4,!1),function(ee,te,re,Q){const ae=ee.gl;ae.texImage2D(ae.TEXTURE_2D,0,ae.RGBA,te.width/4,te.height/4,0,ae.RGBA,ee.extRenderToTextureHalfFloat?ee.extTextureHalfFloat.HALF_FLOAT_OES:ae.UNSIGNED_BYTE,null),Q.colorAttachment.set(re)}(G,H,Z,ie)}})(x,p,h),x.clear({color:l.Color.transparent});const k=p.transform,P=k.projection.name==="globe",O=P?["PROJECTION_GLOBE_VIEW"]:null,F=[l.mercatorXfromLng(k.center.lng),l.mercatorYfromLat(k.center.lat)];for(let G=0;G<_.length;G++){const H=_[G];if(s.hasRenderableParent(H))continue;const q=s.getTile(H),V=q.getBucket(h);if(!V)continue;const ie=V.programConfigurations.get(h.id),Z=p.useProgram("heatmap",ie,O),{zoom:ee}=p.transform;p.terrain&&p.terrain.setupElevationDraw(q,Z),p.prepareDrawProgram(x,Z,H.toUnwrapped());const te=k.projection.createInversionMatrix(k,H.canonical);Z.draw(x,b.TRIANGLES,l.DepthMode.disabled,E,S,l.CullFaceMode.disabled,nx(p,H,q,te,F,ee,h.paint.get("heatmap-intensity")),h.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,h.paint,p.transform.zoom,ie,P?V.globeExtVertexBuffer:null)}x.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(x,b){const E=x.context,S=E.gl,k=b.heatmapFbo;if(!k)return;E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get()),E.activeTexture.set(S.TEXTURE1);let P=b.colorRampTexture;P||(P=b.colorRampTexture=new l.Texture(E,b.colorRamp,S.RGBA)),P.bind(S.LINEAR,S.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(E,S.TRIANGLES,l.DepthMode.disabled,l.StencilMode.disabled,x.colorModeForRenderPass(),l.CullFaceMode.disabled,((O,F,G,H)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,b),b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(p,h))},line:function(p,s,h,_){if(p.renderPass!=="translucent")return;const x=h.paint.get("line-opacity"),b=h.paint.get("line-width");if(x.constantOr(1)===0||b.constantOr(1)===0)return;const E=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),S=p.colorModeForRenderPass(),k=p.terrain&&p.terrain.renderingToTexture?1:l.exported.devicePixelRatio,P=h.paint.get("line-dasharray"),O=P.constantOr(1),F=h.layout.get("line-cap"),G=h.paint.get("line-pattern"),H=G.constantOr(1),q=h.paint.get("line-gradient"),V=h.getCrossfadeParameters(),ie=H?"linePattern":"line",Z=p.context,ee=Z.gl,te=(Q=>{const ae=[];Hd(Q)&&ae.push("RENDER_LINE_DASH"),Q.paint.get("line-gradient")&&ae.push("RENDER_LINE_GRADIENT");const ye=Q.paint.get("line-pattern").constantOr(1),Te=Q.paint.get("line-opacity").constantOr(1)!==1;return!ye&&Te&&ae.push("RENDER_LINE_ALPHA_DISCARD"),ae})(h);let re=te.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(re=!1);for(const Q of _){const ae=s.getTile(Q);if(H&&!ae.patternsLoaded())continue;const ye=ae.getBucket(h);if(!ye)continue;p.prepareDrawTile();const Te=ye.programConfigurations.get(h.id),Me=p.useProgram(ie,Te,te),Ae=G.constantOr(null);if(Ae&&ae.imageAtlas){const ke=ae.imageAtlas,ht=ke.patternPositions[Ae.to.toString()],St=ke.patternPositions[Ae.from.toString()];ht&&St&&Te.setConstantPatternPositions(ht,St)}const We=P.constantOr(null),ve=F.constantOr(null);if(!H&&We&&ve&&ae.lineAtlas){const ke=ae.lineAtlas,ht=ke.getDash(We.to,ve),St=ke.getDash(We.from,ve);ht&&St&&Te.setConstantPatternPositions(ht,St)}const He=p.terrain?Q.projMatrix:null,$e=H?Wd(p,ae,h,V,He,k):rx(p,ae,h,V,He,ye.lineClipsArray.length,k);if(q){const ke=ye.gradients[h.id];let ht=ke.texture;if(h.gradientVersion!==ke.version){let St=256;if(h.stepInterpolant){const dt=s.getSource().maxzoom,ft=Q.canonical.z===dt?Math.ceil(1<<p.transform.maxZoom-Q.canonical.z):1;St=l.clamp(l.nextPowerOfTwo(ye.maxLineLength/l.EXTENT*1024*ft),256,Z.maxTextureSize)}ke.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:St,image:ke.gradient||void 0,clips:ye.lineClipsArray}),ke.texture?ke.texture.update(ke.gradient):ke.texture=new l.Texture(Z,ke.gradient,ee.RGBA),ke.version=h.gradientVersion,ht=ke.texture}Z.activeTexture.set(ee.TEXTURE1),ht.bind(h.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}O&&(Z.activeTexture.set(ee.TEXTURE0),ae.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),Te.updatePaintBuffers(V)),H&&(Z.activeTexture.set(ee.TEXTURE0),ae.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Te.updatePaintBuffers(V)),p.prepareDrawProgram(Z,Me,Q.toUnwrapped());const mt=ke=>{Me.draw(Z,ee.TRIANGLES,E,ke,S,l.CullFaceMode.disabled,$e,h.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,h.paint,p.transform.zoom,Te,ye.layoutVertexBuffer2)};if(re){const ke=p.stencilModeForClipping(Q).ref;ke===0&&p.terrain&&Z.clear({stencil:0});const ht={func:ee.EQUAL,mask:255};$e.u_alpha_discard_threshold=.8,mt(new l.StencilMode(ht,ke,255,ee.KEEP,ee.KEEP,ee.INVERT)),$e.u_alpha_discard_threshold=0,mt(new l.StencilMode(ht,ke,255,ee.KEEP,ee.KEEP,ee.KEEP))}else mt(p.stencilModeForClipping(Q))}re&&(p.resetStencilClippingMasks(),p.terrain&&Z.clear({stencil:0}))},fill:function(p,s,h,_){const x=h.paint.get("fill-color"),b=h.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const E=p.colorModeForRenderPass(),S=h.paint.get("fill-pattern"),k=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&x.constantOr(l.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===k){const P=p.depthModeForSublayer(1,p.renderPass==="opaque"?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly);Fu(p,s,h,_,P,E,!1)}if(p.renderPass==="translucent"&&h.paint.get("fill-antialias")){const P=p.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,l.DepthMode.ReadOnly);Fu(p,s,h,_,P,E,!0)}},"fill-extrusion":function(p,s,h,_){const x=h.paint.get("fill-extrusion-opacity");if(x!==0&&p.renderPass==="translucent"){const b=new l.DepthMode(p.context.gl.LEQUAL,l.DepthMode.ReadWrite,p.depthRangeFor3D);if(x!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))ja(p,s,h,_,b,l.StencilMode.disabled,l.ColorMode.disabled),ja(p,s,h,_,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const E=p.colorModeForRenderPass();ja(p,s,h,_,b,l.StencilMode.disabled,E)}}},hillshade:function(p,s,h,_){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const x=p.context,b=p.depthModeForSublayer(0,l.DepthMode.ReadOnly),E=p.colorModeForRenderPass(),S=p.terrain&&p.terrain.renderingToTexture,[k,P]=p.renderPass!=="translucent"||S?[{},_]:p.stencilConfigForOverlap(_);for(const O of P){const F=s.getTile(O);if(F.needsHillshadePrepare&&p.renderPass==="offscreen")Ud(p,F,h,b,l.StencilMode.disabled,E);else if(p.renderPass==="translucent"){const G=S&&p.terrain?p.terrain.stencilModeForRTTOverlap(O):k[O.overscaledZ];Zm(p,O,F,h,b,G,E)}}x.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,h,_,x,b){if(p.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!_.length)return;const E=p.context,S=E.gl,k=s.getSource(),P=p.useProgram("raster"),O=p.colorModeForRenderPass(),F=p.terrain&&p.terrain.renderingToTexture,[G,H]=k instanceof le||F?[{},_]:p.stencilConfigForOverlap(_),q=H[H.length-1].overscaledZ,V=!p.options.moving;for(const ie of H){const Z=F?l.DepthMode.disabled:p.depthModeForSublayer(ie.overscaledZ-q,h.paint.get("raster-opacity")===1?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly,S.LESS),ee=ie.toUnwrapped(),te=s.getTile(ie);if(F&&(!te||!te.hasData()))continue;const re=F?ie.projMatrix:p.transform.calculateProjMatrix(ee,V),Q=p.terrain&&F?p.terrain.stencilModeForRTTOverlap(ie):G[ie.overscaledZ],ae=b?0:h.paint.get("raster-fade-duration");te.registerFadeDuration(ae);const ye=s.findLoadedParent(ie,0),Te=jd(te,ye,s,p.transform,ae);let Me,Ae;p.terrain&&p.terrain.prepareDrawTile();const We=h.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;E.activeTexture.set(S.TEXTURE0),te.texture.bind(We,S.CLAMP_TO_EDGE),E.activeTexture.set(S.TEXTURE1),ye?(ye.texture.bind(We,S.CLAMP_TO_EDGE),Me=Math.pow(2,ye.tileID.overscaledZ-te.tileID.overscaledZ),Ae=[te.tileID.canonical.x*Me%1,te.tileID.canonical.y*Me%1]):te.texture.bind(We,S.CLAMP_TO_EDGE);const ve=t_(re,Ae||[0,0],Me||1,Te,h,k instanceof le?k.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(E,P,ee),k instanceof le)k.boundsBuffer&&k.boundsSegments&&P.draw(E,S.TRIANGLES,Z,l.StencilMode.disabled,O,l.CullFaceMode.disabled,ve,h.id,k.boundsBuffer,p.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:He,tileBoundsIndexBuffer:$e,tileBoundsSegments:mt}=p.getTileBoundsBuffers(te);P.draw(E,S.TRIANGLES,Z,Q,O,l.CullFaceMode.disabled,ve,h.id,He,$e,mt)}}p.resetStencilClippingMasks()},background:function(p,s,h,_){const x=h.paint.get("background-color"),b=h.paint.get("background-opacity");if(b===0)return;const E=p.context,S=E.gl,k=p.transform,P=k.tileSize,O=h.paint.get("background-pattern");if(p.isPatternMissing(O))return;const F=!O&&x.a===1&&b===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==F)return;const G=l.StencilMode.disabled,H=p.depthModeForSublayer(0,F==="opaque"?l.DepthMode.ReadWrite:l.DepthMode.ReadOnly),q=p.colorModeForRenderPass(),V=p.useProgram(O?"backgroundPattern":"background");let ie,Z=_;Z||(ie=p.getBackgroundTiles(),Z=Object.values(ie).map(te=>te.tileID)),O&&(E.activeTexture.set(S.TEXTURE0),p.imageManager.bind(p.context));const ee=h.getCrossfadeParameters();for(const te of Z){const re=te.toUnwrapped(),Q=_?te.projMatrix:p.transform.calculateProjMatrix(re);p.prepareDrawTile();const ae=s?s.getTile(te):ie?ie[te.key]:new l.Tile(te,P,k.zoom,p),ye=O?Xd(Q,b,p,O,{tileID:te,tileSize:P},ee):i_(Q,b,x);p.prepareDrawProgram(E,V,re);const{tileBoundsBuffer:Te,tileBoundsIndexBuffer:Me,tileBoundsSegments:Ae}=p.getTileBoundsBuffers(ae);V.draw(E,S.TRIANGLES,H,G,q,l.CullFaceMode.disabled,ye,h.id,Te,Me,Ae)}},sky:function(p,s,h){const _=p.transform,x=_.projection.name==="mercator"||_.projection.name==="globe"?1:l.smoothstep(7,8,_.zoom),b=h.paint.get("sky-opacity")*x;if(b===0)return;const E=p.context,S=h.paint.get("sky-type"),k=new l.DepthMode(E.gl.LEQUAL,l.DepthMode.ReadOnly,[0,1]),P=p.frameCounter/1e3%1;S==="atmosphere"?p.renderPass==="offscreen"?h.needsSkyboxCapture(p)&&(function(O,F,G,H){const q=O.context,V=q.gl;let ie=F.skyboxFbo;if(!ie){ie=F.skyboxFbo=q.createFramebuffer(32,32,!1),F.skyboxGeometry=new Yl(q),F.skyboxTexture=q.gl.createTexture(),V.bindTexture(V.TEXTURE_CUBE_MAP,F.skyboxTexture),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_CUBE_MAP,V.TEXTURE_MAG_FILTER,V.LINEAR);for(let re=0;re<6;++re)V.texImage2D(V.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,V.RGBA,32,32,0,V.RGBA,V.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(ie.framebuffer),q.viewport.set([0,0,32,32]);const Z=F.getCenter(O,!0),ee=O.useProgram("skyboxCapture"),te=new Float64Array(16);l.identity(te),l.rotateY(te,te,.5*-Math.PI),yo(q,F,ee,te,Z,0),l.identity(te),l.rotateY(te,te,.5*Math.PI),yo(q,F,ee,te,Z,1),l.identity(te),l.rotateX(te,te,.5*-Math.PI),yo(q,F,ee,te,Z,2),l.identity(te),l.rotateX(te,te,.5*Math.PI),yo(q,F,ee,te,Z,3),l.identity(te),yo(q,F,ee,te,Z,4),l.identity(te),l.rotateY(te,te,Math.PI),yo(q,F,ee,te,Z,5),q.viewport.set([0,0,O.width,O.height])}(p,h),h.markSkyboxValid(p)):p.renderPass==="sky"&&function(O,F,G,H,q){const V=O.context,ie=V.gl,Z=O.transform,ee=O.useProgram("skybox");V.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,F.skyboxTexture);const te=((re,Q,ae,ye,Te)=>({u_matrix:re,u_sun_direction:Q,u_cubemap:0,u_opacity:ye,u_temporal_offset:Te}))(Z.skyboxMatrix,F.getCenter(O,!1),0,H,q);O.prepareDrawProgram(V,ee),ee.draw(V,ie.TRIANGLES,G,l.StencilMode.disabled,O.colorModeForRenderPass(),l.CullFaceMode.backCW,te,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(p,h,k,b,P):S==="gradient"&&p.renderPass==="sky"&&function(O,F,G,H,q){const V=O.context,ie=V.gl,Z=O.transform,ee=O.useProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Yl(V)),V.activeTexture.set(ie.TEXTURE0);let te=F.colorRampTexture;te||(te=F.colorRampTexture=new l.Texture(V,F.colorRamp,ie.RGBA)),te.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const re=((Q,ae,ye,Te,Me)=>({u_matrix:Q,u_color_ramp:0,u_center_direction:ae,u_radius:l.degToRad(ye),u_opacity:Te,u_temporal_offset:Me}))(Z.skyboxMatrix,F.getCenter(O,!1),F.paint.get("sky-gradient-radius"),H,q);O.prepareDrawProgram(V,ee),ee.draw(V,ie.TRIANGLES,G,l.StencilMode.disabled,O.colorModeForRenderPass(),l.CullFaceMode.backCW,re,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(p,h,k,b,P)},debug:function(p,s,h){for(let _=0;_<h.length;_++)o_(p,s,h[_])},custom:function(p,s,h){const _=p.context,x=h.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))l.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(p.renderPass==="offscreen"){const b=x.prerender;b&&(p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),b.call(x,_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),_.setColorMode(p.colorModeForRenderPass()),_.setStencilMode(l.StencilMode.disabled);const b=x.renderingMode==="3d"?new l.DepthMode(p.context.gl.LEQUAL,l.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,l.DepthMode.ReadOnly);_.setDepthMode(b),x.render(_.gl,p.transform.customLayerMatrix()),_.setDirty(),p.setBaseState(),_.bindFramebuffer.set(null)}}};class l_{constructor(s,h){this.context=new N(s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=l.SourceCache.maxUnderzooming+l.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Su,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(s,h){const _=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new kr(this,s));const x=this._terrain;this.transform.elevation=_?x:null,x.update(s,this.transform,h)}_updateFog(s){const h=s.fog;if(!h||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=h.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const b=_+.78*(x-_);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,h){if(this.width=s*l.exported.devicePixelRatio,this.height=h*l.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const s=this.context,h=new l.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,l.posAttributes.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const _=new l.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(l.EXTENT,0),_.emplaceBack(0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=s.createVertexBuffer(_,l.posAttributes.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const x=new l.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,l.posAttributes.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const b=new l.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(l.EXTENT,0,l.EXTENT,0),b.emplaceBack(0,l.EXTENT,0,l.EXTENT),b.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.mercatorBoundsBuffer=s.createVertexBuffer(b,l.boundsAttributes.members),this.mercatorBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const E=new l.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(E);const S=new l.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])S.emplaceBack(P);this.debugIndexBuffer=s.createIndexBuffer(S),this.emptyTexture=new l.Texture(s,new l.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=l.create();const k=this.context.gl;this.stencilClearMode=new l.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(l.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(s,h.TRIANGLES,l.DepthMode.disabled,this.stencilClearMode,l.ColorMode.disabled,l.CullFaceMode.disabled,ku(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(s,h,_){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!_||_.length===0)return;const x=[];let b=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const O of _)if(this._tileClippingMaskIDs.has(O.key)||(b=!0),this._skippedStencilTileIDs.has(O.key)){if(!h.getTile(O).getBucket(s))continue;this._skippedStencilTileIDs.delete(O.key),x.push(O)}if(!b&&x.length===0)return}const E=this.context,S=E.gl;E.setColorMode(l.ColorMode.disabled),E.setDepthMode(l.DepthMode.disabled);const k=this.useProgram("clippingMask"),P=O=>{const F=h.getTile(O),{tileBoundsBuffer:G,tileBoundsIndexBuffer:H,tileBoundsSegments:q}=this.getTileBoundsBuffers(F);k.draw(E,S.TRIANGLES,l.DepthMode.disabled,new l.StencilMode({func:S.GREATER,mask:255},this._tileClippingMaskIDs.get(O.key)||0,255,S.KEEP,S.KEEP,S.REPLACE),l.ColorMode.disabled,l.CullFaceMode.disabled,ku(O.projMatrix),"$clipping",G,H,q)};if(!b&&x.length>0)for(const O of x)P(O);else{(this._tileClippingMaskIDs.size===0||this.nextStencilID+_.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const O of _)this._tileClippingMaskIDs.set(O.key,this.nextStencilID++),h.getTile(O).getBucket(s)?P(O):this._skippedStencilTileIDs.add(O.key)}this._skippedStencilTileIDs.size===0&&(this.currentStencilSource=h.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new l.StencilMode({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const h=this.context.gl;return new l.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs.get(s.key)||0,0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,_=s.sort((E,S)=>S.overscaledZ-E.overscaledZ),x=_[_.length-1].overscaledZ,b=_[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let S=0;S<b;S++)E[S+x]=new l.StencilMode({func:h.GEQUAL,mask:255},S+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[E,_]}return[{[x]:l.StencilMode.disabled},_]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new l.ColorMode([s.CONSTANT_COLOR,s.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?l.ColorMode.unblended:l.ColorMode.alphaBlended}depthModeForSublayer(s,h,_){if(!this.opaquePassEnabledForLayer())return l.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new l.DepthMode(_||this.context.gl.LEQUAL,h,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const P in x){const O=x[P];O.used&&O.prepare(this.context)}const b={},E={},S={};for(const P in x){const O=x[P];b[P]=O.getVisibleCoordinates(),E[P]=b[P].slice().reverse(),S[P]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<_.length;P++)if(this.style._layers[_[P]].is3D()){this.opaquePassCutoff=P;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new l.GlobeSharedBuffers(this.context)),!l.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const P of _){const O=this.style._layers[P],F=s._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const G=F?E[F.id]:void 0;(O.type==="custom"||O.isSky()||G&&G.length)&&this.renderLayer(this,F,O,G)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let k=l.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(k=this.style.fog.properties.get("color")),this.context.clear({color:h.showOverdrawInspector?l.Color.black:k,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[_[this.currentLayer]],O=s._getLayerSourceCache(P);if(P.isSky())continue;const F=O?E[O.id]:void 0;this._renderTileClippingMasks(P,O,F),this.renderLayer(this,O,P,F)}if(this.renderPass="sky",(l.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const P=this.style._layers[_[this.currentLayer]],O=s._getLayerSourceCache(P);P.isSky()&&this.renderLayer(this,O,P,O?E[O.id]:void 0)}for(this.transform.projection.name==="globe"&&function(P){const O=P.context,F=O.gl,G=P.transform,H=new l.DepthMode(F.LEQUAL,l.DepthMode.ReadOnly,[0,1]),q=P.useProgram("globeAtmosphere"),V=G.centerOffset,ie=G._camera.getCameraToClipPerspective(G._fov,G.width/G.height,G._nearZ,G._farZ);ie[8]=2*-V.x/G.width,ie[9]=2*V.y/G.height;const Z=l.invert([],ie),ee=l.mul([],Z,G.projMatrix),te={u_frustum_tl:vo([-1,1,1],Z),u_frustum_tr:vo([1,1,1],Z),u_frustum_br:vo([1,-1,1],Z),u_frustum_bl:vo([-1,-1,1],Z),u_globe_pos:vo([G.globeMatrix[12],G.globeMatrix[13],G.globeMatrix[14]],ee),u_globe_radius:G.worldSize/2/Math.PI-1,u_opacity:1-l.globeToMercatorTransition(G.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};P.prepareDrawProgram(O,q);const re=P.globeSharedBuffers;re&&q.draw(O,F.TRIANGLES,H,l.StencilMode.disabled,l.ColorMode.alphaBlended,l.CullFaceMode.backCW,te,"skybox",re.atmosphereVertexBuffer,re.atmosphereIndexBuffer,re.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const P=this.style._layers[_[this.currentLayer]],O=s._getLayerSourceCache(P);if(P.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(P)){if(P.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const F=O?(P.type==="symbol"?S:E)[O.id]:void 0;this._renderTileClippingMasks(P,O,O?b[O.id]:void 0),this.renderLayer(this,O,P,F),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let P=null;l.values(this.style._layers).forEach(O=>{const F=s._getLayerSourceCache(O);F&&!O.isHidden(this.transform.zoom)&&(!P||P.getSource().maxzoom<F.getSource().maxzoom)&&(P=F)}),P&&this.options.showTileBoundaries&&tf.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const O=P.transform.padding;st(P,P.transform.height-(O.top||0),3,Qd),st(P,O.bottom||0,3,ef),Wr(P,O.left||0,3,s_),Wr(P,P.transform.width-(O.right||0),3,Bu);const F=P.transform.centerPoint;(function(G,H,q,V){Xl(G,H-1,q-10,2,20,V),Xl(G,H-10,q-1,20,2,V)})(P,F.x,P.transform.height-F.y,Uu)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(l.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,h,_,x){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(_.type)||tf[_.type](s,h,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[s.id];_||(_=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const h={};for(const _ in s){const x=s[_],b=this.context.extTimerQuery,E=b.getQueryObjectEXT(x.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(x.query),h[_]=E}return h}translatePosMatrix(s,h,_,x,b){if(!_[0]&&!_[1])return s;const E=b?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const P=Math.sin(E),O=Math.cos(E);_=[_[0]*O-_[1]*P,_[0]*P+_[1]*O]}const S=[b?_[0]:Yi(h,_[0],this.transform.zoom),b?_[1]:Yi(h,_[1],this.transform.zoom),0],k=new Float32Array(16);return l.translate(k,s,S),k}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),_=this.imageManager.getPattern(s.to.toString());return!h||!_}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,h=this.style&&this.style.fog,_=[];return this.terrain&&!this.terrain.renderingToTexture&&_.push("TERRAIN"),h&&!s&&h.getOpacity(this.transform.pitch)!==0&&_.push("FOG"),s&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(s,h,_){this.cache=this.cache||{};const x=_||[],b=this.currentGlobalDefines().concat(x),E=Wl.cacheKey(s,b,h);return this.cache[E]||(this.cache[E]=new Wl(this.context,s,jl[s],h,ki[s],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=l.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(s,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const b=x.getOpacity(this.transform.pitch);b!==0&&h.setFogUniformValues(s,((E,S,k,P)=>{const O=S.properties.get("color"),F=E.frameCounter/1e3%1,G=[O.r/O.a,O.g/O.a,O.b/O.a,P];return{u_fog_matrix:k?E.transform.calculateFogTileMatrix(k):E.identityMat,u_fog_range:S.getFovAdjustedRange(E.transform._fov),u_fog_color:G,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:F}})(this,x,_,b))}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)h[x.key]=s[x.key]||new l.Tile(x,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class xo{constructor(s=0,h=0,_=0,x=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=_,this.right=x}interpolate(s,h,_){return h.top!=null&&s.top!=null&&(this.top=l.number(s.top,h.top,_)),h.bottom!=null&&s.bottom!=null&&(this.bottom=l.number(s.bottom,h.bottom,_)),h.left!=null&&s.left!=null&&(this.left=l.number(s.left,h.left,_)),h.right!=null&&s.right!=null&&(this.right=l.number(s.right,h.right,_)),this}getCenter(s,h){const _=l.clamp((this.left+s-this.right)/2,0,s),x=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.pointGeometry(_,x)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new xo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function c_(p,s){const h=l.getColumn(p,3);l.fromQuat(p,s),l.setColumn(p,3,h)}function nf(p,s){const h=l.identity$1([]);return l.rotateZ$1(h,h,-s),l.rotateX$1(h,h,-p),h}function Vu(p,s){const h=[p[0],p[1],0],_=[s[0],s[1],0];if(l.length(h)>=1e-15){const E=l.normalize([],h);l.scale$2(_,E,l.dot(_,E)),s[0]=_[0],s[1]=_[1]}const x=l.cross([],s,p);if(l.len(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return nf(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class Jl{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){const h=s instanceof l.MercatorCoordinate?s:new l.MercatorCoordinate(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=l.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(l.MercatorCoordinate.fromLngLat(s)):0,x=this.position,b=l.MercatorCoordinate.fromLngLat(s,_),E=[b.x-x.x,b.y-x.y,b.z-x.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=Vu(E,h)}setPitchBearing(s,h){this.orientation=nf(l.degToRad(s),l.degToRad(-h))}}class Ql{constructor(s,h){this._transform=l.identity([]),this.orientation=h,this.position=s}get mercatorPosition(){const s=this.position;return new l.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=l.getColumn(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&l.setColumn(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||l.identity$1([]),s&&c_(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=nf(s,h),c_(this._transform,this._orientation)}forward(){const s=l.getColumn(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=l.getColumn(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=l.getColumn(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){const _=new Float64Array(16);return l.invert(_,this.getWorldToCamera(s,h)),_}getWorldToCameraPosition(s,h,_){const x=this.position;l.scale$2(x,x,-s);const b=new Float64Array(16);return l.fromScaling(b,[_,_,_]),l.translate(b,b,x),b[10]*=h,b}getWorldToCamera(s,h){const _=new Float64Array(16),x=new Float64Array(4),b=this.position;return l.conjugate(x,this._orientation),l.scale$2(b,b,-s),l.fromQuat(_,x),l.translate(_,_,b),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(s,h,_,x){const b=new Float64Array(16);return l.perspective(b,s,h,_,x),b}getDistanceToElevation(s){const h=s===0?0:l.mercatorZfromAltitude(s,this.position[1]),_=this.forward();return(h-this.position[2])/_[2]}clone(){return new Ql([...this.position],[...this.orientation])}}function rf(p,s){const h=ec(p),_=function(b,E,S,k,P){const O=new l.LngLat(S.lng-180*bo,S.lat),F=new l.LngLat(S.lng+180*bo,S.lat),G=b.project(O.lng,O.lat),H=b.project(F.lng,F.lat),q=-Math.atan2(H.y-G.y,H.x-G.x),V=l.MercatorCoordinate.fromLngLat(S);V.y=l.clamp(V.y,-.999975,.999975);const ie=V.toLngLat(),Z=b.project(ie.lng,ie.lat),ee=l.MercatorCoordinate.fromLngLat(ie);ee.x+=bo;const te=ee.toLngLat(),re=b.project(te.lng,te.lat),Q=af(re.x-Z.x,re.y-Z.y,q),ae=l.MercatorCoordinate.fromLngLat(ie);ae.y+=bo;const ye=ae.toLngLat(),Te=b.project(ye.lng,ye.lat),Me=af(Te.x-Z.x,Te.y-Z.y,q),Ae=Math.abs(Q.x)/Math.abs(Me.y),We=l.identity([]);l.rotateZ(We,We,-q*(1-(P?0:k)));const ve=l.identity([]);return l.scale(ve,ve,[1,1-(1-Ae)*k,1]),ve[4]=-Me.x/Me.y*k,l.rotateZ(ve,ve,q),l.multiply$1(ve,We,ve),ve}(p.projection,0,p.center,h,s),x=sf(p);return l.scale(_,_,[x,x,1]),_}function sf(p){const s=p.projection,h=ec(p),_=of(s,p.center),x=of(s,l.LngLat.convert(s.center));return Math.pow(2,_*h+(1-h)*x)}function ec(p){const s=p.projection.range;if(!s)return 0;const h=Math.max(p.width,p.height),_=Math.log(h/1024)/Math.LN2;return l.smoothstep(s[0]+_,s[1]+_,p.zoom)}const bo=1/4e4;function of(p,s){const h=l.clamp(s.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),_=new l.LngLat(s.lng-180*bo,h),x=new l.LngLat(s.lng+180*bo,h),b=p.project(_.lng,h),E=p.project(x.lng,h),S=l.MercatorCoordinate.fromLngLat(_),k=l.MercatorCoordinate.fromLngLat(x),P=E.x-b.x,O=E.y-b.y,F=k.x-S.x,G=k.y-S.y,H=Math.sqrt((F*F+G*G)/(P*P+O*O));return Math.log(H)/Math.LN2}function af(p,s,h){const _=Math.cos(h),x=Math.sin(h);return{x:p*_-s*x,y:p*x+s*_}}class $u{constructor(s,h,_,x,b,E,S){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=_==null?0:_,this._maxPitch=x==null?60:x,this.setProjection(E),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new xo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ql,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const s=new $u(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(s){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(s||h)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return l.pick(this.projection,["name","center","parallels"])}setProjection(s){s==null&&(s={name:"mercator"}),this.projectionOptions=s;const h=this.projection?this.getProjection():void 0;this.projection=l.getProjection(s);const _=this.getProjection();return R(h,_)?null:(this._calcMatrices(),_)}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return l.wrap(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const h=-s*Math.PI/180;var _;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(x,b,E){var S=b[0],k=b[1],P=b[2],O=b[3],F=Math.sin(E),G=Math.cos(E);x[0]=S*G+P*F,x[1]=k*G+O*F,x[2]=S*-F+P*G,x[3]=k*-F+O*G}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=l.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const s=this._elevation;this._centerAltitude=s.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=s.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,b=0;for(let E=0;E<h.length;E++){const S=new l.pointGeometry(h[E][0]*this.width,_+h[E][1]*(this.height-_)),k=s.pointCoordinate(S);if(!k)continue;const P=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);x+=k[3]*P,b+=P}return b===0?NaN:x/b}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(s),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-_,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let _;_=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];const x=l.length(l.sub([],this._camera.position,_));return l.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!l.exactEquals(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){const _=[s.position.x,s.position.y,s.position.z];l.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,h=new Jl;return h.position=new l.MercatorCoordinate(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!l.length$1(s))return!1;l.normalize$1(s,s);const h=l.transformQuat([],[0,0,-1],s),_=l.transformQuat([],[0,-1,0],s);if(_[2]<0)return!1;const x=Vu(h,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(s){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;s[2]=l.clamp(s[2],x/_,x/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,_){this._unmodified=!1,this._edgeInsets.interpolate(s,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new l.UnwrappedTileID(0,s)];if(this.renderWorldCopies){const _=this.pointCoordinate(new l.pointGeometry(0,0)),x=this.pointCoordinate(new l.pointGeometry(this.width,0)),b=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new l.pointGeometry(0,this.height)),S=Math.floor(Math.min(_.x,x.x,b.x,E.x)),k=Math.floor(Math.max(_.x,x.x,b.x,E.x)),P=1;for(let O=S-P;O<=k+P;O++)O!==0&&h.push(new l.UnwrappedTileID(O,s))}return h}coveringTiles(s){let h=this.coveringZoomLevel(s);const _=h,x=this.elevation&&!s.isTerrainDEM,b=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);const E=this.locationCoordinate(this.center),S=this.center.lat,k=1<<h,P=[k*E.x,k*E.y,0],O=this.projection.name==="globe",F=!O,G=l.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,F),H=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=k*l.mercatorZfromAltitude(1,this.center.lat),V=this._camera.position[2]/l.mercatorZfromAltitude(1,this.center.lat),ie=[k*H.x,k*H.y,V*(F?1:q)],Z=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ee=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,te=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,re=s.isTerrainDEM?-te:this._elevation?this._elevation.getMinElevationBelowMSL():0,Q=this.projection.isReprojectedInTileSpace?sf(this):1,ae=ke=>{const St=new l.MercatorCoordinate(ke.x+25e-6,ke.y,ke.z),dt=new l.MercatorCoordinate(ke.x,ke.y+25e-6,ke.z),ft=ke.toLngLat(),Dt=St.toLngLat(),Gt=dt.toLngLat(),Et=this.locationCoordinate(ft),Ot=this.locationCoordinate(Dt),pi=this.locationCoordinate(Gt),nn=Math.hypot(Ot.x-Et.x,Ot.y-Et.y),Gn=Math.hypot(pi.x-Et.x,pi.y-Et.y);return Math.sqrt(nn*Gn)*Q/25e-6},ye=ke=>{const ht=te,St=re;return{aabb:l.tileAABB(this,k,0,0,0,ke,St,ht,this.projection),zoom:0,x:0,y:0,minZ:St,maxZ:ht,wrap:ke,fullyVisible:!1}},Te=[];let Me=[];const Ae=h,We=s.reparseOverscaled?_:h,ve=ke=>ke*ke,He=ve((V-this._centerAltitude)*q),$e=ke=>{if(!this._elevation||!ke.tileID||!b)return;const ht=this._elevation.getMinMaxForTile(ke.tileID),St=ke.aabb;ht?(St.min[2]=ht.min,St.max[2]=ht.max,St.center[2]=(St.min[2]+St.max[2])/2):(ke.shouldSplit=mt(ke),ke.shouldSplit||(St.min[2]=St.max[2]=St.center[2]=this._centerAltitude))},mt=ke=>{if(ke.zoom<ee)return!0;if(ke.zoom===Ae)return!1;if(ke.shouldSplit!=null)return ke.shouldSplit;const ht=ke.aabb.distanceX(ie),St=ke.aabb.distanceY(ie);let dt=He,ft=1;if(O){dt=ve(ke.aabb.distanceZ(ie));const Gt=Math.pow(2,ke.zoom),Et=l.latFromMercatorY((ke.y+1)/Gt),Ot=l.latFromMercatorY(ke.y/Gt),pi=Math.min(Math.max(S,Et),Ot),nn=l.circumferenceAtLatitude(pi)/l.circumferenceAtLatitude(S);ft=Math.min(nn,1)}else if(x&&(dt=ve(ke.aabb.distanceZ(ie)*q)),this.projection.isReprojectedInTileSpace&&_<=5){const Gt=Math.pow(2,ke.zoom),Et=ae(new l.MercatorCoordinate((ke.x+.5)/Gt,(ke.y+.5)/Gt));ft=Et>.85?1:Et}const Dt=ht*ht+St*St+dt;return Dt<ve((1<<Ae-ke.zoom)*Z*ft*((Gt,Et)=>{if(Et*ve(.707)<Gt)return 1;const Ot=Math.sqrt(Et/Gt);return Ot/(1.4144271570014144+(Math.pow(1.1,Ot-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(dt,He),Dt))};if(this.renderWorldCopies)for(let ke=1;ke<=3;ke++)Te.push(ye(-ke)),Te.push(ye(ke));for(Te.push(ye(0));Te.length>0;){const ke=Te.pop(),ht=ke.x,St=ke.y;let dt=ke.fullyVisible;if(!dt){const ft=ke.aabb.intersects(G);if(ft===0)continue;dt=ft===2}if(ke.zoom!==Ae&&mt(ke))for(let ft=0;ft<4;ft++){const Dt=(ht<<1)+ft%2,Gt=(St<<1)+(ft>>1),Et={aabb:b?ke.aabb.quadrant(ft):l.tileAABB(this,k,ke.zoom+1,Dt,Gt,ke.wrap,ke.minZ,ke.maxZ,this.projection),zoom:ke.zoom+1,x:Dt,y:Gt,wrap:ke.wrap,fullyVisible:dt,tileID:void 0,shouldSplit:void 0,minZ:ke.minZ,maxZ:ke.maxZ};x&&!O&&(Et.tileID=new l.OverscaledTileID(ke.zoom+1===Ae?We:ke.zoom+1,ke.wrap,ke.zoom+1,Dt,Gt),$e(Et)),Te.push(Et)}else{const ft=ke.zoom===Ae?We:ke.zoom;if(s.minzoom&&s.minzoom>ft)continue;const Dt=P[0]-(.5+ht+(ke.wrap<<ke.zoom))*(1<<h-ke.zoom),Gt=P[1]-.5-St,Et=ke.tileID?ke.tileID:new l.OverscaledTileID(ft,ke.wrap,ke.zoom,ht,St);Me.push({tileID:Et,distanceSq:Dt*Dt+Gt*Gt})}}if(this.fogCullDistSq){const ke=this.fogCullDistSq,ht=this.horizonLineFromTop();Me=Me.filter(St=>{const dt=[0,0,0,1],ft=[l.EXTENT,l.EXTENT,0,1],Dt=this.calculateFogTileMatrix(St.tileID.toUnwrapped());l.transformMat4$1(dt,dt,Dt),l.transformMat4$1(ft,ft,Dt);const Gt=l.getAABBPointSquareDist(dt,ft);if(Gt===0)return!0;let Et=!1;const Ot=this._elevation;if(Ot&&Gt>ke&&ht!==0){const pi=this.calculateProjMatrix(St.tileID.toUnwrapped());let nn;s.isTerrainDEM||(nn=Ot.getMinMaxForTile(St.tileID)),nn||(nn={min:re,max:te});const Gn=l.furthestTileCorner(this.rotation),qn=[Gn[0]*l.EXTENT,Gn[1]*l.EXTENT,nn.max];l.transformMat4(qn,qn,pi),Et=(1-qn[1])*this.height*.5<ht}return Gt<ke||Et})}return Me.sort((ke,ht)=>ke.distanceSq-ht.distanceSq).map(ke=>ke.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=l.clamp(s.lat,-l.MAX_MERCATOR_LATITUDE,l.MAX_MERCATOR_LATITUDE),_=this.projection.project(s.lng,h);return new l.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(s,h){let _,x;const b=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;_=(h.x-b.x)/S,x=(h.y-b.y)/S}else{const S=this.pointCoordinate(h),k=this.pointCoordinate(b);_=S.x-k.x,x=S.y-k.y}const E=this.locationCoordinate(s);this.setLocation(new l.MercatorCoordinate(E.x-_,E.y-x))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this._coordinatePoint(this.locationCoordinate(s),!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,h){const _=h?l.mercatorZfromAltitude(h,s.lat):void 0,x=this.projection.project(s.lng,s.lat);return new l.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){const _=h!=null?h:this._centerAltitude,x=[s.x,s.y,0,1],b=[s.x,s.y,1,1];l.transformMat4$1(x,x,this.pixelMatrixInverse),l.transformMat4$1(b,b,this.pixelMatrixInverse);const E=b[3];l.scale$1(x,x,1/x[3]),l.scale$1(b,b,1/E);const S=x[2],k=b[2];return{p0:x,p1:b,t:S===k?0:(_-S)/(k-S)}}screenPointToMercatorRay(s){const h=[s.x,s.y,0,1],_=[s.x,s.y,1,1];return l.transformMat4$1(h,h,this.pixelMatrixInverse),l.transformMat4$1(_,_,this.pixelMatrixInverse),l.scale$1(h,h,1/h[3]),l.scale$1(_,_,1/_[3]),h[2]=l.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=l.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,l.scale$1(h,h,1/this.worldSize),l.scale$1(_,_,1/this.worldSize),new l.Ray([h[0],h[1],h[2]],l.normalize([],l.sub([],_,h)))}rayIntersectionCoordinate(s){const{p0:h,p1:_,t:x}=s,b=l.mercatorZfromAltitude(h[2],this._center.lat),E=l.mercatorZfromAltitude(_[2],this._center.lat);return new l.MercatorCoordinate(l.number(h[0],_[0],x)/this.worldSize,l.number(h[1],_[1],x)/this.worldSize,l.number(b,E,x))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);const h=this.elevation;let _=this.elevation.pointCoordinate(s);if(_)return new l.MercatorCoordinate(_[0],_[1],_[2]);let x=0,b=this.horizonLineFromTop();if(s.y>b)return this.pointCoordinate(s);const E=.02*b,S=s.clone();for(let k=0;k<10&&b-x>E;k++){S.y=l.number(x,b,.66);const P=h.pointCoordinate(S);P?(b=S.y,_=P):x=S.y}return _?new l.MercatorCoordinate(_[0],_[1],_[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){if(this.elevation)return!this.elevation.pointCoordinate(s);{const h=this.horizonLineFromTop();return s.y<h}}_coordinatePoint(s,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,x=[s.x*this.worldSize,s.y*this.worldSize,_+s.toAltitude(),1];return l.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new l.pointGeometry(x[0]/x[3],x[1]/x[3]):new l.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(s,h){const _=new l.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new l.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new l.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new l.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(_,s),k=this.pointCoordinate(x,s);const P=this.pointCoordinate(b,h),O=this.pointCoordinate(E,h),F=(G,H)=>(H.y-G.y)/(H.x-G.x);return S.y>1&&k.y>=0?S=new l.MercatorCoordinate((1-O.y)/F(O,S)+O.x,1):S.y<0&&k.y<=1&&(S=new l.MercatorCoordinate(-O.y/F(O,S)+O.x,0)),k.y>1&&S.y>=0?k=new l.MercatorCoordinate((1-P.y)/F(P,k)+P.x,1):k.y<0&&S.y<=1&&(k=new l.MercatorCoordinate(-P.y/F(P,k)+P.x,0)),new l.LngLatBounds().extend(this.coordinateLocation(S)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(P))}_getBounds3D(){const s=this.elevation;if(!s.visibleDemTiles.length)return this._getBounds(0,0);const h=s.visibleDemTiles.reduce((_,x)=>{if(x.dem){const b=x.dem.tree;_.min=Math.min(_.min,b.minimums[0]),_.max=Math.max(_.max,b.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(s=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-l.MAX_MERCATOR_LATITUDE,this.maxLat=l.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=l.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=l.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=l.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=l.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){const h=s.key,_=this._distanceTileDataCache;if(_[h])return _[h];const x=s.canonical,b=1/this.height,E=this.cameraWorldSize/this.zoomScale(x.z),S=(x.x+Math.pow(2,x.z)*s.wrap)*E,k=x.y*E,P=this.point,O=this.angle,F=Math.sin(-O),G=-Math.cos(-O);return _[h]={bearing:[F,G],center:[(P.x-S)*b,(P.y-k)*b],scale:E/l.EXTENT*b},_[h]}calculateFogTileMatrix(s){const h=s.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const x=this.calculatePosMatrix(s,this.cameraWorldSize);return l.multiply$1(x,this.worldToFogMatrix,x),_[h]=new Float32Array(x),_[h]}calculateProjMatrix(s,h=!1){const _=s.key,x=h?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const b=this.calculatePosMatrix(s,this.worldSize);return l.multiply$1(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,b),x[_]=new Float32Array(b),x[_]}calculatePixelsToTileUnitsMatrix(s){const h=s.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const x=function(b,E){const{scale:S}=b.tileTransform,k=S*l.EXTENT/(b.tileSize*Math.pow(2,E.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return P=new Float32Array(4),G=(O=E.inverseAdjustmentMatrix)[1],H=O[2],q=O[3],ie=(F=[k,k])[1],P[0]=O[0]*(V=F[0]),P[1]=G*V,P[2]=H*ie,P[3]=q*ie,P;var P,O,F,G,H,q,V,ie}(s,this);return _[h]=x,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const s=this._elevation;this._updateCameraState();const h=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=this._camera.forward(),b=l.mercatorZfromAltitude(1,this._center.lat);_[2]/=b,x[2]/=b,l.normalize(x,x);const E=s.raycast(_,x,s.exaggeration());if(E){const S=l.scaleAndAdd([],_,x,E),k=new l.MercatorCoordinate(S[0],S[1],l.mercatorZfromAltitude(S[2],l.latFromMercatorY(S[1]))),P=(k.z+l.length([k.x-_[0],k.y-_[1],k.z-_[2]*b]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const s=this._elevation;this._updateCameraState();const h=l.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),x=s.getAtPointOrZero(new l.MercatorCoordinate(..._)),b=this._minimumHeightOverTerrain()*Math.cos(l.degToRad(this._maxPitch)),E=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*x;if(E<b){const S=this.locationCoordinate(this._center,this._centerAltitude),k=[S.x-_[0],S.y-_[1],S.z-_[2]],P=l.length(k);k[2]-=(b-E)/this._projectionScaler;const O=l.length(k);if(O===0)return;l.scale$2(k,k,P/O*this._projectionScaler),this._camera.position=[S.x-k[0],S.y-k[1],S.z*this._projectionScaler-k[2]],this._camera.orientation=Vu(k,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const F=this.center;return F.lat=l.clamp(F.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(F.lng=l.clamp(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:_}=this.point;let x=0,b=h,E=_;const S=this.width/2,k=this.height/2,P=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(_-k<P&&(E=P+k),_+k>O&&(E=O-k),O-P<this.height&&(x=Math.max(x,this.height/(O-P)),E=(O+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,H=this.worldSize/2-(F+G)/2;b=(h+H+this.worldSize)%this.worldSize-H,b-S<F&&(b=F+S),b+S>G&&(b=G-S),G-F<this.width&&(x=Math.max(x,this.width/(G-F)),b=(G+F)/2)}b===h&&E===_||(this.center=this.unproject(new l.pointGeometry(b,E))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCameraAltitude(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this._fov/2,h=this.centerOffset,_=this.pixelsPerMeter;this._projectionScaler=_/(l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(s)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?_:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-h.x/this.width,b[9]=2*h.y/this.height;let E=l.mul([],b,x);if(this.projection.isReprojectedInTileSpace){const re=this.locationCoordinate(this.center),Q=l.identity([]);l.translate(Q,Q,[re.x*this.worldSize,re.y*this.worldSize,0]),l.multiply$1(Q,Q,rf(this)),l.translate(Q,Q,[-re.x*this.worldSize,-re.y*this.worldSize,0]),l.multiply$1(E,E,Q),this.inverseAdjustmentMatrix=function(ae){const ye=rf(ae,!0);return _i([],[ye[0],ye[1],ye[4],ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=l.scale([],E,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=E,this.invProjMatrix=l.invert(new Float64Array(16),this.projMatrix);const S=new Float32Array(16);l.identity(S),l.scale(S,S,[1,-1,1]),l.rotateX(S,S,this._pitch),l.rotateZ(S,S,this.angle);const k=l.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),P=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-h.x/this.width,k[9]=2*(h.y+P)/this.height,this.skyboxMatrix=l.multiply$1(S,k,S);const O=this.point,F=O.x,G=O.y,H=this.width%2/2,q=this.height%2/2,V=Math.cos(this.angle),ie=Math.sin(this.angle),Z=F-Math.round(F)+V*H+ie*q,ee=G-Math.round(G)+V*q+ie*H,te=new Float64Array(E);if(l.translate(te,te,[Z>.5?Z-1:Z,ee>.5?ee-1:ee,0]),this.alignedProjMatrix=te,E=l.create(),l.scale(E,E,[this.width/2,-this.height/2,1]),l.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=l.create(),l.scale(E,E,[1,-1,1]),l.translate(E,E,[-1,-1,0]),l.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=l.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=l.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");this.pixelMatrixInverse=E,this.globeMatrix=this.projection.name==="globe"?l.calculateGlobeMatrix(this):E,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSize,h=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height,b=[s,s,h];l.scale$2(b,b,x),l.scale$2(_,_,-1),l.multiply$2(_,_,b);const E=l.create();l.translate(E,E,_),l.scale(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,x)}_computeCameraPosition(s){const h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*b,x.y/this.worldSize-_[1]*b,s/this.worldSize*this._centerAltitude-_[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=s[2];let x=1;_>0&&(x=Math.min((h-this._camera.position[2])/_,1)),this._camera.position=l.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const s=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),b=l.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(l.degToRad(this._maxPitch)),S=Math.max((s[2]-b)/Math.cos(_),E),k=this._zoomFromMercatorZ(S);l.scaleAndAdd(s,s,h,S),this._pitch=l.clamp(_,l.degToRad(this.minPitch),l.degToRad(this.maxPitch)),this.angle=l.wrap(x,-Math.PI,Math.PI),this._setZoom(l.clamp(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new l.MercatorCoordinate(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(l.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(s,h){const _=Math.min(s.x,h.x),x=Math.max(s.x,h.x),b=Math.min(s.y,h.y),E=Math.max(s.y,h.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new l.pointGeometry(_,b),new l.pointGeometry(x,E),new l.pointGeometry(_,E),new l.pointGeometry(x,b)],k=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const O of S){const F=this.pointRayIntersection(O);if(F.t<0)return!0;const G=this.rayIntersectionCoordinate(F);if(G.x<k||G.y<0||G.x>P||G.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+l.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new l.pointGeometry(0,0),new l.pointGeometry(this.width,this.height))}zoomDeltaToMovement(s,h){const _=l.length(l.sub([],this._camera.position,s)),x=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(x)}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,s))}}function lf(p,s){let h=!1,_=null;const x=()=>{_=null,h&&(p(),_=setTimeout(x,s),h=!1)};return()=>(h=!0,_||x(),_)}class u_{constructor(s){this._hashName=s&&encodeURIComponent(s),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=lf(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,l.window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),l.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(s){const h=this._map;if(!h)return"";const _=h.getCenter(),x=Math.round(100*h.getZoom())/100,b=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,b),S=Math.round(_.lng*E)/E,k=Math.round(_.lat*E)/E,P=h.getBearing(),O=h.getPitch();let F="";if(F+=s?`/${S}/${k}/${x}`:`${x}/${k}/${S}`,(P||O)&&(F+="/"+Math.round(10*P)/10),O&&(F+=`/${Math.round(O)}`),this._hashName){const G=this._hashName;let H=!1;const q=l.window.location.hash.slice(1).split("&").map(V=>{const ie=V.split("=")[0];return ie===G?(H=!0,`${ie}=${F}`):V}).filter(V=>V);return H||q.push(`${G}=${F}`),`#${q.join("&")}`}return`#${F}`}_getCurrentHash(){const s=l.window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=l.window.location.href.replace(/(#.+)?$/,this.getHashString());l.window.history.replaceState(l.window.history.state,null,s)}}const Ks={linearity:.3,easing:l.bezier(0,0,.3,1)},h_=l.extend({deceleration:2500,maxSpeed:1400},Ks),d_=l.extend({deceleration:20,maxSpeed:1400},Ks),f_=l.extend({deceleration:1e3,maxSpeed:360},Ks),p_=l.extend({deceleration:1e3,maxSpeed:90},Ks);class m_{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=l.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const b=Cn(h.pan.mag(),_,l.extend({},h_,s||{}));x.offset=h.pan.mult(b.amount/h.pan.mag()),x.center=this._map.transform.center,tc(x,b)}if(h.zoom){const b=Cn(h.zoom,_,d_);x.zoom=this._map.transform.zoom+b.amount,tc(x,b)}if(h.bearing){const b=Cn(h.bearing,_,f_);x.bearing=this._map.transform.bearing+l.clamp(b.amount,-179,179),tc(x,b)}if(h.pitch){const b=Cn(h.pitch,_,p_);x.pitch=this._map.transform.pitch+b.amount,tc(x,b)}if(x.zoom||x.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function tc(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function Cn(p,s,h){const{maxSpeed:_,linearity:x,deceleration:b}=h,E=l.clamp(p*x/(s/1e3),-_,_),S=Math.abs(E)/(b*x);return{easing:h.easing,duration:1e3*S,amount:E*(S/2)}}class Dr extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,_,x={}){const b=zt(h.getCanvasContainer(),_),E=h.unproject(b);super(s,l.extend({point:b,lngLat:E,originalEvent:_},x)),this._defaultPrevented=!1,this.target=h}}class ic extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,_){const x=s==="touchend"?_.changedTouches:_.touches,b=rt(h.getCanvasContainer(),x),E=b.map(k=>h.unproject(k)),S=b.reduce((k,P,O,F)=>k.add(P.div(F.length)),new l.pointGeometry(0,0));super(s,{points:b,point:S,lngLats:E,lngLat:h.unproject(S),originalEvent:_}),this._defaultPrevented=!1}}class ax extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,_){super(s,{originalEvent:_}),this._defaultPrevented=!1}}class lx{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new ax(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Dr(s.type,this._map,s))}mouseup(s){this._map.fire(new Dr(s.type,this._map,s))}preclick(s){const h=l.extend({},s);h.type="preclick",this._map.fire(new Dr(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Dr(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Dr(s.type,this._map,s))}mouseover(s){this._map.fire(new Dr(s.type,this._map,s))}mouseout(s){this._map.fire(new Dr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new ic(s.type,this._map,s))}touchmove(s){this._map.fire(new ic(s.type,this._map,s))}touchend(s){this._map.fire(new ic(s.type,this._map,s))}touchcancel(s){this._map.fire(new ic(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zs{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Dr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Dr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class __{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(Be(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=_,this._box||(this._box=$("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const b=Math.min(x.x,_.x),E=Math.max(x.x,_.x),S=Math.min(x.y,_.y),k=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${S}px)`,this._box.style.width=E-b+"px",this._box.style.height=k-S+"px")})}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const _=this._startPos,x=h;if(this.reset(),lt(),_.x!==x.x||_.y!==x.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:b=>b.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),nt(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new l.Event(s,{originalEvent:h}))}}function wo(p,s){const h={};for(let _=0;_<p.length;_++)h[p[_].identifier]=s[_];return h}class Ms{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const b=new l.pointGeometry(0,0);for(const E of x)b._add(E);return b.div(x.length)}(h),this.touches=wo(_,h)))}touchmove(s,h,_){if(this.aborted||!this.centroid)return;const x=wo(_,h);for(const b in this.touches){const E=this.touches[b],S=x[b];(!S||S.dist(E)>30)&&(this.aborted=!0)}}touchend(s,h,_){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class qa{constructor(s){this.singleTap=new Ms(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,_){this.singleTap.touchstart(s,h,_)}touchmove(s,h,_){this.singleTap.touchmove(s,h,_)}touchend(s,h,_){const x=this.singleTap.touchend(s,h,_);if(x){const b=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(b&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class at{constructor(){this._zoomIn=new qa({numTouches:1,numTaps:2}),this._zoomOut=new qa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,_){this._zoomIn.touchstart(s,h,_),this._zoomOut.touchstart(s,h,_)}touchmove(s,h,_){this._zoomIn.touchmove(s,h,_),this._zoomOut.touchmove(s,h,_)}touchend(s,h,_){const x=this._zoomIn.touchend(s,h,_),b=this._zoomOut.touchend(s,h,_);return x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:s})}):b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const g_={0:1,2:2};class ju{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const _=Wt(s);this._correctButton(s,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(s,h){const _=this._lastPoint;if(_){if(s.preventDefault(),this._eventButton!=null&&function(x,b){const E=g_[b];return x.buttons===void 0||(x.buttons&E)!==E}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}}mouseupWindow(s){this._lastPoint&&Wt(s)===this._eventButton&&(this._moved&&lt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nc extends ju{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class Wa extends ju{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const _=.8*(h.x-s.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(s){s.preventDefault()}}class cf extends ju{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const _=-.5*(h.y-s.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(s){s.preventDefault()}}class y_{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),l.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0)}touchstart(s,h,_){return this._calculateTransform(s,h,_)}touchmove(s,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.preventDefault(),this._calculateTransform(s,h,_)}}touchend(s,h,_){this._calculateTransform(s,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,_){_.length>0&&(this._active=!0);const x=wo(_,h),b=new l.pointGeometry(0,0),E=new l.pointGeometry(0,0);let S=0;for(const P in x){const O=x[P],F=this._touches[P];F&&(b._add(O),E._add(O.sub(F)),S++,x[P]=O)}if(this._touches=x,S<this._minTouches||!E.mag())return;const k=E.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(S),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Gu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,_){return{}}touchstart(s,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,_){const x=this._firstTwoTouches;if(!x)return;s.preventDefault();const[b,E]=x,S=rc(_,h,b),k=rc(_,h,E);if(!S||!k)return;const P=this._aroundCenter?null:S.add(k).div(2);return this._move([S,k],P,s)}touchend(s,h,_){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,E=rc(_,h,x),S=rc(_,h,b);E&&S||(this._active&&lt(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function rc(p,s,h){for(let _=0;_<p.length;_++)if(p[_].identifier===h)return s[_]}function uf(p,s){return Math.log(p/s)/Math.LN2}class v_ extends Gu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const _=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(uf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:uf(this._distance,_),pinchAround:h}}}function hf(p,s){return 180*p.angleWith(s)/Math.PI}class qu extends Gu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const _=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hf(this._vector,_),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,_=hf(s,this._startVector);return Math.abs(_)<h}}function sc(p){return Math.abs(p.y)>Math.abs(p.x)}class Wu extends Gu{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,sc(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,_){const x=this._lastPoints;if(!x)return;const b=s[0].sub(x[0]),E=s[1].sub(x[1]);return this._map._cooperativeGestures&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(b,E,_.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5})}gestureBeginsVertically(s,h,_){if(this._valid!==void 0)return this._valid;const x=s.mag()>=2,b=h.mag()>=2;if(!x&&!b)return;if(!x||!b)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const E=s.y>0==h.y>0;return sc(s)&&sc(h)&&E}}const x_={panStep:100,bearingStep:15,pitchStep:10};class b_{constructor(){const s=x_;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,_=0,x=0,b=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?_=-1:(s.preventDefault(),b=-1);break;case 39:s.shiftKey?_=1:(s.preventDefault(),b=1);break;case 38:s.shiftKey?x=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?x=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:S=>{const k=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:w_,zoom:h?Math.round(k)+h*(s.shiftKey?2:1):k,bearing:S.getBearing()+_*this._bearingStep,pitch:S.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:S.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function w_(p){return p*(2-p)}const df=4.000244140625;class E_{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===l.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const _=l.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%df==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=zt(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform,h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>df?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&P!==0&&(P=1/P);const O=h(),F=Math.pow(2,O),G=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(G*P))),this._type==="wheel"&&(this._startZoom=h(),this._easing=this._smoothOutEasing(200)),this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:h(),x=this._startZoom,b=this._easing;let E,S=!1;if(this._type==="wheel"&&x&&b){const k=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),P=b(k);E=l.number(x,_,P),k<1?this._frameId||(this._frameId=!0):S=!0}else E=_,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:E-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=l.ease;if(this._prevEase){const _=this._prevEase,x=(l.exported.now()-_.start)/_.duration,b=_.easing(x+.01)-_.easing(x),E=.27/Math.sqrt(b*b+1e-4)*.01,S=Math.sqrt(.0729-E*E);h=l.bezier(E,S,.25,1)}return this._prevEase={start:l.exported.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=$("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(l.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!l.window.document.fullscreenElement||!!l.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class T_{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class I_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(s.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ff{constructor(){this._tap=new qa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,_){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(s,h,_))}touchmove(s,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=h[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,s.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(s,h,_)}touchend(s,h,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(s,h,_)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class S_{constructor(s,h,_){this._el=s,this._mousePan=h,this._touchPan=_}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class A_{constructor(s,h,_){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class C_{constructor(s,h,_,x){this._el=s,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const oc=p=>p.zoom||p.drag||p.pitch||p.rotate;class pf extends l.Event{}class M_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){const _=l.sub([],h,s);this.radius=l.length(_[2]<0?l.div([],_,this.constants):[_[0],_[1],0])}projectRay(s){l.div(s,s,this.constants),l.normalize(s,s),l.mul$1(s,s,this.constants);const h=l.scale$2([],s,this.radius);if(h[2]>0){const _=l.scale$2([],[0,0,1],l.dot(h,[0,0,1])),x=l.scale$2([],l.normalize([],[h[0],h[1],0]),this.radius),b=l.add([],h,l.scale$2([],l.sub([],l.add([],x,_),h),2));h[0]=b[0],h[1]=b[1]}return h}}function Ha(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class k_{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new m_(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new M_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[l.window.document,"mousemove",{capture:!0}],[l.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[l.window,"blur",void 0]];for(const[x,b,E]of this._listeners)x.addEventListener(b,x===l.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,h,_]of this._listeners)s.removeEventListener(h,s===l.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(s){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new lx(h,s));const x=h.boxZoom=new __(h,s);this._add("boxZoom",x);const b=new at,E=new I_;h.doubleClickZoom=new T_(E,b),this._add("tapZoom",b),this._add("clickZoom",E);const S=new ff;this._add("tapDragZoom",S);const k=h.touchPitch=new Wu(h);this._add("touchPitch",k);const P=new Wa(s),O=new cf(s);h.dragRotate=new A_(s,P,O),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const F=new nc(s),G=new y_(h,s);h.dragPan=new S_(_,F,G),this._add("mousePan",F),this._add("touchPan",G,["touchZoom","touchRotate"]);const H=new qu,q=new v_;h.touchZoomRotate=new C_(_,q,H,S),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Zs(h));const V=h.scrollZoom=new E_(h,this);this._add("scrollZoom",V,["mousePan"]);const ie=h.keyboard=new b_;this._add("keyboard",ie);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[Z]&&h[Z].enable(s[Z])}_add(s,h,_){this._handlers.push({handlerName:s,handler:h,allowed:_}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!oc(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,h,_){for(const x in s)if(x!==_&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const _ of s)this._el.contains(_.target)&&h.push(_);return h}handleEvent(s,h){this._updatingCamera=!0;const _=s.type==="renderFrame",x=_?void 0:s,b={needsRenderFrame:!1},E={},S={},k=s.touches?this._getMapTouches(s.touches):void 0,P=k?rt(this._el,k):_?void 0:zt(this._el,s);for(const{handlerName:G,handler:H,allowed:q}of this._handlers){if(!H.isEnabled())continue;let V;this._blockedByActive(S,q,G)?H.reset():H[h||s.type]&&(V=H[h||s.type](s,P,k),this.mergeHandlerResult(b,E,V,G,x),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||H.isActive())&&(S[G]=H)}const O={};for(const G in this._previousActiveHandlers)S[G]||(O[G]=x);this._previousActiveHandlers=S,(Object.keys(O).length||Ha(b))&&(this._changes.push([b,E,O]),this._triggerRenderFrame()),(Object.keys(S).length||Ha(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=b;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(s,h,_,x,b){if(!_)return;l.extend(s,_);const E={handlerName:x,originalEvent:_.originalEvent||b};_.zoomDelta!==void 0&&(h.zoom=E),_.panDelta!==void 0&&(h.drag=E),_.pitchDelta!==void 0&&(h.pitch=E),_.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const s={},h={},_={};for(const[x,b,E]of this._changes)x.panDelta&&(s.panDelta=(s.panDelta||new l.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(s.around=x.around),x.aroundCoord!==void 0&&(s.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(s.pinchAround=x.pinchAround),x.noInertia&&(s.noInertia=x.noInertia),l.extend(h,b),l.extend(_,E);this._updateMapTransform(s,h,_),this._changes=[]}_updateMapTransform(s,h,_){const x=this._map,b=x.transform,E=ee=>[ee.x,ee.y,ee.z];if((ee=>{const te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!Ha(s)){const ee=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",ee!==b.zoom&&this._map._update(!0)}if(!Ha(s))return void this._fireEvents(h,_,!0);let{panDelta:S,zoomDelta:k,bearingDelta:P,pitchDelta:O,around:F,aroundCoord:G,pinchAround:H}=s;H!==void 0&&(F=H),(ee=>h.drag&&!this._eventsInProgress.drag)()&&F&&(this._dragOrigin=E(b.pointCoordinate3D(F)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),F=F||x.transform.centerPoint,P&&(b.bearing+=P),O&&(b.pitch+=O),b._updateCameraState();const q=[0,0,0];if(S){const ee=b.pointCoordinate(F);if(b.projection.name==="globe"){const te=l.latFromMercatorY(ee.y),re=b.center.lat,Q=Math.min(l.mercatorZfromAltitude(1,te)/l.mercatorZfromAltitude(1,re),2);S=S.rotate(-b.angle),q[0]=-S.x/b.worldSize*Q,q[1]=-S.y/b.worldSize*Q}else{const te=b.pointCoordinate(F.sub(S));ee&&te&&(q[0]=te.x-ee.x,q[1]=te.y-ee.y)}}const V=b.zoom,ie=[0,0,0];if(k){const ee=E(G||b.pointCoordinate3D(F)),te={dir:l.normalize([],l.sub([],ee,b._camera.position))};if(te.dir[2]<0){const re=b.zoomDeltaToMovement(ee,k);l.scale$2(ie,te.dir,re)}}const Z=l.add(q,q,ie);b._translateCameraConstrained(Z),k&&Math.abs(b.zoom-V)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,_,!0)}_fireEvents(s,h,_){const x=oc(this._eventsInProgress),b=oc(s),E={};for(const O in s){const{originalEvent:F}=s[O];this._eventsInProgress[O]||(E[`${O}start`]=F),this._eventsInProgress[O]=s[O]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const O in E)this._fireEvent(O,E[O]);b&&this._fireEvent("move",b.originalEvent);for(const O in s){const{originalEvent:F}=s[O];this._fireEvent(O,F)}const S={};let k;for(const O in this._eventsInProgress){const{handlerName:F,originalEvent:G}=this._eventsInProgress[O];this._handlersById[F].isActive()||(delete this._eventsInProgress[O],k=h[F]||G,S[`${O}end`]=k)}for(const O in S)this._fireEvent(O,S[O]);const P=oc(this._eventsInProgress);if(_&&(x||b)&&!P){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;O?(F(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:k})):(this._map.fire(new l.Event("moveend",{originalEvent:k})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new l.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new pf("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Hu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class mf extends l.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,_){return s=l.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,l.extend({offset:s},h),_)}panTo(s,h,_){return this.easeTo(l.extend({center:s},h),_)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,_){return this.easeTo(l.extend({zoom:s},h),_)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,_){return this.easeTo(l.extend({bearing:s},h),_)}resetNorth(s,h){return this.rotateTo(0,l.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=l.LngLatBounds.convert(s);const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),_,h)}_extendCameraOptions(s){const h={top:0,bottom:0,right:0,left:0};if(typeof(s=l.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){const _=s.padding;s.padding={top:_,bottom:_,right:_,left:_}}return s.padding=l.extend(h,s.padding),s}_cameraForBoxAndBearing(s,h,_,x){const b=this._extendCameraOptions(x),E=this.transform,S=E.padding,k=E.project(l.LngLat.convert(s)),P=E.project(l.LngLat.convert(h)),O=new l.pointGeometry(k.x,P.y),F=new l.pointGeometry(P.x,k.y),G=-l.degToRad(_),H=k.rotate(G),q=P.rotate(G),V=O.rotate(G),ie=F.rotate(G),Z=new l.pointGeometry(Math.max(H.x,q.x,V.x,ie.x),Math.max(H.y,q.y,V.y,ie.y)),ee=new l.pointGeometry(Math.min(H.x,q.x,V.x,ie.x),Math.min(H.y,q.y,V.y,ie.y)),te=Z.sub(ee),re=(E.width-((S.left||0)+(S.right||0)+b.padding.left+b.padding.right))/te.x,Q=(E.height-((S.top||0)+(S.bottom||0)+b.padding.top+b.padding.bottom))/te.y;if(Q<0||re<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ae=Math.min(E.scaleZoom(E.scale*Math.min(re,Q)),b.maxZoom),ye=typeof b.offset.x=="number"&&typeof b.offset.y=="number"?new l.pointGeometry(b.offset.x,b.offset.y):l.pointGeometry.convert(b.offset),Te=new l.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(_*Math.PI/180),Me=ye.add(Te).mult(E.scale/E.zoomScale(ae));return{center:E.unproject(k.add(P).div(2).sub(Me)),zoom:ae,bearing:_}}_cameraForBox(s,h,_,x,b){const E=this._extendCameraOptions(b);_=_||0,x=x||0,s=l.LngLat.convert(s),h=l.LngLat.convert(h);const S=this.transform.clone();S.padding=E.padding;const k=this.getFreeCameraOptions(),P=new l.LngLat(.5*(s.lng+h.lng),.5*(s.lat+h.lat)),O=.5*(_+x);if(S._camera.position[2]<l.mercatorZfromAltitude(O,P.lat))return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");k.lookAtPoint(P),S.setFreeCameraOptions(k);const F=l.MercatorCoordinate.fromLngLat(s),G=l.MercatorCoordinate.fromLngLat(h),H=S.pointRayIntersection(S.centerPoint,O),q=[(V=S.rayIntersectionCoordinate(H)).x,V.y,V.z];var V;const ie=S.screenPointToMercatorRay(S.centerPoint),Z=S.projection.name!=="globe";let ee,te=0;do{const re=Math.floor(S.zoom),Q=1<<re,ae=Math.min(Q*F.x,Q*G.x),ye=Math.min(Q*F.y,Q*G.y),Te=Math.max(Q*F.x,Q*G.x),Me=Math.max(Q*F.y,Q*G.y),Ae=new l.Aabb([ae,ye,_],[Te,Me,x]),We=l.Frustum.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,re,Z);if(Ae.intersects(We)!==2){ee&&(S._camera.position=l.scaleAndAdd([],S._camera.position,ie.dir,-ee),S._updateStateFromCamera());break}const ve=l.sub([],S._camera.position,q);ee=.5*l.length(ve),S._camera.position=l.scaleAndAdd([],S._camera.position,ie.dir,ee);try{S._updateStateFromCamera()}catch{return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++te<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(s,h,_){return this._fitInternal(this.cameraForBounds(s,h),h,_)}_raycastElevationBox(s,h){const _=this.transform.elevation;if(!_)return;const x=new l.pointGeometry(s.x,h.y),b=new l.pointGeometry(h.x,s.y),E=_.pointCoordinate(s);if(!E)return;const S=_.pointCoordinate(h);if(!S)return;const k=_.pointCoordinate(x);if(!k)return;const P=_.pointCoordinate(b);if(!P)return;const O=new l.MercatorCoordinate(E[0],E[1]).toLngLat(),F=new l.MercatorCoordinate(S[0],S[1]).toLngLat(),G=new l.MercatorCoordinate(k[0],k[1]).toLngLat(),H=new l.MercatorCoordinate(P[0],P[1]).toLngLat(),q=Math.min(O.lng,Math.min(F.lng,Math.min(G.lng,H.lng))),V=Math.min(O.lat,Math.min(F.lat,Math.min(G.lat,H.lat))),ie=Math.max(O.lng,Math.max(F.lng,Math.max(G.lng,H.lng))),Z=Math.max(O.lat,Math.max(F.lat,Math.max(G.lat,H.lat))),ee=Math.min(E[3],Math.min(S[3],Math.min(k[3],P[3]))),te=Math.max(E[3],Math.max(S[3],Math.max(k[3],P[3])));return{minLngLat:new l.LngLat(q,V),maxLngLat:new l.LngLat(ie,Z),minAltitude:ee,maxAltitude:te}}fitScreenCoordinates(s,h,_,x,b){let E,S,k,P;const O=l.pointGeometry.convert(s),F=l.pointGeometry.convert(h),G=this._raycastElevationBox(O,F);if(G)E=G.minLngLat,S=G.maxLngLat,k=G.minAltitude,P=G.maxAltitude;else{if(this.transform.anyCornerOffEdge(O,F))return this;E=this.transform.pointLocation(O),S=this.transform.pointLocation(F)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(s)),this.transform.pointLocation(l.pointGeometry.convert(h)),_,x):this._cameraForBox(E,S,k,P,x),x,b)}_fitInternal(s,h,_){return s?(delete(h=l.extend(s,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(s,h){this.stop();const _=s.preloadOnly?this.transform.clone():this.transform;let x=!1,b=!1,E=!1;return"zoom"in s&&_.zoom!==+s.zoom&&(x=!0,_.zoom=+s.zoom),s.center!==void 0&&(_.center=l.LngLat.convert(s.center)),"bearing"in s&&_.bearing!==+s.bearing&&(b=!0,_.bearing=+s.bearing),"pitch"in s&&_.pitch!==+s.pitch&&(E=!0,_.pitch=+s.pitch),s.padding==null||_.isPaddingEqual(s.padding)||(_.padding=s.padding),s.preloadOnly?(this._preloadTiles(_),this):(this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),x&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),b&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),E&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||l.warnOnce(Hu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return l.warnOnce(Hu),this;this.stop();const x=_.zoom,b=_.pitch,E=_.bearing;_.setFreeCameraOptions(s);const S=x!==_.zoom,k=b!==_.pitch,P=E!==_.bearing;return this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),S&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),P&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),k&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=l.extend({offset:[0,0],duration:500,easing:l.ease},s)).animate===!1||!s.essential&&l.exported.prefersReducedMotion)&&(s.duration=0);const _=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),S=this.getPadding(),k="zoom"in s?+s.zoom:x,P="bearing"in s?this._normalizeBearing(s.bearing,b):b,O="pitch"in s?+s.pitch:E,F="padding"in s?s.padding:_.padding,G=l.pointGeometry.convert(s.offset);let H,q,V;if(_.projection.name==="globe"){const Me=l.MercatorCoordinate.fromLngLat(_.center),Ae=G.rotate(-_.angle);Me.x+=Ae.x/_.worldSize,Me.y+=Ae.y/_.worldSize;const We=Me.toLngLat(),ve=l.LngLat.convert(s.center||We);this._normalizeCenter(ve),H=_.centerPoint.add(Ae),q=new l.pointGeometry(Me.x,Me.y).mult(_.worldSize),V=new l.pointGeometry(l.mercatorXfromLng(ve.lng),l.mercatorYfromLat(ve.lat)).mult(_.worldSize).sub(q)}else{H=_.centerPoint.add(G);const Me=_.pointLocation(H),Ae=l.LngLat.convert(s.center||Me);this._normalizeCenter(Ae),q=_.project(Me),V=_.project(Ae).sub(q)}const ie=_.zoomScale(k-x);let Z,ee;s.around&&(Z=l.LngLat.convert(s.around),ee=_.locationPoint(Z));const te=this._zooming||k!==x,re=this._rotating||b!==P,Q=this._pitching||O!==E,ae=!_.isPaddingEqual(F),ye=Me=>Ae=>{if(te&&(Me.zoom=l.number(x,k,Ae)),re&&(Me.bearing=l.number(b,P,Ae)),Q&&(Me.pitch=l.number(E,O,Ae)),ae&&(Me.interpolatePadding(S,F,Ae),H=Me.centerPoint.add(G)),Z)Me.setLocationAtPoint(Z,ee);else{const We=Me.zoomScale(Me.zoom-x),ve=k>x?Math.min(2,ie):Math.max(.5,ie),He=Math.pow(ve,1-Ae),$e=Me.unproject(q.add(V.mult(Ae*He)).mult(We));Me.setLocationAtPoint(Me.renderWorldCopies?$e.wrap():$e,H)}return s.preloadOnly||this._fireMoveEvents(h),Me};if(s.preloadOnly){const Me=this._emulate(ye,s.duration,_);return this._preloadTiles(Me),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=re,this._pitching=Q,this._padding=ae,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,Te),this._ease(ye(_),Me=>{_.recenterOnTerrain(),this._afterEase(h,Me)},s),this}_prepareEase(s,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new l.Event("movestart",s)),this._zooming&&!_.zooming&&this.fire(new l.Event("zoomstart",s)),this._rotating&&!_.rotating&&this.fire(new l.Event("rotatestart",s)),this._pitching&&!_.pitching&&this.fire(new l.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new l.Event("move",s)),this._zooming&&this.fire(new l.Event("zoom",s)),this._rotating&&this.fire(new l.Event("rotate",s)),this._pitching&&this.fire(new l.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new l.Event("zoomend",s)),x&&this.fire(new l.Event("rotateend",s)),b&&this.fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}flyTo(s,h){if(!s.essential&&l.exported.prefersReducedMotion){const dt=l.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(dt,h)}this.stop(),s=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},s);const _=this.transform,x=this.getZoom(),b=this.getBearing(),E=this.getPitch(),S=this.getPadding(),k="zoom"in s?l.clamp(+s.zoom,_.minZoom,_.maxZoom):x,P="bearing"in s?this._normalizeBearing(s.bearing,b):b,O="pitch"in s?+s.pitch:E,F="padding"in s?s.padding:_.padding,G=_.zoomScale(k-x),H=l.pointGeometry.convert(s.offset);let q=_.centerPoint.add(H);const V=_.pointLocation(q),ie=l.LngLat.convert(s.center||V);this._normalizeCenter(ie);const Z=_.project(V),ee=_.project(ie).sub(Z);let te=s.curve;const re=Math.max(_.width,_.height),Q=re/G,ae=ee.mag();if("minZoom"in s){const dt=l.clamp(Math.min(s.minZoom,x,k),_.minZoom,_.maxZoom),ft=re/_.zoomScale(dt-x);te=Math.sqrt(ft/ae*2)}const ye=te*te;function Te(dt){const ft=(Q*Q-re*re+(dt?-1:1)*ye*ye*ae*ae)/(2*(dt?Q:re)*ye*ae);return Math.log(Math.sqrt(ft*ft+1)-ft)}function Me(dt){return(Math.exp(dt)-Math.exp(-dt))/2}function Ae(dt){return(Math.exp(dt)+Math.exp(-dt))/2}const We=Te(0);let ve=function(dt){return Ae(We)/Ae(We+te*dt)},He=function(dt){return re*((Ae(We)*(Me(ft=We+te*dt)/Ae(ft))-Me(We))/ye)/ae;var ft},$e=(Te(1)-We)/te;if(Math.abs(ae)<1e-6||!isFinite($e)){if(Math.abs(re-Q)<1e-6)return this.easeTo(s,h);const dt=Q<re?-1:1;$e=Math.abs(Math.log(Q/re))/te,He=function(){return 0},ve=function(ft){return Math.exp(dt*te*ft)}}s.duration="duration"in s?+s.duration:1e3*$e/("screenSpeed"in s?+s.screenSpeed/te:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const mt=b!==P,ke=O!==E,ht=!_.isPaddingEqual(F),St=dt=>ft=>{const Dt=ft*$e,Gt=1/ve(Dt);dt.zoom=ft===1?k:x+dt.scaleZoom(Gt),mt&&(dt.bearing=l.number(b,P,ft)),ke&&(dt.pitch=l.number(E,O,ft)),ht&&(dt.interpolatePadding(S,F,ft),q=dt.centerPoint.add(H));const Et=ft===1?ie:dt.unproject(Z.add(ee.mult(He(Dt))).mult(Gt));return dt.setLocationAtPoint(dt.renderWorldCopies?Et.wrap():Et,q),dt._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),dt};if(s.preloadOnly){const dt=this._emulate(St,s.duration,_);return this._preloadTiles(dt),this}return this._zooming=!0,this._rotating=mt,this._pitching=ke,this._padding=ht,this._prepareEase(h,!1),this._ease(St(_),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!s){const _=this.handlers;_&&_.stop(!1)}return this}_ease(s,h,_){_.animate===!1||_.duration===0?(s(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=_,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=l.wrap(s,-180,180);const _=Math.abs(s-h);return Math.abs(s-360-h)<_&&(s-=360),Math.abs(s+360-h)<_&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=s.lng-h.center.lng;s.lng+=_>180?-360:_<-180?360:0}_emulate(s,h,_){const x=Math.ceil(15*h/1e3),b=[],E=s(_.clone());for(let S=0;S<=x;S++){const k=E(S/x);b.push(k.clone())}return b}}class Ku{constructor(s={}){this.options=s,l.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const h=this.options&&this.options.compact;return this._map=s,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=$("button","mapboxgl-ctrl-attrib-button",this._container),$("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const _=this._map._getUIString(`AttributionControl.${h}`);s.setAttribute("aria-label",_),s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||l.config.ACCESS_TOKEN}];if(s){const _=h.reduce((x,b,E)=>(b.value&&(x+=`${b.key}=${b.value}${E<h.length-1?"&":""}`),x),"?");s.href=`${l.config.FEEDBACK_URL}/${_}${this._map._hash?this._map._hash.getHashString(!0):""}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._sourceCaches;for(const x in h){const b=h[x];if(b.used){const E=b.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s.sort((x,b)=>x.length-b.length),s=s.filter((x,b)=>{for(let E=b+1;E<s.length;E++)if(s[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const _=s.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,s.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class D_{constructor(){l.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=$("div","mapboxgl-ctrl");const h=$("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const h in s){const _=s[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class P_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const x of _)if(x.id===s)return void(x.cancelled=!0)}run(s=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Zu(p,s,h){if(p=new l.LngLat(p.lng,p.lat),s){const _=new l.LngLat(p.lng-360,p.lat),x=new l.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-h.center.lng)/360),E=h.locationPoint(p).distSqr(s),S=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint(_).distSqr(s)<E&&(S||Math.abs(_.lng-h.center.lng)<b)?p=_:h.locationPoint(x).distSqr(s)<E&&(S||Math.abs(x.lng-h.center.lng)<b)&&(p=x)}for(;Math.abs(p.lng-h.center.lng)>180;){const _=h.locationPoint(p);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;p.lng>h.center.lng?p.lng-=360:p.lng+=360}return p}const Xu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Yu extends l.Evented{constructor(s,h){if(super(),(s instanceof l.window.HTMLElement||h)&&(s=l.extend({element:s},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),s&&s.element)this._element=s.element,this._offset=l.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=$("div");const x=41,b=27,E=J("svg",{display:"block",height:x*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${x}`},this._element),S=J("radialGradient",{id:"shadowGradient"},J("defs",{},E));J("stop",{offset:"10%","stop-opacity":.4},S),J("stop",{offset:"100%","stop-opacity":.05},S),J("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),J("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),J("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),J("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=l.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in Xu)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const h=s.code,_=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const s=this._map;if(!s)return;const h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();const _=s.unproject(h);let x=!1;if(s.transform._terrainEnabled()&&s.getTerrain()){const E=s.getFreeCameraOptions();if(E.position){const S=E.position.toLngLat();x=S.distanceTo(_)<.9*S.distanceTo(this._lngLat)}}const b=(1-s._queryFogOpacity(_))*(x?.2:1);this._element.style.opacity=`${b}`,this._popup&&this._popup._setOpacity(`${b}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s)return;const h=this._offset.mult(this._scale),_=this._calculatePitch(),x=this._calculateRotation();this._element.style.transform=`
            translate(${s.x}px, ${s.y}px) ${Xu[this._anchor]}
            rotateX(${_}deg) rotateZ(${x}deg)
            translate(${h.x}px, ${h.y}px)
        `}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._map&&this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._map&&this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(s){l.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Zu(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),s===!0?this._updateFrameId=l.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!h.getTerrain()&&!h.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=l.pointGeometry.convert(s),this._update(),this}_onMove(s){const h=this._map;if(h){if(!this._isDragging){const _=this._clickTolerance||h._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(s){const h=this._map;h&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class cx{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const h=l.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,_){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+_}}const ux={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},_f={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function ac(p){p.parentNode&&p.parentNode.removeChild(p)}const gf={showCompass:!0,showZoom:!0,visualizePitch:!1};class yf{constructor(s,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Wa({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,_&&(this.mousePitch=new cf({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),Be()}move(s,h){const _=this.map,x=this.mouseRotate.mousemoveWindow(s,h),b=x&&x.bearingDelta;if(b&&_.setBearing(_.getBearing()+b),this.mousePitch){const E=this.mousePitch.mousemoveWindow(s,h),S=E&&E.pitchDelta;S&&_.setPitch(_.getPitch()+S)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){nt(),l.window.removeEventListener("mousemove",this.mousemove),l.window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(l.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),zt(this.element,s)),l.window.addEventListener("mousemove",this.mousemove),l.window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,zt(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=rt(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=rt(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const _r={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Pr,lc=0,la=!1;const vf={maxWidth:100,unit:"metric"};function Ju(p,s,h){const _=h&&h.maxWidth||100,x=p._containerHeight/2,b=p._containerWidth/2-_/2,E=p.unproject([b,x]),S=p.unproject([b+_,x]),k=E.distanceTo(S);if(h&&h.unit==="imperial"){const P=3.2808*k;P>5280?Ka(s,_,P/5280,p._getUIString("ScaleControl.Miles"),p):Ka(s,_,P,p._getUIString("ScaleControl.Feet"),p)}else h&&h.unit==="nautical"?Ka(s,_,k/1852,p._getUIString("ScaleControl.NauticalMiles"),p):k>=1e3?Ka(s,_,k/1e3,p._getUIString("ScaleControl.Kilometers"),p):Ka(s,_,k,p._getUIString("ScaleControl.Meters"),p)}function Ka(p,s,h,_,x){const b=function(S){const k=Math.pow(10,`${Math.floor(S)}`.length-1);let P=S/k;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(O){const F=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*F)/F}(P),k*P}(h),E=b/h;x._requestDomTask(()=>{p.style.width=s*E+"px",p.innerHTML=`${b}&nbsp;${_}`})}const Hr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cc(p=new l.pointGeometry(0,0),s="bottom"){if(typeof p=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new l.pointGeometry(0,p);case"top-left":return new l.pointGeometry(h,h);case"top-right":return new l.pointGeometry(-h,h);case"bottom":return new l.pointGeometry(0,-p);case"bottom-left":return new l.pointGeometry(h,-h);case"bottom-right":return new l.pointGeometry(-h,-h);case"left":return new l.pointGeometry(p,0);case"right":return new l.pointGeometry(-p,0)}return new l.pointGeometry(0,0)}return p instanceof l.pointGeometry||Array.isArray(p)?l.pointGeometry.convert(p):l.pointGeometry.convert(p[s]||[0,0])}const Za={version:l.version,supported:I,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends mf{constructor(p){if((p=l.extend({},_f,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&l.isSafariWithAntialiasingBug(l.window)&&(p.antialias=!1,l.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new $u(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new P_,this._domRenderTaskQueue=new P_,this._controls=[],this._markers=[],this._mapId=l.uniqueId(),this._locale=l.extend({},ux,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new cx(0),this._explicitProjection=null,this._requestManager=new l.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,typeof p.container=="string"){if(this._container=l.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof l.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&l.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),l.window!==void 0&&(l.window.addEventListener("online",this._onWindowOnline,!1),l.window.addEventListener("resize",this._onWindowResize,!1),l.window.addEventListener("orientationchange",this._onWindowResize,!1),l.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new k_(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new u_(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,l.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new Ku({customAttribution:p.customAttribution})),this._logoControl=new D_,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new l.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new l.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(p,s){if(s===void 0&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=p.onAdd(this);this._controls.push(p);const _=this._controlPositions[s];return s.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new l.Event("movestart",p)).fire(new l.Event("move",p)),this.fire(new l.Event("resize",p)),s&&this.fire(new l.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(l.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p==null?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p==null?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new l.Event("zoomstart")).fire(new l.Event("zoom")).fire(new l.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p==null?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p==null?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new l.Event("pitchstart")).fire(new l.Event("pitch")).fire(new l.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._updateProjection(p)}_updateProjection(p){p===null&&(this._explicitProjection=null);const s=p||this.getProjection(),h=this.transform.setProjection(s);if(p&&(this._explicitProjection=this.transform.getProjection()),h){this.painter.clearBackgroundTiles();for(const _ in this.style._sourceCaches)this.style._sourceCaches[_].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(p){return this.transform.locationPoint3D(l.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(l.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,s,h){if(p==="mouseenter"||p==="mouseover"){let _=!1;const x=E=>{const S=s.filter(P=>this.getLayer(P)),k=S.length?this.queryRenderedFeatures(E.point,{layers:S}):[];k.length?_||(_=!0,h.call(this,new Dr(p,this,E.originalEvent,{features:k}))):_=!1},b=()=>{_=!1};return{layers:new Set(s),listener:h,delegates:{mousemove:x,mouseout:b}}}if(p==="mouseleave"||p==="mouseout"){let _=!1;const x=E=>{const S=s.filter(k=>this.getLayer(k));(S.length?this.queryRenderedFeatures(E.point,{layers:S}):[]).length?_=!0:_&&(_=!1,h.call(this,new Dr(p,this,E.originalEvent)))},b=E=>{_&&(_=!1,h.call(this,new Dr(p,this,E.originalEvent)))};return{layers:new Set(s),listener:h,delegates:{mousemove:x,mouseout:b}}}{const _=x=>{const b=s.filter(S=>this.getLayer(S)),E=b.length?this.queryRenderedFeatures(x.point,{layers:b}):[];E.length&&(x.features=E,h.call(this,x),delete x.features)};return{layers:new Set(s),listener:h,delegates:{[p]:_}}}}on(p,s,h){if(h===void 0)return super.on(p,s);Array.isArray(s)||(s=[s]);const _=this._createDelegatedListener(p,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(p,s,h){if(h===void 0)return super.once(p,s);Array.isArray(s)||(s=[s]);const _=this._createDelegatedListener(p,s,h);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(p,s,h){if(h===void 0)return super.off(p,s);s=new Set(Array.isArray(s)?s:[s]);const _=(b,E)=>{if(b.size!==E.size)return!1;for(const S of b)if(!E.has(S))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[p]:void 0;return x&&(b=>{for(let E=0;E<b.length;E++){const S=b[E];if(S.listener===h&&_(S.layers,s)){for(const k in S.delegates)this.off(k,S.delegates[k]);return b.splice(E,1),this}}})(x),this}queryRenderedFeatures(p,s){return this.style?(s!==void 0||p===void 0||p instanceof l.pointGeometry||Array.isArray(p)||(s=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(p,s){return this.style.querySourceFeatures(p,s)}queryTerrainElevation(p,s){const h=this.transform.elevation;return h?(s=l.extend({},{exaggerated:!0},s),h.getAtPoint(l.MercatorCoordinate.fromLngLat(p),null,s.exaggerated)):null}setStyle(p,s){return(s=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){const s=this._locale[p];if(s==null)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new mr(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new mr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,s){if(typeof p=="string"){const h=this._requestManager.normalizeStyleURL(p),_=this._requestManager.transformRequest(h,l.ResourceType.Style);l.getJSON(_,(x,b)=>{x?this.fire(new l.ErrorEvent(x)):b&&this._updateDiff(b,s)})}else typeof p=="object"&&this._updateDiff(p,s)}_updateDiff(p,s){try{this.style.setState(p)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(p,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(l.warnOnce("There is no style added to the map."),!1)}addSource(p,s){return this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const s in p){const h=p[s]._tiles;for(const _ in h){const x=h[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(p,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,h)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,s,{pixelRatio:h=1,sdf:_=!1,stretchX:x,stretchY:b,content:E}={}){if(this._lazyInitEmptyStyle(),s instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&s instanceof l.window.ImageBitmap){const{width:S,height:k,data:P}=l.exported.getImageData(s);this.style.addImage(p,{data:new l.RGBAImage({width:S,height:k},P),pixelRatio:h,stretchX:x,stretchY:b,content:E,sdf:_,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:k}=s,P=s;this.style.addImage(p,{data:new l.RGBAImage({width:S,height:k},new Uint8Array(P.data)),pixelRatio:h,stretchX:x,stretchY:b,content:E,sdf:_,version:0,userImage:P}),P.onAdd&&P.onAdd(this,p)}}updateImage(p,s){const h=this.style.getImage(p);if(!h)return void this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=s instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&s instanceof l.window.ImageBitmap?l.exported.getImageData(s):s,{width:x,height:b}=_;x!==void 0&&b!==void 0?x===h.data.width&&b===h.data.height?(h.data.replace(_.data,!(s instanceof l.window.HTMLImageElement||l.window.ImageBitmap&&s instanceof l.window.ImageBitmap)),this.style.updateImage(p,h)):this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,s){l.getImage(this._requestManager.transformRequest(p,l.ResourceType.Image),(h,_)=>{s(h,_ instanceof l.window.HTMLImageElement?l.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(p,s){return this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)}moveLayer(p,s){return this.style.moveLayer(p,s),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,s,h){return this.style.setLayerZoomRange(p,s,h),this._update(!0)}setFilter(p,s,h={}){return this.style.setFilter(p,s,h),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,s,h,_={}){return this.style.setPaintProperty(p,s,h,_),this._update(!0)}getPaintProperty(p,s){return this.style.getPaintProperty(p,s)}setLayoutProperty(p,s,h,_={}){return this.style.setLayoutProperty(p,s,h,_),this._update(!0)}getLayoutProperty(p,s){return this.style.getLayoutProperty(p,s)}setLight(p,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(l.LngLat.convert(p),this.transform):0}setFeatureState(p,s){return this.style.setFeatureState(p,s),this._update()}removeFeatureState(p,s){return this.style.removeFeatureState(p,s),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let h,_,x,b=this._container;for(;b&&(!_||!x);){const E=l.window.getComputedStyle(b).transform;E&&E!=="none"&&(h=E.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(_=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(x=h[3])),b=b.parentElement}this._containerWidth=_?Math.abs(p/_):p,this._containerHeight=x?Math.abs(s/x):s}_detectMissingCSS(){l.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&l.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=$("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=$("div","mapboxgl-canvas-container",p);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=$("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=$("div","mapboxgl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=$("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){const h=l.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(p),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const s=this._markers.indexOf(p);s!==-1&&this._markers.splice(s,1)}_setupPainter(){const p=l.extend({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);s?(l.storeAuthState(s,!0),this.painter=new l_(s,this.transform),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),l.exported$1.testSupport(s)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;const h=this.painter.context.extTimerQuery,_=l.exported.now();if(this.listens("gpu-timing-frame")&&(s=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;let x=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,P=this.transform.pitch,O=l.exported.now();this.style.zoomHistory.update(k,O);const F=new l.EvaluationParameters(k,{now:O,fadeDuration:b,pitch:P,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=F.crossFadingFactor();G===1&&G===this._crossFadingFactor||(x=!0,this._crossFadingFactor=G),this.style.update(F)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerUpdate()):E=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const k=l.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,s),setTimeout(()=>{const P=h.getQueryObjectEXT(s,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(s),this.fire(new l.Event("gpu-timing-frame",{cpuTime:k,gpuTime:P}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(k);this.fire(new l.Event("gpu-timing-layer",{layerTimes:P}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(S||this._repaint)this.triggerRepaint();else{const k=!this.isMoving()&&this.loaded();if(k&&(E=this._updateAverageElevation(_,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new l.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new l.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,s=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);if((s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;const E=Math.abs(_-x);if(E>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(x),h(x);this._averageElevation.easeTo(x,p,300)}else if(E>1e-4)return this._averageElevation.jumpTo(x),h(x)}return!!this._averageElevation.isEasing(p)&&h(this._averageElevation.getValue(p))}_authenticate(){l.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===l.AUTH_ERR_MSG||p.status===401)){const s=this.painter.context.gl;l.storeAuthState(s,!1),this._logoControl instanceof D_&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new l.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),l.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function x(b){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,b,0);const E=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,E),E}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(x(p),s.canvasCopies.map(x),s.timeStamps)}_canvasPixelComparison(p,s,h){let _=h[1]-h[0];const x=p.length/4;for(let b=0;b<s.length;b++){const E=s[b];let S=0;for(let k=0;k<E.length;k+=4)E[k]===p[k]&&E[k+1]===p[k+1]&&E[k+2]===p[k+2]&&E[k+3]===p[k+3]&&(S+=1);_+=(h[b+2]-h[b+1])*(1-S/x)}return _}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),l.window!==void 0&&(l.window.removeEventListener("resize",this._onWindowResize,!1),l.window.removeEventListener("orientationchange",this._onWindowResize,!1),l.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),l.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),ac(this._canvasContainer),ac(this._controlContainer),ac(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),l.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=l.exported.frame(s=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(p){const s=this.style?Object.values(this.style._sourceCaches):[];return l.asyncAll(s,(h,_)=>h._preloadTiles(p,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,s){l.setCacheLimits(p,s)}get version(){return l.version}},NavigationControl:class{constructor(p){this.options=l.extend({},gf,p),this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),$("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),$("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=$("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const s=p.getZoom(),h=s===p.getMaxZoom(),_=s===p.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yf(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){const h=$("button",p,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(p,s){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",h),p.firstElementChild&&p.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends l.Evented{constructor(p){super(),this.options=l.extend({},_r,p),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=lf(this._updateMarkerRotation,20)}onAdd(p){var s;return this._map=p,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,Pr!==void 0?s(Pr):l.window.navigator.permissions!==void 0?l.window.navigator.permissions.query({name:"geolocation"}).then(h=>{Pr=h.state!=="denied",s(Pr)}):(Pr=!!l.window.navigator.geolocation,s(Pr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,lc=0,la=!1}_isOutOfMapMaxBounds(p){const s=this._map.getMaxBounds(),h=p.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",p)),this._finish()}}_updateCamera(p){const s=new l.LngLat(p.coords.longitude,p.coords.latitude),h=p.coords.accuracy,_=this._map.getBearing(),x=l.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),x,{geolocateSource:!0})}_updateMarker(p){if(p){const s=new l.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._containerHeight/2,s=this._map.unproject([0,p]),h=this._map.unproject([100,p]),_=s.distanceTo(h)/100,x=Math.ceil(2*this._accuracy/_);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&la)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=$("button","mapboxgl-ctrl-geolocate",this._container),$("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$("div","mapboxgl-user-location"),this._dotElement.appendChild($("div","mapboxgl-user-location-dot")),this._dotElement.appendChild($("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=$("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":lc--,la=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),lc++,lc>1?(p={maximumAge:6e5,timeout:0},la=!0):(p=this.options.positionOptions,la=!1),this._geolocationWatchID=l.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else l.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{l.window.addEventListener("ondeviceorientationabsolute"in l.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};l.window.DeviceMotionEvent!==void 0&&typeof l.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&p()}).catch(console.error):p()}_clearWatch(){l.window.navigator.geolocation.clearWatch(this._geolocationWatchID),l.window.removeEventListener("deviceorientation",this._onDeviceOrientation),l.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ku,ScaleControl:class{constructor(p){this.options=l.extend({},vf,p),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ju(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=$("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,Ju(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof l.window.HTMLElement?this._container=p.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in l.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in l.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=$("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,l.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!l.window.document.fullscreenEnabled&&!l.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=$("button","mapboxgl-ctrl-fullscreen",this._controlContainer);$("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),l.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(l.window.document.fullscreenElement||l.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?l.window.document.exitFullscreen?l.window.document.exitFullscreen():l.window.document.webkitCancelFullScreen&&l.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends l.Evented{constructor(p){super(),this.options=l.extend(Object.create(Hr),p),l.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=l.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(l.window.document.createTextNode(p))}setHTML(p){const s=l.window.document.createDocumentFragment(),h=l.window.document.createElement("body");let _;for(h.innerHTML=p;_=h.firstChild,_;)s.appendChild(_);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=$("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){const h=this._closeButton=$("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const s=this._map,h=this._container,_=this._pos;if(!s||!h||!_)return"bottom";const x=h.offsetWidth,b=h.offsetHeight,E=_.x<x/2,S=_.x>s.transform.width-x/2;if(_.y+p<b)return E?"top-left":S?"top-right":"top";if(_.y>s.transform.height-b){if(E)return"bottom-left";if(S)return"bottom-right"}return E?"left":S?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){const s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=$("div","mapboxgl-popup",s.getContainer()),this._tip=$("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zu(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){const x=this._pos=this._trackPointer&&p?p:s.project(this._lngLat),b=cc(this.options.offset),E=this._anchor=this._getAnchor(b.y),S=cc(this.options.offset,E),k=x.add(S).round();s._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Xu[E]} translate(${k.x}px,${k.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Gi);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:Yu,Style:mr,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,FreeCameraOptions:Jl,Evented:l.Evented,config:l.config,prewarm:function(){Lt().acquire(kt)},clearPrewarmedResources:function(){const p=It;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(kt),It=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return l.config.ACCESS_TOKEN},set accessToken(p){l.config.ACCESS_TOKEN=p},get baseApiUrl(){return l.config.API_URL},set baseApiUrl(p){l.config.API_URL=p},get workerCount(){return Tt.workerCount},set workerCount(p){Tt.workerCount=p},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){l.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){l.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:l.exported.setNow,restoreNow:l.exported.restoreNow};return Za});var y=c;return y})})(JD);var r7=JD.exports;const _q={setup(t){pq();const e=dk(!1);let i;return Ck(()=>{i=UD(),t6(i,r=>{r?e.value=!0:e.value=!1})}),(r,c)=>{const f=f5("router-view");return Uk(),$k(f)}}},gq="modulepreload",lC={},yq="/",Oo=function(e,i){return!i||i.length===0?e():Promise.all(i.map(r=>{if(r=`${yq}${r}`,r in lC)return;lC[r]=!0;const c=r.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${f}`))return;const y=document.createElement("link");if(y.rel=c?"stylesheet":gq,c||(y.as="script",y.crossOrigin=""),y.href=r,document.head.appendChild(y),c)return new Promise((l,I)=>{y.addEventListener("load",l),y.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>e())},eP=dq({history:CG(),routes:[{path:"/",component:()=>Oo(()=>import("./Home.9065e894.js"),["assets/Home.9065e894.js","assets/healthcare.154b7c27.js","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/register",component:()=>Oo(()=>import("./Register.f103da70.js"),["assets/Register.f103da70.js","assets/healthcare.154b7c27.js"])},{path:"/log-in",component:()=>Oo(()=>import("./Log-in.378a0384.js"),["assets/Log-in.378a0384.js","assets/healthcare.154b7c27.js"])},{path:"/HRCProvider/SearchHistory/",component:()=>Oo(()=>import("./SearchHistory.141ebc69.js"),["assets/SearchHistory.141ebc69.js","assets/SearchHistory.0841e97c.css","assets/ProjectWeberRenew.dc78a7b0.js","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/HRCProvider/GISFinder",component:()=>Oo(()=>import("./GISSearch.b73a2371.js").then(function(t){return t.lr}),["assets/GISSearch.b73a2371.js","assets/GISSearch.2dbd3ab5.css","assets/ProjectWeberRenew.dc78a7b0.js","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/HRCProvider",component:()=>Oo(()=>import("./ProviderHub.3f115963.js"),["assets/ProviderHub.3f115963.js","assets/ProviderHub.0fa6d06f.css","assets/ProjectWeberRenew.dc78a7b0.js","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/findHRC/:name",component:()=>Oo(()=>import("./findHRC.0447f0ad.js"),["assets/findHRC.0447f0ad.js","assets/findHRC.25e5b8f1.css"])},{path:"/HRCDetails/:name",component:()=>Oo(()=>import("./HRCDetails.07a985d0.js"),["assets/HRCDetails.07a985d0.js","assets/HRCDetails.455f14a1.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/HRCProvider/HRCForm",component:()=>Oo(()=>import("./HRCForm.780fb71d.js"),["assets/HRCForm.780fb71d.js","assets/HRCForm.67b6e7a1.css","assets/plugin-vue_export-helper.21dcd24c.js"])},{path:"/underconstruction",component:()=>Oo(()=>import("./Feed.a11bffc0.js"),["assets/Feed.a11bffc0.js","assets/plugin-vue_export-helper.21dcd24c.js"])}]});eP.beforeEach((t,e,i)=>{t.matched.some(r=>r.meta.requiresAuth)?(console.log("checking?"),UD().currentUser?(i(),console.log("redirecting")):(alert("you dont have access!"),i("/"))):i()});var vq="firebase",xq="9.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ir(vq,xq,"app");const tP="@firebase/installations",w1="0.5.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iP=1e4,nP=`w:${w1}`,rP="FIS_v2",bq="https://firebaseinstallations.googleapis.com/v1",wq=60*60*1e3,Eq="installations",Tq="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iq={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},Qc=new fu(Eq,Tq,Iq);function sP(t){return t instanceof Ko&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oP({projectId:t}){return`${bq}/projects/${t}/installations`}function aP(t){return{token:t.token,requestStatus:2,expiresIn:Aq(t.expiresIn),creationTime:Date.now()}}async function lP(t,e){const r=(await e.json()).error;return Qc.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function cP({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function Sq(t,{refreshToken:e}){const i=cP(t);return i.append("Authorization",Cq(e)),i}async function uP(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Aq(t){return Number(t.replace("s","000"))}function Cq(t){return`${rP} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mq({appConfig:t,heartbeatServiceProvider:e},{fid:i}){const r=oP(t),c=cP(t),f=e.getImmediate({optional:!0});if(f){const C=await f.getHeartbeatsHeader();C&&c.append("x-firebase-client",C)}const y={fid:i,authVersion:rP,appId:t.appId,sdkVersion:nP},l={method:"POST",headers:c,body:JSON.stringify(y)},I=await uP(()=>fetch(r,l));if(I.ok){const C=await I.json();return{fid:C.fid||i,registrationStatus:2,refreshToken:C.refreshToken,authToken:aP(C.authToken)}}else throw await lP("Create Installation",I)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hP(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kq(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dq=/^[cdef][\w-]{21}$/,Fb="";function Pq(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const i=Rq(t);return Dq.test(i)?i:Fb}catch{return Fb}}function Rq(t){return kq(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mv(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP=new Map;function fP(t,e){const i=mv(t);pP(i,e),Lq(i,e)}function pP(t,e){const i=dP.get(t);if(!!i)for(const r of i)r(e)}function Lq(t,e){const i=Oq();i&&i.postMessage({key:t,fid:e}),zq()}let Rc=null;function Oq(){return!Rc&&"BroadcastChannel"in self&&(Rc=new BroadcastChannel("[Firebase] FID Change"),Rc.onmessage=t=>{pP(t.data.key,t.data.fid)}),Rc}function zq(){dP.size===0&&Rc&&(Rc.close(),Rc=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nq="firebase-installations-database",Fq=1,eu="firebase-installations-store";let N0=null;function E1(){return N0||(N0=aD(Nq,Fq,(t,e)=>{switch(e){case 0:t.createObjectStore(eu)}})),N0}async function dy(t,e){const i=mv(t),c=(await E1()).transaction(eu,"readwrite"),f=c.objectStore(eu),y=await f.get(i);return await f.put(e,i),await c.complete,(!y||y.fid!==e.fid)&&fP(t,e.fid),e}async function mP(t){const e=mv(t),r=(await E1()).transaction(eu,"readwrite");await r.objectStore(eu).delete(e),await r.complete}async function _v(t,e){const i=mv(t),c=(await E1()).transaction(eu,"readwrite"),f=c.objectStore(eu),y=await f.get(i),l=e(y);return l===void 0?await f.delete(i):await f.put(l,i),await c.complete,l&&(!y||y.fid!==l.fid)&&fP(t,l.fid),l}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T1(t){let e;const i=await _v(t.appConfig,r=>{const c=Bq(r),f=Uq(t,c);return e=f.registrationPromise,f.installationEntry});return i.fid===Fb?{installationEntry:await e}:{installationEntry:i,registrationPromise:e}}function Bq(t){const e=t||{fid:Pq(),registrationStatus:0};return _P(e)}function Uq(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const c=Promise.reject(Qc.create("app-offline"));return{installationEntry:e,registrationPromise:c}}const i={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=Vq(t,i);return{installationEntry:i,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:$q(t)}:{installationEntry:e}}async function Vq(t,e){try{const i=await Mq(t,e);return dy(t.appConfig,i)}catch(i){throw sP(i)&&i.customData.serverCode===409?await mP(t.appConfig):await dy(t.appConfig,{fid:e.fid,registrationStatus:0}),i}}async function $q(t){let e=await cC(t.appConfig);for(;e.registrationStatus===1;)await hP(100),e=await cC(t.appConfig);if(e.registrationStatus===0){const{installationEntry:i,registrationPromise:r}=await T1(t);return r||i}return e}function cC(t){return _v(t,e=>{if(!e)throw Qc.create("installation-not-found");return _P(e)})}function _P(t){return jq(t)?{fid:t.fid,registrationStatus:0}:t}function jq(t){return t.registrationStatus===1&&t.registrationTime+iP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gq({appConfig:t,heartbeatServiceProvider:e},i){const r=qq(t,i),c=Sq(t,i),f=e.getImmediate({optional:!0});if(f){const C=await f.getHeartbeatsHeader();C&&c.append("x-firebase-client",C)}const y={installation:{sdkVersion:nP,appId:t.appId}},l={method:"POST",headers:c,body:JSON.stringify(y)},I=await uP(()=>fetch(r,l));if(I.ok){const C=await I.json();return aP(C)}else throw await lP("Generate Auth Token",I)}function qq(t,{fid:e}){return`${oP(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I1(t,e=!1){let i;const r=await _v(t.appConfig,f=>{if(!gP(f))throw Qc.create("not-registered");const y=f.authToken;if(!e&&Kq(y))return f;if(y.requestStatus===1)return i=Wq(t,e),f;{if(!navigator.onLine)throw Qc.create("app-offline");const l=Xq(f);return i=Hq(t,l),l}});return i?await i:r.authToken}async function Wq(t,e){let i=await uC(t.appConfig);for(;i.authToken.requestStatus===1;)await hP(100),i=await uC(t.appConfig);const r=i.authToken;return r.requestStatus===0?I1(t,e):r}function uC(t){return _v(t,e=>{if(!gP(e))throw Qc.create("not-registered");const i=e.authToken;return Yq(i)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function Hq(t,e){try{const i=await Gq(t,e),r=Object.assign(Object.assign({},e),{authToken:i});return await dy(t.appConfig,r),i}catch(i){if(sP(i)&&(i.customData.serverCode===401||i.customData.serverCode===404))await mP(t.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await dy(t.appConfig,r)}throw i}}function gP(t){return t!==void 0&&t.registrationStatus===2}function Kq(t){return t.requestStatus===2&&!Zq(t)}function Zq(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+wq}function Xq(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function Yq(t){return t.requestStatus===1&&t.requestTime+iP<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jq(t){const e=t,{installationEntry:i,registrationPromise:r}=await T1(e);return r?r.catch(console.error):I1(e).catch(console.error),i.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qq(t,e=!1){const i=t;return await eW(i),(await I1(i,e)).token}async function eW(t){const{registrationPromise:e}=await T1(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tW(t){if(!t||!t.options)throw F0("App Configuration");if(!t.name)throw F0("App Name");const e=["projectId","apiKey","appId"];for(const i of e)if(!t.options[i])throw F0(i);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function F0(t){return Qc.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yP="installations",iW="installations-internal",nW=t=>{const e=t.getProvider("app").getImmediate(),i=tW(e),r=xd(e,"heartbeat");return{app:e,appConfig:i,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},rW=t=>{const e=t.getProvider("app").getImmediate(),i=xd(e,yP).getImmediate();return{getId:()=>Jq(i),getToken:c=>Qq(i,c)}};function sW(){Ns(new Is(yP,nW,"PUBLIC")),Ns(new Is(iW,rW,"PRIVATE"))}sW();Ir(tP,w1);Ir(tP,w1,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hC="analytics",oW="firebase_id",aW="origin",lW=60*1e3,cW="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",vP="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ys=new vd("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xP(t){return Promise.all(t.map(e=>e.catch(i=>i)))}function uW(t,e){const i=document.createElement("script");i.src=`${vP}?l=${t}&id=${e}`,i.async=!0,document.head.appendChild(i)}function hW(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function dW(t,e,i,r,c,f){const y=r[c];try{if(y)await e[y];else{const I=(await xP(i)).find(C=>C.measurementId===c);I&&await e[I.appId]}}catch(l){ys.error(l)}t("config",c,f)}async function fW(t,e,i,r,c){try{let f=[];if(c&&c.send_to){let y=c.send_to;Array.isArray(y)||(y=[y]);const l=await xP(i);for(const I of y){const C=l.find(R=>R.measurementId===I),L=C&&e[C.appId];if(L)f.push(L);else{f=[];break}}}f.length===0&&(f=Object.values(e)),await Promise.all(f),t("event",r,c||{})}catch(f){ys.error(f)}}function pW(t,e,i,r){async function c(f,y,l){try{f==="event"?await fW(t,e,i,y,l):f==="config"?await dW(t,e,i,r,y,l):t("set",y)}catch(I){ys.error(I)}}return c}function mW(t,e,i,r,c){let f=function(...y){window[r].push(arguments)};return window[c]&&typeof window[c]=="function"&&(f=window[c]),window[c]=pW(f,t,e,i),{gtagCore:f,wrappedGtag:window[c]}}function _W(){const t=window.document.getElementsByTagName("script");for(const e of Object.values(t))if(e.src&&e.src.includes(vP))return e;return null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gW={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},lo=new fu("analytics","Analytics",gW);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yW=30,vW=1e3;class xW{constructor(e={},i=vW){this.throttleMetadata=e,this.intervalMillis=i}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,i){this.throttleMetadata[e]=i}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const bP=new xW;function bW(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function wW(t){var e;const{appId:i,apiKey:r}=t,c={method:"GET",headers:bW(r)},f=cW.replace("{app-id}",i),y=await fetch(f,c);if(y.status!==200&&y.status!==304){let l="";try{const I=await y.json();!((e=I.error)===null||e===void 0)&&e.message&&(l=I.error.message)}catch{}throw lo.create("config-fetch-failed",{httpStatus:y.status,responseMessage:l})}return y.json()}async function EW(t,e=bP,i){const{appId:r,apiKey:c,measurementId:f}=t.options;if(!r)throw lo.create("no-app-id");if(!c){if(f)return{measurementId:f,appId:r};throw lo.create("no-api-key")}const y=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new SW;return setTimeout(async()=>{l.abort()},i!==void 0?i:lW),wP({appId:r,apiKey:c,measurementId:f},y,l,e)}async function wP(t,{throttleEndTimeMillis:e,backoffCount:i},r,c=bP){const{appId:f,measurementId:y}=t;try{await TW(r,e)}catch(l){if(y)return ys.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${y} provided in the "measurementId" field in the local Firebase config. [${l.message}]`),{appId:f,measurementId:y};throw l}try{const l=await wW(t);return c.deleteThrottleMetadata(f),l}catch(l){if(!IW(l)){if(c.deleteThrottleMetadata(f),y)return ys.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${y} provided in the "measurementId" field in the local Firebase config. [${l.message}]`),{appId:f,measurementId:y};throw l}const I=Number(l.customData.httpStatus)===503?SA(i,c.intervalMillis,yW):SA(i,c.intervalMillis),C={throttleEndTimeMillis:Date.now()+I,backoffCount:i+1};return c.setThrottleMetadata(f,C),ys.debug(`Calling attemptFetch again in ${I} millis`),wP(t,C,r,c)}}function TW(t,e){return new Promise((i,r)=>{const c=Math.max(e-Date.now(),0),f=setTimeout(i,c);t.addEventListener(()=>{clearTimeout(f),r(lo.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function IW(t){if(!(t instanceof Ko)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class SW{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AW(){if(iD())try{await nD()}catch(t){return ys.warn(lo.create("indexeddb-unavailable",{errorInfo:t}).message),!1}else return ys.warn(lo.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function CW(t,e,i,r,c,f,y){var l;const I=EW(t);I.then(J=>{i[J.measurementId]=J.appId,t.options.measurementId&&J.measurementId!==t.options.measurementId&&ys.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${J.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(J=>ys.error(J)),e.push(I);const C=AW().then(J=>{if(J)return r.getId()}),[L,R]=await Promise.all([I,C]);_W()||uW(f,L.measurementId),c("js",new Date);const $=(l=y==null?void 0:y.config)!==null&&l!==void 0?l:{};return $[aW]="firebase",$.update=!0,R!=null&&($[oW]=R),c("config",L.measurementId,$),L.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MW{constructor(e){this.app=e}_delete(){return delete Mp[this.app.options.appId],Promise.resolve()}}let Mp={},dC=[];const fC={};let B0="dataLayer",kW="gtag",pC,EP,mC=!1;function DW(){const t=[];if(o1()&&t.push("This is a browser extension environment."),c$()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,c)=>`(${c+1}) ${r}`).join(" "),i=lo.create("invalid-analytics-context",{errorInfo:e});ys.warn(i.message)}}function PW(t,e,i){DW();const r=t.options.appId;if(!r)throw lo.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)ys.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw lo.create("no-api-key");if(Mp[r]!=null)throw lo.create("already-exists",{id:r});if(!mC){hW(B0);const{wrappedGtag:f,gtagCore:y}=mW(Mp,dC,fC,B0,kW);EP=f,pC=y,mC=!0}return Mp[r]=CW(t,dC,fC,e,pC,B0,i),new MW(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function RW(t,e,i,r,c){if(c&&c.global){t("event",i,r);return}else{const f=await e,y=Object.assign(Object.assign({},r),{send_to:f});t("event",i,y)}}function LW(t,e,i,r){t=Ts(t),RW(EP,Mp[t.app.options.appId],e,i,r).catch(c=>ys.error(c))}const _C="@firebase/analytics",gC="0.7.8";function OW(){Ns(new Is(hC,(e,{options:i})=>{const r=e.getProvider("app").getImmediate(),c=e.getProvider("installations-internal").getImmediate();return PW(r,c,i)},"PUBLIC")),Ns(new Is("analytics-internal",t,"PRIVATE")),Ir(_C,gC),Ir(_C,gC,"esm2017");function t(e){try{const i=e.getProvider(hC).getImmediate();return{logEvent:(r,c,f)=>LW(i,r,c,f)}}catch(i){throw lo.create("interop-component-reg-failed",{reason:i})}}}OW();const yC="@firebase/database",vC="0.12.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TP="";function zW(t){TP=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NW{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,i){i==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),or(i))}get(e){const i=this.domStorage_.getItem(this.prefixedName_(e));return i==null?null:Gp(i)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FW{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,i){i==null?delete this.cache_[e]:this.cache_[e]=i}get(e){return Pa(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IP=function(t){try{if(typeof window!="undefined"&&typeof window[t]!="undefined"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new NW(e)}}catch{}return new FW},Lc=IP("localStorage"),Bb=IP("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nh=new vd("@firebase/database"),BW=function(){let t=1;return function(){return t++}}(),SP=function(t){const e=x$(t),i=new m$;i.update(e);const r=i.digest();return r1.encodeByteArray(r)},bm=function(...t){let e="";for(let i=0;i<t.length;i++){const r=t[i];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=bm.apply(null,r):typeof r=="object"?e+=or(r):e+=r,e+=" "}return e};let Gc=null,xC=!0;const UW=function(t,e){xt(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?(Nh.logLevel=Oi.VERBOSE,Gc=Nh.log.bind(Nh),e&&Bb.set("logging_enabled",!0)):typeof t=="function"?Gc=t:(Gc=null,Bb.remove("logging_enabled"))},br=function(...t){if(xC===!0&&(xC=!1,Gc===null&&Bb.get("logging_enabled")===!0&&UW(!0)),Gc){const e=bm.apply(null,t);Gc(e)}},wm=function(t){return function(...e){br(t,...e)}},Ub=function(...t){const e="FIREBASE INTERNAL ERROR: "+bm(...t);Nh.error(e)},tu=function(...t){const e=`FIREBASE FATAL ERROR: ${bm(...t)}`;throw Nh.error(e),new Error(e)},vs=function(...t){const e="FIREBASE WARNING: "+bm(...t);Nh.warn(e)},VW=function(){typeof window!="undefined"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&vs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},AP=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},$W=function(t){if(document.readyState==="complete")t();else{let e=!1;const i=function(){if(!document.body){setTimeout(i,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&i()}),window.attachEvent("onload",i))}},Qh="[MIN_NAME]",iu="[MAX_NAME]",Ed=function(t,e){if(t===e)return 0;if(t===Qh||e===iu)return-1;if(e===Qh||t===iu)return 1;{const i=bC(t),r=bC(e);return i!==null?r!==null?i-r===0?t.length-e.length:i-r:-1:r!==null?1:t<e?-1:1}},jW=function(t,e){return t===e?0:t<e?-1:1},sp=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+or(e))},S1=function(t){if(typeof t!="object"||t===null)return or(t);const e=[];for(const r in t)e.push(r);e.sort();let i="{";for(let r=0;r<e.length;r++)r!==0&&(i+=","),i+=or(e[r]),i+=":",i+=S1(t[e[r]]);return i+="}",i},CP=function(t,e){const i=t.length;if(i<=e)return[t];const r=[];for(let c=0;c<i;c+=e)c+e>i?r.push(t.substring(c,i)):r.push(t.substring(c,c+e));return r};function Bs(t,e){for(const i in t)t.hasOwnProperty(i)&&e(i,t[i])}const MP=function(t){xt(!AP(t),"Invalid JSON number");const e=11,i=52,r=(1<<e-1)-1;let c,f,y,l,I;t===0?(f=0,y=0,c=1/t===-1/0?1:0):(c=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),r),f=l+r,y=Math.round(t*Math.pow(2,i-l)-Math.pow(2,i))):(f=0,y=Math.round(t/Math.pow(2,1-r-i))));const C=[];for(I=i;I;I-=1)C.push(y%2?1:0),y=Math.floor(y/2);for(I=e;I;I-=1)C.push(f%2?1:0),f=Math.floor(f/2);C.push(c?1:0),C.reverse();const L=C.join("");let R="";for(I=0;I<64;I+=8){let $=parseInt(L.substr(I,8),2).toString(16);$.length===1&&($="0"+$),R=R+$}return R.toLowerCase()},GW=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},qW=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},WW=new RegExp("^-?(0*)\\d{1,10}$"),HW=-2147483648,KW=2147483647,bC=function(t){if(WW.test(t)){const e=Number(t);if(e>=HW&&e<=KW)return e}return null},Em=function(t){try{t()}catch(e){setTimeout(()=>{const i=e.stack||"";throw vs("Exception was thrown by user callback.",i),e},Math.floor(0))}},ZW=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},kp=function(t,e){const i=setTimeout(t,e);return typeof i=="object"&&i.unref&&i.unref(),i};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XW{constructor(e,i){this.appName_=e,this.appCheckProvider=i,this.appCheck=i==null?void 0:i.getImmediate({optional:!0}),this.appCheck||i==null||i.get().then(r=>this.appCheck=r)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((i,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(i,r):i(null)},0)})}addTokenChangeListener(e){var i;(i=this.appCheckProvider)===null||i===void 0||i.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){vs(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YW{constructor(e,i,r){this.appName_=e,this.firebaseOptions_=i,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(c=>this.auth_=c)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(i=>i&&i.code==="auth/token-not-initialized"?(br("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(i)):new Promise((i,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(i,r):i(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(i=>i.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(i=>i.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',vs(e)}}class Vb{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Vb.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A1="5",kP="v",DP="s",PP="r",RP="f",LP=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,OP="ls",JW="p",$b="ac",zP="websocket",NP="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QW{constructor(e,i,r,c,f=!1,y="",l=!1){this.secure=i,this.namespace=r,this.webSocketOnly=c,this.nodeAdmin=f,this.persistenceKey=y,this.includeNamespaceInQueryParams=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Lc.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Lc.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",i=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${i}`}}function eH(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function FP(t,e,i){xt(typeof e=="string","typeof type must == string"),xt(typeof i=="object","typeof params must == object");let r;if(e===zP)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===NP)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);eH(t)&&(i.ns=t.namespace);const c=[];return Bs(i,(f,y)=>{c.push(f+"="+y)}),r+c.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tH{constructor(){this.counters_={}}incrementCounter(e,i=1){Pa(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=i}get(){return s$(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U0={},V0={};function C1(t){const e=t.toString();return U0[e]||(U0[e]=new tH),U0[e]}function iH(t,e){const i=t.toString();return V0[i]||(V0[i]=e()),V0[i]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nH{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,i){this.closeAfterResponse=e,this.onClose=i,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,i){for(this.pendingResponses[e]=i;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let c=0;c<r.length;++c)r[c]&&Em(()=>{this.onMessage_(r[c])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wC="start",rH="close",sH="pLPCommand",oH="pRTLPCB",BP="id",UP="pw",VP="ser",aH="cb",lH="seg",cH="ts",uH="d",hH="dframe",$P=1870,jP=30,dH=$P-jP,fH=25e3,pH=3e4;class Ah{constructor(e,i,r,c,f,y,l){this.connId=e,this.repoInfo=i,this.applicationId=r,this.appCheckToken=c,this.authToken=f,this.transportSessionId=y,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=wm(e),this.stats_=C1(i),this.urlFn=I=>(this.appCheckToken&&(I[$b]=this.appCheckToken),FP(i,NP,I))}open(e,i){this.curSegmentNum=0,this.onDisconnect_=i,this.myPacketOrderer=new nH(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(pH)),$W(()=>{if(this.isClosed_)return;this.scriptTagHolder=new M1((...f)=>{const[y,l,I,C,L]=f;if(this.incrementIncomingBytes_(f),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,y===wC)this.id=l,this.password=I;else if(y===rH)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+y)},(...f)=>{const[y,l]=f;this.incrementIncomingBytes_(f),this.myPacketOrderer.handleResponse(y,l)},()=>{this.onClosed_()},this.urlFn);const r={};r[wC]="t",r[VP]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[aH]=this.scriptTagHolder.uniqueCallbackIdentifier),r[kP]=A1,this.transportSessionId&&(r[DP]=this.transportSessionId),this.lastSessionId&&(r[OP]=this.lastSessionId),this.applicationId&&(r[JW]=this.applicationId),this.appCheckToken&&(r[$b]=this.appCheckToken),typeof location!="undefined"&&location.hostname&&LP.test(location.hostname)&&(r[PP]=RP);const c=this.urlFn(r);this.log_("Connecting via long-poll to "+c),this.scriptTagHolder.addTag(c,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ah.forceAllow_=!0}static forceDisallow(){Ah.forceDisallow_=!0}static isAvailable(){return Ah.forceAllow_?!0:!Ah.forceDisallow_&&typeof document!="undefined"&&document.createElement!=null&&!GW()&&!qW()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const i=or(e);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const r=Yk(i),c=CP(r,dH);for(let f=0;f<c.length;f++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,c.length,c[f]),this.curSegmentNum++}addDisconnectPingFrame(e,i){this.myDisconnFrame=document.createElement("iframe");const r={};r[hH]="t",r[BP]=e,r[UP]=i,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const i=or(e).length;this.bytesReceived+=i,this.stats_.incrementCounter("bytes_received",i)}}class M1{constructor(e,i,r,c){this.onDisconnect=r,this.urlFn=c,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=BW(),window[sH+this.uniqueCallbackIdentifier]=e,window[oH+this.uniqueCallbackIdentifier]=i,this.myIFrame=M1.createIFrame_();let f="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"){const l=document.domain;f='<script>document.domain="'+l+'";<\/script>'}const y="<html><body>"+f+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(y),this.myIFrame.doc.close()}catch(l){br("frame writing exception"),l.stack&&br(l.stack),br(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||br("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,i){for(this.myID=e,this.myPW=i,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[BP]=this.myID,e[UP]=this.myPW,e[VP]=this.currentSerial;let i=this.urlFn(e),r="",c=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+jP+r.length<=$P;){const y=this.pendingSegs.shift();r=r+"&"+lH+c+"="+y.seg+"&"+cH+c+"="+y.ts+"&"+uH+c+"="+y.d,c++}return i=i+r,this.addLongPollTag_(i,this.currentSerial),!0}else return!1}enqueueSegment(e,i,r){this.pendingSegs.push({seg:e,ts:i,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,i){this.outstandingRequests.add(i);const r=()=>{this.outstandingRequests.delete(i),this.newRequest_()},c=setTimeout(r,Math.floor(fH)),f=()=>{clearTimeout(c),r()};this.addTag(e,f)}addTag(e,i){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const c=r.readyState;(!c||c==="loaded"||c==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),i())},r.onerror=()=>{br("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mH=16384,_H=45e3;let fy=null;typeof MozWebSocket!="undefined"?fy=MozWebSocket:typeof WebSocket!="undefined"&&(fy=WebSocket);class io{constructor(e,i,r,c,f,y,l){this.connId=e,this.applicationId=r,this.appCheckToken=c,this.authToken=f,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=wm(this.connId),this.stats_=C1(i),this.connURL=io.connectionURL_(i,y,l,c),this.nodeAdmin=i.nodeAdmin}static connectionURL_(e,i,r,c){const f={};return f[kP]=A1,typeof location!="undefined"&&location.hostname&&LP.test(location.hostname)&&(f[PP]=RP),i&&(f[DP]=i),r&&(f[OP]=r),c&&(f[$b]=c),FP(e,zP,f)}open(e,i){this.onDisconnect=i,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Lc.set("previous_websocket_failure",!0);try{if(!tD()){const r={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new fy(this.connURL,[],r)}}catch(r){this.log_("Error instantiating WebSocket.");const c=r.message||r.data;c&&this.log_(c),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const c=r.message||r.data;c&&this.log_(c),this.onClosed_()}}start(){}static forceDisallow(){io.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator!="undefined"&&navigator.userAgent){const i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&fy!==null&&!io.forceDisallow_}static previouslyFailed(){return Lc.isInMemoryStorage||Lc.get("previous_websocket_failure")===!0}markConnectionHealthy(){Lc.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const r=Gp(i);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(xt(this.frames===null,"We already have a frame buffer"),e.length<=6){const i=Number(e);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const i=e.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{const r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const i=or(e);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const r=CP(i,mH);r.length>1&&this.sendString_(String(r.length));for(let c=0;c<r.length;c++)this.sendString_(r[c])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(_H))}sendString_(e){try{this.mySock.send(e)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}io.responsesRequiredToBeHealthy=2;io.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k1{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Ah,io]}initTransports_(e){const i=io&&io.isAvailable();let r=i&&!io.previouslyFailed();if(e.webSocketOnly&&(i||vs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[io];else{const c=this.transports_=[];for(const f of k1.ALL_TRANSPORTS)f&&f.isAvailable()&&c.push(f)}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gH=6e4,yH=5e3,vH=10*1024,xH=100*1024,$0="t",EC="d",bH="s",TC="r",wH="e",IC="o",SC="a",AC="n",CC="p",EH="h";class TH{constructor(e,i,r,c,f,y,l,I,C,L){this.id=e,this.repoInfo_=i,this.applicationId_=r,this.appCheckToken_=c,this.authToken_=f,this.onMessage_=y,this.onReady_=l,this.onDisconnect_=I,this.onKill_=C,this.lastSessionId=L,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=wm("c:"+this.id+":"),this.transportManager_=new k1(i),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const i=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(i,r)},Math.floor(0));const c=e.healthyTimeout||0;c>0&&(this.healthyTimeout_=kp(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>xH?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>vH?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(c)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return i=>{e===this.conn_?this.onConnectionLost_(i):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return i=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(i):e===this.secondaryConn_?this.onSecondaryMessageReceived_(i):this.log_("message on old connection"))}}sendRequest(e){const i={t:"d",d:e};this.sendData_(i)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if($0 in e){const i=e[$0];i===SC?this.upgradeIfSecondaryHealthy_():i===TC?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):i===IC&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const i=sp("t",e),r=sp("d",e);if(i==="c")this.onSecondaryControl_(r);else if(i==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+i)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:CC,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SC,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:AC,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const i=sp("t",e),r=sp("d",e);i==="c"?this.onControl_(r):i==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const i=sp($0,e);if(EC in e){const r=e[EC];if(i===EH)this.onHandshake_(r);else if(i===AC){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let c=0;c<this.pendingDataMessages.length;++c)this.onDataMessage_(this.pendingDataMessages[c]);this.pendingDataMessages=[],this.tryCleanupConnection()}else i===bH?this.onConnectionShutdown_(r):i===TC?this.onReset_(r):i===wH?Ub("Server Error: "+r):i===IC?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ub("Unknown control packet command: "+i)}}onHandshake_(e){const i=e.ts,r=e.v,c=e.h;this.sessionId=e.s,this.repoInfo_.host=c,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,i),A1!==r&&vs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const i=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(i,r),kp(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(gH))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,i){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(i,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):kp(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(yH))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:CC,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Lc.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GP{put(e,i,r,c){}merge(e,i,r,c){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,i,r){}onDisconnectMerge(e,i,r){}onDisconnectCancel(e,i){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qP{constructor(e){this.allowedEvents_=e,this.listeners_={},xt(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...i){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let c=0;c<r.length;c++)r[c].callback.apply(r[c].context,i)}}on(e,i,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:i,context:r});const c=this.getInitialEvent(e);c&&i.apply(r,c)}off(e,i,r){this.validateEventType_(e);const c=this.listeners_[e]||[];for(let f=0;f<c.length;f++)if(c[f].callback===i&&(!r||r===c[f].context)){c.splice(f,1);return}}validateEventType_(e){xt(this.allowedEvents_.find(i=>i===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py extends qP{constructor(){super(["online"]),this.online_=!0,typeof window!="undefined"&&typeof window.addEventListener!="undefined"&&!lv()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new py}getInitialEvent(e){return xt(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MC=32,kC=768;class _n{constructor(e,i){if(i===void 0){this.pieces_=e.split("/");let r=0;for(let c=0;c<this.pieces_.length;c++)this.pieces_[c].length>0&&(this.pieces_[r]=this.pieces_[c],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=i}toString(){let e="";for(let i=this.pieceNum_;i<this.pieces_.length;i++)this.pieces_[i]!==""&&(e+="/"+this.pieces_[i]);return e||"/"}}function en(){return new _n("")}function zi(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ml(t){return t.pieces_.length-t.pieceNum_}function pn(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new _n(t.pieces_,e)}function WP(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function IH(t){let e="";for(let i=t.pieceNum_;i<t.pieces_.length;i++)t.pieces_[i]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[i])));return e||"/"}function HP(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function KP(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let i=t.pieceNum_;i<t.pieces_.length-1;i++)e.push(t.pieces_[i]);return new _n(e,0)}function Yn(t,e){const i=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)i.push(t.pieces_[r]);if(e instanceof _n)for(let r=e.pieceNum_;r<e.pieces_.length;r++)i.push(e.pieces_[r]);else{const r=e.split("/");for(let c=0;c<r.length;c++)r[c].length>0&&i.push(r[c])}return new _n(i,0)}function Di(t){return t.pieceNum_>=t.pieces_.length}function Os(t,e){const i=zi(t),r=zi(e);if(i===null)return e;if(i===r)return Os(pn(t),pn(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function ZP(t,e){if(Ml(t)!==Ml(e))return!1;for(let i=t.pieceNum_,r=e.pieceNum_;i<=t.pieces_.length;i++,r++)if(t.pieces_[i]!==e.pieces_[r])return!1;return!0}function so(t,e){let i=t.pieceNum_,r=e.pieceNum_;if(Ml(t)>Ml(e))return!1;for(;i<t.pieces_.length;){if(t.pieces_[i]!==e.pieces_[r])return!1;++i,++r}return!0}class SH{constructor(e,i){this.errorPrefix_=i,this.parts_=HP(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=cv(this.parts_[r]);XP(this)}}function AH(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=cv(e),XP(t)}function CH(t){const e=t.parts_.pop();t.byteLength_-=cv(e),t.parts_.length>0&&(t.byteLength_-=1)}function XP(t){if(t.byteLength_>kC)throw new Error(t.errorPrefix_+"has a key path longer than "+kC+" bytes ("+t.byteLength_+").");if(t.parts_.length>MC)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+MC+") or object contains a cycle "+Ac(t))}function Ac(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1 extends qP{constructor(){super(["visible"]);let e,i;typeof document!="undefined"&&typeof document.addEventListener!="undefined"&&(typeof document.hidden!="undefined"?(i="visibilitychange",e="hidden"):typeof document.mozHidden!="undefined"?(i="mozvisibilitychange",e="mozHidden"):typeof document.msHidden!="undefined"?(i="msvisibilitychange",e="msHidden"):typeof document.webkitHidden!="undefined"&&(i="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,i&&document.addEventListener(i,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}static getInstance(){return new D1}getInitialEvent(e){return xt(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const op=1e3,MH=60*5*1e3,kH=3*1e3,DC=30*1e3,DH=1.3,PH=3e4,RH="server_kill",PC=3;class Ta extends GP{constructor(e,i,r,c,f,y,l,I){if(super(),this.repoInfo_=e,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=c,this.onServerInfoUpdate_=f,this.authTokenProvider_=y,this.appCheckTokenProvider_=l,this.authOverride_=I,this.id=Ta.nextPersistentConnectionId_++,this.log_=wm("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=op,this.maxReconnectDelay_=MH,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,I&&!tD())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");D1.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&py.getInstance().on("online",this.onOnline_,this)}sendRequest(e,i,r){const c=++this.requestNumber_,f={r:c,a:e,b:i};this.log_(or(f)),xt(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(f),r&&(this.requestCBHash_[c]=r)}get(e){this.initConnection_();const i=new s1,r={p:e._path.toString(),q:e._queryObject},c={action:"g",request:r,onComplete:y=>{const l=y.d;y.s==="ok"?(this.onDataUpdate_(r.p,l,!1,null),i.resolve(l)):i.reject(l)}};this.outstandingGets_.push(c),this.outstandingGetCount_++;const f=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{const y=this.outstandingGets_[f];y===void 0||c!==y||(delete this.outstandingGets_[f],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),this.log_("get "+f+" timed out on connection"),i.reject(new Error("Client is offline.")))},kH),this.connected_&&this.sendGet_(f),i.promise}listen(e,i,r,c){this.initConnection_();const f=e._queryIdentifier,y=e._path.toString();this.log_("Listen called for "+y+" "+f),this.listens.has(y)||this.listens.set(y,new Map),xt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),xt(!this.listens.get(y).has(f),"listen() called twice for same path/queryId.");const l={onComplete:c,hashFn:i,query:e,tag:r};this.listens.get(y).set(f,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const i=this.outstandingGets_[e];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(e){const i=e.query,r=i._path.toString(),c=i._queryIdentifier;this.log_("Listen on "+r+" for "+c);const f={p:r},y="q";e.tag&&(f.q=i._queryObject,f.t=e.tag),f.h=e.hashFn(),this.sendRequest(y,f,l=>{const I=l.d,C=l.s;Ta.warnOnListenWarnings_(I,i),(this.listens.get(r)&&this.listens.get(r).get(c))===e&&(this.log_("listen response",l),C!=="ok"&&this.removeListen_(r,c),e.onComplete&&e.onComplete(C,I))})}static warnOnListenWarnings_(e,i){if(e&&typeof e=="object"&&Pa(e,"w")){const r=Xh(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const c='".indexOn": "'+i._queryParams.getIndex().toString()+'"',f=i._path.toString();vs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${c} at ${f} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||p$(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=DC)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,i=f$(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,c=>{const f=c.s,y=c.d||"error";this.authToken_===e&&(f==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(f,y))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const i=e.s,r=e.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(e,i){const r=e._path.toString(),c=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+c),xt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,c)&&this.connected_&&this.sendUnlisten_(r,c,e._queryObject,i)}sendUnlisten_(e,i,r,c){this.log_("Unlisten on "+e+" for "+i);const f={p:e},y="n";c&&(f.q=r,f.t=c),this.sendRequest(y,f)}onDisconnectPut(e,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,i,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:i,onComplete:r})}onDisconnectMerge(e,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,i,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:i,onComplete:r})}onDisconnectCancel(e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(e,i,r,c){const f={p:i,d:r};this.log_("onDisconnect "+e,f),this.sendRequest(e,f,y=>{c&&setTimeout(()=>{c(y.s,y.d)},Math.floor(0))})}put(e,i,r,c){this.putInternal("p",e,i,r,c)}merge(e,i,r,c){this.putInternal("m",e,i,r,c)}putInternal(e,i,r,c,f){this.initConnection_();const y={p:i,d:r};f!==void 0&&(y.h=f),this.outstandingPuts_.push({action:e,request:y,onComplete:c}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(e){const i=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,c=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(i,r,f=>{this.log_(i+" response",f),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),c&&c(f.s,f.d)})}reportStats(e){if(this.connected_){const i={c:e};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){const f=r.d;this.log_("reportStats","Error sending stats: "+f)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+or(e));const i=e.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,i){this.log_("handleServerMessage",e,i),e==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):e==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):e==="c"?this.onListenRevoked_(i.p,i.q):e==="ac"?this.onAuthRevoked_(i.s,i.d):e==="apc"?this.onAppCheckRevoked_(i.s,i.d):e==="sd"?this.onSecurityDebugPacket_(i):Ub("Unrecognized action received from server: "+or(e)+`
Are you using the latest client?`)}onReady_(e,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){xt(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=op,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=op,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>PH&&(this.reconnectDelay_=op),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-e);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*DH)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),c=this.id+":"+Ta.nextConnectionId_++,f=this.lastSessionId;let y=!1,l=null;const I=function(){l?l.close():(y=!0,r())},C=function(R){xt(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(R)};this.realtime_={close:I,sendRequest:C};const L=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[R,$]=await Promise.all([this.authTokenProvider_.getToken(L),this.appCheckTokenProvider_.getToken(L)]);y?br("getToken() completed but was canceled"):(br("getToken() completed. Creating connection."),this.authToken_=R&&R.accessToken,this.appCheckToken_=$&&$.token,l=new TH(c,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,i,r,J=>{vs(J+" ("+this.repoInfo_.toString()+")"),this.interrupt(RH)},f))}catch(R){this.log_("Failed to get token: "+R),y||(this.repoInfo_.nodeAdmin&&vs(R),I())}}}interrupt(e){br("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){br("Resuming connection for reason: "+e),delete this.interruptReasons_[e],kb(this.interruptReasons_)&&(this.reconnectDelay_=op,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const i=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const i=this.outstandingPuts_[e];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,i){let r;i?r=i.map(f=>S1(f)).join("$"):r="default";const c=this.removeListen_(e,r);c&&c.onComplete&&c.onComplete("permission_denied")}removeListen_(e,i){const r=new _n(e).toString();let c;if(this.listens.has(r)){const f=this.listens.get(r);c=f.get(i),f.delete(i),f.size===0&&this.listens.delete(r)}else c=void 0;return c}onAuthRevoked_(e,i){br("Auth token revoked: "+e+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=PC&&(this.reconnectDelay_=DC,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,i){br("App check token revoked: "+e+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=PC&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const i of e.values())this.sendListen_(i);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let i="js";e["sdk."+i+"."+TP.replace(/\./g,"-")]=1,lv()?e["framework.cordova"]=1:a1()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=py.getInstance().currentlyOnline();return kb(this.interruptReasons_)&&e}}Ta.nextPersistentConnectionId_=0;Ta.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ni{constructor(e,i){this.name=e,this.node=i}static Wrap(e,i){return new Ni(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,i){const r=new Ni(Qh,e),c=new Ni(Qh,i);return this.compare(r,c)!==0}minPost(){return Ni.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wg;class YP extends gv{static get __EMPTY_NODE(){return wg}static set __EMPTY_NODE(e){wg=e}compare(e,i){return Ed(e.name,i.name)}isDefinedOn(e){throw gd("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,i){return!1}minPost(){return Ni.MIN}maxPost(){return new Ni(iu,wg)}makePost(e,i){return xt(typeof e=="string","KeyIndex indexValue must always be a string."),new Ni(e,wg)}toString(){return".key"}}const Fh=new YP;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg{constructor(e,i,r,c,f=null){this.isReverse_=c,this.resultGenerator_=f,this.nodeStack_=[];let y=1;for(;!e.isEmpty();)if(e=e,y=i?r(e.key,i):1,c&&(y*=-1),y<0)this.isReverse_?e=e.left:e=e.right;else if(y===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),i;if(this.resultGenerator_?i=this.resultGenerator_(e.key,e.value):i={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return i}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Xn{constructor(e,i,r,c,f){this.key=e,this.value=i,this.color=r!=null?r:Xn.RED,this.left=c!=null?c:ls.EMPTY_NODE,this.right=f!=null?f:ls.EMPTY_NODE}copy(e,i,r,c,f){return new Xn(e!=null?e:this.key,i!=null?i:this.value,r!=null?r:this.color,c!=null?c:this.left,f!=null?f:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,r){let c=this;const f=r(e,c.key);return f<0?c=c.copy(null,null,null,c.left.insert(e,i,r),null):f===0?c=c.copy(null,i,null,null,null):c=c.copy(null,null,null,null,c.right.insert(e,i,r)),c.fixUp_()}removeMin_(){if(this.left.isEmpty())return ls.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,i){let r,c;if(r=this,i(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(e,r.key)===0){if(r.right.isEmpty())return ls.EMPTY_NODE;c=r.right.min_(),r=r.copy(c.key,c.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Xn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Xn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Xn.RED=!0;Xn.BLACK=!1;class LH{copy(e,i,r,c,f){return this}insert(e,i,r){return new Xn(e,i,null)}remove(e,i){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ls{constructor(e,i=ls.EMPTY_NODE){this.comparator_=e,this.root_=i}insert(e,i){return new ls(this.comparator_,this.root_.insert(e,i,this.comparator_).copy(null,null,Xn.BLACK,null,null))}remove(e){return new ls(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Xn.BLACK,null,null))}get(e){let i,r=this.root_;for(;!r.isEmpty();){if(i=this.comparator_(e,r.key),i===0)return r.value;i<0?r=r.left:i>0&&(r=r.right)}return null}getPredecessorKey(e){let i,r=this.root_,c=null;for(;!r.isEmpty();)if(i=this.comparator_(e,r.key),i===0){if(r.left.isEmpty())return c?c.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else i<0?r=r.left:i>0&&(c=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Eg(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,i){return new Eg(this.root_,e,this.comparator_,!1,i)}getReverseIteratorFrom(e,i){return new Eg(this.root_,e,this.comparator_,!0,i)}getReverseIterator(e){return new Eg(this.root_,null,this.comparator_,!0,e)}}ls.EMPTY_NODE=new LH;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OH(t,e){return Ed(t.name,e.name)}function P1(t,e){return Ed(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jb;function zH(t){jb=t}const JP=function(t){return typeof t=="number"?"number:"+MP(t):"string:"+t},QP=function(t){if(t.isLeafNode()){const e=t.val();xt(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Pa(e,".sv"),"Priority must be a string or number.")}else xt(t===jb||t.isEmpty(),"priority of unexpected type.");xt(t===jb||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let RC;class Kn{constructor(e,i=Kn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=i,this.lazyHash_=null,xt(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),QP(this.priorityNode_)}static set __childrenNodeConstructor(e){RC=e}static get __childrenNodeConstructor(){return RC}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Kn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Kn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Di(e)?this:zi(e)===".priority"?this.priorityNode_:Kn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,i){return null}updateImmediateChild(e,i){return e===".priority"?this.updatePriority(i):i.isEmpty()&&e!==".priority"?this:Kn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,i).updatePriority(this.priorityNode_)}updateChild(e,i){const r=zi(e);return r===null?i:i.isEmpty()&&r!==".priority"?this:(xt(r!==".priority"||Ml(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,Kn.__childrenNodeConstructor.EMPTY_NODE.updateChild(pn(e),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,i){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+JP(this.priorityNode_.val())+":");const i=typeof this.value_;e+=i+":",i==="number"?e+=MP(this.value_):e+=this.value_,this.lazyHash_=SP(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Kn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Kn.__childrenNodeConstructor?-1:(xt(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const i=typeof e.value_,r=typeof this.value_,c=Kn.VALUE_TYPE_ORDER.indexOf(i),f=Kn.VALUE_TYPE_ORDER.indexOf(r);return xt(c>=0,"Unknown leaf type: "+i),xt(f>=0,"Unknown leaf type: "+r),c===f?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:f-c}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const i=e;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}Kn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eR,tR;function NH(t){eR=t}function FH(t){tR=t}class BH extends gv{compare(e,i){const r=e.node.getPriority(),c=i.node.getPriority(),f=r.compareTo(c);return f===0?Ed(e.name,i.name):f}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,i){return!e.getPriority().equals(i.getPriority())}minPost(){return Ni.MIN}maxPost(){return new Ni(iu,new Kn("[PRIORITY-POST]",tR))}makePost(e,i){const r=eR(e);return new Ni(i,new Kn("[PRIORITY-POST]",r))}toString(){return".priority"}}const Tr=new BH;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UH=Math.log(2);class VH{constructor(e){const i=f=>parseInt(Math.log(f)/UH,10),r=f=>parseInt(Array(f+1).join("1"),2);this.count=i(e+1),this.current_=this.count-1;const c=r(this.count);this.bits_=e+1&c}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const my=function(t,e,i,r){t.sort(e);const c=function(I,C){const L=C-I;let R,$;if(L===0)return null;if(L===1)return R=t[I],$=i?i(R):R,new Xn($,R.node,Xn.BLACK,null,null);{const J=parseInt(L/2,10)+I,pe=c(I,J),Re=c(J+1,C);return R=t[J],$=i?i(R):R,new Xn($,R.node,Xn.BLACK,pe,Re)}},f=function(I){let C=null,L=null,R=t.length;const $=function(pe,Re){const we=R-pe,Be=R;R-=pe;const nt=c(we+1,Be),yt=t[we],lt=i?i(yt):yt;J(new Xn(lt,yt.node,Re,null,nt))},J=function(pe){C?(C.left=pe,C=pe):(L=pe,C=pe)};for(let pe=0;pe<I.count;++pe){const Re=I.nextBitIsOne(),we=Math.pow(2,I.count-(pe+1));Re?$(we,Xn.BLACK):($(we,Xn.BLACK),$(we,Xn.RED))}return L},y=new VH(t.length),l=f(y);return new ls(r||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let j0;const xh={};class wa{constructor(e,i){this.indexes_=e,this.indexSet_=i}static get Default(){return xt(xh&&Tr,"ChildrenNode.ts has not been loaded"),j0=j0||new wa({".priority":xh},{".priority":Tr}),j0}get(e){const i=Xh(this.indexes_,e);if(!i)throw new Error("No index defined for "+e);return i instanceof ls?i:null}hasIndex(e){return Pa(this.indexSet_,e.toString())}addIndex(e,i){xt(e!==Fh,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let c=!1;const f=i.getIterator(Ni.Wrap);let y=f.getNext();for(;y;)c=c||e.isDefinedOn(y.node),r.push(y),y=f.getNext();let l;c?l=my(r,e.getCompare()):l=xh;const I=e.toString(),C=Object.assign({},this.indexSet_);C[I]=e;const L=Object.assign({},this.indexes_);return L[I]=l,new wa(L,C)}addToIndexes(e,i){const r=ry(this.indexes_,(c,f)=>{const y=Xh(this.indexSet_,f);if(xt(y,"Missing index implementation for "+f),c===xh)if(y.isDefinedOn(e.node)){const l=[],I=i.getIterator(Ni.Wrap);let C=I.getNext();for(;C;)C.name!==e.name&&l.push(C),C=I.getNext();return l.push(e),my(l,y.getCompare())}else return xh;else{const l=i.get(e.name);let I=c;return l&&(I=I.remove(new Ni(e.name,l))),I.insert(e,e.node)}});return new wa(r,this.indexSet_)}removeFromIndexes(e,i){const r=ry(this.indexes_,c=>{if(c===xh)return c;{const f=i.get(e.name);return f?c.remove(new Ni(e.name,f)):c}});return new wa(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ap;class Ki{constructor(e,i,r){this.children_=e,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&QP(this.priorityNode_),this.children_.isEmpty()&&xt(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ap||(ap=new Ki(new ls(P1),null,wa.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ap}updatePriority(e){return this.children_.isEmpty()?this:new Ki(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const i=this.children_.get(e);return i===null?ap:i}}getChild(e){const i=zi(e);return i===null?this:this.getImmediateChild(i).getChild(pn(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,i){if(xt(i,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(i);{const r=new Ni(e,i);let c,f;i.isEmpty()?(c=this.children_.remove(e),f=this.indexMap_.removeFromIndexes(r,this.children_)):(c=this.children_.insert(e,i),f=this.indexMap_.addToIndexes(r,this.children_));const y=c.isEmpty()?ap:this.priorityNode_;return new Ki(c,y,f)}}updateChild(e,i){const r=zi(e);if(r===null)return i;{xt(zi(e)!==".priority"||Ml(e)===1,".priority must be the last token in a path");const c=this.getImmediateChild(r).updateChild(pn(e),i);return this.updateImmediateChild(r,c)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const i={};let r=0,c=0,f=!0;if(this.forEachChild(Tr,(y,l)=>{i[y]=l.val(e),r++,f&&Ki.INTEGER_REGEXP_.test(y)?c=Math.max(c,Number(y)):f=!1}),!e&&f&&c<2*r){const y=[];for(const l in i)y[l]=i[l];return y}else return e&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+JP(this.getPriority().val())+":"),this.forEachChild(Tr,(i,r)=>{const c=r.hash();c!==""&&(e+=":"+i+":"+c)}),this.lazyHash_=e===""?"":SP(e)}return this.lazyHash_}getPredecessorChildName(e,i,r){const c=this.resolveIndex_(r);if(c){const f=c.getPredecessorKey(new Ni(e,i));return f?f.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const i=this.resolveIndex_(e);if(i){const r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const i=this.getFirstChildName(e);return i?new Ni(i,this.children_.get(i)):null}getLastChildName(e){const i=this.resolveIndex_(e);if(i){const r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const i=this.getLastChildName(e);return i?new Ni(i,this.children_.get(i)):null}forEachChild(e,i){const r=this.resolveIndex_(e);return r?r.inorderTraversal(c=>i(c.name,c.node)):this.children_.inorderTraversal(i)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,i){const r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(e,c=>c);{const c=this.children_.getIteratorFrom(e.name,Ni.Wrap);let f=c.peek();for(;f!=null&&i.compare(f,e)<0;)c.getNext(),f=c.peek();return c}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,i){const r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(e,c=>c);{const c=this.children_.getReverseIteratorFrom(e.name,Ni.Wrap);let f=c.peek();for(;f!=null&&i.compare(f,e)>0;)c.getNext(),f=c.peek();return c}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Tm?-1:0}withIndex(e){if(e===Fh||this.indexMap_.hasIndex(e))return this;{const i=this.indexMap_.addIndex(e,this.children_);return new Ki(this.children_,this.priorityNode_,i)}}isIndexed(e){return e===Fh||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const i=e;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){const r=this.getIterator(Tr),c=i.getIterator(Tr);let f=r.getNext(),y=c.getNext();for(;f&&y;){if(f.name!==y.name||!f.node.equals(y.node))return!1;f=r.getNext(),y=c.getNext()}return f===null&&y===null}else return!1;else return!1}}resolveIndex_(e){return e===Fh?null:this.indexMap_.get(e.toString())}}Ki.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class $H extends Ki{constructor(){super(new ls(P1),Ki.EMPTY_NODE,wa.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ki.EMPTY_NODE}isEmpty(){return!1}}const Tm=new $H;Object.defineProperties(Ni,{MIN:{value:new Ni(Qh,Ki.EMPTY_NODE)},MAX:{value:new Ni(iu,Tm)}});YP.__EMPTY_NODE=Ki.EMPTY_NODE;Kn.__childrenNodeConstructor=Ki;zH(Tm);FH(Tm);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jH=!0;function wr(t,e=null){if(t===null)return Ki.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),xt(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const i=t;return new Kn(i,wr(e))}if(!(t instanceof Array)&&jH){const i=[];let r=!1;if(Bs(t,(y,l)=>{if(y.substring(0,1)!=="."){const I=wr(l);I.isEmpty()||(r=r||!I.getPriority().isEmpty(),i.push(new Ni(y,I)))}}),i.length===0)return Ki.EMPTY_NODE;const f=my(i,OH,y=>y.name,P1);if(r){const y=my(i,Tr.getCompare());return new Ki(f,wr(e),new wa({".priority":y},{".priority":Tr}))}else return new Ki(f,wr(e),wa.Default)}else{let i=Ki.EMPTY_NODE;return Bs(t,(r,c)=>{if(Pa(t,r)&&r.substring(0,1)!=="."){const f=wr(c);(f.isLeafNode()||!f.isEmpty())&&(i=i.updateImmediateChild(r,f))}}),i.updatePriority(wr(e))}}NH(wr);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GH extends gv{constructor(e){super(),this.indexPath_=e,xt(!Di(e)&&zi(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,i){const r=this.extractChild(e.node),c=this.extractChild(i.node),f=r.compareTo(c);return f===0?Ed(e.name,i.name):f}makePost(e,i){const r=wr(e),c=Ki.EMPTY_NODE.updateChild(this.indexPath_,r);return new Ni(i,c)}maxPost(){const e=Ki.EMPTY_NODE.updateChild(this.indexPath_,Tm);return new Ni(iu,e)}toString(){return HP(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qH extends gv{compare(e,i){const r=e.node.compareTo(i.node);return r===0?Ed(e.name,i.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,i){return!e.equals(i)}minPost(){return Ni.MIN}maxPost(){return Ni.MAX}makePost(e,i){const r=wr(e);return new Ni(i,r)}toString(){return".value"}}const WH=new qH;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HH(t){return{type:"value",snapshotNode:t}}function KH(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function ZH(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function LC(t,e,i){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:i}}function XH(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R1{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Tr}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return xt(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return xt(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Qh}hasEnd(){return this.endSet_}getIndexEndValue(){return xt(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return xt(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:iu}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return xt(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Tr}copy(){const e=new R1;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function OC(t){const e={};if(t.isDefault())return e;let i;return t.index_===Tr?i="$priority":t.index_===WH?i="$value":t.index_===Fh?i="$key":(xt(t.index_ instanceof GH,"Unrecognized index type!"),i=t.index_.toString()),e.orderBy=or(i),t.startSet_&&(e.startAt=or(t.indexStartValue_),t.startNameSet_&&(e.startAt+=","+or(t.indexStartName_))),t.endSet_&&(e.endAt=or(t.indexEndValue_),t.endNameSet_&&(e.endAt+=","+or(t.indexEndName_))),t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function zC(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_)),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_)),t.limitSet_){e.l=t.limit_;let i=t.viewFrom_;i===""&&(t.isViewFromLeft()?i="l":i="r"),e.vf=i}return t.index_!==Tr&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _y extends GP{constructor(e,i,r,c){super(),this.repoInfo_=e,this.onDataUpdate_=i,this.authTokenProvider_=r,this.appCheckTokenProvider_=c,this.log_=wm("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,i){return i!==void 0?"tag$"+i:(xt(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,i,r,c){const f=e._path.toString();this.log_("Listen called for "+f+" "+e._queryIdentifier);const y=_y.getListenId_(e,r),l={};this.listens_[y]=l;const I=OC(e._queryParams);this.restRequest_(f+".json",I,(C,L)=>{let R=L;if(C===404&&(R=null,C=null),C===null&&this.onDataUpdate_(f,R,!1,r),Xh(this.listens_,y)===l){let $;C?C===401?$="permission_denied":$="rest_error:"+C:$="ok",c($,null)}})}unlisten(e,i){const r=_y.getListenId_(e,i);delete this.listens_[r]}get(e){const i=OC(e._queryParams),r=e._path.toString(),c=new s1;return this.restRequest_(r+".json",i,(f,y)=>{let l=y;f===404&&(l=null,f=null),f===null?(this.onDataUpdate_(r,l,!1,null),c.resolve(l)):c.reject(new Error(l))}),c.promise}refreshAuthToken(e){}restRequest_(e,i={},r){return i.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([c,f])=>{c&&c.accessToken&&(i.auth=c.accessToken),f&&f.token&&(i.ac=f.token);const y=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+yd(i);this.log_("Sending REST request for "+y);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(r&&l.readyState===4){this.log_("REST Response for "+y+" received. status:",l.status,"response:",l.responseText);let I=null;if(l.status>=200&&l.status<300){try{I=Gp(l.responseText)}catch{vs("Failed to parse JSON response for "+y+": "+l.responseText)}r(null,I)}else l.status!==401&&l.status!==404&&vs("Got unsuccessful REST response for "+y+" Status: "+l.status),r(l.status);r=null}},l.open("GET",y,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YH{constructor(){this.rootNode_=Ki.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,i){this.rootNode_=this.rootNode_.updateChild(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gy(){return{value:null,children:new Map}}function iR(t,e,i){if(Di(e))t.value=i,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,i);else{const r=zi(e);t.children.has(r)||t.children.set(r,gy());const c=t.children.get(r);e=pn(e),iR(c,e,i)}}function Gb(t,e,i){t.value!==null?i(e,t.value):JH(t,(r,c)=>{const f=new _n(e.toString()+"/"+r);Gb(c,f,i)})}function JH(t,e){t.children.forEach((i,r)=>{e(r,i)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QH{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),i=Object.assign({},e);return this.last_&&Bs(this.last_,(r,c)=>{i[r]=i[r]-c}),this.last_=e,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NC=10*1e3,e8=30*1e3,t8=5*60*1e3;class i8{constructor(e,i){this.server_=i,this.statsToReport_={},this.statsListener_=new QH(e);const r=NC+(e8-NC)*Math.random();kp(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),i={};let r=!1;Bs(e,(c,f)=>{f>0&&Pa(this.statsToReport_,c)&&(i[c]=f,r=!0)}),r&&this.server_.reportStats(i),kp(this.reportStats_.bind(this),Math.floor(Math.random()*2*t8))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bo;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Bo||(Bo={}));function nR(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function rR(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function sR(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yy{constructor(e,i,r){this.path=e,this.affectedTree=i,this.revert=r,this.type=Bo.ACK_USER_WRITE,this.source=nR()}operationForChild(e){if(Di(this.path)){if(this.affectedTree.value!=null)return xt(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const i=this.affectedTree.subtree(new _n(e));return new yy(en(),i,this.revert)}}else return xt(zi(this.path)===e,"operationForChild called for unrelated child."),new yy(pn(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(e,i,r){this.source=e,this.path=i,this.snap=r,this.type=Bo.OVERWRITE}operationForChild(e){return Di(this.path)?new nu(this.source,en(),this.snap.getImmediateChild(e)):new nu(this.source,pn(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xp{constructor(e,i,r){this.source=e,this.path=i,this.children=r,this.type=Bo.MERGE}operationForChild(e){if(Di(this.path)){const i=this.children.subtree(new _n(e));return i.isEmpty()?null:i.value?new nu(this.source,en(),i.value):new Xp(this.source,en(),i)}else return xt(zi(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Xp(this.source,pn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L1{constructor(e,i,r){this.node_=e,this.fullyInitialized_=i,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Di(e))return this.isFullyInitialized()&&!this.filtered_;const i=zi(e);return this.isCompleteForChild(i)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function n8(t,e,i,r){const c=[],f=[];return e.forEach(y=>{y.type==="child_changed"&&t.index_.indexedValueChanged(y.oldSnap,y.snapshotNode)&&f.push(XH(y.childName,y.snapshotNode))}),lp(t,c,"child_removed",e,r,i),lp(t,c,"child_added",e,r,i),lp(t,c,"child_moved",f,r,i),lp(t,c,"child_changed",e,r,i),lp(t,c,"value",e,r,i),c}function lp(t,e,i,r,c,f){const y=r.filter(l=>l.type===i);y.sort((l,I)=>s8(t,l,I)),y.forEach(l=>{const I=r8(t,l,f);c.forEach(C=>{C.respondsTo(l.type)&&e.push(C.createEvent(I,t.query_))})})}function r8(t,e,i){return e.type==="value"||e.type==="child_removed"||(e.prevName=i.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function s8(t,e,i){if(e.childName==null||i.childName==null)throw gd("Should only compare child_ events.");const r=new Ni(e.childName,e.snapshotNode),c=new Ni(i.childName,i.snapshotNode);return t.index_.compare(r,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oR(t,e){return{eventCache:t,serverCache:e}}function Dp(t,e,i,r){return oR(new L1(e,i,r),t.serverCache)}function aR(t,e,i,r){return oR(t.eventCache,new L1(e,i,r))}function qb(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function ru(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let G0;const o8=()=>(G0||(G0=new ls(jW)),G0);class fn{constructor(e,i=o8()){this.value=e,this.children=i}static fromObject(e){let i=new fn(null);return Bs(e,(r,c)=>{i=i.set(new _n(r),c)}),i}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,i){if(this.value!=null&&i(this.value))return{path:en(),value:this.value};if(Di(e))return null;{const r=zi(e),c=this.children.get(r);if(c!==null){const f=c.findRootMostMatchingPathAndValue(pn(e),i);return f!=null?{path:Yn(new _n(r),f.path),value:f.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Di(e))return this;{const i=zi(e),r=this.children.get(i);return r!==null?r.subtree(pn(e)):new fn(null)}}set(e,i){if(Di(e))return new fn(i,this.children);{const r=zi(e),f=(this.children.get(r)||new fn(null)).set(pn(e),i),y=this.children.insert(r,f);return new fn(this.value,y)}}remove(e){if(Di(e))return this.children.isEmpty()?new fn(null):new fn(null,this.children);{const i=zi(e),r=this.children.get(i);if(r){const c=r.remove(pn(e));let f;return c.isEmpty()?f=this.children.remove(i):f=this.children.insert(i,c),this.value===null&&f.isEmpty()?new fn(null):new fn(this.value,f)}else return this}}get(e){if(Di(e))return this.value;{const i=zi(e),r=this.children.get(i);return r?r.get(pn(e)):null}}setTree(e,i){if(Di(e))return i;{const r=zi(e),f=(this.children.get(r)||new fn(null)).setTree(pn(e),i);let y;return f.isEmpty()?y=this.children.remove(r):y=this.children.insert(r,f),new fn(this.value,y)}}fold(e){return this.fold_(en(),e)}fold_(e,i){const r={};return this.children.inorderTraversal((c,f)=>{r[c]=f.fold_(Yn(e,c),i)}),i(e,this.value,r)}findOnPath(e,i){return this.findOnPath_(e,en(),i)}findOnPath_(e,i,r){const c=this.value?r(i,this.value):!1;if(c)return c;if(Di(e))return null;{const f=zi(e),y=this.children.get(f);return y?y.findOnPath_(pn(e),Yn(i,f),r):null}}foreachOnPath(e,i){return this.foreachOnPath_(e,en(),i)}foreachOnPath_(e,i,r){if(Di(e))return this;{this.value&&r(i,this.value);const c=zi(e),f=this.children.get(c);return f?f.foreachOnPath_(pn(e),Yn(i,c),r):new fn(null)}}foreach(e){this.foreach_(en(),e)}foreach_(e,i){this.children.inorderTraversal((r,c)=>{c.foreach_(Yn(e,r),i)}),this.value&&i(e,this.value)}foreachChild(e){this.children.inorderTraversal((i,r)=>{r.value&&e(i,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e){this.writeTree_=e}static empty(){return new co(new fn(null))}}function Pp(t,e,i){if(Di(e))return new co(new fn(i));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const c=r.path;let f=r.value;const y=Os(c,e);return f=f.updateChild(y,i),new co(t.writeTree_.set(c,f))}else{const c=new fn(i),f=t.writeTree_.setTree(e,c);return new co(f)}}}function FC(t,e,i){let r=t;return Bs(i,(c,f)=>{r=Pp(r,Yn(e,c),f)}),r}function BC(t,e){if(Di(e))return co.empty();{const i=t.writeTree_.setTree(e,new fn(null));return new co(i)}}function Wb(t,e){return mu(t,e)!=null}function mu(t,e){const i=t.writeTree_.findRootMostValueAndPath(e);return i!=null?t.writeTree_.get(i.path).getChild(Os(i.path,e)):null}function UC(t){const e=[],i=t.writeTree_.value;return i!=null?i.isLeafNode()||i.forEachChild(Tr,(r,c)=>{e.push(new Ni(r,c))}):t.writeTree_.children.inorderTraversal((r,c)=>{c.value!=null&&e.push(new Ni(r,c.value))}),e}function Tl(t,e){if(Di(e))return t;{const i=mu(t,e);return i!=null?new co(new fn(i)):new co(t.writeTree_.subtree(e))}}function Hb(t){return t.writeTree_.isEmpty()}function ed(t,e){return lR(en(),t.writeTree_,e)}function lR(t,e,i){if(e.value!=null)return i.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((c,f)=>{c===".priority"?(xt(f.value!==null,"Priority writes must always be leaf nodes"),r=f.value):i=lR(Yn(t,c),f,i)}),!i.getChild(t).isEmpty()&&r!==null&&(i=i.updateChild(Yn(t,".priority"),r)),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cR(t,e){return pR(e,t)}function a8(t,e,i,r,c){xt(r>t.lastWriteId,"Stacking an older write on top of newer ones"),c===void 0&&(c=!0),t.allWrites.push({path:e,snap:i,writeId:r,visible:c}),c&&(t.visibleWrites=Pp(t.visibleWrites,e,i)),t.lastWriteId=r}function l8(t,e){for(let i=0;i<t.allWrites.length;i++){const r=t.allWrites[i];if(r.writeId===e)return r}return null}function c8(t,e){const i=t.allWrites.findIndex(l=>l.writeId===e);xt(i>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[i];t.allWrites.splice(i,1);let c=r.visible,f=!1,y=t.allWrites.length-1;for(;c&&y>=0;){const l=t.allWrites[y];l.visible&&(y>=i&&u8(l,r.path)?c=!1:so(r.path,l.path)&&(f=!0)),y--}if(c){if(f)return h8(t),!0;if(r.snap)t.visibleWrites=BC(t.visibleWrites,r.path);else{const l=r.children;Bs(l,I=>{t.visibleWrites=BC(t.visibleWrites,Yn(r.path,I))})}return!0}else return!1}function u8(t,e){if(t.snap)return so(t.path,e);for(const i in t.children)if(t.children.hasOwnProperty(i)&&so(Yn(t.path,i),e))return!0;return!1}function h8(t){t.visibleWrites=uR(t.allWrites,d8,en()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function d8(t){return t.visible}function uR(t,e,i){let r=co.empty();for(let c=0;c<t.length;++c){const f=t[c];if(e(f)){const y=f.path;let l;if(f.snap)so(i,y)?(l=Os(i,y),r=Pp(r,l,f.snap)):so(y,i)&&(l=Os(y,i),r=Pp(r,en(),f.snap.getChild(l)));else if(f.children){if(so(i,y))l=Os(i,y),r=FC(r,l,f.children);else if(so(y,i))if(l=Os(y,i),Di(l))r=FC(r,en(),f.children);else{const I=Xh(f.children,zi(l));if(I){const C=I.getChild(pn(l));r=Pp(r,en(),C)}}}else throw gd("WriteRecord should have .snap or .children")}}return r}function hR(t,e,i,r,c){if(!r&&!c){const f=mu(t.visibleWrites,e);if(f!=null)return f;{const y=Tl(t.visibleWrites,e);if(Hb(y))return i;if(i==null&&!Wb(y,en()))return null;{const l=i||Ki.EMPTY_NODE;return ed(y,l)}}}else{const f=Tl(t.visibleWrites,e);if(!c&&Hb(f))return i;if(!c&&i==null&&!Wb(f,en()))return null;{const y=function(C){return(C.visible||c)&&(!r||!~r.indexOf(C.writeId))&&(so(C.path,e)||so(e,C.path))},l=uR(t.allWrites,y,e),I=i||Ki.EMPTY_NODE;return ed(l,I)}}}function f8(t,e,i){let r=Ki.EMPTY_NODE;const c=mu(t.visibleWrites,e);if(c)return c.isLeafNode()||c.forEachChild(Tr,(f,y)=>{r=r.updateImmediateChild(f,y)}),r;if(i){const f=Tl(t.visibleWrites,e);return i.forEachChild(Tr,(y,l)=>{const I=ed(Tl(f,new _n(y)),l);r=r.updateImmediateChild(y,I)}),UC(f).forEach(y=>{r=r.updateImmediateChild(y.name,y.node)}),r}else{const f=Tl(t.visibleWrites,e);return UC(f).forEach(y=>{r=r.updateImmediateChild(y.name,y.node)}),r}}function p8(t,e,i,r,c){xt(r||c,"Either existingEventSnap or existingServerSnap must exist");const f=Yn(e,i);if(Wb(t.visibleWrites,f))return null;{const y=Tl(t.visibleWrites,f);return Hb(y)?c.getChild(i):ed(y,c.getChild(i))}}function m8(t,e,i,r){const c=Yn(e,i),f=mu(t.visibleWrites,c);if(f!=null)return f;if(r.isCompleteForChild(i)){const y=Tl(t.visibleWrites,c);return ed(y,r.getNode().getImmediateChild(i))}else return null}function _8(t,e){return mu(t.visibleWrites,e)}function g8(t,e,i,r,c,f,y){let l;const I=Tl(t.visibleWrites,e),C=mu(I,en());if(C!=null)l=C;else if(i!=null)l=ed(I,i);else return[];if(l=l.withIndex(y),!l.isEmpty()&&!l.isLeafNode()){const L=[],R=y.getCompare(),$=f?l.getReverseIteratorFrom(r,y):l.getIteratorFrom(r,y);let J=$.getNext();for(;J&&L.length<c;)R(J,r)!==0&&L.push(J),J=$.getNext();return L}else return[]}function y8(){return{visibleWrites:co.empty(),allWrites:[],lastWriteId:-1}}function Kb(t,e,i,r){return hR(t.writeTree,t.treePath,e,i,r)}function dR(t,e){return f8(t.writeTree,t.treePath,e)}function VC(t,e,i,r){return p8(t.writeTree,t.treePath,e,i,r)}function vy(t,e){return _8(t.writeTree,Yn(t.treePath,e))}function v8(t,e,i,r,c,f){return g8(t.writeTree,t.treePath,e,i,r,c,f)}function O1(t,e,i){return m8(t.writeTree,t.treePath,e,i)}function fR(t,e){return pR(Yn(t.treePath,e),t.writeTree)}function pR(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x8{constructor(){this.changeMap=new Map}trackChildChange(e){const i=e.type,r=e.childName;xt(i==="child_added"||i==="child_changed"||i==="child_removed","Only child changes supported for tracking"),xt(r!==".priority","Only non-priority child changes can be tracked.");const c=this.changeMap.get(r);if(c){const f=c.type;if(i==="child_added"&&f==="child_removed")this.changeMap.set(r,LC(r,e.snapshotNode,c.snapshotNode));else if(i==="child_removed"&&f==="child_added")this.changeMap.delete(r);else if(i==="child_removed"&&f==="child_changed")this.changeMap.set(r,ZH(r,c.oldSnap));else if(i==="child_changed"&&f==="child_added")this.changeMap.set(r,KH(r,e.snapshotNode));else if(i==="child_changed"&&f==="child_changed")this.changeMap.set(r,LC(r,e.snapshotNode,c.oldSnap));else throw gd("Illegal combination of changes: "+e+" occurred after "+c)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b8{getCompleteChild(e){return null}getChildAfterChild(e,i,r){return null}}const mR=new b8;class z1{constructor(e,i,r=null){this.writes_=e,this.viewCache_=i,this.optCompleteServerCache_=r}getCompleteChild(e){const i=this.viewCache_.eventCache;if(i.isCompleteForChild(e))return i.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new L1(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return O1(this.writes_,e,r)}}getChildAfterChild(e,i,r){const c=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ru(this.viewCache_),f=v8(this.writes_,c,i,1,r,e);return f.length===0?null:f[0]}}function w8(t,e){xt(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),xt(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function E8(t,e,i,r,c){const f=new x8;let y,l;if(i.type===Bo.OVERWRITE){const C=i;C.source.fromUser?y=Zb(t,e,C.path,C.snap,r,c,f):(xt(C.source.fromServer,"Unknown source."),l=C.source.tagged||e.serverCache.isFiltered()&&!Di(C.path),y=xy(t,e,C.path,C.snap,r,c,l,f))}else if(i.type===Bo.MERGE){const C=i;C.source.fromUser?y=I8(t,e,C.path,C.children,r,c,f):(xt(C.source.fromServer,"Unknown source."),l=C.source.tagged||e.serverCache.isFiltered(),y=Xb(t,e,C.path,C.children,r,c,l,f))}else if(i.type===Bo.ACK_USER_WRITE){const C=i;C.revert?y=C8(t,e,C.path,r,c,f):y=S8(t,e,C.path,C.affectedTree,r,c,f)}else if(i.type===Bo.LISTEN_COMPLETE)y=A8(t,e,i.path,r,f);else throw gd("Unknown operation type: "+i.type);const I=f.getChanges();return T8(e,y,I),{viewCache:y,changes:I}}function T8(t,e,i){const r=e.eventCache;if(r.isFullyInitialized()){const c=r.getNode().isLeafNode()||r.getNode().isEmpty(),f=qb(t);(i.length>0||!t.eventCache.isFullyInitialized()||c&&!r.getNode().equals(f)||!r.getNode().getPriority().equals(f.getPriority()))&&i.push(HH(qb(e)))}}function _R(t,e,i,r,c,f){const y=e.eventCache;if(vy(r,i)!=null)return e;{let l,I;if(Di(i))if(xt(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const C=ru(e),L=C instanceof Ki?C:Ki.EMPTY_NODE,R=dR(r,L);l=t.filter.updateFullNode(e.eventCache.getNode(),R,f)}else{const C=Kb(r,ru(e));l=t.filter.updateFullNode(e.eventCache.getNode(),C,f)}else{const C=zi(i);if(C===".priority"){xt(Ml(i)===1,"Can't have a priority with additional path components");const L=y.getNode();I=e.serverCache.getNode();const R=VC(r,i,L,I);R!=null?l=t.filter.updatePriority(L,R):l=y.getNode()}else{const L=pn(i);let R;if(y.isCompleteForChild(C)){I=e.serverCache.getNode();const $=VC(r,i,y.getNode(),I);$!=null?R=y.getNode().getImmediateChild(C).updateChild(L,$):R=y.getNode().getImmediateChild(C)}else R=O1(r,C,e.serverCache);R!=null?l=t.filter.updateChild(y.getNode(),C,R,L,c,f):l=y.getNode()}}return Dp(e,l,y.isFullyInitialized()||Di(i),t.filter.filtersNodes())}}function xy(t,e,i,r,c,f,y,l){const I=e.serverCache;let C;const L=y?t.filter:t.filter.getIndexedFilter();if(Di(i))C=L.updateFullNode(I.getNode(),r,null);else if(L.filtersNodes()&&!I.isFiltered()){const J=I.getNode().updateChild(i,r);C=L.updateFullNode(I.getNode(),J,null)}else{const J=zi(i);if(!I.isCompleteForPath(i)&&Ml(i)>1)return e;const pe=pn(i),we=I.getNode().getImmediateChild(J).updateChild(pe,r);J===".priority"?C=L.updatePriority(I.getNode(),we):C=L.updateChild(I.getNode(),J,we,pe,mR,null)}const R=aR(e,C,I.isFullyInitialized()||Di(i),L.filtersNodes()),$=new z1(c,R,f);return _R(t,R,i,c,$,l)}function Zb(t,e,i,r,c,f,y){const l=e.eventCache;let I,C;const L=new z1(c,e,f);if(Di(i))C=t.filter.updateFullNode(e.eventCache.getNode(),r,y),I=Dp(e,C,!0,t.filter.filtersNodes());else{const R=zi(i);if(R===".priority")C=t.filter.updatePriority(e.eventCache.getNode(),r),I=Dp(e,C,l.isFullyInitialized(),l.isFiltered());else{const $=pn(i),J=l.getNode().getImmediateChild(R);let pe;if(Di($))pe=r;else{const Re=L.getCompleteChild(R);Re!=null?WP($)===".priority"&&Re.getChild(KP($)).isEmpty()?pe=Re:pe=Re.updateChild($,r):pe=Ki.EMPTY_NODE}if(J.equals(pe))I=e;else{const Re=t.filter.updateChild(l.getNode(),R,pe,$,L,y);I=Dp(e,Re,l.isFullyInitialized(),t.filter.filtersNodes())}}}return I}function $C(t,e){return t.eventCache.isCompleteForChild(e)}function I8(t,e,i,r,c,f,y){let l=e;return r.foreach((I,C)=>{const L=Yn(i,I);$C(e,zi(L))&&(l=Zb(t,l,L,C,c,f,y))}),r.foreach((I,C)=>{const L=Yn(i,I);$C(e,zi(L))||(l=Zb(t,l,L,C,c,f,y))}),l}function jC(t,e,i){return i.foreach((r,c)=>{e=e.updateChild(r,c)}),e}function Xb(t,e,i,r,c,f,y,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let I=e,C;Di(i)?C=r:C=new fn(null).setTree(i,r);const L=e.serverCache.getNode();return C.children.inorderTraversal((R,$)=>{if(L.hasChild(R)){const J=e.serverCache.getNode().getImmediateChild(R),pe=jC(t,J,$);I=xy(t,I,new _n(R),pe,c,f,y,l)}}),C.children.inorderTraversal((R,$)=>{const J=!e.serverCache.isCompleteForChild(R)&&$.value===void 0;if(!L.hasChild(R)&&!J){const pe=e.serverCache.getNode().getImmediateChild(R),Re=jC(t,pe,$);I=xy(t,I,new _n(R),Re,c,f,y,l)}}),I}function S8(t,e,i,r,c,f,y){if(vy(c,i)!=null)return e;const l=e.serverCache.isFiltered(),I=e.serverCache;if(r.value!=null){if(Di(i)&&I.isFullyInitialized()||I.isCompleteForPath(i))return xy(t,e,i,I.getNode().getChild(i),c,f,l,y);if(Di(i)){let C=new fn(null);return I.getNode().forEachChild(Fh,(L,R)=>{C=C.set(new _n(L),R)}),Xb(t,e,i,C,c,f,l,y)}else return e}else{let C=new fn(null);return r.foreach((L,R)=>{const $=Yn(i,L);I.isCompleteForPath($)&&(C=C.set(L,I.getNode().getChild($)))}),Xb(t,e,i,C,c,f,l,y)}}function A8(t,e,i,r,c){const f=e.serverCache,y=aR(e,f.getNode(),f.isFullyInitialized()||Di(i),f.isFiltered());return _R(t,y,i,r,mR,c)}function C8(t,e,i,r,c,f){let y;if(vy(r,i)!=null)return e;{const l=new z1(r,e,c),I=e.eventCache.getNode();let C;if(Di(i)||zi(i)===".priority"){let L;if(e.serverCache.isFullyInitialized())L=Kb(r,ru(e));else{const R=e.serverCache.getNode();xt(R instanceof Ki,"serverChildren would be complete if leaf node"),L=dR(r,R)}L=L,C=t.filter.updateFullNode(I,L,f)}else{const L=zi(i);let R=O1(r,L,e.serverCache);R==null&&e.serverCache.isCompleteForChild(L)&&(R=I.getImmediateChild(L)),R!=null?C=t.filter.updateChild(I,L,R,pn(i),l,f):e.eventCache.getNode().hasChild(L)?C=t.filter.updateChild(I,L,Ki.EMPTY_NODE,pn(i),l,f):C=I,C.isEmpty()&&e.serverCache.isFullyInitialized()&&(y=Kb(r,ru(e)),y.isLeafNode()&&(C=t.filter.updateFullNode(C,y,f)))}return y=e.serverCache.isFullyInitialized()||vy(r,en())!=null,Dp(e,C,y,t.filter.filtersNodes())}}function M8(t,e){const i=ru(t.viewCache_);return i&&(t.query._queryParams.loadsAllData()||!Di(e)&&!i.getImmediateChild(zi(e)).isEmpty())?i.getChild(e):null}function GC(t,e,i,r){e.type===Bo.MERGE&&e.source.queryId!==null&&(xt(ru(t.viewCache_),"We should always have a full cache before handling merges"),xt(qb(t.viewCache_),"Missing event cache, even though we have a server cache"));const c=t.viewCache_,f=E8(t.processor_,c,e,i,r);return w8(t.processor_,f.viewCache),xt(f.viewCache.serverCache.isFullyInitialized()||!c.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=f.viewCache,k8(t,f.changes,f.viewCache.eventCache.getNode(),null)}function k8(t,e,i,r){const c=r?[r]:t.eventRegistrations_;return n8(t.eventGenerator_,e,i,c)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qC;function D8(t){xt(!qC,"__referenceConstructor has already been defined"),qC=t}function N1(t,e,i,r){const c=e.source.queryId;if(c!==null){const f=t.views.get(c);return xt(f!=null,"SyncTree gave us an op for an invalid query."),GC(f,e,i,r)}else{let f=[];for(const y of t.views.values())f=f.concat(GC(y,e,i,r));return f}}function F1(t,e){let i=null;for(const r of t.views.values())i=i||M8(r,e);return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let WC;function P8(t){xt(!WC,"__referenceConstructor has already been defined"),WC=t}class HC{constructor(e){this.listenProvider_=e,this.syncPointTree_=new fn(null),this.pendingWriteTree_=y8(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function R8(t,e,i,r,c){return a8(t.pendingWriteTree_,e,i,r,c),c?vv(t,new nu(nR(),e,i)):[]}function Ch(t,e,i=!1){const r=l8(t.pendingWriteTree_,e);if(c8(t.pendingWriteTree_,e)){let f=new fn(null);return r.snap!=null?f=f.set(en(),!0):Bs(r.children,y=>{f=f.set(new _n(y),!0)}),vv(t,new yy(r.path,f,i))}else return[]}function yv(t,e,i){return vv(t,new nu(rR(),e,i))}function L8(t,e,i){const r=fn.fromObject(i);return vv(t,new Xp(rR(),e,r))}function O8(t,e,i,r){const c=xR(t,r);if(c!=null){const f=bR(c),y=f.path,l=f.queryId,I=Os(y,e),C=new nu(sR(l),I,i);return wR(t,y,C)}else return[]}function z8(t,e,i,r){const c=xR(t,r);if(c){const f=bR(c),y=f.path,l=f.queryId,I=Os(y,e),C=fn.fromObject(i),L=new Xp(sR(l),I,C);return wR(t,y,L)}else return[]}function gR(t,e,i){const c=t.pendingWriteTree_,f=t.syncPointTree_.findOnPath(e,(y,l)=>{const I=Os(y,e),C=F1(l,I);if(C)return C});return hR(c,e,f,i,!0)}function vv(t,e){return yR(e,t.syncPointTree_,null,cR(t.pendingWriteTree_,en()))}function yR(t,e,i,r){if(Di(t.path))return vR(t,e,i,r);{const c=e.get(en());i==null&&c!=null&&(i=F1(c,en()));let f=[];const y=zi(t.path),l=t.operationForChild(y),I=e.children.get(y);if(I&&l){const C=i?i.getImmediateChild(y):null,L=fR(r,y);f=f.concat(yR(l,I,C,L))}return c&&(f=f.concat(N1(c,t,r,i))),f}}function vR(t,e,i,r){const c=e.get(en());i==null&&c!=null&&(i=F1(c,en()));let f=[];return e.children.inorderTraversal((y,l)=>{const I=i?i.getImmediateChild(y):null,C=fR(r,y),L=t.operationForChild(y);L&&(f=f.concat(vR(L,l,I,C)))}),c&&(f=f.concat(N1(c,t,r,i))),f}function xR(t,e){return t.tagToQueryMap.get(e)}function bR(t){const e=t.indexOf("$");return xt(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new _n(t.substr(0,e))}}function wR(t,e,i){const r=t.syncPointTree_.get(e);xt(r,"Missing sync point for query tag that we're tracking");const c=cR(t.pendingWriteTree_,e);return N1(r,i,c,null)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{constructor(e){this.node_=e}getImmediateChild(e){const i=this.node_.getImmediateChild(e);return new B1(i)}node(){return this.node_}}class U1{constructor(e,i){this.syncTree_=e,this.path_=i}getImmediateChild(e){const i=Yn(this.path_,e);return new U1(this.syncTree_,i)}node(){return gR(this.syncTree_,this.path_)}}const N8=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},KC=function(t,e,i){if(!t||typeof t!="object")return t;if(xt(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return F8(t[".sv"],e,i);if(typeof t[".sv"]=="object")return B8(t[".sv"],e);xt(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},F8=function(t,e,i){switch(t){case"timestamp":return i.timestamp;default:xt(!1,"Unexpected server value: "+t)}},B8=function(t,e,i){t.hasOwnProperty("increment")||xt(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&xt(!1,"Unexpected increment value: "+r);const c=e.node();if(xt(c!==null&&typeof c!="undefined","Expected ChildrenNode.EMPTY_NODE for nulls"),!c.isLeafNode())return r;const y=c.getValue();return typeof y!="number"?r:y+r},U8=function(t,e,i,r){return V1(e,new U1(i,t),r)},V8=function(t,e,i){return V1(t,new B1(e),i)};function V1(t,e,i){const r=t.getPriority().val(),c=KC(r,e.getImmediateChild(".priority"),i);let f;if(t.isLeafNode()){const y=t,l=KC(y.getValue(),e,i);return l!==y.getValue()||c!==y.getPriority().val()?new Kn(l,wr(c)):t}else{const y=t;return f=y,c!==y.getPriority().val()&&(f=f.updatePriority(new Kn(c))),y.forEachChild(Tr,(l,I)=>{const C=V1(I,e.getImmediateChild(l),i);C!==I&&(f=f.updateImmediateChild(l,C))}),f}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $1{constructor(e="",i=null,r={children:{},childCount:0}){this.name=e,this.parent=i,this.node=r}}function j1(t,e){let i=e instanceof _n?e:new _n(e),r=t,c=zi(i);for(;c!==null;){const f=Xh(r.node.children,c)||{children:{},childCount:0};r=new $1(c,r,f),i=pn(i),c=zi(i)}return r}function Td(t){return t.node.value}function ER(t,e){t.node.value=e,Yb(t)}function TR(t){return t.node.childCount>0}function $8(t){return Td(t)===void 0&&!TR(t)}function xv(t,e){Bs(t.node.children,(i,r)=>{e(new $1(i,t,r))})}function IR(t,e,i,r){i&&!r&&e(t),xv(t,c=>{IR(c,e,!0,r)}),i&&r&&e(t)}function j8(t,e,i){let r=i?t:t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function Im(t){return new _n(t.parent===null?t.name:Im(t.parent)+"/"+t.name)}function Yb(t){t.parent!==null&&G8(t.parent,t.name,t)}function G8(t,e,i){const r=$8(i),c=Pa(t.node.children,e);r&&c?(delete t.node.children[e],t.node.childCount--,Yb(t)):!r&&!c&&(t.node.children[e]=i.node,t.node.childCount++,Yb(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q8=/[\[\].#$\/\u0000-\u001F\u007F]/,W8=/[\[\].#$\u0000-\u001F\u007F]/,q0=10*1024*1024,SR=function(t){return typeof t=="string"&&t.length!==0&&!q8.test(t)},H8=function(t){return typeof t=="string"&&t.length!==0&&!W8.test(t)},K8=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),H8(t)},AR=function(t,e,i){const r=i instanceof _n?new SH(i,t):i;if(e===void 0)throw new Error(t+"contains undefined "+Ac(r));if(typeof e=="function")throw new Error(t+"contains a function "+Ac(r)+" with contents = "+e.toString());if(AP(e))throw new Error(t+"contains "+e.toString()+" "+Ac(r));if(typeof e=="string"&&e.length>q0/3&&cv(e)>q0)throw new Error(t+"contains a string greater than "+q0+" utf8 bytes "+Ac(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let c=!1,f=!1;if(Bs(e,(y,l)=>{if(y===".value")c=!0;else if(y!==".priority"&&y!==".sv"&&(f=!0,!SR(y)))throw new Error(t+" contains an invalid key ("+y+") "+Ac(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);AH(r,y),AR(t,l,r),CH(r)}),c&&f)throw new Error(t+' contains ".value" child '+Ac(r)+" in addition to actual children.")}},Z8=function(t,e){const i=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!SR(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||i.length!==0&&!K8(i))throw new Error(v$(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X8{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Y8(t,e){let i=null;for(let r=0;r<e.length;r++){const c=e[r],f=c.getPath();i!==null&&!ZP(f,i.path)&&(t.eventLists_.push(i),i=null),i===null&&(i={events:[],path:f}),i.events.push(c)}i&&t.eventLists_.push(i)}function _u(t,e,i){Y8(t,i),J8(t,r=>so(r,e)||so(e,r))}function J8(t,e){t.recursionDepth_++;let i=!0;for(let r=0;r<t.eventLists_.length;r++){const c=t.eventLists_[r];if(c){const f=c.path;e(f)?(Q8(t.eventLists_[r]),t.eventLists_[r]=null):i=!1}}i&&(t.eventLists_=[]),t.recursionDepth_--}function Q8(t){for(let e=0;e<t.events.length;e++){const i=t.events[e];if(i!==null){t.events[e]=null;const r=i.getEventRunner();Gc&&br("event: "+i.toString()),Em(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eK="repo_interrupt",tK=25;class iK{constructor(e,i,r,c){this.repoInfo_=e,this.forceRestClient_=i,this.authTokenProvider_=r,this.appCheckProvider_=c,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new X8,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=gy(),this.transactionQueueTree_=new $1,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function nK(t,e,i){if(t.stats_=C1(t.repoInfo_),t.forceRestClient_||ZW())t.server_=new _y(t.repoInfo_,(r,c,f,y)=>{ZC(t,r,c,f,y)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>XC(t,!0),0);else{if(typeof i!="undefined"&&i!==null){if(typeof i!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{or(i)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new Ta(t.repoInfo_,e,(r,c,f,y)=>{ZC(t,r,c,f,y)},r=>{XC(t,r)},r=>{sK(t,r)},t.authTokenProvider_,t.appCheckProvider_,i),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=iH(t.repoInfo_,()=>new i8(t.stats_,t.server_)),t.infoData_=new YH,t.infoSyncTree_=new HC({startListening:(r,c,f,y)=>{let l=[];const I=t.infoData_.getNode(r._path);return I.isEmpty()||(l=yv(t.infoSyncTree_,r._path,I),setTimeout(()=>{y("ok")},0)),l},stopListening:()=>{}}),G1(t,"connected",!1),t.serverSyncTree_=new HC({startListening:(r,c,f,y)=>(t.server_.listen(r,f,c,(l,I)=>{const C=y(l,I);_u(t.eventQueue_,r._path,C)}),[]),stopListening:(r,c)=>{t.server_.unlisten(r,c)}})}function rK(t){const i=t.infoData_.getNode(new _n(".info/serverTimeOffset")).val()||0;return new Date().getTime()+i}function CR(t){return N8({timestamp:rK(t)})}function ZC(t,e,i,r,c){t.dataUpdateCount++;const f=new _n(e);i=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,i):i;let y=[];if(c)if(r){const I=ry(i,C=>wr(C));y=z8(t.serverSyncTree_,f,I,c)}else{const I=wr(i);y=O8(t.serverSyncTree_,f,I,c)}else if(r){const I=ry(i,C=>wr(C));y=L8(t.serverSyncTree_,f,I)}else{const I=wr(i);y=yv(t.serverSyncTree_,f,I)}let l=f;y.length>0&&(l=W1(t,f)),_u(t.eventQueue_,l,y)}function XC(t,e){G1(t,"connected",e),e===!1&&aK(t)}function sK(t,e){Bs(e,(i,r)=>{G1(t,i,r)})}function G1(t,e,i){const r=new _n("/.info/"+e),c=wr(i);t.infoData_.updateSnapshot(r,c);const f=yv(t.infoSyncTree_,r,c);_u(t.eventQueue_,r,f)}function oK(t){return t.nextWriteId_++}function aK(t){MR(t,"onDisconnectEvents");const e=CR(t),i=gy();Gb(t.onDisconnect_,en(),(c,f)=>{const y=U8(c,f,t.serverSyncTree_,e);iR(i,c,y)});let r=[];Gb(i,en(),(c,f)=>{r=r.concat(yv(t.serverSyncTree_,c,f));const y=hK(t,c);W1(t,y)}),t.onDisconnect_=gy(),_u(t.eventQueue_,en(),r)}function lK(t){t.persistentConnection_&&t.persistentConnection_.interrupt(eK)}function MR(t,...e){let i="";t.persistentConnection_&&(i=t.persistentConnection_.id+":"),br(i,...e)}function kR(t,e,i){return gR(t.serverSyncTree_,e,i)||Ki.EMPTY_NODE}function q1(t,e=t.transactionQueueTree_){if(e||bv(t,e),Td(e)){const i=PR(t,e);xt(i.length>0,"Sending zero length transaction queue"),i.every(c=>c.status===0)&&cK(t,Im(e),i)}else TR(e)&&xv(e,i=>{q1(t,i)})}function cK(t,e,i){const r=i.map(C=>C.currentWriteId),c=kR(t,e,r);let f=c;const y=c.hash();for(let C=0;C<i.length;C++){const L=i[C];xt(L.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),L.status=1,L.retryCount++;const R=Os(e,L.path);f=f.updateChild(R,L.currentOutputSnapshotRaw)}const l=f.val(!0),I=e;t.server_.put(I.toString(),l,C=>{MR(t,"transaction put response",{path:I.toString(),status:C});let L=[];if(C==="ok"){const R=[];for(let $=0;$<i.length;$++)i[$].status=2,L=L.concat(Ch(t.serverSyncTree_,i[$].currentWriteId)),i[$].onComplete&&R.push(()=>i[$].onComplete(null,!0,i[$].currentOutputSnapshotResolved)),i[$].unwatcher();bv(t,j1(t.transactionQueueTree_,e)),q1(t,t.transactionQueueTree_),_u(t.eventQueue_,e,L);for(let $=0;$<R.length;$++)Em(R[$])}else{if(C==="datastale")for(let R=0;R<i.length;R++)i[R].status===3?i[R].status=4:i[R].status=0;else{vs("transaction at "+I.toString()+" failed: "+C);for(let R=0;R<i.length;R++)i[R].status=4,i[R].abortReason=C}W1(t,e)}},y)}function W1(t,e){const i=DR(t,e),r=Im(i),c=PR(t,i);return uK(t,c,r),r}function uK(t,e,i){if(e.length===0)return;const r=[];let c=[];const y=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const I=e[l],C=Os(i,I.path);let L=!1,R;if(xt(C!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),I.status===4)L=!0,R=I.abortReason,c=c.concat(Ch(t.serverSyncTree_,I.currentWriteId,!0));else if(I.status===0)if(I.retryCount>=tK)L=!0,R="maxretry",c=c.concat(Ch(t.serverSyncTree_,I.currentWriteId,!0));else{const $=kR(t,I.path,y);I.currentInputSnapshot=$;const J=e[l].update($.val());if(J!==void 0){AR("transaction failed: Data returned ",J,I.path);let pe=wr(J);typeof J=="object"&&J!=null&&Pa(J,".priority")||(pe=pe.updatePriority($.getPriority()));const we=I.currentWriteId,Be=CR(t),nt=V8(pe,$,Be);I.currentOutputSnapshotRaw=pe,I.currentOutputSnapshotResolved=nt,I.currentWriteId=oK(t),y.splice(y.indexOf(we),1),c=c.concat(R8(t.serverSyncTree_,I.path,nt,I.currentWriteId,I.applyLocally)),c=c.concat(Ch(t.serverSyncTree_,we,!0))}else L=!0,R="nodata",c=c.concat(Ch(t.serverSyncTree_,I.currentWriteId,!0))}_u(t.eventQueue_,i,c),c=[],L&&(e[l].status=2,function($){setTimeout($,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(R==="nodata"?r.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):r.push(()=>e[l].onComplete(new Error(R),!1,null))))}bv(t,t.transactionQueueTree_);for(let l=0;l<r.length;l++)Em(r[l]);q1(t,t.transactionQueueTree_)}function DR(t,e){let i,r=t.transactionQueueTree_;for(i=zi(e);i!==null&&Td(r)===void 0;)r=j1(r,i),e=pn(e),i=zi(e);return r}function PR(t,e){const i=[];return RR(t,e,i),i.sort((r,c)=>r.order-c.order),i}function RR(t,e,i){const r=Td(e);if(r)for(let c=0;c<r.length;c++)i.push(r[c]);xv(e,c=>{RR(t,c,i)})}function bv(t,e){const i=Td(e);if(i){let r=0;for(let c=0;c<i.length;c++)i[c].status!==2&&(i[r]=i[c],r++);i.length=r,ER(e,i.length>0?i:void 0)}xv(e,r=>{bv(t,r)})}function hK(t,e){const i=Im(DR(t,e)),r=j1(t.transactionQueueTree_,e);return j8(r,c=>{W0(t,c)}),W0(t,r),IR(r,c=>{W0(t,c)}),i}function W0(t,e){const i=Td(e);if(i){const r=[];let c=[],f=-1;for(let y=0;y<i.length;y++)i[y].status===3||(i[y].status===1?(xt(f===y-1,"All SENT items should be at beginning of queue."),f=y,i[y].status=3,i[y].abortReason="set"):(xt(i[y].status===0,"Unexpected transaction status in abort"),i[y].unwatcher(),c=c.concat(Ch(t.serverSyncTree_,i[y].currentWriteId,!0)),i[y].onComplete&&r.push(i[y].onComplete.bind(null,new Error("set"),!1,null))));f===-1?ER(e,void 0):i.length=f+1,_u(t.eventQueue_,Im(e),c);for(let y=0;y<r.length;y++)Em(r[y])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dK(t){let e="";const i=t.split("/");for(let r=0;r<i.length;r++)if(i[r].length>0){let c=i[r];try{c=decodeURIComponent(c.replace(/\+/g," "))}catch{}e+="/"+c}return e}function fK(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const i of t.split("&")){if(i.length===0)continue;const r=i.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):vs(`Invalid query segment '${i}' in query '${t}'`)}return e}const YC=function(t,e){const i=pK(t),r=i.namespace;i.domain==="firebase.com"&&tu(i.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&i.domain!=="localhost"&&tu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),i.secure||VW();const c=i.scheme==="ws"||i.scheme==="wss";return{repoInfo:new QW(i.host,i.secure,r,c,e,"",r!==i.subdomain),path:new _n(i.pathString)}},pK=function(t){let e="",i="",r="",c="",f="",y=!0,l="https",I=443;if(typeof t=="string"){let C=t.indexOf("//");C>=0&&(l=t.substring(0,C-1),t=t.substring(C+2));let L=t.indexOf("/");L===-1&&(L=t.length);let R=t.indexOf("?");R===-1&&(R=t.length),e=t.substring(0,Math.min(L,R)),L<R&&(c=dK(t.substring(L,R)));const $=fK(t.substring(Math.min(t.length,R)));C=e.indexOf(":"),C>=0?(y=l==="https"||l==="wss",I=parseInt(e.substring(C+1),10)):C=e.length;const J=e.slice(0,C);if(J.toLowerCase()==="localhost")i="localhost";else if(J.split(".").length<=2)i=J;else{const pe=e.indexOf(".");r=e.substring(0,pe).toLowerCase(),i=e.substring(pe+1),f=r}"ns"in $&&(f=$.ns)}return{host:e,port:I,domain:i,subdomain:r,secure:y,scheme:l,pathString:c,namespace:f}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H1{constructor(e,i,r,c){this._repo=e,this._path=i,this._queryParams=r,this._orderByCalled=c}get key(){return Di(this._path)?null:WP(this._path)}get ref(){return new Id(this._repo,this._path)}get _queryIdentifier(){const e=zC(this._queryParams),i=S1(e);return i==="{}"?"default":i}get _queryObject(){return zC(this._queryParams)}isEqual(e){if(e=Ts(e),!(e instanceof H1))return!1;const i=this._repo===e._repo,r=ZP(this._path,e._path),c=this._queryIdentifier===e._queryIdentifier;return i&&r&&c}toJSON(){return this.toString()}toString(){return this._repo.toString()+IH(this._path)}}class Id extends H1{constructor(e,i){super(e,i,new R1,!1)}get parent(){const e=KP(this._path);return e===null?null:new Id(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}D8(Id);P8(Id);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mK="FIREBASE_DATABASE_EMULATOR_HOST",Jb={};let _K=!1;function gK(t,e,i,r,c){let f=r||t.options.databaseURL;f===void 0&&(t.options.projectId||tu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),br("Using default host for project ",t.options.projectId),f=`${t.options.projectId}-default-rtdb.firebaseio.com`);let y=YC(f,c),l=y.repoInfo,I,C;typeof process!="undefined"&&process.env&&(C=process.env[mK]),C?(I=!0,f=`http://${C}?ns=${l.namespace}`,y=YC(f,c),l=y.repoInfo):I=!y.repoInfo.secure;const L=c&&I?new Vb(Vb.OWNER):new YW(t.name,t.options,e);Z8("Invalid Firebase Database URL",y),Di(y.path)||tu("Database URL must point to the root of a Firebase Database (not including a child path).");const R=vK(l,t,L,new XW(t.name,i));return new xK(R,t)}function yK(t,e){const i=Jb[e];(!i||i[t.key]!==t)&&tu(`Database ${e}(${t.repoInfo_}) has already been deleted.`),lK(t),delete i[t.key]}function vK(t,e,i,r){let c=Jb[e.name];c||(c={},Jb[e.name]=c);let f=c[t.toURLString()];return f&&tu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),f=new iK(t,_K,i,r),c[t.toURLString()]=f,f}class xK{constructor(e,i){this._repoInternal=e,this.app=i,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(nK(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Id(this._repo,en())),this._rootInternal}_delete(){return this._rootInternal!==null&&(yK(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&tu("Cannot call "+e+" on a deleted database.")}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bK(t){zW(pu),Ns(new Is("database",(e,{instanceIdentifier:i})=>{const r=e.getProvider("app").getImmediate(),c=e.getProvider("auth-internal"),f=e.getProvider("app-check-internal");return gK(r,c,f,i)},"PUBLIC").setMultipleInstances(!0)),Ir(yC,vC,t),Ir(yC,vC,"esm2017")}Ta.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Ta.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};bK();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Rs.UNAUTHENTICATED=new Rs(null),Rs.GOOGLE_CREDENTIALS=new Rs("google-credentials-uid"),Rs.FIRST_PARTY=new Rs("first-party-uid"),Rs.MOCK_USER=new Rs("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wv="9.6.11";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const by=new vd("@firebase/firestore");function wK(t,...e){if(by.logLevel<=Oi.DEBUG){const i=e.map(LR);by.debug(`Firestore (${wv}): ${t}`,...i)}}function EK(t,...e){if(by.logLevel<=Oi.ERROR){const i=e.map(LR);by.error(`Firestore (${wv}): ${t}`,...i)}}function LR(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TK(t="Unexpected state"){const e=`FIRESTORE (${wv}) INTERNAL ASSERTION FAILED: `+t;throw EK(e),new Error(e)}function K1(t,e){t||TK()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rp="invalid-argument",JC="failed-precondition";class Oc extends Ko{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IK{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class SK{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(Rs.UNAUTHENTICATED))}shutdown(){}}class AK{constructor(e){this.auth=null,e.onInit(i=>{this.auth=i})}getToken(){return this.auth?this.auth.getToken().then(e=>e?(K1(typeof e.accessToken=="string"),new IK(e.accessToken,new Rs(this.auth.getUid()))):null):Promise.resolve(null)}invalidateToken(){}start(e,i){}shutdown(){}}class CK{constructor(e,i,r){this.type="FirstParty",this.user=Rs.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",i);const c=e.auth.getAuthHeaderValueForFirstParty([]);c&&this.headers.set("Authorization",c),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}}class MK{constructor(e,i,r){this.t=e,this.i=i,this.o=r}getToken(){return Promise.resolve(new CK(this.t,this.i,this.o))}start(e,i){e.enqueueRetryable(()=>i(Rs.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class kK{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class DK{constructor(e){this.u=e,this.appCheck=null,e.onInit(i=>{this.appCheck=i})}getToken(){return this.appCheck?this.appCheck.getToken().then(e=>e?(K1(typeof e.token=="string"),new kK(e.token)):null):Promise.resolve(null)}invalidateToken(){}start(e,i){}shutdown(){}}class Yp{constructor(e,i){this.projectId=e,this.database=i||"(default)"}static empty(){return new Yp("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Yp&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var QC,Pi;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(Pi=QC||(QC={}))[Pi.OK=0]="OK",Pi[Pi.CANCELLED=1]="CANCELLED",Pi[Pi.UNKNOWN=2]="UNKNOWN",Pi[Pi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Pi[Pi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Pi[Pi.NOT_FOUND=5]="NOT_FOUND",Pi[Pi.ALREADY_EXISTS=6]="ALREADY_EXISTS",Pi[Pi.PERMISSION_DENIED=7]="PERMISSION_DENIED",Pi[Pi.UNAUTHENTICATED=16]="UNAUTHENTICATED",Pi[Pi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Pi[Pi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Pi[Pi.ABORTED=10]="ABORTED",Pi[Pi.OUT_OF_RANGE=11]="OUT_OF_RANGE",Pi[Pi.UNIMPLEMENTED=12]="UNIMPLEMENTED",Pi[Pi.INTERNAL=13]="INTERNAL",Pi[Pi.UNAVAILABLE=14]="UNAVAILABLE",Pi[Pi.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eM=new Map;class tM{constructor(e){var i;if(e.host===void 0){if(e.ssl!==void 0)throw new Oc(Rp,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(i=e.ssl)===null||i===void 0||i;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Oc(Rp,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,function(r,c,f,y){if(c===!0&&y===!0)throw new Oc(Rp,`${r} and ${f} cannot be used together.`)}("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PK{constructor(e,i,r){this._authCredentials=i,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tM({}),this._settingsFrozen=!1,e instanceof Yp?this._databaseId=e:(this._app=e,this._databaseId=function(c){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new Oc(Rp,'"projectId" not provided in firebase.initializeApp.');return new Yp(c.options.projectId)}(e))}get app(){if(!this._app)throw new Oc(JC,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new Oc(JC,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tM(e),e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new SK;switch(i.type){case"gapi":const r=i.client;return K1(!(typeof r!="object"||r===null||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new MK(r,i.sessionIndex||"0",i.iamToken||null);case"provider":return i.client;default:throw new Oc(Rp,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const i=eM.get(e);i&&(wK("ComponentProvider","Removing Datastore"),eM.delete(e),i.terminate())}(this),Promise.resolve()}}function RK(t=c1()){return xd(t,"firestore/lite").getImmediate()}(function(t){wv=t})(`${pu}_lite`),Ns(new Is("firestore/lite",(t,{options:e})=>{const i=t.getProvider("app").getImmediate(),r=new PK(i,new AK(t.getProvider("auth-internal")),new DK(t.getProvider("app-check-internal")));return e&&r._setSettings(e),r},"PUBLIC")),Ir("firestore-lite","3.4.8",""),Ir("firestore-lite","3.4.8","esm2017");var LK=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Mt,Z1=Z1||{},ni=LK||self;function wy(){}function Qb(t){var e=typeof t;return e=e!="object"?e:t?Array.isArray(t)?"array":e:"null",e=="array"||e=="object"&&typeof t.length=="number"}function Sm(t){var e=typeof t;return e=="object"&&t!=null||e=="function"}function OK(t){return Object.prototype.hasOwnProperty.call(t,H0)&&t[H0]||(t[H0]=++zK)}var H0="closure_uid_"+(1e9*Math.random()>>>0),zK=0;function NK(t,e,i){return t.call.apply(t.bind,arguments)}function FK(t,e,i){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(c,r),t.apply(e,c)}}return function(){return t.apply(e,arguments)}}function cr(t,e,i){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?cr=NK:cr=FK,cr.apply(null,arguments)}function Tg(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var r=i.slice();return r.push.apply(r,arguments),t.apply(this,r)}}function fr(t,e){function i(){}i.prototype=e.prototype,t.Z=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.Vb=function(r,c,f){for(var y=Array(arguments.length-2),l=2;l<arguments.length;l++)y[l-2]=arguments[l];return e.prototype[c].apply(r,y)}}function Ol(){this.s=this.s,this.o=this.o}var BK=0,UK={};Ol.prototype.s=!1;Ol.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),BK!=0)){var t=OK(this);delete UK[t]}};Ol.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const OR=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(typeof t=="string")return typeof e!="string"||e.length!=1?-1:t.indexOf(e,0);for(let i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1},zR=Array.prototype.forEach?function(t,e,i){Array.prototype.forEach.call(t,e,i)}:function(t,e,i){const r=t.length,c=typeof t=="string"?t.split(""):t;for(let f=0;f<r;f++)f in c&&e.call(i,c[f],f,t)};function VK(t){e:{var e=PZ;const i=t.length,r=typeof t=="string"?t.split(""):t;for(let c=0;c<i;c++)if(c in r&&e.call(void 0,r[c],c,t)){e=c;break e}e=-1}return 0>e?null:typeof t=="string"?t.charAt(e):t[e]}function iM(t){return Array.prototype.concat.apply([],arguments)}function X1(t){const e=t.length;if(0<e){const i=Array(e);for(let r=0;r<e;r++)i[r]=t[r];return i}return[]}function Ey(t){return/^[\s\xa0]*$/.test(t)}var nM=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Br(t,e){return t.indexOf(e)!=-1}function K0(t,e){return t<e?-1:t>e?1:0}var Ur;e:{var rM=ni.navigator;if(rM){var sM=rM.userAgent;if(sM){Ur=sM;break e}}Ur=""}function Y1(t,e,i){for(const r in t)e.call(i,t[r],r,t)}function NR(t){const e={};for(const i in t)e[i]=t[i];return e}var oM="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function FR(t,e){let i,r;for(let c=1;c<arguments.length;c++){r=arguments[c];for(i in r)t[i]=r[i];for(let f=0;f<oM.length;f++)i=oM[f],Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}}function J1(t){return J1[" "](t),t}J1[" "]=wy;function $K(t){var e=qK;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=t(9)}var jK=Br(Ur,"Opera"),td=Br(Ur,"Trident")||Br(Ur,"MSIE"),BR=Br(Ur,"Edge"),ew=BR||td,UR=Br(Ur,"Gecko")&&!(Br(Ur.toLowerCase(),"webkit")&&!Br(Ur,"Edge"))&&!(Br(Ur,"Trident")||Br(Ur,"MSIE"))&&!Br(Ur,"Edge"),GK=Br(Ur.toLowerCase(),"webkit")&&!Br(Ur,"Edge");function VR(){var t=ni.document;return t?t.documentMode:void 0}var Ty;e:{var Z0="",X0=function(){var t=Ur;if(UR)return/rv:([^\);]+)(\)|;)/.exec(t);if(BR)return/Edge\/([\d\.]+)/.exec(t);if(td)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t);if(GK)return/WebKit\/(\S+)/.exec(t);if(jK)return/(?:Version)[ \/]?(\S+)/.exec(t)}();if(X0&&(Z0=X0?X0[1]:""),td){var Y0=VR();if(Y0!=null&&Y0>parseFloat(Z0)){Ty=String(Y0);break e}}Ty=Z0}var qK={};function WK(){return $K(function(){let t=0;const e=nM(String(Ty)).split("."),i=nM("9").split("."),r=Math.max(e.length,i.length);for(let y=0;t==0&&y<r;y++){var c=e[y]||"",f=i[y]||"";do{if(c=/(\d*)(\D*)(.*)/.exec(c)||["","","",""],f=/(\d*)(\D*)(.*)/.exec(f)||["","","",""],c[0].length==0&&f[0].length==0)break;t=K0(c[1].length==0?0:parseInt(c[1],10),f[1].length==0?0:parseInt(f[1],10))||K0(c[2].length==0,f[2].length==0)||K0(c[2],f[2]),c=c[3],f=f[3]}while(t==0)}return 0<=t})}var tw;if(ni.document&&td){var aM=VR();tw=aM||parseInt(Ty,10)||void 0}else tw=void 0;var HK=tw,KK=function(){if(!ni.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ni.addEventListener("test",wy,e),ni.removeEventListener("test",wy,e)}catch{}return t}();function Sr(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Sr.prototype.h=function(){this.defaultPrevented=!0};function Jp(t,e){if(Sr.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var i=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(UR){e:{try{J1(e.nodeName);var c=!0;break e}catch{}c=!1}c||(e=null)}}else i=="mouseover"?e=t.fromElement:i=="mouseout"&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=t.clientX!==void 0?t.clientX:t.pageX,this.clientY=t.clientY!==void 0?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=typeof t.pointerType=="string"?t.pointerType:ZK[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Jp.Z.h.call(this)}}fr(Jp,Sr);var ZK={2:"touch",3:"pen",4:"mouse"};Jp.prototype.h=function(){Jp.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Am="closure_listenable_"+(1e6*Math.random()|0),XK=0;function YK(t,e,i,r,c){this.listener=t,this.proxy=null,this.src=e,this.type=i,this.capture=!!r,this.ia=c,this.key=++XK,this.ca=this.fa=!1}function Ev(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Tv(t){this.src=t,this.g={},this.h=0}Tv.prototype.add=function(t,e,i,r,c){var f=t.toString();t=this.g[f],t||(t=this.g[f]=[],this.h++);var y=nw(t,e,r,c);return-1<y?(e=t[y],i||(e.fa=!1)):(e=new YK(e,this.src,f,!!r,c),e.fa=i,t.push(e)),e};function iw(t,e){var i=e.type;if(i in t.g){var r=t.g[i],c=OR(r,e),f;(f=0<=c)&&Array.prototype.splice.call(r,c,1),f&&(Ev(e),t.g[i].length==0&&(delete t.g[i],t.h--))}}function nw(t,e,i,r){for(var c=0;c<t.length;++c){var f=t[c];if(!f.ca&&f.listener==e&&f.capture==!!i&&f.ia==r)return c}return-1}var Q1="closure_lm_"+(1e6*Math.random()|0),J0={};function $R(t,e,i,r,c){if(r&&r.once)return GR(t,e,i,r,c);if(Array.isArray(e)){for(var f=0;f<e.length;f++)$R(t,e[f],i,r,c);return null}return i=iE(i),t&&t[Am]?t.N(e,i,Sm(r)?!!r.capture:!!r,c):jR(t,e,i,!1,r,c)}function jR(t,e,i,r,c,f){if(!e)throw Error("Invalid event type");var y=Sm(c)?!!c.capture:!!c,l=tE(t);if(l||(t[Q1]=l=new Tv(t)),i=l.add(e,i,r,y,f),i.proxy)return i;if(r=JK(),i.proxy=r,r.src=t,r.listener=i,t.addEventListener)KK||(c=y),c===void 0&&(c=!1),t.addEventListener(e.toString(),r,c);else if(t.attachEvent)t.attachEvent(WR(e.toString()),r);else if(t.addListener&&t.removeListener)t.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return i}function JK(){function t(i){return e.call(t.src,t.listener,i)}var e=QK;return t}function GR(t,e,i,r,c){if(Array.isArray(e)){for(var f=0;f<e.length;f++)GR(t,e[f],i,r,c);return null}return i=iE(i),t&&t[Am]?t.O(e,i,Sm(r)?!!r.capture:!!r,c):jR(t,e,i,!0,r,c)}function qR(t,e,i,r,c){if(Array.isArray(e))for(var f=0;f<e.length;f++)qR(t,e[f],i,r,c);else r=Sm(r)?!!r.capture:!!r,i=iE(i),t&&t[Am]?(t=t.i,e=String(e).toString(),e in t.g&&(f=t.g[e],i=nw(f,i,r,c),-1<i&&(Ev(f[i]),Array.prototype.splice.call(f,i,1),f.length==0&&(delete t.g[e],t.h--)))):t&&(t=tE(t))&&(e=t.g[e.toString()],t=-1,e&&(t=nw(e,i,r,c)),(i=-1<t?e[t]:null)&&eE(i))}function eE(t){if(typeof t!="number"&&t&&!t.ca){var e=t.src;if(e&&e[Am])iw(e.i,t);else{var i=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(i,r,t.capture):e.detachEvent?e.detachEvent(WR(i),r):e.addListener&&e.removeListener&&e.removeListener(r),(i=tE(e))?(iw(i,t),i.h==0&&(i.src=null,e[Q1]=null)):Ev(t)}}}function WR(t){return t in J0?J0[t]:J0[t]="on"+t}function QK(t,e){if(t.ca)t=!0;else{e=new Jp(e,this);var i=t.listener,r=t.ia||t.src;t.fa&&eE(t),t=i.call(r,e)}return t}function tE(t){return t=t[Q1],t instanceof Tv?t:null}var Q0="__closure_events_fn_"+(1e9*Math.random()>>>0);function iE(t){return typeof t=="function"?t:(t[Q0]||(t[Q0]=function(e){return t.handleEvent(e)}),t[Q0])}function er(){Ol.call(this),this.i=new Tv(this),this.P=this,this.I=null}fr(er,Ol);er.prototype[Am]=!0;er.prototype.removeEventListener=function(t,e,i,r){qR(this,t,e,i,r)};function ur(t,e){var i,r=t.I;if(r)for(i=[];r;r=r.I)i.push(r);if(t=t.P,r=e.type||e,typeof e=="string")e=new Sr(e,t);else if(e instanceof Sr)e.target=e.target||t;else{var c=e;e=new Sr(r,t),FR(e,c)}if(c=!0,i)for(var f=i.length-1;0<=f;f--){var y=e.g=i[f];c=Ig(y,r,!0,e)&&c}if(y=e.g=t,c=Ig(y,r,!0,e)&&c,c=Ig(y,r,!1,e)&&c,i)for(f=0;f<i.length;f++)y=e.g=i[f],c=Ig(y,r,!1,e)&&c}er.prototype.M=function(){if(er.Z.M.call(this),this.i){var t=this.i,e;for(e in t.g){for(var i=t.g[e],r=0;r<i.length;r++)Ev(i[r]);delete t.g[e],t.h--}}this.I=null};er.prototype.N=function(t,e,i,r){return this.i.add(String(t),e,!1,i,r)};er.prototype.O=function(t,e,i,r){return this.i.add(String(t),e,!0,i,r)};function Ig(t,e,i,r){if(e=t.i.g[String(e)],!e)return!0;e=e.concat();for(var c=!0,f=0;f<e.length;++f){var y=e[f];if(y&&!y.ca&&y.capture==i){var l=y.listener,I=y.ia||y.src;y.fa&&iw(t.i,y),c=l.call(I,r)!==!1&&c}}return c&&!r.defaultPrevented}var nE=ni.JSON.stringify;function eZ(){var t=KR;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}class tZ{constructor(){this.h=this.g=null}add(e,i){const r=HR.get();r.set(e,i),this.h?this.h.next=r:this.g=r,this.h=r}}var HR=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new iZ,t=>t.reset());class iZ{constructor(){this.next=this.g=this.h=null}set(e,i){this.h=e,this.g=i,this.next=null}reset(){this.next=this.g=this.h=null}}function nZ(t){ni.setTimeout(()=>{throw t},0)}function rE(t,e){rw||rZ(),sw||(rw(),sw=!0),KR.add(t,e)}var rw;function rZ(){var t=ni.Promise.resolve(void 0);rw=function(){t.then(sZ)}}var sw=!1,KR=new tZ;function sZ(){for(var t;t=eZ();){try{t.h.call(t.g)}catch(i){nZ(i)}var e=HR;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}sw=!1}function Iv(t,e){er.call(this),this.h=t||1,this.g=e||ni,this.j=cr(this.kb,this),this.l=Date.now()}fr(Iv,er);Mt=Iv.prototype;Mt.da=!1;Mt.S=null;Mt.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ur(this,"tick"),this.da&&(sE(this),this.start()))}};Mt.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function sE(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}Mt.M=function(){Iv.Z.M.call(this),sE(this),delete this.g};function oE(t,e,i){if(typeof t=="function")i&&(t=cr(t,i));else if(t&&typeof t.handleEvent=="function")t=cr(t.handleEvent,t);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:ni.setTimeout(t,e||0)}function ZR(t){t.g=oE(()=>{t.g=null,t.i&&(t.i=!1,ZR(t))},t.j);const e=t.h;t.h=null,t.m.apply(null,e)}class oZ extends Ol{constructor(e,i){super(),this.m=e,this.j=i,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:ZR(this)}M(){super.M(),this.g&&(ni.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qp(t){Ol.call(this),this.h=t,this.g={}}fr(Qp,Ol);var lM=[];function XR(t,e,i,r){Array.isArray(i)||(i&&(lM[0]=i.toString()),i=lM);for(var c=0;c<i.length;c++){var f=$R(e,i[c],r||t.handleEvent,!1,t.h||t);if(!f)break;t.g[f.key]=f}}function YR(t){Y1(t.g,function(e,i){this.g.hasOwnProperty(i)&&eE(e)},t),t.g={}}Qp.prototype.M=function(){Qp.Z.M.call(this),YR(this)};Qp.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Sv(){this.g=!0}Sv.prototype.Aa=function(){this.g=!1};function aZ(t,e,i,r,c,f){t.info(function(){if(t.g)if(f)for(var y="",l=f.split("&"),I=0;I<l.length;I++){var C=l[I].split("=");if(1<C.length){var L=C[0];C=C[1];var R=L.split("_");y=2<=R.length&&R[1]=="type"?y+(L+"="+C+"&"):y+(L+"=redacted&")}}else y=null;else y=f;return"XMLHTTP REQ ("+r+") [attempt "+c+"]: "+e+`
`+i+`
`+y})}function lZ(t,e,i,r,c,f,y){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+c+"]: "+e+`
`+i+`
`+f+" "+y})}function Mh(t,e,i,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+uZ(t,i)+(r?" "+r:"")})}function cZ(t,e){t.info(function(){return"TIMEOUT: "+e})}Sv.prototype.info=function(){};function uZ(t,e){if(!t.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i){for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var r=i[t];if(!(2>r.length)){var c=r[1];if(Array.isArray(c)&&!(1>c.length)){var f=c[0];if(f!="noop"&&f!="stop"&&f!="close")for(var y=1;y<c.length;y++)c[y]=""}}}}return nE(i)}catch{return e}}var gu={},cM=null;function Av(){return cM=cM||new er}gu.Ma="serverreachability";function JR(t){Sr.call(this,gu.Ma,t)}fr(JR,Sr);function em(t){const e=Av();ur(e,new JR(e,t))}gu.STAT_EVENT="statevent";function QR(t,e){Sr.call(this,gu.STAT_EVENT,t),this.stat=e}fr(QR,Sr);function Vr(t){const e=Av();ur(e,new QR(e,t))}gu.Na="timingevent";function eL(t,e){Sr.call(this,gu.Na,t),this.size=e}fr(eL,Sr);function Cm(t,e){if(typeof t!="function")throw Error("Fn must not be null and must be a function");return ni.setTimeout(function(){t()},e)}var Cv={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},tL={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function aE(){}aE.prototype.h=null;function uM(t){return t.h||(t.h=t.i())}function iL(){}var Mm={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function lE(){Sr.call(this,"d")}fr(lE,Sr);function cE(){Sr.call(this,"c")}fr(cE,Sr);var ow;function Mv(){}fr(Mv,aE);Mv.prototype.g=function(){return new XMLHttpRequest};Mv.prototype.i=function(){return{}};ow=new Mv;function km(t,e,i,r){this.l=t,this.j=e,this.m=i,this.X=r||1,this.V=new Qp(this),this.P=hZ,t=ew?125:void 0,this.W=new Iv(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new nL}function nL(){this.i=null,this.g="",this.h=!1}var hZ=45e3,aw={},Iy={};Mt=km.prototype;Mt.setTimeout=function(t){this.P=t};function lw(t,e,i){t.K=1,t.v=Dv(ka(e)),t.s=i,t.U=!0,rL(t,null)}function rL(t,e){t.F=Date.now(),Dm(t),t.A=ka(t.v);var i=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),hL(i.h,"t",r),t.C=0,i=t.l.H,t.h=new nL,t.g=DL(t.l,i?e:null,!t.s),0<t.O&&(t.L=new oZ(cr(t.Ia,t,t.g),t.O)),XR(t.V,t.g,"readystatechange",t.gb),e=t.H?NR(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),em(1),aZ(t.j,t.u,t.A,t.m,t.X,t.s)}Mt.gb=function(t){t=t.target;const e=this.L;e&&Ea(t)==3?e.l():this.Ia(t)};Mt.Ia=function(t){try{if(t==this.g)e:{const L=Ea(this.g);var e=this.g.Da();const R=this.g.ba();if(!(3>L)&&(L!=3||ew||this.g&&(this.h.h||this.g.ga()||pM(this.g)))){this.I||L!=4||e==7||(e==8||0>=R?em(3):em(2)),kv(this);var i=this.g.ba();this.N=i;t:if(sL(this)){var r=pM(this.g);t="";var c=r.length,f=Ea(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){zc(this),Lp(this);var y="";break t}this.h.i=new ni.TextDecoder}for(e=0;e<c;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:f&&e==c-1});r.splice(0,c),this.h.g+=t,this.C=0,y=this.h.g}else y=this.g.ga();if(this.i=i==200,lZ(this.j,this.u,this.A,this.m,this.X,L,i),this.i){if(this.$&&!this.J){t:{if(this.g){var l,I=this.g;if((l=I.g?I.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ey(l)){var C=l;break t}}C=null}if(i=C)Mh(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,cw(this,i);else{this.i=!1,this.o=3,Vr(12),zc(this),Lp(this);break e}}this.U?(oL(this,L,y),ew&&this.i&&L==3&&(XR(this.V,this.W,"tick",this.fb),this.W.start())):(Mh(this.j,this.m,y,null),cw(this,y)),L==4&&zc(this),this.i&&!this.I&&(L==4?AL(this.l,this):(this.i=!1,Dm(this)))}else i==400&&0<y.indexOf("Unknown SID")?(this.o=3,Vr(12)):(this.o=0,Vr(13)),zc(this),Lp(this)}}}catch{}finally{}};function sL(t){return t.g?t.u=="GET"&&t.K!=2&&t.l.Ba:!1}function oL(t,e,i){let r=!0,c;for(;!t.I&&t.C<i.length;)if(c=dZ(t,i),c==Iy){e==4&&(t.o=4,Vr(14),r=!1),Mh(t.j,t.m,null,"[Incomplete Response]");break}else if(c==aw){t.o=4,Vr(15),Mh(t.j,t.m,i,"[Invalid Chunk]"),r=!1;break}else Mh(t.j,t.m,c,null),cw(t,c);sL(t)&&c!=Iy&&c!=aw&&(t.h.g="",t.C=0),e!=4||i.length!=0||t.h.h||(t.o=1,Vr(16),r=!1),t.i=t.i&&r,r?0<i.length&&!t.aa&&(t.aa=!0,e=t.l,e.g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+i.length),yE(e),e.L=!0,Vr(11))):(Mh(t.j,t.m,i,"[Invalid Chunked Response]"),zc(t),Lp(t))}Mt.fb=function(){if(this.g){var t=Ea(this.g),e=this.g.ga();this.C<e.length&&(kv(this),oL(this,t,e),this.i&&t!=4&&Dm(this))}};function dZ(t,e){var i=t.C,r=e.indexOf(`
`,i);return r==-1?Iy:(i=Number(e.substring(i,r)),isNaN(i)?aw:(r+=1,r+i>e.length?Iy:(e=e.substr(r,i),t.C=r+i,e)))}Mt.cancel=function(){this.I=!0,zc(this)};function Dm(t){t.Y=Date.now()+t.P,aL(t,t.P)}function aL(t,e){if(t.B!=null)throw Error("WatchDog timer not null");t.B=Cm(cr(t.eb,t),e)}function kv(t){t.B&&(ni.clearTimeout(t.B),t.B=null)}Mt.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(cZ(this.j,this.A),this.K!=2&&(em(3),Vr(17)),zc(this),this.o=2,Lp(this)):aL(this,this.Y-t)};function Lp(t){t.l.G==0||t.I||AL(t.l,t)}function zc(t){kv(t);var e=t.L;e&&typeof e.na=="function"&&e.na(),t.L=null,sE(t.W),YR(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function cw(t,e){try{var i=t.l;if(i.G!=0&&(i.g==t||uw(i.i,t))){if(i.I=t.N,!t.J&&uw(i.i,t)&&i.G==3){try{var r=i.Ca.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var c=r;if(c[0]==0){e:if(!i.u){if(i.g)if(i.g.F+3e3<t.F)My(i),Lv(i);else break e;gE(i),Vr(18)}}else i.ta=c[1],0<i.ta-i.U&&37500>c[2]&&i.N&&i.A==0&&!i.v&&(i.v=Cm(cr(i.ab,i),6e3));if(1>=pL(i.i)&&i.ka){try{i.ka()}catch{}i.ka=void 0}}else Nc(i,11)}else if((t.J||i.g==t)&&My(i),!Ey(e))for(c=i.Ca.g.parse(e),e=0;e<c.length;e++){let C=c[e];if(i.U=C[0],C=C[1],i.G==2)if(C[0]=="c"){i.J=C[1],i.la=C[2];const L=C[3];L!=null&&(i.ma=L,i.h.info("VER="+i.ma));const R=C[4];R!=null&&(i.za=R,i.h.info("SVER="+i.za));const $=C[5];$!=null&&typeof $=="number"&&0<$&&(r=1.5*$,i.K=r,i.h.info("backChannelRequestTimeoutMs_="+r)),r=i;const J=t.g;if(J){const pe=J.g?J.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(pe){var f=r.i;!f.g&&(Br(pe,"spdy")||Br(pe,"quic")||Br(pe,"h2"))&&(f.j=f.l,f.g=new Set,f.h&&(dE(f,f.h),f.h=null))}if(r.D){const Re=J.g?J.g.getResponseHeader("X-HTTP-Session-Id"):null;Re&&(r.sa=Re,gn(r.F,r.D,Re))}}i.G=3,i.j&&i.j.xa(),i.$&&(i.O=Date.now()-t.F,i.h.info("Handshake RTT: "+i.O+"ms")),r=i;var y=t;if(r.oa=kL(r,r.H?r.la:null,r.W),y.J){mL(r.i,y);var l=y,I=r.K;I&&l.setTimeout(I),l.B&&(kv(l),Dm(l)),r.g=y}else IL(r);0<i.l.length&&Ov(i)}else C[0]!="stop"&&C[0]!="close"||Nc(i,7);else i.G==3&&(C[0]=="stop"||C[0]=="close"?C[0]=="stop"?Nc(i,7):_E(i):C[0]!="noop"&&i.j&&i.j.wa(C),i.A=0)}}em(4)}catch{}}function fZ(t){if(t.R&&typeof t.R=="function")return t.R();if(typeof t=="string")return t.split("");if(Qb(t)){for(var e=[],i=t.length,r=0;r<i;r++)e.push(t[r]);return e}e=[],i=0;for(r in t)e[i++]=t[r];return e}function uE(t,e){if(t.forEach&&typeof t.forEach=="function")t.forEach(e,void 0);else if(Qb(t)||typeof t=="string")zR(t,e,void 0);else{if(t.T&&typeof t.T=="function")var i=t.T();else if(t.R&&typeof t.R=="function")i=void 0;else if(Qb(t)||typeof t=="string"){i=[];for(var r=t.length,c=0;c<r;c++)i.push(c)}else for(c in i=[],r=0,t)i[r++]=c;r=fZ(t),c=r.length;for(var f=0;f<c;f++)e.call(void 0,r[f],i&&i[f],t)}}function Sd(t,e){this.h={},this.g=[],this.i=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var r=0;r<i;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Sd)for(i=t.T(),r=0;r<i.length;r++)this.set(i[r],t.get(i[r]));else for(r in t)this.set(r,t[r])}Mt=Sd.prototype;Mt.R=function(){hE(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t};Mt.T=function(){return hE(this),this.g.concat()};function hE(t){if(t.i!=t.g.length){for(var e=0,i=0;e<t.g.length;){var r=t.g[e];su(t.h,r)&&(t.g[i++]=r),e++}t.g.length=i}if(t.i!=t.g.length){var c={};for(i=e=0;e<t.g.length;)r=t.g[e],su(c,r)||(t.g[i++]=r,c[r]=1),e++;t.g.length=i}}Mt.get=function(t,e){return su(this.h,t)?this.h[t]:e};Mt.set=function(t,e){su(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e};Mt.forEach=function(t,e){for(var i=this.T(),r=0;r<i.length;r++){var c=i[r],f=this.get(c);t.call(e,f,c,this)}};function su(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var lL=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function pZ(t,e){if(t){t=t.split("&");for(var i=0;i<t.length;i++){var r=t[i].indexOf("="),c=null;if(0<=r){var f=t[i].substring(0,r);c=t[i].substring(r+1)}else f=t[i];e(f,c?decodeURIComponent(c.replace(/\+/g," ")):"")}}}function ou(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof ou){this.g=e!==void 0?e:t.g,Sy(this,t.j),this.s=t.s,Ay(this,t.i),Cy(this,t.m),this.l=t.l,e=t.h;var i=new tm;i.i=e.i,e.g&&(i.g=new Sd(e.g),i.h=e.h),hM(this,i),this.o=t.o}else t&&(i=String(t).match(lL))?(this.g=!!e,Sy(this,i[1]||"",!0),this.s=Op(i[2]||""),Ay(this,i[3]||"",!0),Cy(this,i[4]),this.l=Op(i[5]||"",!0),hM(this,i[6]||"",!0),this.o=Op(i[7]||"")):(this.g=!!e,this.h=new tm(null,this.g))}ou.prototype.toString=function(){var t=[],e=this.j;e&&t.push(_p(e,dM,!0),":");var i=this.i;return(i||e=="file")&&(t.push("//"),(e=this.s)&&t.push(_p(e,dM,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i=this.m,i!=null&&t.push(":",String(i))),(i=this.l)&&(this.i&&i.charAt(0)!="/"&&t.push("/"),t.push(_p(i,i.charAt(0)=="/"?vZ:yZ,!0))),(i=this.h.toString())&&t.push("?",i),(i=this.o)&&t.push("#",_p(i,bZ)),t.join("")};function ka(t){return new ou(t)}function Sy(t,e,i){t.j=i?Op(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ay(t,e,i){t.i=i?Op(e,!0):e}function Cy(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function hM(t,e,i){e instanceof tm?(t.h=e,wZ(t.h,t.g)):(i||(e=_p(e,xZ)),t.h=new tm(e,t.g))}function gn(t,e,i){t.h.set(e,i)}function Dv(t){return gn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function mZ(t){return t instanceof ou?ka(t):new ou(t,void 0)}function _Z(t,e,i,r){var c=new ou(null,void 0);return t&&Sy(c,t),e&&Ay(c,e),i&&Cy(c,i),r&&(c.l=r),c}function Op(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function _p(t,e,i){return typeof t=="string"?(t=encodeURI(t).replace(e,gZ),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function gZ(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(t&15).toString(16)}var dM=/[#\/\?@]/g,yZ=/[#\?:]/g,vZ=/[#\?]/g,xZ=/[#\?@]/g,bZ=/#/g;function tm(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function zl(t){t.g||(t.g=new Sd,t.h=0,t.i&&pZ(t.i,function(e,i){t.add(decodeURIComponent(e.replace(/\+/g," ")),i)}))}Mt=tm.prototype;Mt.add=function(t,e){zl(this),this.i=null,t=Ad(this,t);var i=this.g.get(t);return i||this.g.set(t,i=[]),i.push(e),this.h+=1,this};function cL(t,e){zl(t),e=Ad(t,e),su(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,t=t.g,su(t.h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&hE(t)))}function uL(t,e){return zl(t),e=Ad(t,e),su(t.g.h,e)}Mt.forEach=function(t,e){zl(this),this.g.forEach(function(i,r){zR(i,function(c){t.call(e,c,r,this)},this)},this)};Mt.T=function(){zl(this);for(var t=this.g.R(),e=this.g.T(),i=[],r=0;r<e.length;r++)for(var c=t[r],f=0;f<c.length;f++)i.push(e[r]);return i};Mt.R=function(t){zl(this);var e=[];if(typeof t=="string")uL(this,t)&&(e=iM(e,this.g.get(Ad(this,t))));else{t=this.g.R();for(var i=0;i<t.length;i++)e=iM(e,t[i])}return e};Mt.set=function(t,e){return zl(this),this.i=null,t=Ad(this,t),uL(this,t)&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this};Mt.get=function(t,e){return t?(t=this.R(t),0<t.length?String(t[0]):e):e};function hL(t,e,i){cL(t,e),0<i.length&&(t.i=null,t.g.set(Ad(t,e),X1(i)),t.h+=i.length)}Mt.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),i=0;i<e.length;i++){var r=e[i],c=encodeURIComponent(String(r));r=this.R(r);for(var f=0;f<r.length;f++){var y=c;r[f]!==""&&(y+="="+encodeURIComponent(String(r[f]))),t.push(y)}}return this.i=t.join("&")};function Ad(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function wZ(t,e){e&&!t.j&&(zl(t),t.i=null,t.g.forEach(function(i,r){var c=r.toLowerCase();r!=c&&(cL(this,r),hL(this,c,i))},t)),t.j=e}var EZ=class{constructor(t,e){this.h=t,this.g=e}};function dL(t){this.l=t||TZ,ni.PerformanceNavigationTiming?(t=ni.performance.getEntriesByType("navigation"),t=0<t.length&&(t[0].nextHopProtocol=="hq"||t[0].nextHopProtocol=="h2")):t=!!(ni.g&&ni.g.Ea&&ni.g.Ea()&&ni.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var TZ=10;function fL(t){return t.h?!0:t.g?t.g.size>=t.j:!1}function pL(t){return t.h?1:t.g?t.g.size:0}function uw(t,e){return t.h?t.h==e:t.g?t.g.has(e):!1}function dE(t,e){t.g?t.g.add(e):t.h=e}function mL(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}dL.prototype.cancel=function(){if(this.i=_L(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const t of this.g.values())t.cancel();this.g.clear()}};function _L(t){if(t.h!=null)return t.i.concat(t.h.D);if(t.g!=null&&t.g.size!==0){let e=t.i;for(const i of t.g.values())e=e.concat(i.D);return e}return X1(t.i)}function fE(){}fE.prototype.stringify=function(t){return ni.JSON.stringify(t,void 0)};fE.prototype.parse=function(t){return ni.JSON.parse(t,void 0)};function IZ(){this.g=new fE}function SZ(t,e,i){const r=i||"";try{uE(t,function(c,f){let y=c;Sm(c)&&(y=nE(c)),e.push(r+f+"="+encodeURIComponent(y))})}catch(c){throw e.push(r+"type="+encodeURIComponent("_badmap")),c}}function AZ(t,e){const i=new Sv;if(ni.Image){const r=new Image;r.onload=Tg(Sg,i,r,"TestLoadImage: loaded",!0,e),r.onerror=Tg(Sg,i,r,"TestLoadImage: error",!1,e),r.onabort=Tg(Sg,i,r,"TestLoadImage: abort",!1,e),r.ontimeout=Tg(Sg,i,r,"TestLoadImage: timeout",!1,e),ni.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}function Sg(t,e,i,r,c){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,c(r)}catch{}}function Pm(t){this.l=t.$b||null,this.j=t.ib||!1}fr(Pm,aE);Pm.prototype.g=function(){return new Pv(this.l,this.j)};Pm.prototype.i=function(t){return function(){return t}}({});function Pv(t,e){er.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=pE,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}fr(Pv,er);var pE=0;Mt=Pv.prototype;Mt.open=function(t,e){if(this.readyState!=pE)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,im(this)};Mt.send=function(t){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||ni).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))};Mt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Rm(this)),this.readyState=pE};Mt.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,im(this)),this.g&&(this.readyState=3,im(this),this.g)))if(this.responseType==="arraybuffer")t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof ni.ReadableStream!="undefined"&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gL(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))};function gL(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}Mt.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Rm(this):im(this),this.readyState==3&&gL(this)}};Mt.Ua=function(t){this.g&&(this.response=this.responseText=t,Rm(this))};Mt.Ta=function(t){this.g&&(this.response=t,Rm(this))};Mt.ha=function(){this.g&&Rm(this)};function Rm(t){t.readyState=4,t.l=null,t.j=null,t.A=null,im(t)}Mt.setRequestHeader=function(t,e){this.v.append(t,e)};Mt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""};Mt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var i=e.next();!i.done;)i=i.value,t.push(i[0]+": "+i[1]),i=e.next();return t.join(`\r
`)};function im(t){t.onreadystatechange&&t.onreadystatechange.call(t)}Object.defineProperty(Pv.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(t){this.m=t?"include":"same-origin"}});var CZ=ni.JSON.parse;function zn(t){er.call(this),this.headers=new Sd,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=yL,this.K=this.L=!1}fr(zn,er);var yL="",MZ=/^https?$/i,kZ=["POST","PUT"];Mt=zn.prototype;Mt.ea=function(t,e,i,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ow.g(),this.C=this.u?uM(this.u):uM(ow),this.g.onreadystatechange=cr(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(f){fM(this,f);return}t=i||"";const c=new Sd(this.headers);r&&uE(r,function(f,y){c.set(y,f)}),r=VK(c.T()),i=ni.FormData&&t instanceof ni.FormData,!(0<=OR(kZ,e))||r||i||c.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),c.forEach(function(f,y){this.g.setRequestHeader(y,f)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{bL(this),0<this.B&&((this.K=DZ(this.g))?(this.g.timeout=this.B,this.g.ontimeout=cr(this.pa,this)):this.A=oE(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(f){fM(this,f)}};function DZ(t){return td&&WK()&&typeof t.timeout=="number"&&t.ontimeout!==void 0}function PZ(t){return t.toLowerCase()=="content-type"}Mt.pa=function(){typeof Z1!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ur(this,"timeout"),this.abort(8))};function fM(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,vL(t),Rv(t)}function vL(t){t.D||(t.D=!0,ur(t,"complete"),ur(t,"error"))}Mt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,ur(this,"complete"),ur(this,"abort"),Rv(this))};Mt.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Rv(this,!0)),zn.Z.M.call(this)};Mt.Fa=function(){this.s||(this.F||this.v||this.l?xL(this):this.cb())};Mt.cb=function(){xL(this)};function xL(t){if(t.h&&typeof Z1!="undefined"&&(!t.C[1]||Ea(t)!=4||t.ba()!=2)){if(t.v&&Ea(t)==4)oE(t.Fa,0,t);else if(ur(t,"readystatechange"),Ea(t)==4){t.h=!1;try{const l=t.ba();e:switch(l){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var i;if(!(i=e)){var r;if(r=l===0){var c=String(t.H).match(lL)[1]||null;if(!c&&ni.self&&ni.self.location){var f=ni.self.location.protocol;c=f.substr(0,f.length-1)}r=!MZ.test(c?c.toLowerCase():"")}i=r}if(i)ur(t,"complete"),ur(t,"success");else{t.m=6;try{var y=2<Ea(t)?t.g.statusText:""}catch{y=""}t.j=y+" ["+t.ba()+"]",vL(t)}}finally{Rv(t)}}}}function Rv(t,e){if(t.g){bL(t);const i=t.g,r=t.C[0]?wy:null;t.g=null,t.C=null,e||ur(t,"ready");try{i.onreadystatechange=r}catch{}}}function bL(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(ni.clearTimeout(t.A),t.A=null)}function Ea(t){return t.g?t.g.readyState:0}Mt.ba=function(){try{return 2<Ea(this)?this.g.status:-1}catch{return-1}};Mt.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}};Mt.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&e.indexOf(t)==0&&(e=e.substring(t.length)),CZ(e)}};function pM(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case yL:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch{return null}}Mt.Da=function(){return this.m};Mt.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function RZ(t){let e="";return Y1(t,function(i,r){e+=r,e+=":",e+=i,e+=`\r
`}),e}function mE(t,e,i){e:{for(r in i){var r=!1;break e}r=!0}r||(i=RZ(i),typeof t=="string"?i!=null&&encodeURIComponent(String(i)):gn(t,e,i))}function cp(t,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[t]||e}function wL(t){this.za=0,this.l=[],this.h=new Sv,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=cp("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=cp("baseRetryDelayMs",5e3,t),this.$a=cp("retryDelaySeedMs",1e4,t),this.Ya=cp("forwardChannelMaxRetries",2,t),this.ra=cp("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new dL(t&&t.concurrentRequestLimit),this.Ca=new IZ,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||t.Xb!==!1}Mt=wL.prototype;Mt.ma=8;Mt.G=1;function _E(t){if(EL(t),t.G==3){var e=t.V++,i=ka(t.F);gn(i,"SID",t.J),gn(i,"RID",e),gn(i,"TYPE","terminate"),Lm(t,i),e=new km(t,t.h,e,void 0),e.K=2,e.v=Dv(ka(i)),i=!1,ni.navigator&&ni.navigator.sendBeacon&&(i=ni.navigator.sendBeacon(e.v.toString(),"")),!i&&ni.Image&&(new Image().src=e.v,i=!0),i||(e.g=DL(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Dm(e)}ML(t)}Mt.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch{}};function Lv(t){t.g&&(yE(t),t.g.cancel(),t.g=null)}function EL(t){Lv(t),t.u&&(ni.clearTimeout(t.u),t.u=null),My(t),t.i.cancel(),t.m&&(typeof t.m=="number"&&ni.clearTimeout(t.m),t.m=null)}function eb(t,e){t.l.push(new EZ(t.Za++,e)),t.G==3&&Ov(t)}function Ov(t){fL(t.i)||t.m||(t.m=!0,rE(t.Ha,t),t.C=0)}function LZ(t,e){return pL(t.i)>=t.i.j-(t.m?1:0)?!1:t.m?(t.l=e.D.concat(t.l),!0):t.G==1||t.G==2||t.C>=(t.Xa?0:t.Ya)?!1:(t.m=Cm(cr(t.Ha,t,e),CL(t,t.C)),t.C++,!0)}Mt.Ha=function(t){if(this.m)if(this.m=null,this.G==1){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const c=new km(this,this.h,t,void 0);let f=this.s;if(this.P&&(f?(f=NR(f),FR(f,this.P)):f=this.P),this.o===null&&(c.H=f),this.ja)e:{for(var e=0,i=0;i<this.l.length;i++){t:{var r=this.l[i];if("__data__"in r.g&&(r=r.g.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=i;break e}if(e===4096||i===this.l.length-1){e=i+1;break e}}e=1e3}else e=1e3;e=TL(this,c,e),i=ka(this.F),gn(i,"RID",t),gn(i,"CVER",22),this.D&&gn(i,"X-HTTP-Session-Id",this.D),Lm(this,i),this.o&&f&&mE(i,this.o,f),dE(this.i,c),this.Ra&&gn(i,"TYPE","init"),this.ja?(gn(i,"$req",e),gn(i,"SID","null"),c.$=!0,lw(c,i,null)):lw(c,i,e),this.G=2}}else this.G==3&&(t?mM(this,t):this.l.length==0||fL(this.i)||mM(this))};function mM(t,e){var i;e?i=e.m:i=t.V++;const r=ka(t.F);gn(r,"SID",t.J),gn(r,"RID",i),gn(r,"AID",t.U),Lm(t,r),t.o&&t.s&&mE(r,t.o,t.s),i=new km(t,t.h,i,t.C+1),t.o===null&&(i.H=t.s),e&&(t.l=e.D.concat(t.l)),e=TL(t,i,1e3),i.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),dE(t.i,i),lw(i,r,e)}function Lm(t,e){t.j&&uE({},function(i,r){gn(e,r,i)})}function TL(t,e,i){i=Math.min(t.l.length,i);var r=t.j?cr(t.j.Oa,t.j,t):null;e:{var c=t.l;let f=-1;for(;;){const y=["count="+i];f==-1?0<i?(f=c[0].h,y.push("ofs="+f)):f=0:y.push("ofs="+f);let l=!0;for(let I=0;I<i;I++){let C=c[I].h;const L=c[I].g;if(C-=f,0>C)f=Math.max(0,c[I].h-100),l=!1;else try{SZ(L,y,"req"+C+"_")}catch{r&&r(L)}}if(l){r=y.join("&");break e}}}return t=t.l.splice(0,i),e.D=t,r}function IL(t){t.g||t.u||(t.Y=1,rE(t.Ga,t),t.A=0)}function gE(t){return t.g||t.u||3<=t.A?!1:(t.Y++,t.u=Cm(cr(t.Ga,t),CL(t,t.A)),t.A++,!0)}Mt.Ga=function(){if(this.u=null,SL(this),this.$&&!(this.L||this.g==null||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Cm(cr(this.bb,this),t)}};Mt.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Vr(10),Lv(this),SL(this))};function yE(t){t.B!=null&&(ni.clearTimeout(t.B),t.B=null)}function SL(t){t.g=new km(t,t.h,"rpc",t.Y),t.o===null&&(t.g.H=t.s),t.g.O=0;var e=ka(t.oa);gn(e,"RID","rpc"),gn(e,"SID",t.J),gn(e,"CI",t.N?"0":"1"),gn(e,"AID",t.U),Lm(t,e),gn(e,"TYPE","xmlhttp"),t.o&&t.s&&mE(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var i=t.g;t=t.la,i.K=1,i.v=Dv(ka(e)),i.s=null,i.U=!0,rL(i,t)}Mt.ab=function(){this.v!=null&&(this.v=null,Lv(this),gE(this),Vr(19))};function My(t){t.v!=null&&(ni.clearTimeout(t.v),t.v=null)}function AL(t,e){var i=null;if(t.g==e){My(t),yE(t),t.g=null;var r=2}else if(uw(t.i,e))i=e.D,mL(t.i,e),r=1;else return;if(t.I=e.N,t.G!=0){if(e.i)if(r==1){i=e.s?e.s.length:0,e=Date.now()-e.F;var c=t.C;r=Av(),ur(r,new eL(r,i,e,c)),Ov(t)}else IL(t);else if(c=e.o,c==3||c==0&&0<t.I||!(r==1&&LZ(t,e)||r==2&&gE(t)))switch(i&&0<i.length&&(e=t.i,e.i=e.i.concat(i)),c){case 1:Nc(t,5);break;case 4:Nc(t,10);break;case 3:Nc(t,6);break;default:Nc(t,2)}}}function CL(t,e){let i=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(i*=2),i*e}function Nc(t,e){if(t.h.info("Error code "+e),e==2){var i=null;t.j&&(i=null);var r=cr(t.jb,t);i||(i=new ou("//www.google.com/images/cleardot.gif"),ni.location&&ni.location.protocol=="http"||Sy(i,"https"),Dv(i)),AZ(i.toString(),r)}else Vr(2);t.G=0,t.j&&t.j.va(e),ML(t),EL(t)}Mt.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Vr(2)):(this.h.info("Failed to ping google.com"),Vr(1))};function ML(t){t.G=0,t.I=-1,t.j&&((_L(t.i).length!=0||t.l.length!=0)&&(t.i.i.length=0,X1(t.l),t.l.length=0),t.j.ua())}function kL(t,e,i){let r=mZ(i);if(r.i!="")e&&Ay(r,e+"."+r.i),Cy(r,r.m);else{const c=ni.location;r=_Z(c.protocol,e?e+"."+c.hostname:c.hostname,+c.port,i)}return t.aa&&Y1(t.aa,function(c,f){gn(r,f,c)}),e=t.D,i=t.sa,e&&i&&gn(r,e,i),gn(r,"VER",t.ma),Lm(t,r),r}function DL(t,e,i){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=i&&t.Ba&&!t.qa?new zn(new Pm({ib:!0})):new zn(t.qa),e.L=t.H,e}function PL(){}Mt=PL.prototype;Mt.xa=function(){};Mt.wa=function(){};Mt.va=function(){};Mt.ua=function(){};Mt.Oa=function(){};function ky(){if(td&&!(10<=Number(HK)))throw Error("Environmental error: no available transport.")}ky.prototype.g=function(t,e){return new Ss(t,e)};function Ss(t,e){er.call(this),this.g=new wL(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!Ey(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ey(e)&&(this.g.D=e,t=this.h,t!==null&&e in t&&(t=this.h,e in t&&delete t[e])),this.j=new Cd(this)}fr(Ss,er);Ss.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,i=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),rE(cr(t.hb,t,e))),Vr(0),t.W=e,t.aa=i||{},t.N=t.X,t.F=kL(t,null,t.W),Ov(t)};Ss.prototype.close=function(){_E(this.g)};Ss.prototype.u=function(t){if(typeof t=="string"){var e={};e.__data__=t,eb(this.g,e)}else this.v?(e={},e.__data__=nE(t),eb(this.g,e)):eb(this.g,t)};Ss.prototype.M=function(){this.g.j=null,delete this.j,_E(this.g),delete this.g,Ss.Z.M.call(this)};function RL(t){lE.call(this);var e=t.__sm__;if(e){e:{for(const i in e){t=i;break e}t=void 0}(this.i=t)&&(t=this.i,e=e!==null&&t in e?e[t]:void 0),this.data=e}else this.data=t}fr(RL,lE);function LL(){cE.call(this),this.status=1}fr(LL,cE);function Cd(t){this.g=t}fr(Cd,PL);Cd.prototype.xa=function(){ur(this.g,"a")};Cd.prototype.wa=function(t){ur(this.g,new RL(t))};Cd.prototype.va=function(t){ur(this.g,new LL(t))};Cd.prototype.ua=function(){ur(this.g,"b")};ky.prototype.createWebChannel=ky.prototype.g;Ss.prototype.send=Ss.prototype.u;Ss.prototype.open=Ss.prototype.m;Ss.prototype.close=Ss.prototype.close;Cv.NO_ERROR=0;Cv.TIMEOUT=8;Cv.HTTP_ERROR=6;tL.COMPLETE="complete";iL.EventType=Mm;Mm.OPEN="a";Mm.CLOSE="b";Mm.ERROR="c";Mm.MESSAGE="d";er.prototype.listen=er.prototype.N;zn.prototype.listenOnce=zn.prototype.O;zn.prototype.getLastError=zn.prototype.La;zn.prototype.getLastErrorCode=zn.prototype.Da;zn.prototype.getStatus=zn.prototype.ba;zn.prototype.getResponseJson=zn.prototype.Qa;zn.prototype.getResponseText=zn.prototype.ga;zn.prototype.send=zn.prototype.ea;var OZ=function(){return new ky},zZ=function(){return Av()},tb=Cv,NZ=tL,FZ=gu,_M={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},BZ=Pm,Ag=iL,UZ=zn;const gM="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rs{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}rs.UNAUTHENTICATED=new rs(null),rs.GOOGLE_CREDENTIALS=new rs("google-credentials-uid"),rs.FIRST_PARTY=new rs("first-party-uid"),rs.MOCK_USER=new rs("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Md="9.6.11";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const au=new vd("@firebase/firestore");function yM(){return au.logLevel}function Ft(t,...e){if(au.logLevel<=Oi.DEBUG){const i=e.map(vE);au.debug(`Firestore (${Md}): ${t}`,...i)}}function kl(t,...e){if(au.logLevel<=Oi.ERROR){const i=e.map(vE);au.error(`Firestore (${Md}): ${t}`,...i)}}function vM(t,...e){if(au.logLevel<=Oi.WARN){const i=e.map(vE);au.warn(`Firestore (${Md}): ${t}`,...i)}}function vE(t){if(typeof t=="string")return t;try{return e=t,JSON.stringify(e)}catch{return t}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ai(t="Unexpected state"){const e=`FIRESTORE (${Md}) INTERNAL ASSERTION FAILED: `+t;throw kl(e),new Error(e)}function cn(t,e){t||ai()}function ui(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const et={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class jt extends Ko{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{constructor(){this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VZ{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class $Z{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable(()=>i(rs.UNAUTHENTICATED))}shutdown(){}}class jZ{constructor(e){this.t=e,this.currentUser=rs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){let r=this.i;const c=I=>this.i!==r?(r=this.i,i(I)):Promise.resolve();let f=new Ia;this.o=()=>{this.i++,this.currentUser=this.u(),f.resolve(),f=new Ia,e.enqueueRetryable(()=>c(this.currentUser))};const y=()=>{const I=f;e.enqueueRetryable(async()=>{await I.promise,await c(this.currentUser)})},l=I=>{Ft("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=I,this.auth.addAuthTokenListener(this.o),y()};this.t.onInit(I=>l(I)),setTimeout(()=>{if(!this.auth){const I=this.t.getImmediate({optional:!0});I?l(I):(Ft("FirebaseAuthCredentialsProvider","Auth not yet detected"),f.resolve(),f=new Ia)}},0),y()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(r=>this.i!==e?(Ft("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(cn(typeof r.accessToken=="string"),new VZ(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return cn(e===null||typeof e=="string"),new rs(e)}}class GZ{constructor(e,i,r){this.type="FirstParty",this.user=rs.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",i);const c=e.auth.getAuthHeaderValueForFirstParty([]);c&&this.headers.set("Authorization",c),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)}}class qZ{constructor(e,i,r){this.h=e,this.l=i,this.m=r}getToken(){return Promise.resolve(new GZ(this.h,this.l,this.m))}start(e,i){e.enqueueRetryable(()=>i(rs.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class WZ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class HZ{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,i){const r=f=>{f.error!=null&&Ft("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${f.error.message}`);const y=f.token!==this.p;return this.p=f.token,Ft("FirebaseAppCheckTokenProvider",`Received ${y?"new":"existing"} token.`),y?i(f.token):Promise.resolve()};this.o=f=>{e.enqueueRetryable(()=>r(f))};const c=f=>{Ft("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=f,this.appCheck.addTokenListener(this.o)};this.g.onInit(f=>c(f)),setTimeout(()=>{if(!this.appCheck){const f=this.g.getImmediate({optional:!0});f?c(f):Ft("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(i=>i?(cn(typeof i.token=="string"),this.p=i.token,new WZ(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xE{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=r=>this.I(r),this.T=r=>i.writeSequenceNumber(r))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KZ(t){const e=typeof self!="undefined"&&(self.crypto||self.msCrypto),i=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let r=0;r<t;r++)i[r]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */xE.A=-1;class OL{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const c=KZ(40);for(let f=0;f<c.length;++f)r.length<20&&c[f]<i&&(r+=e.charAt(c[f]%e.length))}return r}}function Hi(t,e){return t<e?-1:t>e?1:0}function id(t,e,i){return t.length===e.length&&t.every((r,c)=>i(r,e[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new jt(et.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new jt(et.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<-62135596800)throw new jt(et.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new jt(et.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ar.fromMillis(Date.now())}static fromDate(e){return Ar.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*i));return new Ar(i,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Hi(this.nanoseconds,e.nanoseconds):Hi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e){this.timestamp=e}static fromTimestamp(e){return new vi(e)}static min(){return new vi(new Ar(0,0))}static max(){return new vi(new Ar(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xM(t){let e=0;for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e++;return e}function kd(t,e){for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e(i,t[i])}function zL(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(e,i,r){i===void 0?i=0:i>e.length&&ai(),r===void 0?r=e.length-i:r>e.length-i&&ai(),this.segments=e,this.offset=i,this.len=r}get length(){return this.len}isEqual(e){return nm.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof nm?e.forEach(r=>{i.push(r)}):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,r=this.limit();i<r;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const r=Math.min(e.length,i.length);for(let c=0;c<r;c++){const f=e.get(c),y=i.get(c);if(f<y)return-1;if(f>y)return 1}return e.length<i.length?-1:e.length>i.length?1:0}}class yn extends nm{construct(e,i,r){return new yn(e,i,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const i=[];for(const r of e){if(r.indexOf("//")>=0)throw new jt(et.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);i.push(...r.split("/").filter(c=>c.length>0))}return new yn(i)}static emptyPath(){return new yn([])}}const ZZ=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ss extends nm{construct(e,i,r){return new ss(e,i,r)}static isValidIdentifier(e){return ZZ.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ss.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ss(["__name__"])}static fromServerFormat(e){const i=[];let r="",c=0;const f=()=>{if(r.length===0)throw new jt(et.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(r),r=""};let y=!1;for(;c<e.length;){const l=e[c];if(l==="\\"){if(c+1===e.length)throw new jt(et.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const I=e[c+1];if(I!=="\\"&&I!=="."&&I!=="`")throw new jt(et.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=I,c+=2}else l==="`"?(y=!y,c++):l!=="."||y?(r+=l,c++):(f(),c++)}if(f(),y)throw new jt(et.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ss(i)}static emptyPath(){return new ss([])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hw{constructor(e){this.fields=e,e.sort(ss.comparator)}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return id(this.fields,e.fields,(i,r)=>i.isEqual(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e){this.binaryString=e}static fromBase64String(e){const i=atob(e);return new dr(i)}static fromUint8Array(e){const i=function(r){let c="";for(let f=0;f<r.length;++f)c+=String.fromCharCode(r[f]);return c}(e);return new dr(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Hi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}dr.EMPTY_BYTE_STRING=new dr("");const XZ=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dl(t){if(cn(!!t),typeof t=="string"){let e=0;const i=XZ.exec(t);if(cn(!!i),i[1]){let c=i[1];c=(c+"000000000").substr(0,9),e=Number(c)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:On(t.seconds),nanos:On(t.nanos)}}function On(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function nd(t){return typeof t=="string"?dr.fromBase64String(t):dr.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NL(t){var e,i;return((i=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||i===void 0?void 0:i.stringValue)==="server_timestamp"}function FL(t){const e=t.mapValue.fields.__previous_value__;return NL(e)?FL(e):e}function rm(t){const e=Dl(t.mapValue.fields.__local_write_time__.timestampValue);return new Ar(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YZ{constructor(e,i,r,c,f,y,l,I){this.databaseId=e,this.appId=i,this.persistenceKey=r,this.host=c,this.ssl=f,this.forceLongPolling=y,this.autoDetectLongPolling=l,this.useFetchStreams=I}}class rd{constructor(e,i){this.projectId=e,this.database=i||"(default)"}static empty(){return new rd("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof rd&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dd(t){return t==null}function Dy(t){return t===0&&1/t==-1/0}function JZ(t){return typeof t=="number"&&Number.isInteger(t)&&!Dy(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{constructor(e){this.path=e}static fromPath(e){return new Vt(yn.fromString(e))}static fromName(e){return new Vt(yn.fromString(e).popFirst(5))}static empty(){return new Vt(yn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&yn.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return yn.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Vt(new yn(e.slice()))}}function lu(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?NL(t)?4:QZ(t)?9:10:ai()}function Wo(t,e){if(t===e)return!0;const i=lu(t);if(i!==lu(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return rm(t).isEqual(rm(e));case 3:return function(r,c){if(typeof r.timestampValue=="string"&&typeof c.timestampValue=="string"&&r.timestampValue.length===c.timestampValue.length)return r.timestampValue===c.timestampValue;const f=Dl(r.timestampValue),y=Dl(c.timestampValue);return f.seconds===y.seconds&&f.nanos===y.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,c){return nd(r.bytesValue).isEqual(nd(c.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,c){return On(r.geoPointValue.latitude)===On(c.geoPointValue.latitude)&&On(r.geoPointValue.longitude)===On(c.geoPointValue.longitude)}(t,e);case 2:return function(r,c){if("integerValue"in r&&"integerValue"in c)return On(r.integerValue)===On(c.integerValue);if("doubleValue"in r&&"doubleValue"in c){const f=On(r.doubleValue),y=On(c.doubleValue);return f===y?Dy(f)===Dy(y):isNaN(f)&&isNaN(y)}return!1}(t,e);case 9:return id(t.arrayValue.values||[],e.arrayValue.values||[],Wo);case 10:return function(r,c){const f=r.mapValue.fields||{},y=c.mapValue.fields||{};if(xM(f)!==xM(y))return!1;for(const l in f)if(f.hasOwnProperty(l)&&(y[l]===void 0||!Wo(f[l],y[l])))return!1;return!0}(t,e);default:return ai()}}function sm(t,e){return(t.values||[]).find(i=>Wo(i,e))!==void 0}function sd(t,e){if(t===e)return 0;const i=lu(t),r=lu(e);if(i!==r)return Hi(i,r);switch(i){case 0:case 9007199254740991:return 0;case 1:return Hi(t.booleanValue,e.booleanValue);case 2:return function(c,f){const y=On(c.integerValue||c.doubleValue),l=On(f.integerValue||f.doubleValue);return y<l?-1:y>l?1:y===l?0:isNaN(y)?isNaN(l)?0:-1:1}(t,e);case 3:return bM(t.timestampValue,e.timestampValue);case 4:return bM(rm(t),rm(e));case 5:return Hi(t.stringValue,e.stringValue);case 6:return function(c,f){const y=nd(c),l=nd(f);return y.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(c,f){const y=c.split("/"),l=f.split("/");for(let I=0;I<y.length&&I<l.length;I++){const C=Hi(y[I],l[I]);if(C!==0)return C}return Hi(y.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(c,f){const y=Hi(On(c.latitude),On(f.latitude));return y!==0?y:Hi(On(c.longitude),On(f.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(c,f){const y=c.values||[],l=f.values||[];for(let I=0;I<y.length&&I<l.length;++I){const C=sd(y[I],l[I]);if(C)return C}return Hi(y.length,l.length)}(t.arrayValue,e.arrayValue);case 10:return function(c,f){const y=c.fields||{},l=Object.keys(y),I=f.fields||{},C=Object.keys(I);l.sort(),C.sort();for(let L=0;L<l.length&&L<C.length;++L){const R=Hi(l[L],C[L]);if(R!==0)return R;const $=sd(y[l[L]],I[C[L]]);if($!==0)return $}return Hi(l.length,C.length)}(t.mapValue,e.mapValue);default:throw ai()}}function bM(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Hi(t,e);const i=Dl(t),r=Dl(e),c=Hi(i.seconds,r.seconds);return c!==0?c:Hi(i.nanos,r.nanos)}function Bh(t){return dw(t)}function dw(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const c=Dl(r);return`time(${c.seconds},${c.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?nd(t.bytesValue).toBase64():"referenceValue"in t?(i=t.referenceValue,Vt.fromName(i).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(r){let c="[",f=!0;for(const y of r.values||[])f?f=!1:c+=",",c+=dw(y);return c+"]"}(t.arrayValue):"mapValue"in t?function(r){const c=Object.keys(r.fields||{}).sort();let f="{",y=!0;for(const l of c)y?y=!1:f+=",",f+=`${l}:${dw(r.fields[l])}`;return f+"}"}(t.mapValue):ai();var e,i}function fw(t){return!!t&&"integerValue"in t}function bE(t){return!!t&&"arrayValue"in t}function wM(t){return!!t&&"nullValue"in t}function EM(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Vg(t){return!!t&&"mapValue"in t}function zp(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return kd(t.mapValue.fields,(i,r)=>e.mapValue.fields[i]=zp(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(t.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=zp(t.arrayValue.values[i]);return e}return Object.assign({},t)}function QZ(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class no{constructor(e){this.value=e}static empty(){return new no({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let r=0;r<e.length-1;++r)if(i=(i.mapValue.fields||{})[e.get(r)],!Vg(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=zp(i)}setAll(e){let i=ss.emptyPath(),r={},c=[];e.forEach((y,l)=>{if(!i.isImmediateParentOf(l)){const I=this.getFieldsMap(i);this.applyChanges(I,r,c),r={},c=[],i=l.popLast()}y?r[l.lastSegment()]=zp(y):c.push(l.lastSegment())});const f=this.getFieldsMap(i);this.applyChanges(f,r,c)}delete(e){const i=this.field(e.popLast());Vg(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return Wo(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let r=0;r<e.length;++r){let c=i.mapValue.fields[e.get(r)];Vg(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},i.mapValue.fields[e.get(r)]=c),i=c}return i.mapValue.fields}applyChanges(e,i,r){kd(i,(c,f)=>e[c]=f);for(const c of r)delete e[c]}clone(){return new no(zp(this.value))}}function BL(t){const e=[];return kd(t.fields,(i,r)=>{const c=new ss([i]);if(Vg(r)){const f=BL(r.mapValue).fields;if(f.length===0)e.push(c);else for(const y of f)e.push(c.child(y))}else e.push(c)}),new hw(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er{constructor(e,i,r,c,f,y){this.key=e,this.documentType=i,this.version=r,this.readTime=c,this.data=f,this.documentState=y}static newInvalidDocument(e){return new Er(e,0,vi.min(),vi.min(),no.empty(),0)}static newFoundDocument(e,i,r){return new Er(e,1,i,vi.min(),r,0)}static newNoDocument(e,i){return new Er(e,2,i,vi.min(),no.empty(),0)}static newUnknownDocument(e,i){return new Er(e,3,i,vi.min(),no.empty(),2)}convertToFoundDocument(e,i){return this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=no.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=no.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Er&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Er(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function eX(t,e){const i=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,c=vi.fromTimestamp(r===1e9?new Ar(i+1,0):new Ar(i,r));return new od(c,Vt.empty(),e)}function tX(t){return new od(t.readTime,t.key,-1)}class od{constructor(e,i,r){this.readTime=e,this.documentKey=i,this.largestBatchId=r}static min(){return new od(vi.min(),Vt.empty(),-1)}static max(){return new od(vi.max(),Vt.empty(),-1)}}function iX(t,e){let i=t.readTime.compareTo(e.readTime);return i!==0?i:(i=Vt.comparator(t.documentKey,e.documentKey),i!==0?i:Hi(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nX{constructor(e,i=null,r=[],c=[],f=null,y=null,l=null){this.path=e,this.collectionGroup=i,this.orderBy=r,this.filters=c,this.limit=f,this.startAt=y,this.endAt=l,this.P=null}}function TM(t,e=null,i=[],r=[],c=null,f=null,y=null){return new nX(t,e,i,r,c,f,y)}function wE(t){const e=ui(t);if(e.P===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map(r=>{return(c=r).field.canonicalString()+c.op.toString()+Bh(c.value);var c}).join(","),i+="|ob:",i+=e.orderBy.map(r=>function(c){return c.field.canonicalString()+c.dir}(r)).join(","),Dd(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map(r=>Bh(r)).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map(r=>Bh(r)).join(",")),e.P=i}return e.P}function rX(t){let e=t.path.canonicalString();return t.collectionGroup!==null&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(i=>{return`${(r=i).field.canonicalString()} ${r.op} ${Bh(r.value)}`;var r}).join(", ")}]`),Dd(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(i=>function(r){return`${r.field.canonicalString()} (${r.dir})`}(i)).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(i=>Bh(i)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(i=>Bh(i)).join(",")),`Target(${e})`}function EE(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let c=0;c<t.orderBy.length;c++)if(!dX(t.orderBy[c],e.orderBy[c]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let c=0;c<t.filters.length;c++)if(i=t.filters[c],r=e.filters[c],i.op!==r.op||!i.field.isEqual(r.field)||!Wo(i.value,r.value))return!1;var i,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!SM(t.startAt,e.startAt)&&SM(t.endAt,e.endAt)}function pw(t){return Vt.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class cs extends class{}{constructor(e,i,r){super(),this.field=e,this.op=i,this.value=r}static create(e,i,r){return e.isKeyField()?i==="in"||i==="not-in"?this.V(e,i,r):new sX(e,i,r):i==="array-contains"?new lX(e,r):i==="in"?new cX(e,r):i==="not-in"?new uX(e,r):i==="array-contains-any"?new hX(e,r):new cs(e,i,r)}static V(e,i,r){return i==="in"?new oX(e,r):new aX(e,r)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&this.v(sd(i,this.value)):i!==null&&lu(this.value)===lu(i)&&this.v(sd(i,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ai()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class sX extends cs{constructor(e,i,r){super(e,i,r),this.key=Vt.fromName(r.referenceValue)}matches(e){const i=Vt.comparator(e.key,this.key);return this.v(i)}}class oX extends cs{constructor(e,i){super(e,"in",i),this.keys=UL("in",i)}matches(e){return this.keys.some(i=>i.isEqual(e.key))}}class aX extends cs{constructor(e,i){super(e,"not-in",i),this.keys=UL("not-in",i)}matches(e){return!this.keys.some(i=>i.isEqual(e.key))}}function UL(t,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(r=>Vt.fromName(r.referenceValue))}class lX extends cs{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return bE(i)&&sm(i.arrayValue,this.value)}}class cX extends cs{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&sm(this.value.arrayValue,i)}}class uX extends cs{constructor(e,i){super(e,"not-in",i)}matches(e){if(sm(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&!sm(this.value.arrayValue,i)}}class hX extends cs{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!bE(i)||!i.arrayValue.values)&&i.arrayValue.values.some(r=>sm(this.value.arrayValue,r))}}class Py{constructor(e,i){this.position=e,this.inclusive=i}}class Np{constructor(e,i="asc"){this.field=e,this.dir=i}}function dX(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function IM(t,e,i){let r=0;for(let c=0;c<t.position.length;c++){const f=e[c],y=t.position[c];if(f.field.isKeyField()?r=Vt.comparator(Vt.fromName(y.referenceValue),i.key):r=sd(y,i.data.field(f.field)),f.dir==="desc"&&(r*=-1),r!==0)break}return r}function SM(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let i=0;i<t.position.length;i++)if(!Wo(t.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zv{constructor(e,i=null,r=[],c=[],f=null,y="F",l=null,I=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=r,this.filters=c,this.limit=f,this.limitType=y,this.startAt=l,this.endAt=I,this.D=null,this.C=null,this.startAt,this.endAt}}function fX(t,e,i,r,c,f,y,l){return new zv(t,e,i,r,c,f,y,l)}function TE(t){return new zv(t)}function $g(t){return!Dd(t.limit)&&t.limitType==="F"}function Ry(t){return!Dd(t.limit)&&t.limitType==="L"}function pX(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function mX(t){for(const e of t.filters)if(e.S())return e.field;return null}function _X(t){return t.collectionGroup!==null}function om(t){const e=ui(t);if(e.D===null){e.D=[];const i=mX(e),r=pX(e);if(i!==null&&r===null)i.isKeyField()||e.D.push(new Np(i)),e.D.push(new Np(ss.keyField(),"asc"));else{let c=!1;for(const f of e.explicitOrderBy)e.D.push(f),f.field.isKeyField()&&(c=!0);if(!c){const f=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.D.push(new Np(ss.keyField(),f))}}}return e.D}function cu(t){const e=ui(t);if(!e.C)if(e.limitType==="F")e.C=TM(e.path,e.collectionGroup,om(e),e.filters,e.limit,e.startAt,e.endAt);else{const i=[];for(const f of om(e)){const y=f.dir==="desc"?"asc":"desc";i.push(new Np(f.field,y))}const r=e.endAt?new Py(e.endAt.position,!e.endAt.inclusive):null,c=e.startAt?new Py(e.startAt.position,!e.startAt.inclusive):null;e.C=TM(e.path,e.collectionGroup,i,e.filters,e.limit,r,c)}return e.C}function gX(t,e,i){return new zv(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,i,t.startAt,t.endAt)}function Nv(t,e){return EE(cu(t),cu(e))&&t.limitType===e.limitType}function VL(t){return`${wE(cu(t))}|lt:${t.limitType}`}function mw(t){return`Query(target=${rX(cu(t))}; limitType=${t.limitType})`}function IE(t,e){return e.isFoundDocument()&&function(i,r){const c=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(c):Vt.isDocumentKey(i.path)?i.path.isEqual(c):i.path.isImmediateParentOf(c)}(t,e)&&function(i,r){for(const c of i.explicitOrderBy)if(!c.field.isKeyField()&&r.data.field(c.field)===null)return!1;return!0}(t,e)&&function(i,r){for(const c of i.filters)if(!c.matches(r))return!1;return!0}(t,e)&&function(i,r){return!(i.startAt&&!function(c,f,y){const l=IM(c,f,y);return c.inclusive?l<=0:l<0}(i.startAt,om(i),r)||i.endAt&&!function(c,f,y){const l=IM(c,f,y);return c.inclusive?l>=0:l>0}(i.endAt,om(i),r))}(t,e)}function yX(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function $L(t){return(e,i)=>{let r=!1;for(const c of om(t)){const f=vX(c,e,i);if(f!==0)return f;r=r||c.field.isKeyField()}return 0}}function vX(t,e,i){const r=t.field.isKeyField()?Vt.comparator(e.key,i.key):function(c,f,y){const l=f.data.field(c),I=y.data.field(c);return l!==null&&I!==null?sd(l,I):ai()}(t.field,e,i);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ai()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jL(t,e){if(t.N){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Dy(e)?"-0":e}}function GL(t){return{integerValue:""+t}}function xX(t,e){return JZ(e)?GL(e):jL(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fv{constructor(){this._=void 0}}function bX(t,e,i){return t instanceof Ly?function(r,c){const f={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return c&&(f.fields.__previous_value__=c),{mapValue:f}}(i,e):t instanceof am?WL(t,e):t instanceof lm?HL(t,e):function(r,c){const f=qL(r,c),y=AM(f)+AM(r.k);return fw(f)&&fw(r.k)?GL(y):jL(r.M,y)}(t,e)}function wX(t,e,i){return t instanceof am?WL(t,e):t instanceof lm?HL(t,e):i}function qL(t,e){return t instanceof Oy?fw(i=e)||function(r){return!!r&&"doubleValue"in r}(i)?e:{integerValue:0}:null;var i}class Ly extends Fv{}class am extends Fv{constructor(e){super(),this.elements=e}}function WL(t,e){const i=KL(e);for(const r of t.elements)i.some(c=>Wo(c,r))||i.push(r);return{arrayValue:{values:i}}}class lm extends Fv{constructor(e){super(),this.elements=e}}function HL(t,e){let i=KL(e);for(const r of t.elements)i=i.filter(c=>!Wo(c,r));return{arrayValue:{values:i}}}class Oy extends Fv{constructor(e,i){super(),this.M=e,this.k=i}}function AM(t){return On(t.integerValue||t.doubleValue)}function KL(t){return bE(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function EX(t,e){return t.field.isEqual(e.field)&&function(i,r){return i instanceof am&&r instanceof am||i instanceof lm&&r instanceof lm?id(i.elements,r.elements,Wo):i instanceof Oy&&r instanceof Oy?Wo(i.k,r.k):i instanceof Ly&&r instanceof Ly}(t.transform,e.transform)}class TX{constructor(e,i){this.version=e,this.transformResults=i}}class Uh{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new Uh}static exists(e){return new Uh(void 0,e)}static updateTime(e){return new Uh(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function jg(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Bv{}function IX(t,e,i){t instanceof Uv?function(r,c,f){const y=r.value.clone(),l=kM(r.fieldTransforms,c,f.transformResults);y.setAll(l),c.convertToFoundDocument(f.version,y).setHasCommittedMutations()}(t,e,i):t instanceof Om?function(r,c,f){if(!jg(r.precondition,c))return void c.convertToUnknownDocument(f.version);const y=kM(r.fieldTransforms,c,f.transformResults),l=c.data;l.setAll(ZL(r)),l.setAll(y),c.convertToFoundDocument(f.version,l).setHasCommittedMutations()}(t,e,i):function(r,c,f){c.convertToNoDocument(f.version).setHasCommittedMutations()}(0,e,i)}function _w(t,e,i){t instanceof Uv?function(r,c,f){if(!jg(r.precondition,c))return;const y=r.value.clone(),l=DM(r.fieldTransforms,f,c);y.setAll(l),c.convertToFoundDocument(MM(c),y).setHasLocalMutations()}(t,e,i):t instanceof Om?function(r,c,f){if(!jg(r.precondition,c))return;const y=DM(r.fieldTransforms,f,c),l=c.data;l.setAll(ZL(r)),l.setAll(y),c.convertToFoundDocument(MM(c),l).setHasLocalMutations()}(t,e,i):function(r,c){jg(r.precondition,c)&&c.convertToNoDocument(vi.min())}(t,e)}function SX(t,e){let i=null;for(const r of t.fieldTransforms){const c=e.data.field(r.field),f=qL(r.transform,c||null);f!=null&&(i==null&&(i=no.empty()),i.set(r.field,f))}return i||null}function CM(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&id(i,r,(c,f)=>EX(c,f))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function MM(t){return t.isFoundDocument()?t.version:vi.min()}class Uv extends Bv{constructor(e,i,r,c=[]){super(),this.key=e,this.value=i,this.precondition=r,this.fieldTransforms=c,this.type=0}}class Om extends Bv{constructor(e,i,r,c,f=[]){super(),this.key=e,this.data=i,this.fieldMask=r,this.precondition=c,this.fieldTransforms=f,this.type=1}}function ZL(t){const e=new Map;return t.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const r=t.data.field(i);e.set(i,r)}}),e}function kM(t,e,i){const r=new Map;cn(t.length===i.length);for(let c=0;c<i.length;c++){const f=t[c],y=f.transform,l=e.data.field(f.field);r.set(f.field,wX(y,l,i[c]))}return r}function DM(t,e,i){const r=new Map;for(const c of t){const f=c.transform,y=i.data.field(c.field);r.set(c.field,bX(f,y,e))}return r}class AX extends Bv{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}}class CX extends Bv{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MX{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ln,Ri;function kX(t){switch(t){default:return ai();case et.CANCELLED:case et.UNKNOWN:case et.DEADLINE_EXCEEDED:case et.RESOURCE_EXHAUSTED:case et.INTERNAL:case et.UNAVAILABLE:case et.UNAUTHENTICATED:return!1;case et.INVALID_ARGUMENT:case et.NOT_FOUND:case et.ALREADY_EXISTS:case et.PERMISSION_DENIED:case et.FAILED_PRECONDITION:case et.ABORTED:case et.OUT_OF_RANGE:case et.UNIMPLEMENTED:case et.DATA_LOSS:return!0}}function XL(t){if(t===void 0)return kl("GRPC error has no .code"),et.UNKNOWN;switch(t){case Ln.OK:return et.OK;case Ln.CANCELLED:return et.CANCELLED;case Ln.UNKNOWN:return et.UNKNOWN;case Ln.DEADLINE_EXCEEDED:return et.DEADLINE_EXCEEDED;case Ln.RESOURCE_EXHAUSTED:return et.RESOURCE_EXHAUSTED;case Ln.INTERNAL:return et.INTERNAL;case Ln.UNAVAILABLE:return et.UNAVAILABLE;case Ln.UNAUTHENTICATED:return et.UNAUTHENTICATED;case Ln.INVALID_ARGUMENT:return et.INVALID_ARGUMENT;case Ln.NOT_FOUND:return et.NOT_FOUND;case Ln.ALREADY_EXISTS:return et.ALREADY_EXISTS;case Ln.PERMISSION_DENIED:return et.PERMISSION_DENIED;case Ln.FAILED_PRECONDITION:return et.FAILED_PRECONDITION;case Ln.ABORTED:return et.ABORTED;case Ln.OUT_OF_RANGE:return et.OUT_OF_RANGE;case Ln.UNIMPLEMENTED:return et.UNIMPLEMENTED;case Ln.DATA_LOSS:return et.DATA_LOSS;default:return ai()}}(Ri=Ln||(Ln={}))[Ri.OK=0]="OK",Ri[Ri.CANCELLED=1]="CANCELLED",Ri[Ri.UNKNOWN=2]="UNKNOWN",Ri[Ri.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ri[Ri.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ri[Ri.NOT_FOUND=5]="NOT_FOUND",Ri[Ri.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ri[Ri.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ri[Ri.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ri[Ri.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ri[Ri.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ri[Ri.ABORTED=10]="ABORTED",Ri[Ri.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ri[Ri.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ri[Ri.INTERNAL=13]="INTERNAL",Ri[Ri.UNAVAILABLE=14]="UNAVAILABLE",Ri[Ri.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),r=this.inner[i];if(r!==void 0){for(const[c,f]of r)if(this.equalsFn(c,e))return f}}has(e){return this.get(e)!==void 0}set(e,i){const r=this.mapKeyFn(e),c=this.inner[r];if(c===void 0)return this.inner[r]=[[e,i]],void this.innerSize++;for(let f=0;f<c.length;f++)if(this.equalsFn(c[f][0],e))return void(c[f]=[e,i]);c.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return!1;for(let c=0;c<r.length;c++)if(this.equalsFn(r[c][0],e))return r.length===1?delete this.inner[i]:r.splice(c,1),this.innerSize--,!0;return!1}forEach(e){kd(this.inner,(i,r)=>{for(const[c,f]of r)e(c,f)})}isEmpty(){return zL(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e,i){this.comparator=e,this.root=i||rr.EMPTY}insert(e,i){return new tr(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,rr.BLACK,null,null))}remove(e){return new tr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rr.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(r===0)return i.value;r<0?i=i.left:r>0&&(i=i.right)}return null}indexOf(e){let i=0,r=this.root;for(;!r.isEmpty();){const c=this.comparator(e,r.key);if(c===0)return i+r.left.size;c<0?r=r.left:(i+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((i,r)=>(e(i,r),!1))}toString(){const e=[];return this.inorderTraversal((i,r)=>(e.push(`${i}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Cg(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Cg(this.root,e,this.comparator,!1)}getReverseIterator(){return new Cg(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Cg(this.root,e,this.comparator,!0)}}class Cg{constructor(e,i,r,c){this.isReverse=c,this.nodeStack=[];let f=1;for(;!e.isEmpty();)if(f=i?r(e.key,i):1,i&&c&&(f*=-1),f<0)e=this.isReverse?e.left:e.right;else{if(f===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rr{constructor(e,i,r,c,f){this.key=e,this.value=i,this.color=r!=null?r:rr.RED,this.left=c!=null?c:rr.EMPTY,this.right=f!=null?f:rr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,r,c,f){return new rr(e!=null?e:this.key,i!=null?i:this.value,r!=null?r:this.color,c!=null?c:this.left,f!=null?f:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,r){let c=this;const f=r(e,c.key);return c=f<0?c.copy(null,null,null,c.left.insert(e,i,r),null):f===0?c.copy(null,i,null,null,null):c.copy(null,null,null,null,c.right.insert(e,i,r)),c.fixUp()}removeMin(){if(this.left.isEmpty())return rr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let r,c=this;if(i(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,i),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),i(e,c.key)===0){if(c.right.isEmpty())return rr.EMPTY;r=c.right.min(),c=c.copy(r.key,r.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,i))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,rr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,rr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw ai();const e=this.left.check();if(e!==this.right.check())throw ai();return e+(this.isRed()?0:1)}}rr.EMPTY=null,rr.RED=!0,rr.BLACK=!1;rr.EMPTY=new class{constructor(){this.size=0}get key(){throw ai()}get value(){throw ai()}get color(){throw ai()}get left(){throw ai()}get right(){throw ai()}copy(t,e,i,r,c){return this}insert(t,e,i){return new rr(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(e){this.comparator=e,this.data=new tr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((i,r)=>(e(i),!1))}forEachInRange(e,i){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const c=r.getNext();if(this.comparator(c.key,e[1])>=0)return;i(c.key)}}forEachWhile(e,i){let r;for(r=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new PM(this.data.getIterator())}getIteratorFrom(e){return new PM(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach(r=>{i=i.add(r)}),i}isEqual(e){if(!(e instanceof hr)||this.size!==e.size)return!1;const i=this.data.getIterator(),r=e.data.getIterator();for(;i.hasNext();){const c=i.getNext().key,f=r.getNext().key;if(this.comparator(c,f)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(i=>{e.push(i)}),e}toString(){const e=[];return this.forEach(i=>e.push(i)),"SortedSet("+e.toString()+")"}copy(e){const i=new hr(this.comparator);return i.data=e,i}}class PM{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DX=new tr(Vt.comparator);function uu(){return DX}const PX=new tr(Vt.comparator);function gw(){return PX}function ib(){return new Pd(t=>t.toString(),(t,e)=>t.isEqual(e))}const RX=new tr(Vt.comparator),LX=new hr(Vt.comparator);function mn(...t){let e=LX;for(const i of t)e=e.add(i);return e}const OX=new hr(Hi);function YL(){return OX}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vv{constructor(e,i,r,c,f){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=r,this.documentUpdates=c,this.resolvedLimboDocuments=f}static createSynthesizedRemoteEventForCurrentChange(e,i){const r=new Map;return r.set(e,zm.createSynthesizedTargetChangeForCurrentChange(e,i)),new Vv(vi.min(),r,YL(),uu(),mn())}}class zm{constructor(e,i,r,c,f){this.resumeToken=e,this.current=i,this.addedDocuments=r,this.modifiedDocuments=c,this.removedDocuments=f}static createSynthesizedTargetChangeForCurrentChange(e,i){return new zm(dr.EMPTY_BYTE_STRING,i,mn(),mn(),mn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg{constructor(e,i,r,c){this.O=e,this.removedTargetIds=i,this.key=r,this.F=c}}class JL{constructor(e,i){this.targetId=e,this.$=i}}class QL{constructor(e,i,r=dr.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=i,this.resumeToken=r,this.cause=c}}class RM{constructor(){this.B=0,this.L=OM(),this.U=dr.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return this.B!==0}get j(){return this.K}W(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}H(){let e=mn(),i=mn(),r=mn();return this.L.forEach((c,f)=>{switch(f){case 0:e=e.add(c);break;case 2:i=i.add(c);break;case 1:r=r.add(c);break;default:ai()}}),new zm(this.U,this.q,e,i,r)}J(){this.K=!1,this.L=OM()}Y(e,i){this.K=!0,this.L=this.L.insert(e,i)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class zX{constructor(e){this.nt=e,this.st=new Map,this.it=uu(),this.rt=LM(),this.ot=new hr(Hi)}ut(e){for(const i of e.O)e.F&&e.F.isFoundDocument()?this.at(i,e.F):this.ct(i,e.key,e.F);for(const i of e.removedTargetIds)this.ct(i,e.key,e.F)}ht(e){this.forEachTarget(e,i=>{const r=this.lt(i);switch(e.state){case 0:this.ft(i)&&r.W(e.resumeToken);break;case 1:r.tt(),r.G||r.J(),r.W(e.resumeToken);break;case 2:r.tt(),r.G||this.removeTarget(i);break;case 3:this.ft(i)&&(r.et(),r.W(e.resumeToken));break;case 4:this.ft(i)&&(this.dt(i),r.W(e.resumeToken));break;default:ai()}})}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.st.forEach((r,c)=>{this.ft(c)&&i(c)})}_t(e){const i=e.targetId,r=e.$.count,c=this.wt(i);if(c){const f=c.target;if(pw(f))if(r===0){const y=new Vt(f.path);this.ct(i,y,Er.newNoDocument(y,vi.min()))}else cn(r===1);else this.gt(i)!==r&&(this.dt(i),this.ot=this.ot.add(i))}}yt(e){const i=new Map;this.st.forEach((f,y)=>{const l=this.wt(y);if(l){if(f.current&&pw(l.target)){const I=new Vt(l.target.path);this.it.get(I)!==null||this.It(y,I)||this.ct(y,I,Er.newNoDocument(I,e))}f.j&&(i.set(y,f.H()),f.J())}});let r=mn();this.rt.forEach((f,y)=>{let l=!0;y.forEachWhile(I=>{const C=this.wt(I);return!C||C.purpose===2||(l=!1,!1)}),l&&(r=r.add(f))}),this.it.forEach((f,y)=>y.setReadTime(e));const c=new Vv(e,i,this.ot,this.it,r);return this.it=uu(),this.rt=LM(),this.ot=new hr(Hi),c}at(e,i){if(!this.ft(e))return;const r=this.It(e,i.key)?2:0;this.lt(e).Y(i.key,r),this.it=this.it.insert(i.key,i),this.rt=this.rt.insert(i.key,this.Tt(i.key).add(e))}ct(e,i,r){if(!this.ft(e))return;const c=this.lt(e);this.It(e,i)?c.Y(i,1):c.X(i),this.rt=this.rt.insert(i,this.Tt(i).delete(e)),r&&(this.it=this.it.insert(i,r))}removeTarget(e){this.st.delete(e)}gt(e){const i=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let i=this.st.get(e);return i||(i=new RM,this.st.set(e,i)),i}Tt(e){let i=this.rt.get(e);return i||(i=new hr(Hi),this.rt=this.rt.insert(e,i)),i}ft(e){const i=this.wt(e)!==null;return i||Ft("WatchChangeAggregator","Detected inactive target",e),i}wt(e){const i=this.st.get(e);return i&&i.G?null:this.nt.Et(e)}dt(e){this.st.set(e,new RM),this.nt.getRemoteKeysForTarget(e).forEach(i=>{this.ct(e,i,null)})}It(e,i){return this.nt.getRemoteKeysForTarget(e).has(i)}}function LM(){return new tr(Vt.comparator)}function OM(){return new tr(Vt.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NX=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),FX=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))();class BX{constructor(e,i){this.databaseId=e,this.N=i}}function zy(t,e){return t.N?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function eO(t,e){return t.N?e.toBase64():e.toUint8Array()}function UX(t,e){return zy(t,e.toTimestamp())}function Sa(t){return cn(!!t),vi.fromTimestamp(function(e){const i=Dl(e);return new Ar(i.seconds,i.nanos)}(t))}function SE(t,e){return function(i){return new yn(["projects",i.projectId,"databases",i.database])}(t).child("documents").child(e).canonicalString()}function tO(t){const e=yn.fromString(t);return cn(rO(e)),e}function yw(t,e){return SE(t.databaseId,e.path)}function nb(t,e){const i=tO(e);if(i.get(1)!==t.databaseId.projectId)throw new jt(et.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+t.databaseId.projectId);if(i.get(3)!==t.databaseId.database)throw new jt(et.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+t.databaseId.database);return new Vt(iO(i))}function vw(t,e){return SE(t.databaseId,e)}function VX(t){const e=tO(t);return e.length===4?yn.emptyPath():iO(e)}function xw(t){return new yn(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function iO(t){return cn(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function zM(t,e,i){return{name:yw(t,e),fields:i.value.mapValue.fields}}function $X(t,e){let i;if("targetChange"in e){e.targetChange;const r=function(I){return I==="NO_CHANGE"?0:I==="ADD"?1:I==="REMOVE"?2:I==="CURRENT"?3:I==="RESET"?4:ai()}(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],f=function(I,C){return I.N?(cn(C===void 0||typeof C=="string"),dr.fromBase64String(C||"")):(cn(C===void 0||C instanceof Uint8Array),dr.fromUint8Array(C||new Uint8Array))}(t,e.targetChange.resumeToken),y=e.targetChange.cause,l=y&&function(I){const C=I.code===void 0?et.UNKNOWN:XL(I.code);return new jt(C,I.message||"")}(y);i=new QL(r,c,f,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const c=nb(t,r.document.name),f=Sa(r.document.updateTime),y=new no({mapValue:{fields:r.document.fields}}),l=Er.newFoundDocument(c,f,y),I=r.targetIds||[],C=r.removedTargetIds||[];i=new Gg(I,C,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const c=nb(t,r.document),f=r.readTime?Sa(r.readTime):vi.min(),y=Er.newNoDocument(c,f),l=r.removedTargetIds||[];i=new Gg([],l,y.key,y)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const c=nb(t,r.document),f=r.removedTargetIds||[];i=new Gg([],f,c,null)}else{if(!("filter"in e))return ai();{e.filter;const r=e.filter;r.targetId;const c=r.count||0,f=new MX(c),y=r.targetId;i=new JL(y,f)}}return i}function jX(t,e){let i;if(e instanceof Uv)i={update:zM(t,e.key,e.value)};else if(e instanceof AX)i={delete:yw(t,e.key)};else if(e instanceof Om)i={update:zM(t,e.key,e.data),updateMask:QX(e.fieldMask)};else{if(!(e instanceof CX))return ai();i={verify:yw(t,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map(r=>function(c,f){const y=f.transform;if(y instanceof Ly)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof am)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof lm)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Oy)return{fieldPath:f.field.canonicalString(),increment:y.k};throw ai()}(0,r))),e.precondition.isNone||(i.currentDocument=function(r,c){return c.updateTime!==void 0?{updateTime:UX(r,c.updateTime)}:c.exists!==void 0?{exists:c.exists}:ai()}(t,e.precondition)),i}function GX(t,e){return t&&t.length>0?(cn(e!==void 0),t.map(i=>function(r,c){let f=r.updateTime?Sa(r.updateTime):Sa(c);return f.isEqual(vi.min())&&(f=Sa(c)),new TX(f,r.transformResults||[])}(i,e))):[]}function qX(t,e){return{documents:[vw(t,e.path)]}}function WX(t,e){const i={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(i.parent=vw(t,r),i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i.parent=vw(t,r.popLast()),i.structuredQuery.from=[{collectionId:r.lastSegment()}]);const c=function(I){if(I.length===0)return;const C=I.map(L=>function(R){if(R.op==="=="){if(EM(R.value))return{unaryFilter:{field:bh(R.field),op:"IS_NAN"}};if(wM(R.value))return{unaryFilter:{field:bh(R.field),op:"IS_NULL"}}}else if(R.op==="!="){if(EM(R.value))return{unaryFilter:{field:bh(R.field),op:"IS_NOT_NAN"}};if(wM(R.value))return{unaryFilter:{field:bh(R.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bh(R.field),op:XX(R.op),value:R.value}}}(L));return C.length===1?C[0]:{compositeFilter:{op:"AND",filters:C}}}(e.filters);c&&(i.structuredQuery.where=c);const f=function(I){if(I.length!==0)return I.map(C=>function(L){return{field:bh(L.field),direction:ZX(L.dir)}}(C))}(e.orderBy);f&&(i.structuredQuery.orderBy=f);const y=function(I,C){return I.N||Dd(C)?C:{value:C}}(t,e.limit);var l;return y!==null&&(i.structuredQuery.limit=y),e.startAt&&(i.structuredQuery.startAt={before:(l=e.startAt).inclusive,values:l.position}),e.endAt&&(i.structuredQuery.endAt=function(I){return{before:!I.inclusive,values:I.position}}(e.endAt)),i}function HX(t){let e=VX(t.parent);const i=t.structuredQuery,r=i.from?i.from.length:0;let c=null;if(r>0){cn(r===1);const L=i.from[0];L.allDescendants?c=L.collectionId:e=e.child(L.collectionId)}let f=[];i.where&&(f=nO(i.where));let y=[];i.orderBy&&(y=i.orderBy.map(L=>function(R){return new Np(kh(R.field),function($){switch($){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(R.direction))}(L)));let l=null;i.limit&&(l=function(L){let R;return R=typeof L=="object"?L.value:L,Dd(R)?null:R}(i.limit));let I=null;i.startAt&&(I=function(L){const R=!!L.before,$=L.values||[];return new Py($,R)}(i.startAt));let C=null;return i.endAt&&(C=function(L){const R=!L.before,$=L.values||[];return new Py($,R)}(i.endAt)),fX(e,c,y,f,l,"F",I,C)}function KX(t,e){const i=function(r,c){switch(c){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return ai()}}(0,e.purpose);return i==null?null:{"goog-listen-tags":i}}function nO(t){return t?t.unaryFilter!==void 0?[JX(t)]:t.fieldFilter!==void 0?[YX(t)]:t.compositeFilter!==void 0?t.compositeFilter.filters.map(e=>nO(e)).reduce((e,i)=>e.concat(i)):ai():[]}function ZX(t){return NX[t]}function XX(t){return FX[t]}function bh(t){return{fieldPath:t.canonicalString()}}function kh(t){return ss.fromServerFormat(t.fieldPath)}function YX(t){return cs.create(kh(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ai()}}(t.fieldFilter.op),t.fieldFilter.value)}function JX(t){switch(t.unaryFilter.op){case"IS_NAN":const e=kh(t.unaryFilter.field);return cs.create(e,"==",{doubleValue:NaN});case"IS_NULL":const i=kh(t.unaryFilter.field);return cs.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=kh(t.unaryFilter.field);return cs.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=kh(t.unaryFilter.field);return cs.create(c,"!=",{nullValue:"NULL_VALUE"});default:return ai()}}function QX(t){const e=[];return t.fields.forEach(i=>e.push(i.canonicalString())),{fieldPaths:e}}function rO(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e9="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class t9{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&ai(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new pt((r,c)=>{this.nextCallback=f=>{this.wrapSuccess(e,f).next(r,c)},this.catchCallback=f=>{this.wrapFailure(i,f).next(r,c)}})}toPromise(){return new Promise((e,i)=>{this.next(e,i)})}wrapUserFunction(e){try{const i=e();return i instanceof pt?i:pt.resolve(i)}catch(i){return pt.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction(()=>e(i)):pt.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction(()=>e(i)):pt.reject(i)}static resolve(e){return new pt((i,r)=>{i(e)})}static reject(e){return new pt((i,r)=>{r(e)})}static waitFor(e){return new pt((i,r)=>{let c=0,f=0,y=!1;e.forEach(l=>{++c,l.next(()=>{++f,y&&f===c&&i()},I=>r(I))}),y=!0,f===c&&i()})}static or(e){let i=pt.resolve(!1);for(const r of e)i=i.next(c=>c?pt.resolve(c):r());return i}static forEach(e,i){const r=[];return e.forEach((c,f)=>{r.push(i.call(this,c,f))}),this.waitFor(r)}}function Nm(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i9{constructor(e,i,r,c){this.batchId=e,this.localWriteTime=i,this.baseMutations=r,this.mutations=c}applyToRemoteDocument(e,i){const r=i.mutationResults;for(let c=0;c<this.mutations.length;c++){const f=this.mutations[c];f.key.isEqual(e.key)&&IX(f,e,r[c])}}applyToLocalView(e){for(const i of this.baseMutations)i.key.isEqual(e.key)&&_w(i,e,this.localWriteTime);for(const i of this.mutations)i.key.isEqual(e.key)&&_w(i,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach(i=>{const r=e.get(i.key),c=r;this.applyToLocalView(c),r.isValidDocument()||c.convertToNoDocument(vi.min())})}keys(){return this.mutations.reduce((e,i)=>e.add(i.key),mn())}isEqual(e){return this.batchId===e.batchId&&id(this.mutations,e.mutations,(i,r)=>CM(i,r))&&id(this.baseMutations,e.baseMutations,(i,r)=>CM(i,r))}}class AE{constructor(e,i,r,c){this.batch=e,this.commitVersion=i,this.mutationResults=r,this.docVersions=c}static from(e,i,r){cn(e.mutations.length===r.length);let c=RX;const f=e.mutations;for(let y=0;y<f.length;y++)c=c.insert(f[y].key,r[y].version);return new AE(e,i,r,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n9{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qc{constructor(e,i,r,c,f=vi.min(),y=vi.min(),l=dr.EMPTY_BYTE_STRING){this.target=e,this.targetId=i,this.purpose=r,this.sequenceNumber=c,this.snapshotVersion=f,this.lastLimboFreeSnapshotVersion=y,this.resumeToken=l}withSequenceNumber(e){return new qc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,i){return new qc(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new qc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r9{constructor(e){this.Jt=e}}function s9(t){const e=HX({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?gX(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o9{constructor(){this.qe=new a9}addToCollectionParentIndex(e,i){return this.qe.add(i),pt.resolve()}getCollectionParents(e,i){return pt.resolve(this.qe.getEntries(i))}addFieldIndex(e,i){return pt.resolve()}deleteFieldIndex(e,i){return pt.resolve()}getDocumentsMatchingTarget(e,i){return pt.resolve(null)}getFieldIndex(e,i){return pt.resolve(null)}getFieldIndexes(e,i){return pt.resolve([])}getNextCollectionGroupToUpdate(e){return pt.resolve(null)}updateCollectionGroup(e,i,r){return pt.resolve()}updateIndexEntries(e,i){return pt.resolve()}}class a9{constructor(){this.index={}}add(e){const i=e.lastSegment(),r=e.popLast(),c=this.index[i]||new hr(yn.comparator),f=!c.has(r);return this.index[i]=c.add(r),f}has(e){const i=e.lastSegment(),r=e.popLast(),c=this.index[i];return c&&c.has(r)}getEntries(e){return(this.index[e]||new hr(yn.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ad{constructor(e){this.mn=e}next(){return this.mn+=2,this.mn}static gn(){return new ad(0)}static yn(){return new ad(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fm(t){if(t.code!==et.FAILED_PRECONDITION||t.message!==e9)throw t;Ft("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l9{constructor(){this.changes=new Pd(e=>e.toString(),(e,i)=>e.isEqual(i)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,Er.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const r=this.changes.get(i);return r!==void 0?pt.resolve(r):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c9{constructor(e,i,r){this.ds=e,this.Bs=i,this.indexManager=r}Ls(e,i){return this.Bs.getAllMutationBatchesAffectingDocumentKey(e,i).next(r=>this.Us(e,i,r))}Us(e,i,r){return this.ds.getEntry(e,i).next(c=>{for(const f of r)f.applyToLocalView(c);return c})}qs(e,i){e.forEach((r,c)=>{for(const f of i)f.applyToLocalView(c)})}Ks(e,i){return this.ds.getEntries(e,i).next(r=>this.Gs(e,r).next(()=>r))}Gs(e,i){return this.Bs.getAllMutationBatchesAffectingDocumentKeys(e,i).next(r=>this.qs(i,r))}Qs(e,i,r){return function(c){return Vt.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0}(i)?this.js(e,i.path):_X(i)?this.Ws(e,i,r):this.zs(e,i,r)}js(e,i){return this.Ls(e,new Vt(i)).next(r=>{let c=gw();return r.isFoundDocument()&&(c=c.insert(r.key,r)),c})}Ws(e,i,r){const c=i.collectionGroup;let f=gw();return this.indexManager.getCollectionParents(e,c).next(y=>pt.forEach(y,l=>{const I=function(C,L){return new zv(L,null,C.explicitOrderBy.slice(),C.filters.slice(),C.limit,C.limitType,C.startAt,C.endAt)}(i,l.child(c));return this.zs(e,I,r).next(C=>{C.forEach((L,R)=>{f=f.insert(L,R)})})}).next(()=>f))}zs(e,i,r){let c;return this.ds.getAllFromCollection(e,i.path,r).next(f=>(c=f,this.Bs.getAllMutationBatchesAffectingQuery(e,i))).next(f=>{for(const y of f)for(const l of y.mutations){const I=l.key;let C=c.get(I);C==null&&(C=Er.newInvalidDocument(I),c=c.insert(I,C)),_w(l,C,y.localWriteTime),C.isFoundDocument()||(c=c.remove(I))}}).next(()=>(c.forEach((f,y)=>{IE(i,y)||(c=c.remove(f))}),c))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(e,i,r,c){this.targetId=e,this.fromCache=i,this.Hs=r,this.Js=c}static Ys(e,i){let r=mn(),c=mn();for(const f of i.docChanges)switch(f.type){case 0:r=r.add(f.doc.key);break;case 1:c=c.add(f.doc.key)}return new CE(e,i.fromCache,r,c)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u9{Xs(e){this.Zs=e}Qs(e,i,r,c){return function(f){return f.filters.length===0&&f.limit===null&&f.startAt==null&&f.endAt==null&&(f.explicitOrderBy.length===0||f.explicitOrderBy.length===1&&f.explicitOrderBy[0].field.isKeyField())}(i)||r.isEqual(vi.min())?this.ti(e,i):this.Zs.Ks(e,c).next(f=>{const y=this.ei(i,f);return($g(i)||Ry(i))&&this.ni(i.limitType,y,c,r)?this.ti(e,i):(yM()<=Oi.DEBUG&&Ft("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),mw(i)),this.Zs.Qs(e,i,eX(r,-1)).next(l=>(y.forEach(I=>{l=l.insert(I.key,I)}),l)))})}ei(e,i){let r=new hr($L(e));return i.forEach((c,f)=>{IE(e,f)&&(r=r.add(f))}),r}ni(e,i,r,c){if(r.size!==i.size)return!0;const f=e==="F"?i.last():i.first();return!!f&&(f.hasPendingWrites||f.version.compareTo(c)>0)}ti(e,i){return yM()<=Oi.DEBUG&&Ft("QueryEngine","Using full collection scan to execute query:",mw(i)),this.Zs.Qs(e,i,od.min())}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h9{constructor(e,i,r,c){this.persistence=e,this.si=i,this.M=c,this.ii=new tr(Hi),this.ri=new Pd(f=>wE(f),EE),this.oi=new Map,this.ui=e.getRemoteDocumentCache(),this.fs=e.getTargetCache(),this._s=e.getBundleCache(),this.ai(r)}ai(e){this.indexManager=this.persistence.getIndexManager(e),this.Bs=this.persistence.getMutationQueue(e,this.indexManager),this.ci=new c9(this.ui,this.Bs,this.indexManager),this.ui.setIndexManager(this.indexManager),this.si.Xs(this.ci)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>e.collect(i,this.ii))}}function d9(t,e,i,r){return new h9(t,e,i,r)}async function sO(t,e){const i=ui(t);return await i.persistence.runTransaction("Handle user change","readonly",r=>{let c;return i.Bs.getAllMutationBatches(r).next(f=>(c=f,i.ai(e),i.Bs.getAllMutationBatches(r))).next(f=>{const y=[],l=[];let I=mn();for(const C of c){y.push(C.batchId);for(const L of C.mutations)I=I.add(L.key)}for(const C of f){l.push(C.batchId);for(const L of C.mutations)I=I.add(L.key)}return i.ci.Ks(r,I).next(C=>({hi:C,removedBatchIds:y,addedBatchIds:l}))})})}function f9(t,e){const i=ui(t);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const c=e.batch.keys(),f=i.ui.newChangeBuffer({trackRemovals:!0});return function(y,l,I,C){const L=I.batch,R=L.keys();let $=pt.resolve();return R.forEach(J=>{$=$.next(()=>C.getEntry(l,J)).next(pe=>{const Re=I.docVersions.get(J);cn(Re!==null),pe.version.compareTo(Re)<0&&(L.applyToRemoteDocument(pe,I),pe.isValidDocument()&&(pe.setReadTime(I.commitVersion),C.addEntry(pe)))})}),$.next(()=>y.Bs.removeMutationBatch(l,L))}(i,r,e,f).next(()=>f.apply(r)).next(()=>i.Bs.performConsistencyCheck(r)).next(()=>i.ci.Ks(r,c))})}function oO(t){const e=ui(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",i=>e.fs.getLastRemoteSnapshotVersion(i))}function p9(t,e){const i=ui(t),r=e.snapshotVersion;let c=i.ii;return i.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const y=i.ui.newChangeBuffer({trackRemovals:!0});c=i.ii;const l=[];e.targetChanges.forEach((C,L)=>{const R=c.get(L);if(!R)return;l.push(i.fs.removeMatchingKeys(f,C.removedDocuments,L).next(()=>i.fs.addMatchingKeys(f,C.addedDocuments,L)));let $=R.withSequenceNumber(f.currentSequenceNumber);e.targetMismatches.has(L)?$=$.withResumeToken(dr.EMPTY_BYTE_STRING,vi.min()).withLastLimboFreeSnapshotVersion(vi.min()):C.resumeToken.approximateByteSize()>0&&($=$.withResumeToken(C.resumeToken,r)),c=c.insert(L,$),function(J,pe,Re){return J.resumeToken.approximateByteSize()===0||pe.snapshotVersion.toMicroseconds()-J.snapshotVersion.toMicroseconds()>=3e8?!0:Re.addedDocuments.size+Re.modifiedDocuments.size+Re.removedDocuments.size>0}(R,$,C)&&l.push(i.fs.updateTargetData(f,$))});let I=uu();if(e.documentUpdates.forEach(C=>{e.resolvedLimboDocuments.has(C)&&l.push(i.persistence.referenceDelegate.updateLimboDocument(f,C))}),l.push(m9(f,y,e.documentUpdates).next(C=>{I=C})),!r.isEqual(vi.min())){const C=i.fs.getLastRemoteSnapshotVersion(f).next(L=>i.fs.setTargetsMetadata(f,f.currentSequenceNumber,r));l.push(C)}return pt.waitFor(l).next(()=>y.apply(f)).next(()=>i.ci.Gs(f,I)).next(()=>I)}).then(f=>(i.ii=c,f))}function m9(t,e,i){let r=mn();return i.forEach(c=>r=r.add(c)),e.getEntries(t,r).next(c=>{let f=uu();return i.forEach((y,l)=>{const I=c.get(y);l.isNoDocument()&&l.version.isEqual(vi.min())?(e.removeEntry(y,l.readTime),f=f.insert(y,l)):!I.isValidDocument()||l.version.compareTo(I.version)>0||l.version.compareTo(I.version)===0&&I.hasPendingWrites?(e.addEntry(l),f=f.insert(y,l)):Ft("LocalStore","Ignoring outdated watch update for ",y,". Current version:",I.version," Watch version:",l.version)}),f})}function _9(t,e){const i=ui(t);return i.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),i.Bs.getNextMutationBatchAfterBatchId(r,e)))}function g9(t,e){const i=ui(t);return i.persistence.runTransaction("Allocate target","readwrite",r=>{let c;return i.fs.getTargetData(r,e).next(f=>f?(c=f,pt.resolve(c)):i.fs.allocateTargetId(r).next(y=>(c=new qc(e,y,0,r.currentSequenceNumber),i.fs.addTargetData(r,c).next(()=>c))))}).then(r=>{const c=i.ii.get(r.targetId);return(c===null||r.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(i.ii=i.ii.insert(r.targetId,r),i.ri.set(e,r.targetId)),r})}async function bw(t,e,i){const r=ui(t),c=r.ii.get(e),f=i?"readwrite":"readwrite-primary";try{i||await r.persistence.runTransaction("Release target",f,y=>r.persistence.referenceDelegate.removeTarget(y,c))}catch(y){if(!Nm(y))throw y;Ft("LocalStore",`Failed to update sequence numbers for target ${e}: ${y}`)}r.ii=r.ii.remove(e),r.ri.delete(c.target)}function NM(t,e,i){const r=ui(t);let c=vi.min(),f=mn();return r.persistence.runTransaction("Execute query","readonly",y=>function(l,I,C){const L=ui(l),R=L.ri.get(C);return R!==void 0?pt.resolve(L.ii.get(R)):L.fs.getTargetData(I,C)}(r,y,cu(e)).next(l=>{if(l)return c=l.lastLimboFreeSnapshotVersion,r.fs.getMatchingKeysForTargetId(y,l.targetId).next(I=>{f=I})}).next(()=>r.si.Qs(y,e,i?c:vi.min(),i?f:mn())).next(l=>(y9(r,yX(e),l),{documents:l,li:f})))}function y9(t,e,i){let r=vi.min();i.forEach((c,f)=>{f.readTime.compareTo(r)>0&&(r=f.readTime)}),t.oi.set(e,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v9{constructor(e){this.M=e,this.wi=new Map,this.mi=new Map}getBundleMetadata(e,i){return pt.resolve(this.wi.get(i))}saveBundleMetadata(e,i){var r;return this.wi.set(i.id,{id:(r=i).id,version:r.version,createTime:Sa(r.createTime)}),pt.resolve()}getNamedQuery(e,i){return pt.resolve(this.mi.get(i))}saveNamedQuery(e,i){return this.mi.set(i.name,function(r){return{name:r.name,query:s9(r.bundledQuery),readTime:Sa(r.readTime)}}(i)),pt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x9{constructor(){this.overlays=new tr(Vt.comparator),this.gi=new Map}getOverlay(e,i){return pt.resolve(this.overlays.get(i))}saveOverlays(e,i,r){return r.forEach((c,f)=>{this.Xt(e,i,f)}),pt.resolve()}removeOverlaysForBatchId(e,i,r){const c=this.gi.get(r);return c!==void 0&&(c.forEach(f=>this.overlays=this.overlays.remove(f)),this.gi.delete(r)),pt.resolve()}getOverlaysForCollection(e,i,r){const c=ib(),f=i.length+1,y=new Vt(i.child("")),l=this.overlays.getIteratorFrom(y);for(;l.hasNext();){const I=l.getNext().value,C=I.getKey();if(!i.isPrefixOf(C.path))break;C.path.length===f&&I.largestBatchId>r&&c.set(I.getKey(),I)}return pt.resolve(c)}getOverlaysForCollectionGroup(e,i,r,c){let f=new tr((C,L)=>C-L);const y=this.overlays.getIterator();for(;y.hasNext();){const C=y.getNext().value;if(C.getKey().getCollectionGroup()===i&&C.largestBatchId>r){let L=f.get(C.largestBatchId);L===null&&(L=ib(),f=f.insert(C.largestBatchId,L)),L.set(C.getKey(),C)}}const l=ib(),I=f.getIterator();for(;I.hasNext()&&(I.getNext().value.forEach((C,L)=>l.set(C,L)),!(l.size()>=c)););return pt.resolve(l)}Xt(e,i,r){if(r===null)return;const c=this.overlays.get(r.key);if(c!==null){const y=this.gi.get(c.largestBatchId).delete(r.key);this.gi.set(c.largestBatchId,y)}this.overlays=this.overlays.insert(r.key,new n9(i,r));let f=this.gi.get(i);f===void 0&&(f=mn(),this.gi.set(i,f)),this.gi.set(i,f.add(r.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ME{constructor(){this.yi=new hr(Zn.pi),this.Ii=new hr(Zn.Ti)}isEmpty(){return this.yi.isEmpty()}addReference(e,i){const r=new Zn(e,i);this.yi=this.yi.add(r),this.Ii=this.Ii.add(r)}Ei(e,i){e.forEach(r=>this.addReference(r,i))}removeReference(e,i){this.Ai(new Zn(e,i))}Ri(e,i){e.forEach(r=>this.removeReference(r,i))}Pi(e){const i=new Vt(new yn([])),r=new Zn(i,e),c=new Zn(i,e+1),f=[];return this.Ii.forEachInRange([r,c],y=>{this.Ai(y),f.push(y.key)}),f}bi(){this.yi.forEach(e=>this.Ai(e))}Ai(e){this.yi=this.yi.delete(e),this.Ii=this.Ii.delete(e)}Vi(e){const i=new Vt(new yn([])),r=new Zn(i,e),c=new Zn(i,e+1);let f=mn();return this.Ii.forEachInRange([r,c],y=>{f=f.add(y.key)}),f}containsKey(e){const i=new Zn(e,0),r=this.yi.firstAfterOrEqual(i);return r!==null&&e.isEqual(r.key)}}class Zn{constructor(e,i){this.key=e,this.vi=i}static pi(e,i){return Vt.comparator(e.key,i.key)||Hi(e.vi,i.vi)}static Ti(e,i){return Hi(e.vi,i.vi)||Vt.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b9{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.Bs=[],this.Si=1,this.Di=new hr(Zn.pi)}checkEmpty(e){return pt.resolve(this.Bs.length===0)}addMutationBatch(e,i,r,c){const f=this.Si;this.Si++,this.Bs.length>0&&this.Bs[this.Bs.length-1];const y=new i9(f,i,r,c);this.Bs.push(y);for(const l of c)this.Di=this.Di.add(new Zn(l.key,f)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return pt.resolve(y)}lookupMutationBatch(e,i){return pt.resolve(this.Ci(i))}getNextMutationBatchAfterBatchId(e,i){const r=i+1,c=this.xi(r),f=c<0?0:c;return pt.resolve(this.Bs.length>f?this.Bs[f]:null)}getHighestUnacknowledgedBatchId(){return pt.resolve(this.Bs.length===0?-1:this.Si-1)}getAllMutationBatches(e){return pt.resolve(this.Bs.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const r=new Zn(i,0),c=new Zn(i,Number.POSITIVE_INFINITY),f=[];return this.Di.forEachInRange([r,c],y=>{const l=this.Ci(y.vi);f.push(l)}),pt.resolve(f)}getAllMutationBatchesAffectingDocumentKeys(e,i){let r=new hr(Hi);return i.forEach(c=>{const f=new Zn(c,0),y=new Zn(c,Number.POSITIVE_INFINITY);this.Di.forEachInRange([f,y],l=>{r=r.add(l.vi)})}),pt.resolve(this.Ni(r))}getAllMutationBatchesAffectingQuery(e,i){const r=i.path,c=r.length+1;let f=r;Vt.isDocumentKey(f)||(f=f.child(""));const y=new Zn(new Vt(f),0);let l=new hr(Hi);return this.Di.forEachWhile(I=>{const C=I.key.path;return!!r.isPrefixOf(C)&&(C.length===c&&(l=l.add(I.vi)),!0)},y),pt.resolve(this.Ni(l))}Ni(e){const i=[];return e.forEach(r=>{const c=this.Ci(r);c!==null&&i.push(c)}),i}removeMutationBatch(e,i){cn(this.ki(i.batchId,"removed")===0),this.Bs.shift();let r=this.Di;return pt.forEach(i.mutations,c=>{const f=new Zn(c.key,i.batchId);return r=r.delete(f),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)}).next(()=>{this.Di=r})}_n(e){}containsKey(e,i){const r=new Zn(i,0),c=this.Di.firstAfterOrEqual(r);return pt.resolve(i.isEqual(c&&c.key))}performConsistencyCheck(e){return this.Bs.length,pt.resolve()}ki(e,i){return this.xi(e)}xi(e){return this.Bs.length===0?0:e-this.Bs[0].batchId}Ci(e){const i=this.xi(e);return i<0||i>=this.Bs.length?null:this.Bs[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w9{constructor(e){this.Mi=e,this.docs=new tr(Vt.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const r=i.key,c=this.docs.get(r),f=c?c.size:0,y=this.Mi(i);return this.docs=this.docs.insert(r,{document:i.mutableCopy(),size:y}),this.size+=y-f,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const r=this.docs.get(i);return pt.resolve(r?r.document.mutableCopy():Er.newInvalidDocument(i))}getEntries(e,i){let r=uu();return i.forEach(c=>{const f=this.docs.get(c);r=r.insert(c,f?f.document.mutableCopy():Er.newInvalidDocument(c))}),pt.resolve(r)}getAllFromCollection(e,i,r){let c=uu();const f=new Vt(i.child("")),y=this.docs.getIteratorFrom(f);for(;y.hasNext();){const{key:l,value:{document:I}}=y.getNext();if(!i.isPrefixOf(l.path))break;l.path.length>i.length+1||iX(tX(I),r)<=0||(c=c.insert(I.key,I.mutableCopy()))}return pt.resolve(c)}getAllFromCollectionGroup(e,i,r,c){ai()}Oi(e,i){return pt.forEach(this.docs,r=>i(r))}newChangeBuffer(e){return new E9(this)}getSize(e){return pt.resolve(this.size)}}class E9 extends l9{constructor(e){super(),this.Kn=e}applyChanges(e){const i=[];return this.changes.forEach((r,c)=>{c.isValidDocument()?i.push(this.Kn.addEntry(e,c)):this.Kn.removeEntry(r)}),pt.waitFor(i)}getFromCache(e,i){return this.Kn.getEntry(e,i)}getAllFromCache(e,i){return this.Kn.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T9{constructor(e){this.persistence=e,this.Fi=new Pd(i=>wE(i),EE),this.lastRemoteSnapshotVersion=vi.min(),this.highestTargetId=0,this.$i=0,this.Bi=new ME,this.targetCount=0,this.Li=ad.gn()}forEachTarget(e,i){return this.Fi.forEach((r,c)=>i(c)),pt.resolve()}getLastRemoteSnapshotVersion(e){return pt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return pt.resolve(this.$i)}allocateTargetId(e){return this.highestTargetId=this.Li.next(),pt.resolve(this.highestTargetId)}setTargetsMetadata(e,i,r){return r&&(this.lastRemoteSnapshotVersion=r),i>this.$i&&(this.$i=i),pt.resolve()}Tn(e){this.Fi.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this.Li=new ad(i),this.highestTargetId=i),e.sequenceNumber>this.$i&&(this.$i=e.sequenceNumber)}addTargetData(e,i){return this.Tn(i),this.targetCount+=1,pt.resolve()}updateTargetData(e,i){return this.Tn(i),pt.resolve()}removeTargetData(e,i){return this.Fi.delete(i.target),this.Bi.Pi(i.targetId),this.targetCount-=1,pt.resolve()}removeTargets(e,i,r){let c=0;const f=[];return this.Fi.forEach((y,l)=>{l.sequenceNumber<=i&&r.get(l.targetId)===null&&(this.Fi.delete(y),f.push(this.removeMatchingKeysForTargetId(e,l.targetId)),c++)}),pt.waitFor(f).next(()=>c)}getTargetCount(e){return pt.resolve(this.targetCount)}getTargetData(e,i){const r=this.Fi.get(i)||null;return pt.resolve(r)}addMatchingKeys(e,i,r){return this.Bi.Ei(i,r),pt.resolve()}removeMatchingKeys(e,i,r){this.Bi.Ri(i,r);const c=this.persistence.referenceDelegate,f=[];return c&&i.forEach(y=>{f.push(c.markPotentiallyOrphaned(e,y))}),pt.waitFor(f)}removeMatchingKeysForTargetId(e,i){return this.Bi.Pi(i),pt.resolve()}getMatchingKeysForTargetId(e,i){const r=this.Bi.Vi(i);return pt.resolve(r)}containsKey(e,i){return pt.resolve(this.Bi.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I9{constructor(e,i){this.Ui={},this.overlays={},this.es=new xE(0),this.ns=!1,this.ns=!0,this.referenceDelegate=e(this),this.fs=new T9(this),this.indexManager=new o9,this.ds=function(r){return new w9(r)}(r=>this.referenceDelegate.qi(r)),this.M=new r9(i),this._s=new v9(this.M)}start(){return Promise.resolve()}shutdown(){return this.ns=!1,Promise.resolve()}get started(){return this.ns}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new x9,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let r=this.Ui[e.toKey()];return r||(r=new b9(i,this.referenceDelegate),this.Ui[e.toKey()]=r),r}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getBundleCache(){return this._s}runTransaction(e,i,r){Ft("MemoryPersistence","Starting transaction:",e);const c=new S9(this.es.next());return this.referenceDelegate.Ki(),r(c).next(f=>this.referenceDelegate.Gi(c).next(()=>f)).toPromise().then(f=>(c.raiseOnCommittedEvent(),f))}Qi(e,i){return pt.or(Object.values(this.Ui).map(r=>()=>r.containsKey(e,i)))}}class S9 extends t9{constructor(e){super(),this.currentSequenceNumber=e}}class kE{constructor(e){this.persistence=e,this.ji=new ME,this.Wi=null}static zi(e){return new kE(e)}get Hi(){if(this.Wi)return this.Wi;throw ai()}addReference(e,i,r){return this.ji.addReference(r,i),this.Hi.delete(r.toString()),pt.resolve()}removeReference(e,i,r){return this.ji.removeReference(r,i),this.Hi.add(r.toString()),pt.resolve()}markPotentiallyOrphaned(e,i){return this.Hi.add(i.toString()),pt.resolve()}removeTarget(e,i){this.ji.Pi(i.targetId).forEach(c=>this.Hi.add(c.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,i.targetId).next(c=>{c.forEach(f=>this.Hi.add(f.toString()))}).next(()=>r.removeTargetData(e,i))}Ki(){this.Wi=new Set}Gi(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return pt.forEach(this.Hi,r=>{const c=Vt.fromPath(r);return this.Ji(e,c).next(f=>{f||i.removeEntry(c,vi.min())})}).next(()=>(this.Wi=null,i.apply(e)))}updateLimboDocument(e,i){return this.Ji(e,i).next(r=>{r?this.Hi.delete(i.toString()):this.Hi.add(i.toString())})}qi(e){return 0}Ji(e,i){return pt.or([()=>pt.resolve(this.ji.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.Qi(e,i)])}}class FM{constructor(){this.activeTargetIds=YL()}Zi(e){this.activeTargetIds=this.activeTargetIds.add(e)}tr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Xi(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class A9{constructor(){this.$r=new FM,this.Br={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,r){}addLocalQueryTarget(e){return this.$r.Zi(e),this.Br[e]||"not-current"}updateQueryState(e,i,r){this.Br[e]=i}removeLocalQueryTarget(e){this.$r.tr(e)}isLocalQueryTarget(e){return this.$r.activeTargetIds.has(e)}clearQueryState(e){delete this.Br[e]}getAllActiveQueryTargets(){return this.$r.activeTargetIds}isActiveQueryTarget(e){return this.$r.activeTargetIds.has(e)}start(){return this.$r=new FM,Promise.resolve()}handleUserChange(e,i,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C9{Lr(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BM{constructor(){this.Ur=()=>this.qr(),this.Kr=()=>this.Gr(),this.Qr=[],this.jr()}Lr(e){this.Qr.push(e)}shutdown(){window.removeEventListener("online",this.Ur),window.removeEventListener("offline",this.Kr)}jr(){window.addEventListener("online",this.Ur),window.addEventListener("offline",this.Kr)}qr(){Ft("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Qr)e(0)}Gr(){Ft("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Qr)e(1)}static vt(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M9={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k9{constructor(e){this.Wr=e.Wr,this.zr=e.zr}Hr(e){this.Jr=e}Yr(e){this.Xr=e}onMessage(e){this.Zr=e}close(){this.zr()}send(e){this.Wr(e)}eo(){this.Jr()}no(e){this.Xr(e)}so(e){this.Zr(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D9 extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http";this.io=i+"://"+e.host,this.ro="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}oo(e,i,r,c,f){const y=this.uo(e,i);Ft("RestConnection","Sending: ",y,r);const l={};return this.ao(l,c,f),this.co(e,y,l,r).then(I=>(Ft("RestConnection","Received: ",I),I),I=>{throw vM("RestConnection",`${e} failed with error: `,I,"url: ",y,"request:",r),I})}ho(e,i,r,c,f){return this.oo(e,i,r,c,f)}ao(e,i,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Md,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((c,f)=>e[f]=c),r&&r.headers.forEach((c,f)=>e[f]=c)}uo(e,i){const r=M9[e];return`${this.io}/v1/${i}:${r}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}co(e,i,r,c){return new Promise((f,y)=>{const l=new UZ;l.listenOnce(NZ.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case tb.NO_ERROR:const C=l.getResponseJson();Ft("Connection","XHR received:",JSON.stringify(C)),f(C);break;case tb.TIMEOUT:Ft("Connection",'RPC "'+e+'" timed out'),y(new jt(et.DEADLINE_EXCEEDED,"Request time out"));break;case tb.HTTP_ERROR:const L=l.getStatus();if(Ft("Connection",'RPC "'+e+'" failed with status:',L,"response text:",l.getResponseText()),L>0){const R=l.getResponseJson().error;if(R&&R.status&&R.message){const $=function(J){const pe=J.toLowerCase().replace(/_/g,"-");return Object.values(et).indexOf(pe)>=0?pe:et.UNKNOWN}(R.status);y(new jt($,R.message))}else y(new jt(et.UNKNOWN,"Server responded with status "+l.getStatus()))}else y(new jt(et.UNAVAILABLE,"Connection failed."));break;default:ai()}}finally{Ft("Connection",'RPC "'+e+'" completed.')}});const I=JSON.stringify(c);l.send(i,"POST",I,r,15)})}lo(e,i,r){const c=[this.io,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=OZ(),y=zZ(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(l.xmlHttpFactory=new BZ({})),this.ao(l.initMessageHeaders,i,r),lv()||a1()||a$()||eD()||l$()||o1()||(l.httpHeadersOverwriteParam="$httpHeaders");const I=c.join("");Ft("Connection","Creating WebChannel: "+I,l);const C=f.createWebChannel(I,l);let L=!1,R=!1;const $=new k9({Wr:pe=>{R?Ft("Connection","Not sending because WebChannel is closed:",pe):(L||(Ft("Connection","Opening WebChannel transport."),C.open(),L=!0),Ft("Connection","WebChannel sending:",pe),C.send(pe))},zr:()=>C.close()}),J=(pe,Re,we)=>{pe.listen(Re,Be=>{try{we(Be)}catch(nt){setTimeout(()=>{throw nt},0)}})};return J(C,Ag.EventType.OPEN,()=>{R||Ft("Connection","WebChannel transport opened.")}),J(C,Ag.EventType.CLOSE,()=>{R||(R=!0,Ft("Connection","WebChannel transport closed"),$.no())}),J(C,Ag.EventType.ERROR,pe=>{R||(R=!0,vM("Connection","WebChannel transport errored:",pe),$.no(new jt(et.UNAVAILABLE,"The operation could not be completed")))}),J(C,Ag.EventType.MESSAGE,pe=>{var Re;if(!R){const we=pe.data[0];cn(!!we);const Be=we,nt=Be.error||((Re=Be[0])===null||Re===void 0?void 0:Re.error);if(nt){Ft("Connection","WebChannel received error:",nt);const yt=nt.status;let lt=function(rt){const Wt=Ln[rt];if(Wt!==void 0)return XL(Wt)}(yt),zt=nt.message;lt===void 0&&(lt=et.INTERNAL,zt="Unknown error status: "+yt+" with message "+nt.message),R=!0,$.no(new jt(lt,zt)),C.close()}else Ft("Connection","WebChannel received:",we),$.so(we)}}),J(y,FZ.STAT_EVENT,pe=>{pe.stat===_M.PROXY?Ft("Connection","Detected buffering proxy"):pe.stat===_M.NOPROXY&&Ft("Connection","Detected no buffering proxy")}),setTimeout(()=>{$.eo()},0),$}}function rb(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $v(t){return new BX(t,!0)}class aO{constructor(e,i,r=1e3,c=1.5,f=6e4){this.Yn=e,this.timerId=i,this.fo=r,this._o=c,this.wo=f,this.mo=0,this.yo=null,this.po=Date.now(),this.reset()}reset(){this.mo=0}Io(){this.mo=this.wo}To(e){this.cancel();const i=Math.floor(this.mo+this.Eo()),r=Math.max(0,Date.now()-this.po),c=Math.max(0,i-r);c>0&&Ft("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.mo} ms, delay with jitter: ${i} ms, last attempt: ${r} ms ago)`),this.yo=this.Yn.enqueueAfterDelay(this.timerId,c,()=>(this.po=Date.now(),e())),this.mo*=this._o,this.mo<this.fo&&(this.mo=this.fo),this.mo>this.wo&&(this.mo=this.wo)}Ao(){this.yo!==null&&(this.yo.skipDelay(),this.yo=null)}cancel(){this.yo!==null&&(this.yo.cancel(),this.yo=null)}Eo(){return(Math.random()-.5)*this.mo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lO{constructor(e,i,r,c,f,y,l,I){this.Yn=e,this.Ro=r,this.Po=c,this.bo=f,this.authCredentialsProvider=y,this.appCheckCredentialsProvider=l,this.listener=I,this.state=0,this.Vo=0,this.vo=null,this.So=null,this.stream=null,this.Do=new aO(e,i)}Co(){return this.state===1||this.state===5||this.xo()}xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.No()}async stop(){this.Co()&&await this.close(0)}ko(){this.state=0,this.Do.reset()}Mo(){this.xo()&&this.vo===null&&(this.vo=this.Yn.enqueueAfterDelay(this.Ro,6e4,()=>this.Oo()))}Fo(e){this.$o(),this.stream.send(e)}async Oo(){if(this.xo())return this.close(0)}$o(){this.vo&&(this.vo.cancel(),this.vo=null)}Bo(){this.So&&(this.So.cancel(),this.So=null)}async close(e,i){this.$o(),this.Bo(),this.Do.cancel(),this.Vo++,e!==4?this.Do.reset():i&&i.code===et.RESOURCE_EXHAUSTED?(kl(i.toString()),kl("Using maximum backoff delay to prevent overloading the backend."),this.Do.Io()):i&&i.code===et.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Lo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Yr(i)}Lo(){}auth(){this.state=1;const e=this.Uo(this.Vo),i=this.Vo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,c])=>{this.Vo===i&&this.qo(r,c)},r=>{e(()=>{const c=new jt(et.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Ko(c)})})}qo(e,i){const r=this.Uo(this.Vo);this.stream=this.Go(e,i),this.stream.Hr(()=>{r(()=>(this.state=2,this.So=this.Yn.enqueueAfterDelay(this.Po,1e4,()=>(this.xo()&&(this.state=3),Promise.resolve())),this.listener.Hr()))}),this.stream.Yr(c=>{r(()=>this.Ko(c))}),this.stream.onMessage(c=>{r(()=>this.onMessage(c))})}No(){this.state=5,this.Do.To(async()=>{this.state=0,this.start()})}Ko(e){return Ft("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Uo(e){return i=>{this.Yn.enqueueAndForget(()=>this.Vo===e?i():(Ft("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class P9 extends lO{constructor(e,i,r,c,f,y){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,r,c,y),this.M=f}Go(e,i){return this.bo.lo("Listen",e,i)}onMessage(e){this.Do.reset();const i=$X(this.M,e),r=function(c){if(!("targetChange"in c))return vi.min();const f=c.targetChange;return f.targetIds&&f.targetIds.length?vi.min():f.readTime?Sa(f.readTime):vi.min()}(e);return this.listener.Qo(i,r)}jo(e){const i={};i.database=xw(this.M),i.addTarget=function(c,f){let y;const l=f.target;return y=pw(l)?{documents:qX(c,l)}:{query:WX(c,l)},y.targetId=f.targetId,f.resumeToken.approximateByteSize()>0?y.resumeToken=eO(c,f.resumeToken):f.snapshotVersion.compareTo(vi.min())>0&&(y.readTime=zy(c,f.snapshotVersion.toTimestamp())),y}(this.M,e);const r=KX(this.M,e);r&&(i.labels=r),this.Fo(i)}Wo(e){const i={};i.database=xw(this.M),i.removeTarget=e,this.Fo(i)}}class R9 extends lO{constructor(e,i,r,c,f,y){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,r,c,y),this.M=f,this.zo=!1}get Ho(){return this.zo}start(){this.zo=!1,this.lastStreamToken=void 0,super.start()}Lo(){this.zo&&this.Jo([])}Go(e,i){return this.bo.lo("Write",e,i)}onMessage(e){if(cn(!!e.streamToken),this.lastStreamToken=e.streamToken,this.zo){this.Do.reset();const i=GX(e.writeResults,e.commitTime),r=Sa(e.commitTime);return this.listener.Yo(r,i)}return cn(!e.writeResults||e.writeResults.length===0),this.zo=!0,this.listener.Xo()}Zo(){const e={};e.database=xw(this.M),this.Fo(e)}Jo(e){const i={streamToken:this.lastStreamToken,writes:e.map(r=>jX(this.M,r))};this.Fo(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L9 extends class{}{constructor(e,i,r,c){super(),this.authCredentials=e,this.appCheckCredentials=i,this.bo=r,this.M=c,this.tu=!1}eu(){if(this.tu)throw new jt(et.FAILED_PRECONDITION,"The client has already been terminated.")}oo(e,i,r){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,f])=>this.bo.oo(e,i,r,c,f)).catch(c=>{throw c.name==="FirebaseError"?(c.code===et.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new jt(et.UNKNOWN,c.toString())})}ho(e,i,r){return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([c,f])=>this.bo.ho(e,i,r,c,f)).catch(c=>{throw c.name==="FirebaseError"?(c.code===et.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new jt(et.UNKNOWN,c.toString())})}terminate(){this.tu=!0}}class O9{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.nu=0,this.su=null,this.iu=!0}ru(){this.nu===0&&(this.ou("Unknown"),this.su=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.su=null,this.uu("Backend didn't respond within 10 seconds."),this.ou("Offline"),Promise.resolve())))}au(e){this.state==="Online"?this.ou("Unknown"):(this.nu++,this.nu>=1&&(this.cu(),this.uu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ou("Offline")))}set(e){this.cu(),this.nu=0,e==="Online"&&(this.iu=!1),this.ou(e)}ou(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}uu(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.iu?(kl(i),this.iu=!1):Ft("OnlineStateTracker",i)}cu(){this.su!==null&&(this.su.cancel(),this.su=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z9{constructor(e,i,r,c,f){this.localStore=e,this.datastore=i,this.asyncQueue=r,this.remoteSyncer={},this.hu=[],this.lu=new Map,this.fu=new Set,this.du=[],this._u=f,this._u.Lr(y=>{r.enqueueAndForget(async()=>{yu(this)&&(Ft("RemoteStore","Restarting streams for network reachability change."),await async function(l){const I=ui(l);I.fu.add(4),await Bm(I),I.wu.set("Unknown"),I.fu.delete(4),await jv(I)}(this))})}),this.wu=new O9(r,c)}}async function jv(t){if(yu(t))for(const e of t.du)await e(!0)}async function Bm(t){for(const e of t.du)await e(!1)}function cO(t,e){const i=ui(t);i.lu.has(e.targetId)||(i.lu.set(e.targetId,e),RE(i)?PE(i):Rd(i).xo()&&DE(i,e))}function uO(t,e){const i=ui(t),r=Rd(i);i.lu.delete(e),r.xo()&&hO(i,e),i.lu.size===0&&(r.xo()?r.Mo():yu(i)&&i.wu.set("Unknown"))}function DE(t,e){t.mu.Z(e.targetId),Rd(t).jo(e)}function hO(t,e){t.mu.Z(e),Rd(t).Wo(e)}function PE(t){t.mu=new zX({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.lu.get(e)||null}),Rd(t).start(),t.wu.ru()}function RE(t){return yu(t)&&!Rd(t).Co()&&t.lu.size>0}function yu(t){return ui(t).fu.size===0}function dO(t){t.mu=void 0}async function N9(t){t.lu.forEach((e,i)=>{DE(t,e)})}async function F9(t,e){dO(t),RE(t)?(t.wu.au(e),PE(t)):t.wu.set("Unknown")}async function B9(t,e,i){if(t.wu.set("Online"),e instanceof QL&&e.state===2&&e.cause)try{await async function(r,c){const f=c.cause;for(const y of c.targetIds)r.lu.has(y)&&(await r.remoteSyncer.rejectListen(y,f),r.lu.delete(y),r.mu.removeTarget(y))}(t,e)}catch(r){Ft("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Ny(t,r)}else if(e instanceof Gg?t.mu.ut(e):e instanceof JL?t.mu._t(e):t.mu.ht(e),!i.isEqual(vi.min()))try{const r=await oO(t.localStore);i.compareTo(r)>=0&&await function(c,f){const y=c.mu.yt(f);return y.targetChanges.forEach((l,I)=>{if(l.resumeToken.approximateByteSize()>0){const C=c.lu.get(I);C&&c.lu.set(I,C.withResumeToken(l.resumeToken,f))}}),y.targetMismatches.forEach(l=>{const I=c.lu.get(l);if(!I)return;c.lu.set(l,I.withResumeToken(dr.EMPTY_BYTE_STRING,I.snapshotVersion)),hO(c,l);const C=new qc(I.target,l,1,I.sequenceNumber);DE(c,C)}),c.remoteSyncer.applyRemoteEvent(y)}(t,i)}catch(r){Ft("RemoteStore","Failed to raise snapshot:",r),await Ny(t,r)}}async function Ny(t,e,i){if(!Nm(e))throw e;t.fu.add(1),await Bm(t),t.wu.set("Offline"),i||(i=()=>oO(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{Ft("RemoteStore","Retrying IndexedDB access"),await i(),t.fu.delete(1),await jv(t)})}function fO(t,e){return e().catch(i=>Ny(t,i,e))}async function Gv(t){const e=ui(t),i=Pl(e);let r=e.hu.length>0?e.hu[e.hu.length-1].batchId:-1;for(;U9(e);)try{const c=await _9(e.localStore,r);if(c===null){e.hu.length===0&&i.Mo();break}r=c.batchId,V9(e,c)}catch(c){await Ny(e,c)}pO(e)&&mO(e)}function U9(t){return yu(t)&&t.hu.length<10}function V9(t,e){t.hu.push(e);const i=Pl(t);i.xo()&&i.Ho&&i.Jo(e.mutations)}function pO(t){return yu(t)&&!Pl(t).Co()&&t.hu.length>0}function mO(t){Pl(t).start()}async function $9(t){Pl(t).Zo()}async function j9(t){const e=Pl(t);for(const i of t.hu)e.Jo(i.mutations)}async function G9(t,e,i){const r=t.hu.shift(),c=AE.from(r,e,i);await fO(t,()=>t.remoteSyncer.applySuccessfulWrite(c)),await Gv(t)}async function q9(t,e){e&&Pl(t).Ho&&await async function(i,r){if(c=r.code,kX(c)&&c!==et.ABORTED){const f=i.hu.shift();Pl(i).ko(),await fO(i,()=>i.remoteSyncer.rejectFailedWrite(f.batchId,r)),await Gv(i)}var c}(t,e),pO(t)&&mO(t)}async function UM(t,e){const i=ui(t);i.asyncQueue.verifyOperationInProgress(),Ft("RemoteStore","RemoteStore received new credentials");const r=yu(i);i.fu.add(3),await Bm(i),r&&i.wu.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.fu.delete(3),await jv(i)}async function W9(t,e){const i=ui(t);e?(i.fu.delete(2),await jv(i)):e||(i.fu.add(2),await Bm(i),i.wu.set("Unknown"))}function Rd(t){return t.gu||(t.gu=function(e,i,r){const c=ui(e);return c.eu(),new P9(i,c.bo,c.authCredentials,c.appCheckCredentials,c.M,r)}(t.datastore,t.asyncQueue,{Hr:N9.bind(null,t),Yr:F9.bind(null,t),Qo:B9.bind(null,t)}),t.du.push(async e=>{e?(t.gu.ko(),RE(t)?PE(t):t.wu.set("Unknown")):(await t.gu.stop(),dO(t))})),t.gu}function Pl(t){return t.yu||(t.yu=function(e,i,r){const c=ui(e);return c.eu(),new R9(i,c.bo,c.authCredentials,c.appCheckCredentials,c.M,r)}(t.datastore,t.asyncQueue,{Hr:$9.bind(null,t),Yr:q9.bind(null,t),Xo:j9.bind(null,t),Yo:G9.bind(null,t)}),t.du.push(async e=>{e?(t.yu.ko(),await Gv(t)):(await t.yu.stop(),t.hu.length>0&&(Ft("RemoteStore",`Stopping write stream with ${t.hu.length} pending writes`),t.hu=[]))})),t.yu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE{constructor(e,i,r,c,f){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=r,this.op=c,this.removalCallback=f,this.deferred=new Ia,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(y=>{})}static createAndSchedule(e,i,r,c,f){const y=Date.now()+r,l=new LE(e,i,y,c,f);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new jt(et.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function OE(t,e){if(kl("AsyncQueue",`${e}: ${t}`),Nm(t))return new jt(et.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vh{constructor(e){this.comparator=e?(i,r)=>e(i,r)||Vt.comparator(i.key,r.key):(i,r)=>Vt.comparator(i.key,r.key),this.keyedMap=gw(),this.sortedSet=new tr(this.comparator)}static emptySet(e){return new Vh(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((i,r)=>(e(i),!1))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof Vh)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;i.hasNext();){const c=i.getNext().key,f=r.getNext().key;if(!c.isEqual(f))return!1}return!0}toString(){const e=[];return this.forEach(i=>{e.push(i.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const r=new Vh;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=i,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VM{constructor(){this.pu=new tr(Vt.comparator)}track(e){const i=e.doc.key,r=this.pu.get(i);r?e.type!==0&&r.type===3?this.pu=this.pu.insert(i,e):e.type===3&&r.type!==1?this.pu=this.pu.insert(i,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.pu=this.pu.insert(i,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.pu=this.pu.insert(i,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.pu=this.pu.remove(i):e.type===1&&r.type===2?this.pu=this.pu.insert(i,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.pu=this.pu.insert(i,{type:2,doc:e.doc}):ai():this.pu=this.pu.insert(i,e)}Iu(){const e=[];return this.pu.inorderTraversal((i,r)=>{e.push(r)}),e}}class ld{constructor(e,i,r,c,f,y,l,I){this.query=e,this.docs=i,this.oldDocs=r,this.docChanges=c,this.mutatedKeys=f,this.fromCache=y,this.syncStateChanged=l,this.excludesMetadataChanges=I}static fromInitialDocuments(e,i,r,c){const f=[];return i.forEach(y=>{f.push({type:0,doc:y})}),new ld(e,i,Vh.emptySet(i),f,r,c,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Nv(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,r=e.docChanges;if(i.length!==r.length)return!1;for(let c=0;c<i.length;c++)if(i[c].type!==r[c].type||!i[c].doc.isEqual(r[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H9{constructor(){this.Tu=void 0,this.listeners=[]}}class K9{constructor(){this.queries=new Pd(e=>VL(e),Nv),this.onlineState="Unknown",this.Eu=new Set}}async function _O(t,e){const i=ui(t),r=e.query;let c=!1,f=i.queries.get(r);if(f||(c=!0,f=new H9),c)try{f.Tu=await i.onListen(r)}catch(y){const l=OE(y,`Initialization of query '${mw(e.query)}' failed`);return void e.onError(l)}i.queries.set(r,f),f.listeners.push(e),e.Au(i.onlineState),f.Tu&&e.Ru(f.Tu)&&zE(i)}async function gO(t,e){const i=ui(t),r=e.query;let c=!1;const f=i.queries.get(r);if(f){const y=f.listeners.indexOf(e);y>=0&&(f.listeners.splice(y,1),c=f.listeners.length===0)}if(c)return i.queries.delete(r),i.onUnlisten(r)}function Z9(t,e){const i=ui(t);let r=!1;for(const c of e){const f=c.query,y=i.queries.get(f);if(y){for(const l of y.listeners)l.Ru(c)&&(r=!0);y.Tu=c}}r&&zE(i)}function X9(t,e,i){const r=ui(t),c=r.queries.get(e);if(c)for(const f of c.listeners)f.onError(i);r.queries.delete(e)}function zE(t){t.Eu.forEach(e=>{e.next()})}class yO{constructor(e,i,r){this.query=e,this.Pu=i,this.bu=!1,this.Vu=null,this.onlineState="Unknown",this.options=r||{}}Ru(e){if(!this.options.includeMetadataChanges){const r=[];for(const c of e.docChanges)c.type!==3&&r.push(c);e=new ld(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let i=!1;return this.bu?this.vu(e)&&(this.Pu.next(e),i=!0):this.Su(e,this.onlineState)&&(this.Du(e),i=!0),this.Vu=e,i}onError(e){this.Pu.error(e)}Au(e){this.onlineState=e;let i=!1;return this.Vu&&!this.bu&&this.Su(this.Vu,e)&&(this.Du(this.Vu),i=!0),i}Su(e,i){if(!e.fromCache)return!0;const r=i!=="Offline";return(!this.options.Cu||!r)&&(!e.docs.isEmpty()||i==="Offline")}vu(e){if(e.docChanges.length>0)return!0;const i=this.Vu&&this.Vu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Du(e){e=ld.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Pu.next(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vO{constructor(e){this.key=e}}class xO{constructor(e){this.key=e}}class Y9{constructor(e,i){this.query=e,this.$u=i,this.Bu=null,this.current=!1,this.Lu=mn(),this.mutatedKeys=mn(),this.Uu=$L(e),this.qu=new Vh(this.Uu)}get Ku(){return this.$u}Gu(e,i){const r=i?i.Qu:new VM,c=i?i.qu:this.qu;let f=i?i.mutatedKeys:this.mutatedKeys,y=c,l=!1;const I=$g(this.query)&&c.size===this.query.limit?c.last():null,C=Ry(this.query)&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((L,R)=>{const $=c.get(L),J=IE(this.query,R)?R:null,pe=!!$&&this.mutatedKeys.has($.key),Re=!!J&&(J.hasLocalMutations||this.mutatedKeys.has(J.key)&&J.hasCommittedMutations);let we=!1;$&&J?$.data.isEqual(J.data)?pe!==Re&&(r.track({type:3,doc:J}),we=!0):this.ju($,J)||(r.track({type:2,doc:J}),we=!0,(I&&this.Uu(J,I)>0||C&&this.Uu(J,C)<0)&&(l=!0)):!$&&J?(r.track({type:0,doc:J}),we=!0):$&&!J&&(r.track({type:1,doc:$}),we=!0,(I||C)&&(l=!0)),we&&(J?(y=y.add(J),f=Re?f.add(L):f.delete(L)):(y=y.delete(L),f=f.delete(L)))}),$g(this.query)||Ry(this.query))for(;y.size>this.query.limit;){const L=$g(this.query)?y.last():y.first();y=y.delete(L.key),f=f.delete(L.key),r.track({type:1,doc:L})}return{qu:y,Qu:r,ni:l,mutatedKeys:f}}ju(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,r){const c=this.qu;this.qu=e.qu,this.mutatedKeys=e.mutatedKeys;const f=e.Qu.Iu();f.sort((C,L)=>function(R,$){const J=pe=>{switch(pe){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ai()}};return J(R)-J($)}(C.type,L.type)||this.Uu(C.doc,L.doc)),this.Wu(r);const y=i?this.zu():[],l=this.Lu.size===0&&this.current?1:0,I=l!==this.Bu;return this.Bu=l,f.length!==0||I?{snapshot:new ld(this.query,e.qu,c,f,e.mutatedKeys,l===0,I,!1),Hu:y}:{Hu:y}}Au(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({qu:this.qu,Qu:new VM,mutatedKeys:this.mutatedKeys,ni:!1},!1)):{Hu:[]}}Ju(e){return!this.$u.has(e)&&!!this.qu.has(e)&&!this.qu.get(e).hasLocalMutations}Wu(e){e&&(e.addedDocuments.forEach(i=>this.$u=this.$u.add(i)),e.modifiedDocuments.forEach(i=>{}),e.removedDocuments.forEach(i=>this.$u=this.$u.delete(i)),this.current=e.current)}zu(){if(!this.current)return[];const e=this.Lu;this.Lu=mn(),this.qu.forEach(r=>{this.Ju(r.key)&&(this.Lu=this.Lu.add(r.key))});const i=[];return e.forEach(r=>{this.Lu.has(r)||i.push(new xO(r))}),this.Lu.forEach(r=>{e.has(r)||i.push(new vO(r))}),i}Yu(e){this.$u=e.li,this.Lu=mn();const i=this.Gu(e.documents);return this.applyChanges(i,!0)}Xu(){return ld.fromInitialDocuments(this.query,this.qu,this.mutatedKeys,this.Bu===0)}}class J9{constructor(e,i,r){this.query=e,this.targetId=i,this.view=r}}class Q9{constructor(e){this.key=e,this.Zu=!1}}class eY{constructor(e,i,r,c,f,y){this.localStore=e,this.remoteStore=i,this.eventManager=r,this.sharedClientState=c,this.currentUser=f,this.maxConcurrentLimboResolutions=y,this.ta={},this.ea=new Pd(l=>VL(l),Nv),this.na=new Map,this.sa=new Set,this.ia=new tr(Vt.comparator),this.ra=new Map,this.oa=new ME,this.ua={},this.aa=new Map,this.ca=ad.yn(),this.onlineState="Unknown",this.ha=void 0}get isPrimaryClient(){return this.ha===!0}}async function tY(t,e){const i=hY(t);let r,c;const f=i.ea.get(e);if(f)r=f.targetId,i.sharedClientState.addLocalQueryTarget(r),c=f.view.Xu();else{const y=await g9(i.localStore,cu(e));i.isPrimaryClient&&cO(i.remoteStore,y);const l=i.sharedClientState.addLocalQueryTarget(y.targetId);r=y.targetId,c=await iY(i,e,r,l==="current")}return c}async function iY(t,e,i,r){t.la=(L,R,$)=>async function(J,pe,Re,we){let Be=pe.view.Gu(Re);Be.ni&&(Be=await NM(J.localStore,pe.query,!1).then(({documents:lt})=>pe.view.Gu(lt,Be)));const nt=we&&we.targetChanges.get(pe.targetId),yt=pe.view.applyChanges(Be,J.isPrimaryClient,nt);return jM(J,pe.targetId,yt.Hu),yt.snapshot}(t,L,R,$);const c=await NM(t.localStore,e,!0),f=new Y9(e,c.li),y=f.Gu(c.documents),l=zm.createSynthesizedTargetChangeForCurrentChange(i,r&&t.onlineState!=="Offline"),I=f.applyChanges(y,t.isPrimaryClient,l);jM(t,i,I.Hu);const C=new J9(e,i,f);return t.ea.set(e,C),t.na.has(i)?t.na.get(i).push(e):t.na.set(i,[e]),I.snapshot}async function nY(t,e){const i=ui(t),r=i.ea.get(e),c=i.na.get(r.targetId);if(c.length>1)return i.na.set(r.targetId,c.filter(f=>!Nv(f,e))),void i.ea.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await bw(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),uO(i.remoteStore,r.targetId),ww(i,r.targetId)}).catch(Fm)):(ww(i,r.targetId),await bw(i.localStore,r.targetId,!0))}async function rY(t,e,i){const r=dY(t);try{const c=await function(f,y){const l=ui(f),I=Ar.now(),C=y.reduce((R,$)=>R.add($.key),mn());let L;return l.persistence.runTransaction("Locally write mutations","readwrite",R=>l.ci.Ks(R,C).next($=>{L=$;const J=[];for(const pe of y){const Re=SX(pe,L.get(pe.key));Re!=null&&J.push(new Om(pe.key,Re,BL(Re.value.mapValue),Uh.exists(!0)))}return l.Bs.addMutationBatch(R,I,J,y)})).then(R=>(R.applyToLocalDocumentSet(L),{batchId:R.batchId,changes:L}))}(r.localStore,e);r.sharedClientState.addPendingMutation(c.batchId),function(f,y,l){let I=f.ua[f.currentUser.toKey()];I||(I=new tr(Hi)),I=I.insert(y,l),f.ua[f.currentUser.toKey()]=I}(r,c.batchId,i),await Um(r,c.changes),await Gv(r.remoteStore)}catch(c){const f=OE(c,"Failed to persist write");i.reject(f)}}async function bO(t,e){const i=ui(t);try{const r=await p9(i.localStore,e);e.targetChanges.forEach((c,f)=>{const y=i.ra.get(f);y&&(cn(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?y.Zu=!0:c.modifiedDocuments.size>0?cn(y.Zu):c.removedDocuments.size>0&&(cn(y.Zu),y.Zu=!1))}),await Um(i,r,e)}catch(r){await Fm(r)}}function $M(t,e,i){const r=ui(t);if(r.isPrimaryClient&&i===0||!r.isPrimaryClient&&i===1){const c=[];r.ea.forEach((f,y)=>{const l=y.view.Au(e);l.snapshot&&c.push(l.snapshot)}),function(f,y){const l=ui(f);l.onlineState=y;let I=!1;l.queries.forEach((C,L)=>{for(const R of L.listeners)R.Au(y)&&(I=!0)}),I&&zE(l)}(r.eventManager,e),c.length&&r.ta.Qo(c),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function sY(t,e,i){const r=ui(t);r.sharedClientState.updateQueryState(e,"rejected",i);const c=r.ra.get(e),f=c&&c.key;if(f){let y=new tr(Vt.comparator);y=y.insert(f,Er.newNoDocument(f,vi.min()));const l=mn().add(f),I=new Vv(vi.min(),new Map,new hr(Hi),y,l);await bO(r,I),r.ia=r.ia.remove(f),r.ra.delete(e),NE(r)}else await bw(r.localStore,e,!1).then(()=>ww(r,e,i)).catch(Fm)}async function oY(t,e){const i=ui(t),r=e.batch.batchId;try{const c=await f9(i.localStore,e);EO(i,r,null),wO(i,r),i.sharedClientState.updateMutationState(r,"acknowledged"),await Um(i,c)}catch(c){await Fm(c)}}async function aY(t,e,i){const r=ui(t);try{const c=await function(f,y){const l=ui(f);return l.persistence.runTransaction("Reject batch","readwrite-primary",I=>{let C;return l.Bs.lookupMutationBatch(I,y).next(L=>(cn(L!==null),C=L.keys(),l.Bs.removeMutationBatch(I,L))).next(()=>l.Bs.performConsistencyCheck(I)).next(()=>l.ci.Ks(I,C))})}(r.localStore,e);EO(r,e,i),wO(r,e),r.sharedClientState.updateMutationState(e,"rejected",i),await Um(r,c)}catch(c){await Fm(c)}}function wO(t,e){(t.aa.get(e)||[]).forEach(i=>{i.resolve()}),t.aa.delete(e)}function EO(t,e,i){const r=ui(t);let c=r.ua[r.currentUser.toKey()];if(c){const f=c.get(e);f&&(i?f.reject(i):f.resolve(),c=c.remove(e)),r.ua[r.currentUser.toKey()]=c}}function ww(t,e,i=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.na.get(e))t.ea.delete(r),i&&t.ta.fa(r,i);t.na.delete(e),t.isPrimaryClient&&t.oa.Pi(e).forEach(r=>{t.oa.containsKey(r)||TO(t,r)})}function TO(t,e){t.sa.delete(e.path.canonicalString());const i=t.ia.get(e);i!==null&&(uO(t.remoteStore,i),t.ia=t.ia.remove(e),t.ra.delete(i),NE(t))}function jM(t,e,i){for(const r of i)r instanceof vO?(t.oa.addReference(r.key,e),lY(t,r)):r instanceof xO?(Ft("SyncEngine","Document no longer in limbo: "+r.key),t.oa.removeReference(r.key,e),t.oa.containsKey(r.key)||TO(t,r.key)):ai()}function lY(t,e){const i=e.key,r=i.path.canonicalString();t.ia.get(i)||t.sa.has(r)||(Ft("SyncEngine","New document in limbo: "+i),t.sa.add(r),NE(t))}function NE(t){for(;t.sa.size>0&&t.ia.size<t.maxConcurrentLimboResolutions;){const e=t.sa.values().next().value;t.sa.delete(e);const i=new Vt(yn.fromString(e)),r=t.ca.next();t.ra.set(r,new Q9(i)),t.ia=t.ia.insert(i,r),cO(t.remoteStore,new qc(cu(TE(i.path)),r,2,xE.A))}}async function Um(t,e,i){const r=ui(t),c=[],f=[],y=[];r.ea.isEmpty()||(r.ea.forEach((l,I)=>{y.push(r.la(I,e,i).then(C=>{if(C){r.isPrimaryClient&&r.sharedClientState.updateQueryState(I.targetId,C.fromCache?"not-current":"current"),c.push(C);const L=CE.Ys(I.targetId,C);f.push(L)}}))}),await Promise.all(y),r.ta.Qo(c),await async function(l,I){const C=ui(l);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",L=>pt.forEach(I,R=>pt.forEach(R.Hs,$=>C.persistence.referenceDelegate.addReference(L,R.targetId,$)).next(()=>pt.forEach(R.Js,$=>C.persistence.referenceDelegate.removeReference(L,R.targetId,$)))))}catch(L){if(!Nm(L))throw L;Ft("LocalStore","Failed to update sequence numbers: "+L)}for(const L of I){const R=L.targetId;if(!L.fromCache){const $=C.ii.get(R),J=$.snapshotVersion,pe=$.withLastLimboFreeSnapshotVersion(J);C.ii=C.ii.insert(R,pe)}}}(r.localStore,f))}async function cY(t,e){const i=ui(t);if(!i.currentUser.isEqual(e)){Ft("SyncEngine","User change. New user:",e.toKey());const r=await sO(i.localStore,e);i.currentUser=e,function(c,f){c.aa.forEach(y=>{y.forEach(l=>{l.reject(new jt(et.CANCELLED,f))})}),c.aa.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Um(i,r.hi)}}function uY(t,e){const i=ui(t),r=i.ra.get(e);if(r&&r.Zu)return mn().add(r.key);{let c=mn();const f=i.na.get(e);if(!f)return c;for(const y of f){const l=i.ea.get(y);c=c.unionWith(l.view.Ku)}return c}}function hY(t){const e=ui(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=bO.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=uY.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=sY.bind(null,e),e.ta.Qo=Z9.bind(null,e.eventManager),e.ta.fa=X9.bind(null,e.eventManager),e}function dY(t){const e=ui(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=oY.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=aY.bind(null,e),e}class fY{constructor(){this.synchronizeTabs=!1}async initialize(e){this.M=$v(e.databaseInfo.databaseId),this.sharedClientState=this._a(e),this.persistence=this.wa(e),await this.persistence.start(),this.gcScheduler=this.ma(e),this.localStore=this.ga(e)}ma(e){return null}ga(e){return d9(this.persistence,new u9,e.initialUser,this.M)}wa(e){return new I9(kE.zi,this.M)}_a(e){return new A9}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class pY{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>$M(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=cY.bind(null,this.syncEngine),await W9(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new K9}createDatastore(e){const i=$v(e.databaseInfo.databaseId),r=(c=e.databaseInfo,new D9(c));var c;return function(f,y,l,I){return new L9(f,y,l,I)}(e.authCredentials,e.appCheckCredentials,r,i)}createRemoteStore(e){return i=this.localStore,r=this.datastore,c=e.asyncQueue,f=l=>$M(this.syncEngine,l,0),y=BM.vt()?new BM:new C9,new z9(i,r,c,f,y);var i,r,c,f,y}createSyncEngine(e,i){return function(r,c,f,y,l,I,C){const L=new eY(r,c,f,y,l,I);return C&&(L.ha=!0),L}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}terminate(){return async function(e){const i=ui(e);Ft("RemoteStore","RemoteStore shutting down."),i.fu.add(5),await Bm(i),i._u.shutdown(),i.wu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.pa(this.observer.next,e)}error(e){this.observer.error?this.pa(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Ia(){this.muted=!0}pa(e,i){this.muted||setTimeout(()=>{this.muted||e(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mY{constructor(e,i,r,c){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=r,this.databaseInfo=c,this.user=rs.UNAUTHENTICATED,this.clientId=OL.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async f=>{Ft("FirestoreClient","Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(r,f=>(Ft("FirestoreClient","Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new jt(et.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ia;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const r=OE(i,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function _Y(t,e){t.asyncQueue.verifyOperationInProgress(),Ft("FirestoreClient","Initializing OfflineComponentProvider");const i=await t.getConfiguration();await e.initialize(i);let r=i.initialUser;t.setCredentialChangeListener(async c=>{r.isEqual(c)||(await sO(e.localStore,c),r=c)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t.offlineComponents=e}async function gY(t,e){t.asyncQueue.verifyOperationInProgress();const i=await yY(t);Ft("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(i,r),t.setCredentialChangeListener(c=>UM(e.remoteStore,c)),t.setAppCheckTokenChangeListener((c,f)=>UM(e.remoteStore,f)),t.onlineComponents=e}async function yY(t){return t.offlineComponents||(Ft("FirestoreClient","Using default OfflineComponentProvider"),await _Y(t,new fY)),t.offlineComponents}async function SO(t){return t.onlineComponents||(Ft("FirestoreClient","Using default OnlineComponentProvider"),await gY(t,new pY)),t.onlineComponents}function vY(t){return SO(t).then(e=>e.syncEngine)}async function AO(t){const e=await SO(t),i=e.eventManager;return i.onListen=tY.bind(null,e.syncEngine),i.onUnlisten=nY.bind(null,e.syncEngine),i}function xY(t,e,i={}){const r=new Ia;return t.asyncQueue.enqueueAndForget(async()=>function(c,f,y,l,I){const C=new IO({next:R=>{f.enqueueAndForget(()=>gO(c,L));const $=R.docs.has(y);!$&&R.fromCache?I.reject(new jt(et.UNAVAILABLE,"Failed to get document because the client is offline.")):$&&R.fromCache&&l&&l.source==="server"?I.reject(new jt(et.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):I.resolve(R)},error:R=>I.reject(R)}),L=new yO(TE(y.path),C,{includeMetadataChanges:!0,Cu:!0});return _O(c,L)}(await AO(t),t.asyncQueue,e,i,r)),r.promise}function bY(t,e,i={}){const r=new Ia;return t.asyncQueue.enqueueAndForget(async()=>function(c,f,y,l,I){const C=new IO({next:R=>{f.enqueueAndForget(()=>gO(c,L)),R.fromCache&&l.source==="server"?I.reject(new jt(et.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):I.resolve(R)},error:R=>I.reject(R)}),L=new yO(y,C,{includeMetadataChanges:!0,Cu:!0});return _O(c,L)}(await AO(t),t.asyncQueue,e,i,r)),r.promise}const GM=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CO(t,e,i){if(!i)throw new jt(et.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function wY(t,e,i,r){if(e===!0&&r===!0)throw new jt(et.INVALID_ARGUMENT,`${t} and ${i} cannot be used together.`)}function qM(t){if(!Vt.isDocumentKey(t))throw new jt(et.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function WM(t){if(Vt.isDocumentKey(t))throw new jt(et.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function FE(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ai()}function cd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new jt(et.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=FE(t);throw new jt(et.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HM{constructor(e){var i;if(e.host===void 0){if(e.ssl!==void 0)throw new jt(et.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(i=e.ssl)===null||i===void 0||i;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new jt(et.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,wY("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BE{constructor(e,i,r){this._authCredentials=i,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new HM({}),this._settingsFrozen=!1,e instanceof rd?this._databaseId=e:(this._app=e,this._databaseId=function(c){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new jt(et.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rd(c.options.projectId)}(e))}get app(){if(!this._app)throw new jt(et.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new jt(et.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new HM(e),e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new $Z;switch(i.type){case"gapi":const r=i.client;return cn(!(typeof r!="object"||r===null||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new qZ(r,i.sessionIndex||"0",i.iamToken||null);case"provider":return i.client;default:throw new jt(et.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const i=GM.get(e);i&&(Ft("ComponentProvider","Removing Datastore"),GM.delete(e),i.terminate())}(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xs{constructor(e,i,r){this.converter=i,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Il(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new xs(this.firestore,e,this._key)}}class qv{constructor(e,i,r){this.converter=i,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new qv(this.firestore,e,this._query)}}class Il extends qv{constructor(e,i,r){super(e,i,TE(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new xs(this.firestore,null,new Vt(e))}withConverter(e){return new Il(this.firestore,e,this._path)}}function s7(t,e,...i){if(t=Ts(t),CO("collection","path",e),t instanceof BE){const r=yn.fromString(e,...i);return WM(r),new Il(t,null,r)}{if(!(t instanceof xs||t instanceof Il))throw new jt(et.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(yn.fromString(e,...i));return WM(r),new Il(t.firestore,null,r)}}function o7(t,e,...i){if(t=Ts(t),arguments.length===1&&(e=OL.R()),CO("doc","path",e),t instanceof BE){const r=yn.fromString(e,...i);return qM(r),new xs(t,null,new Vt(r))}{if(!(t instanceof xs||t instanceof Il))throw new jt(et.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(yn.fromString(e,...i));return qM(r),new xs(t.firestore,t instanceof Il?t.converter:null,new Vt(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EY{constructor(){this.ka=Promise.resolve(),this.Ma=[],this.Oa=!1,this.Fa=[],this.$a=null,this.Ba=!1,this.La=!1,this.Ua=[],this.Do=new aO(this,"async_queue_retry"),this.qa=()=>{const i=rb();i&&Ft("AsyncQueue","Visibility state changed to "+i.visibilityState),this.Do.Ao()};const e=rb();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.qa)}get isShuttingDown(){return this.Oa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ka(),this.Ga(e)}enterRestrictedMode(e){if(!this.Oa){this.Oa=!0,this.La=e||!1;const i=rb();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.qa)}}enqueue(e){if(this.Ka(),this.Oa)return new Promise(()=>{});const i=new Ia;return this.Ga(()=>this.Oa&&this.La?Promise.resolve():(e().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ma.push(e),this.Qa()))}async Qa(){if(this.Ma.length!==0){try{await this.Ma[0](),this.Ma.shift(),this.Do.reset()}catch(e){if(!Nm(e))throw e;Ft("AsyncQueue","Operation failed with retryable error: "+e)}this.Ma.length>0&&this.Do.To(()=>this.Qa())}}Ga(e){const i=this.ka.then(()=>(this.Ba=!0,e().catch(r=>{this.$a=r,this.Ba=!1;const c=function(f){let y=f.message||"";return f.stack&&(y=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),y}(r);throw kl("INTERNAL UNHANDLED ERROR: ",c),r}).then(r=>(this.Ba=!1,r))));return this.ka=i,i}enqueueAfterDelay(e,i,r){this.Ka(),this.Ua.indexOf(e)>-1&&(i=0);const c=LE.createAndSchedule(this,e,i,r,f=>this.ja(f));return this.Fa.push(c),c}Ka(){this.$a&&ai()}verifyOperationInProgress(){}async Wa(){let e;do e=this.ka,await e;while(e!==this.ka)}za(e){for(const i of this.Fa)if(i.timerId===e)return!0;return!1}Ha(e){return this.Wa().then(()=>{this.Fa.sort((i,r)=>i.targetTimeMs-r.targetTimeMs);for(const i of this.Fa)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Wa()})}Ja(e){this.Ua.push(e)}ja(e){const i=this.Fa.indexOf(e);this.Fa.splice(i,1)}}class Wv extends BE{constructor(e,i,r){super(e,i,r),this.type="firestore",this._queue=new EY,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||MO(this),this._firestoreClient.terminate()}}function a7(t=c1()){return xd(t,"firestore").getImmediate()}function UE(t){return t._firestoreClient||MO(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function MO(t){var e;const i=t._freezeSettings(),r=function(c,f,y,l){return new YZ(c,f,y,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,l.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new mY(t._authCredentials,t._appCheckCredentials,t._queue,r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new jt(et.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ss(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ud(dr.fromBase64String(e))}catch(i){throw new jt(et.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new ud(dr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kO{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $E{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new jt(et.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new jt(et.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Hi(this._lat,e._lat)||Hi(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TY=/^__.*__$/;class IY{constructor(e,i,r){this.data=e,this.fieldMask=i,this.fieldTransforms=r}toMutation(e,i){return this.fieldMask!==null?new Om(e,this.data,this.fieldMask,i,this.fieldTransforms):new Uv(e,this.data,i,this.fieldTransforms)}}function DO(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ai()}}class jE{constructor(e,i,r,c,f,y){this.settings=e,this.databaseId=i,this.M=r,this.ignoreUndefinedProperties=c,f===void 0&&this.Ya(),this.fieldTransforms=f||[],this.fieldMask=y||[]}get path(){return this.settings.path}get Xa(){return this.settings.Xa}Za(e){return new jE(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}tc(e){var i;const r=(i=this.path)===null||i===void 0?void 0:i.child(e),c=this.Za({path:r,ec:!1});return c.nc(e),c}sc(e){var i;const r=(i=this.path)===null||i===void 0?void 0:i.child(e),c=this.Za({path:r,ec:!1});return c.Ya(),c}ic(e){return this.Za({path:void 0,ec:!0})}rc(e){return Fy(e,this.settings.methodName,this.settings.oc||!1,this.path,this.settings.uc)}contains(e){return this.fieldMask.find(i=>e.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>e.isPrefixOf(i.field))!==void 0}Ya(){if(this.path)for(let e=0;e<this.path.length;e++)this.nc(this.path.get(e))}nc(e){if(e.length===0)throw this.rc("Document fields must not be empty");if(DO(this.Xa)&&TY.test(e))throw this.rc('Document fields cannot begin and end with "__"')}}class SY{constructor(e,i,r){this.databaseId=e,this.ignoreUndefinedProperties=i,this.M=r||$v(e)}ac(e,i,r,c=!1){return new jE({Xa:e,methodName:i,uc:r,path:ss.emptyPath(),ec:!1,oc:c},this.databaseId,this.M,this.ignoreUndefinedProperties)}}function AY(t){const e=t._freezeSettings(),i=$v(t._databaseId);return new SY(t._databaseId,!!e.ignoreUndefinedProperties,i)}function CY(t,e,i,r,c,f={}){const y=t.ac(f.merge||f.mergeFields?2:0,e,i,c);OO("Data must be an object, but it was:",y,r);const l=RO(r,y);let I,C;if(f.merge)I=new hw(y.fieldMask),C=y.fieldTransforms;else if(f.mergeFields){const L=[];for(const R of f.mergeFields){const $=MY(e,R,i);if(!y.contains($))throw new jt(et.INVALID_ARGUMENT,`Field '${$}' is specified in your field mask but missing from your input data.`);DY(L,$)||L.push($)}I=new hw(L),C=y.fieldTransforms.filter(R=>I.covers(R.field))}else I=null,C=y.fieldTransforms;return new IY(new no(l),I,C)}function PO(t,e){if(LO(t=Ts(t)))return OO("Unsupported field value:",e,t),RO(t,e);if(t instanceof kO)return function(i,r){if(!DO(r.Xa))throw r.rc(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.rc(`${i._methodName}() is not currently supported inside arrays`);const c=i._toFieldTransform(r);c&&r.fieldTransforms.push(c)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.ec&&e.Xa!==4)throw e.rc("Nested arrays are not supported");return function(i,r){const c=[];let f=0;for(const y of i){let l=PO(y,r.ic(f));l==null&&(l={nullValue:"NULL_VALUE"}),c.push(l),f++}return{arrayValue:{values:c}}}(t,e)}return function(i,r){if((i=Ts(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return xX(r.M,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const c=Ar.fromDate(i);return{timestampValue:zy(r.M,c)}}if(i instanceof Ar){const c=new Ar(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:zy(r.M,c)}}if(i instanceof $E)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof ud)return{bytesValue:eO(r.M,i._byteString)};if(i instanceof xs){const c=r.databaseId,f=i.firestore._databaseId;if(!f.isEqual(c))throw r.rc(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${c.projectId}/${c.database}`);return{referenceValue:SE(i.firestore._databaseId||r.databaseId,i._key.path)}}throw r.rc(`Unsupported field value: ${FE(i)}`)}(t,e)}function RO(t,e){const i={};return zL(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):kd(t,(r,c)=>{const f=PO(c,e.tc(r));f!=null&&(i[r]=f)}),{mapValue:{fields:i}}}function LO(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Ar||t instanceof $E||t instanceof ud||t instanceof xs||t instanceof kO)}function OO(t,e,i){if(!LO(i)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(i)){const r=FE(i);throw r==="an object"?e.rc(t+" a custom object"):e.rc(t+" "+r)}}function MY(t,e,i){if((e=Ts(e))instanceof VE)return e._internalPath;if(typeof e=="string")return zO(t,e);throw Fy("Field path arguments must be of type string or ",t,!1,void 0,i)}const kY=new RegExp("[~\\*/\\[\\]]");function zO(t,e,i){if(e.search(kY)>=0)throw Fy(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,i);try{return new VE(...e.split("."))._internalPath}catch{throw Fy(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,i)}}function Fy(t,e,i,r,c){const f=r&&!r.isEmpty(),y=c!==void 0;let l=`Function ${e}() called with invalid data`;i&&(l+=" (via `toFirestore()`)"),l+=". ";let I="";return(f||y)&&(I+=" (found",f&&(I+=` in field ${r}`),y&&(I+=` in document ${c}`),I+=")"),new jt(et.INVALID_ARGUMENT,l+t+I)}function DY(t,e){return t.some(i=>i.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NO{constructor(e,i,r,c,f){this._firestore=e,this._userDataWriter=i,this._key=r,this._document=c,this._converter=f}get id(){return this._key.path.lastSegment()}get ref(){return new xs(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new PY(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(FO("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class PY extends NO{data(){return super.data()}}function FO(t,e){return typeof e=="string"?zO(t,e):e instanceof VE?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class BO extends NO{constructor(e,i,r,c,f,y){super(e,i,r,c,y),this._firestore=e,this._firestoreImpl=e,this.metadata=f}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new qg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const r=this._document.data.field(FO("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,i.serverTimestamps)}}}class qg extends BO{data(e={}){return super.data(e)}}class RY{constructor(e,i,r,c){this._firestore=e,this._userDataWriter=i,this._snapshot=c,this.metadata=new gp(c.hasPendingWrites,c.fromCache),this.query=r}get docs(){const e=[];return this.forEach(i=>e.push(i)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach(r=>{e.call(i,new qg(this._firestore,this._userDataWriter,r.key,r,new gp(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new jt(et.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(r,c){if(r._snapshot.oldDocs.isEmpty()){let f=0;return r._snapshot.docChanges.map(y=>({type:"added",doc:new qg(r._firestore,r._userDataWriter,y.doc.key,y.doc,new gp(r._snapshot.mutatedKeys.has(y.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:f++}))}{let f=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(y=>c||y.type!==3).map(y=>{const l=new qg(r._firestore,r._userDataWriter,y.doc.key,y.doc,new gp(r._snapshot.mutatedKeys.has(y.doc.key),r._snapshot.fromCache),r.query.converter);let I=-1,C=-1;return y.type!==0&&(I=f.indexOf(y.doc.key),f=f.delete(y.doc.key)),y.type!==1&&(f=f.add(y.doc),C=f.indexOf(y.doc.key)),{type:LY(y.type),doc:l,oldIndex:I,newIndex:C}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function LY(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ai()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OY(t){if(Ry(t)&&t.explicitOrderBy.length===0)throw new jt(et.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zY{convertValue(e,i="none"){switch(lu(e)){case 0:return null;case 1:return e.booleanValue;case 2:return On(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(nd(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 10:return this.convertObject(e.mapValue,i);default:throw ai()}}convertObject(e,i){const r={};return kd(e.fields,(c,f)=>{r[c]=this.convertValue(f,i)}),r}convertGeoPoint(e){return new $E(On(e.latitude),On(e.longitude))}convertArray(e,i){return(e.values||[]).map(r=>this.convertValue(r,i))}convertServerTimestamp(e,i){switch(i){case"previous":const r=FL(e);return r==null?null:this.convertValue(r,i);case"estimate":return this.convertTimestamp(rm(e));default:return null}}convertTimestamp(e){const i=Dl(e);return new Ar(i.seconds,i.nanos)}convertDocumentKey(e,i){const r=yn.fromString(e);cn(rO(r));const c=new rd(r.get(1),r.get(3)),f=new Vt(r.popFirst(5));return c.isEqual(i)||kl(`Document ${f} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NY(t,e,i){let r;return r=t?i&&(i.merge||i.mergeFields)?t.toFirestore(e,i):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l7(t){t=cd(t,xs);const e=cd(t.firestore,Wv);return xY(UE(e),t._key).then(i=>BY(e,t,i))}class UO extends zY{constructor(e){super(),this.firestore=e}convertBytes(e){return new ud(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new xs(this.firestore,null,i)}}function c7(t){t=cd(t,qv);const e=cd(t.firestore,Wv),i=UE(e),r=new UO(e);return OY(t._query),bY(i,t._query).then(c=>new RY(e,r,t,c))}function u7(t,e,i){t=cd(t,xs);const r=cd(t.firestore,Wv),c=NY(t.converter,e,i);return FY(r,[CY(AY(r),"setDoc",t._key,c,t.converter!==null,i).toMutation(t._key,Uh.none())])}function FY(t,e){return function(i,r){const c=new Ia;return i.asyncQueue.enqueueAndForget(async()=>rY(await vY(i),r,c)),c.promise}(UE(t),e)}function BY(t,e,i){const r=i.docs.get(e._key),c=new UO(t);return new BO(t,c,e._key,r,new gp(i.hasPendingWrites,i.fromCache),e.converter)}(function(t,e=!0){(function(i){Md=i})(pu),Ns(new Is("firestore",(i,{options:r})=>{const c=i.getProvider("app").getImmediate(),f=new Wv(c,new jZ(i.getProvider("auth-internal")),new HZ(i.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:e},r),f._setSettings(r),f},"PUBLIC")),Ir(gM,"3.4.8",t),Ir(gM,"3.4.8","esm2017")})();const UY={apiKey:"AIzaSyAiDKevHPkyVn9Q7BzmKowbAr4rHL_Qz8Y",authDomain:"test-authendication-project.firebaseapp.com",databaseURL:"https://test-authendication-project-default-rtdb.firebaseio.com",projectId:"test-authendication-project",storageBucket:"test-authendication-project.appspot.com",messagingSenderId:"508647974331",appId:"1:508647974331:web:16bba0edc8908c3b10509e",measurementId:"G-FBVHLXY6ZL"},VY=uj(UY);RK(VY);const VO=i$(_q);VO.use(eP);VO.mount("#app");export{Vw as A,c7 as B,s7 as C,a7 as D,l7 as E,ga as F,vl as G,u7 as H,GY as I,qY as J,JY as K,o7 as T,Oo as _,Gk as a,as as b,HY as c,ZY as d,KY as e,v5 as f,dk as g,UD as h,WY as i,e7 as j,t7 as k,mq as l,uj as m,n7 as n,Uk as o,Ck as p,QY as q,f5 as r,i7 as s,jY as t,pq as u,YY as v,P4 as w,wp as x,XY as y,r7 as z};
