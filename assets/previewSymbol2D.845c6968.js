var R=Object.defineProperty,W=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var E=(t,e,o)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,S=(t,e)=>{for(var o in e||(e={}))U.call(e,o)&&E(t,o,e[o]);if(q)for(var o of q(e))G.call(e,o)&&E(t,o,e[o]);return t},j=(t,e)=>W(t,B(e));import{ib as k,x as p,ic as I,id as J,bf as K,e as N,ie as O,ig as D,ih as Q,ii as X,bc as Y}from"./GISSearch.b73a2371.js";import"./index.8ac88fb7.js";import"./ProjectWeberRenew.dc78a7b0.js";import"./plugin-vue_export-helper.21dcd24c.js";const H="picture-fill",_="picture-marker",$="simple-fill",ee="simple-line",te="simple-marker",le="text",ae="Aa",ne=k.size,L=k.maxSize,T=k.maxOutlineSize,ie=k.lineWidth,oe=document.createElement("canvas");function se(t,e){const o=oe.getContext("2d"),f=[];return e&&(e.weight&&f.push(e.weight),e.size&&f.push(e.size+"px"),e.family&&f.push(e.family)),o.font=f.join(" "),o.measureText(t).width}const ce=7.2/2.54,ue=72/2.54;function me(t){if(t.length===0)return 0;if(t.length>2){const e=Y(1),o=parseFloat(t);switch(t.slice(-2)){case"px":return o;case"pt":return o*e;case"in":return 72*o*e;case"pc":return 12*o*e;case"mm":return o*ce*e;case"cm":return o*ue*e}}return parseFloat(t)}function V(t){const e=t==null?void 0:t.size;return{width:e!=null&&typeof e=="object"&&"width"in e?p(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?p(e.height):null}}function ve(t,e){var o,f;const C=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,h=C!=null?p(C):null,b=(e==null?void 0:e.maxSize)!=null?p(e.maxSize):null,A=(e==null?void 0:e.opacity)!=null?e.opacity:null,y=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in t?t.angle:null,v=I(t);let d=J(t);if(v&&!d){const i="type"in v?null:new K(v);(i?i.toHex():null)==="#ffffff"&&(d={color:"#bdc3c7",width:.75})}const c={shape:null,fill:null,stroke:d,offset:[0,0]};(o=d)!=null&&o.width&&(d.width=Math.min(d.width,T));const u=((f=d)==null?void 0:f.width)||0;let r=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),l=0,a=0,w=!1;switch(t.type){case te:{const i=t.style,s=Math.min(h!=null?h:p(t.size),b||L);switch(l=s,a=s,i){case"circle":c.shape={type:"circle",cx:0,cy:0,r:.5*s},r||(l+=u,a+=u);break;case"cross":c.shape={type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[l,.5*a]},{command:"M",values:[.5*l,0]},{command:"L",values:[.5*l,a]}]};break;case"diamond":c.shape={type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*l,0]},{command:"L",values:[l,.5*a]},{command:"L",values:[.5*l,a]},{command:"Z",values:[]}]},r||(l+=u,a+=u);break;case"square":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]},r||(l+=u,a+=u),y&&(w=!0);break;case"triangle":c.shape={type:"path",path:[{command:"M",values:[.5*l,0]},{command:"L",values:[l,a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]},r||(l+=u,a+=u),y&&(w=!0);break;case"x":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,a]},{command:"M",values:[l,0]},{command:"L",values:[0,a]}]},y&&(w=!0);break;case"path":c.shape={type:"path",path:t.path||""},r||(l+=u,a+=u),y&&(w=!0),r=!0}break}case ee:{var F;const{width:i,height:s}=V(e),n=s!=null?s:Math.min(h!=null?h:u,b||T),m=i!=null?i:ie;d.width=n,l=m,a=n;const M=(c==null||(F=c.stroke)==null?void 0:F.cap)||"butt",x=M==="round";r=!0,c.stroke.cap=M==="butt"?"square":M,c.shape={type:"path",path:[{command:"M",values:[x?n/2:0,a/2]},{command:"L",values:[x?l-n/2:l,a/2]}]};break}case H:case $:{const i=typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.isSquareFill),{width:s,height:n}=V(e);l=i&&s!=null?s:h!=null?h:ne,a=i&&n!=null?n:l,r||(l+=u,a+=u),r=!0,c.shape=i?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[l,0]},{command:"L",values:[l,a]},{command:"L",values:[0,a]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:X.fill[0];break}case _:{let i=p(t.width),s=p(t.height);const n=h!=null?h:Math.max(i,s),m=i/s;i=m<=1?Math.ceil(n*m):n,s=m<=1?n:Math.ceil(n/m),l=Math.min(i,b||L),a=Math.min(s,b||L),c.shape={type:"image",x:-Math.round(l/2),y:-Math.round(a/2),width:l,height:a,src:t.url||""},y&&(w=!0);break}case le:{const i=t,s=i.text||ae,n=i.font,m=Math.min(h!=null?h:p(n.size),b||L),M=se(s,{weight:n.weight,size:m,family:n.family}),x=/[\uE600-\uE6FF]/.test(s);l=x?m:M,a=m;let Z=.25*me((n?m:0).toString());x&&(Z+=5),c.shape={type:"text",text:s,x:0,y:Z,align:"middle",decoration:n&&n.decoration,rotated:i.rotated,kerning:i.kerning},c.font=n&&{size:m,style:n.style,decoration:n.decoration,weight:n.weight,family:n.family};break}}if(!c.shape)return Promise.reject(new N("symbolPreview: renderPreviewHTML2D","symbol not supported."));const g=v,P=t.color;let z=null;return g&&g.type==="pattern"&&P&&t.type!==H?z=O(g.src,P.toCss(!0)).then(i=>(g.src=i,c.fill=g,c)):(c.fill=v,z=Promise.resolve(c)),z.then(i=>{const s=[[i]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&e!=null&&e.symbolConfig.applyColorModulation){const n=.6*l;s.unshift([j(S({},i),{offset:[-n,0],fill:D(v,-.3)})]),s.push([j(S({},i),{offset:[n,0],fill:D(v,.3)})]),l+=2*n,r=!1}return Q(s,[l,a],{node:e&&e.node,scale:r,opacity:A,rotation:y,useRotationSize:w,effectView:e==null?void 0:e.effectView})})}export{ve as previewSymbol2D};
